<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.105.0">
<link rel="canonical" type="text/html" href="https://gkcalat.github.io/kubeflow-docs/docs/components/pipelines/v1/sdk/">
<link rel="alternate" type="application/rss&#43;xml" href="https://gkcalat.github.io/kubeflow-docs/docs/components/pipelines/v1/sdk/index.xml">
<meta name="robots" content="noindex, nofollow">

<script type="application/ld+json">
  {
      "@context" : "http://schema.org",
      "@type" : "WebSite",
      "mainEntityOfPage": {
           "@type": "WebPage",
           "@id": "https:\/\/gkcalat.github.io\/kubeflow-docs"
      },
      "articleSection" : "docs",
      "name" : "Pipelines SDK",
      "headline" : "Pipelines SDK",
      "description" : "Information about the Kubeflow Pipelines SDK",
      "inLanguage" : "en-US",
      "author" : "",
      "creator" : "",
      "publisher": "",
      "accountablePerson" : "",
      "copyrightHolder" : "",
      "copyrightYear" : "0001",
      "datePublished": "0001-01-01 00:00:00 \u002b0000 UTC",
      "dateModified" : "0001-01-01 00:00:00 \u002b0000 UTC",
      "url" : "https:\/\/gkcalat.github.io\/kubeflow-docs\/docs\/components\/pipelines\/v1\/sdk\/",
      "wordCount" : "0",
      "keywords" : [ "Kubeflow" ]
  }
  </script>

<link rel="shortcut icon" href="/kubeflow-docs/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/kubeflow-docs/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/kubeflow-docs/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/kubeflow-docs/favicons/favicon-32x32.png" sizes="32x32">
<link rel="manifest" href="/kubeflow-docs/favicons/manifest.json">
<meta name="msapplication-config" content="/kubeflow-docs/favicons/browserconfig.xml" />
<meta name="msapplication-TileColor" content="#4279f4">
<meta name="theme-color" content="#4279f4">

<title>Pipelines SDK | Kubeflow on Google Cloud Platform</title>
<meta name="description" content="Information about the Kubeflow Pipelines SDK">
<meta property="og:title" content="Pipelines SDK" />
<meta property="og:description" content="Information about the Kubeflow Pipelines SDK" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://gkcalat.github.io/kubeflow-docs/docs/components/pipelines/v1/sdk/" /><meta property="og:site_name" content="Kubeflow on Google Cloud Platform" />

<meta itemprop="name" content="Pipelines SDK">
<meta itemprop="description" content="Information about the Kubeflow Pipelines SDK"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Pipelines SDK"/>
<meta name="twitter:description" content="Information about the Kubeflow Pipelines SDK"/>




<link rel="preload" href="/kubeflow-docs/scss/main.min.5006b434b14f73c3d5537a7ba4c8ecef723ddc93f3a3c8530e19d24f75486ea9.css" as="style">
<link href="/kubeflow-docs/scss/main.min.5006b434b14f73c3d5537a7ba4c8ecef723ddc93f3a3c8530e19d24f75486ea9.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-GK9XL47N6S"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-GK9XL47N6S', { 'anonymize_ip': false });
}
</script>

  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand-md navbar-dark  td-navbar">
        <a class="navbar-brand" href="/kubeflow-docs/">
		<span class="navbar-logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 276.93 274.55"><g data-name="Layer 2"><g data-name="Layer 1"><path d="M95.9 62.15l4.1 102.1 73.75-94.12a6.79 6.79.0 019.6-1.11l46 36.92-15-65.61z" fill="#4279f4"/><path fill="#0028aa" d="M102.55 182.98h65.42l-40.17-32.23-25.25 32.23z"/><path fill="#014bd1" d="M180.18 83.92l-44 56.14 46.88 37.61 44.47-55.76-47.35-37.99z"/><path fill="#bedcff" d="M83.56 52.3l.01-.01 38.69-48.52-62.39 30.05-15.41 67.51 39.1-49.03z"/><path fill="#6ca1ff" d="M45.32 122.05l41.44 51.96-3.95-98.98-37.49 47.02z"/><path fill="#a1c3ff" d="M202.31 28.73 142.65.0l-37.13 46.56 96.79-17.83z"/><path d="M1.6 272v-44.78h5.74v23.41l20.48-23.41h6.4l-17.39 19.7 19 25.07H29.1l-15.92-20.8-5.84 6.65V272zm40.02-9.79V240h5.43v22.39a4.67 4.67.0 002.35 4.19 11 11 0 0011 0 4.69 4.69.0 002.33-4.19V240h5.43v22.19a9.08 9.08.0 01-4.1 7.87 16.2 16.2.0 01-18.37.0 9.07 9.07.0 01-4.07-7.85zM77.46 272v-48h5.43v16.81a29.29 29.29.0 019.32-1.73 13.1 13.1.0 016.2 1.41 10.71 10.71.0 014.18 3.74 18.07 18.07.0 012.23 5.06 21.26 21.26.0 01.73 5.58q0 8.43-4.38 12.79T87.35 272zm5.43-4.87h4.55q6.77.0 9.72-2.95t3-9.51a14.21 14.21.0 00-2-7.52 6.55 6.55.0 00-6-3.22 24.73 24.73.0 00-9.25 1.54zm29.47-11.19q0-7.71 4.09-12.3a13.75 13.75.0 0110.8-4.59q13.35.0 13.36 18.86h-22.82a12.3 12.3.0 002.9 7.07q2.59 3.11 7.9 3.1a24.92 24.92.0 0010.55-2v5a27.74 27.74.0 01-9.86 1.87 19.83 19.83.0 01-7.7-1.37 13.31 13.31.0 01-5.28-3.76 16.21 16.21.0 01-3-5.38 20.84 20.84.0 01-.94-6.5zm5.62-2.12h17.26a14.91 14.91.0 00-2.37-7.12 6.44 6.44.0 00-5.62-2.78 8.2 8.2.0 00-6.21 2.72 12.07 12.07.0 00-3.04 7.18z" fill="#4279f4" stroke="#4279f4" stroke-miterlimit="10" stroke-width="3.2"/><path d="M147.32 244.89V240h5v-7.59a8.14 8.14.0 012.31-6.05 7.79 7.79.0 015.69-2.28h7.86V229h-5c-2.21.0-3.67.45-4.37 1.34s-1.06 2.55-1.06 5V240h8.46v4.87h-8.46V272h-5.44v-27.1zM175.26 272v-48h5.43v48zm19.15-3.95a17.86 17.86.0 1112.33 4.9 16.57 16.57.0 01-12.33-4.9zm3.84-20.65a13.16 13.16.0 000 17.2 12.07 12.07.0 0017 0 13.09 13.09.0 000-17.2 12.07 12.07.0 00-17 0zm30.2-7.4h5.75l7.3 25.32 7.43-25.32h5.36l7.34 25.34L269 240h5.74l-10.04 32h-6.12l-6.83-24.58L245 272h-6.47z" fill="#0028aa" stroke="#0028aa" stroke-miterlimit="10" stroke-width="3.2"/></g></g></svg></span><span class="text-uppercase font-weight-bold">Kubeflow on Google Cloud Platform</span>
	</a>
	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main_navbar" aria-controls="main_navbar" aria-expanded="false" aria-label="Toggle navigation">
		<span class="navbar-toggler-icon"></span>
	</button>
	<div class="collapse navbar-collapse ml-md-auto" id="main_navbar">
		<ul class="navbar-nav ml-auto pt-4 pt-md-0 my-2 my-md-1">
			
			
			<li class="nav-item mr-2 mr-lg-4 mt-1 mt-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/kubeflow-docs/docs/" ><span>Docs</span></a>
			</li>
			
			<li class="nav-item mr-2 mr-lg-4 mt-1 mt-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/kubeflow-docs/news/" ><span>News</span></a>
			</li>
			
			<li class="nav-item mr-2 mr-lg-4 mt-1 mt-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="https://github.com/GoogleCloudPlatform/kubeflow-distribution" target="_blank" ><i class='fa-brands fa-github pr-2'></i><span>Source</span></a>
			</li>
			
			
			<li class="nav-item dropdown mt-1 mt-lg-0 mr-2">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	Releases
</a>
<div class="dropdown-menu dropdown-menu-md-right dropdown-menu-lg-left" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/v1.6-release/docs">latest</a>
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/v1.6-release/docs">v1.6</a>
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/v1.5-release/docs">v1.5</a>
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/v1.4-release/docs">v1.4</a>
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/main/docs">dev</a>
	
</div>

			</li>
			
			
		</ul>
	</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/kubeflow-docs/docs/components/pipelines/v1/sdk/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Pipelines SDK</h1>
<div class="lead">Information about the Kubeflow Pipelines SDK</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-4c4cc1220583c8dadcf45ac61da1c89f">Introduction to the Pipelines SDK</a></li>


    
  
    
    
	
<li>2: <a href="#pg-18204851ea0a52843d149feaa73750b8">Install the Kubeflow Pipelines SDK</a></li>


    
  
    
    
	
<li>3: <a href="#pg-16043ffea1aee8a9b986cc1dc4598463">Connect the Pipelines SDK to Kubeflow Pipelines</a></li>


    
  
    
    
	
<li>4: <a href="#pg-95de41d77d62a53dd61ef8fe4dcf3c80">Build a Pipeline</a></li>


    
  
    
    
	
<li>5: <a href="#pg-201764e91fc94af83f5f9784d2243490">Building Components</a></li>


    
  
    
    
	
<li>6: <a href="#pg-ec0a69a45422dd2b502a48a36d15bf24">Building Python function-based components</a></li>


    
  
    
    
	
<li>7: <a href="#pg-affaa52b1b38b301a656c06f43992a9c">Best Practices for Designing Components</a></li>


    
  
    
    
	
<li>8: <a href="#pg-6a9a2a321d5959620aa38f3f01399c97">Pipeline Parameters</a></li>


    
  
    
    
	
<li>9: <a href="#pg-6c3616d054a1d9bb69a6a3e81e532406">Visualize Results in the Pipelines UI</a></li>


    
  
    
    
	
<li>10: <a href="#pg-6290e41c026254218090f8aba54b9598">Pipeline Metrics</a></li>


    
  
    
    
	
<li>11: <a href="#pg-4539e2425322e75e85f28e46fbd56edf">DSL Static Type Checking</a></li>


    
  
    
    
	
<li>12: <a href="#pg-db2b3d927ec2c0b7fed0512c94bc61ae">DSL Recursion</a></li>


    
  
    
    
	
<li>13: <a href="#pg-6a0dc6801800a3b5b8b4c7cb9a1d4104">Using environment variables in pipelines</a></li>


    
  
    
    
	
<li>14: <a href="#pg-ad66bcbcfacb2647b3a55cba3d1e76c6">GCP-specific Uses of the SDK</a></li>


    
  
    
    
	
<li>15: <a href="#pg-af8ccd9f5dc570d16c52b5d3e0ba2cf5">Kubeflow Pipelines SDK for Tekton</a></li>


    
  
    
    
	
<li>16: <a href="#pg-1399671edb649a321c5d364b2a3c2218">Manipulate Kubernetes Resources as Part of a Pipeline</a></li>


    
  
    
    
	
<li>17: <a href="#pg-67b05544f3675abcc53d37062cf6583a">Python Based Visualizations (Deprecated)</a></li>


    
  
    
    
	
<li>18: <a href="#pg-6b0621ddf48d2bc7b2827f237fb1eebf"></a></li>


    
  

    </ul>


<div class="content">
      
</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-4c4cc1220583c8dadcf45ac61da1c89f">1 - Introduction to the Pipelines SDK</h1>
    <div class="lead">Overview of using the SDK to build components and pipelines</div>
	<div class="alert alert-primary" role="alert">
This Kubeflow component has <b>stable</b> status. See the
<a href="/docs/started/support/#application-status">Kubeflow versioning policies</a>.
</div>
<p>The <a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.html">Kubeflow Pipelines
SDK</a>
provides a set of Python packages that you can use to specify and run your
machine learning (ML) workflows. A <em>pipeline</em> is a description of an ML
workflow, including all of the <em>components</em> that make up the steps in the
workflow and how the components interact with each other.</p>
<p><strong>Note</strong>: The SDK documentation here refers to <a href="https://github.com/kubeflow/pipelines">Kubeflow Pipelines with Argo</a> which is the default.
If you are running <a href="https://github.com/kubeflow/kfp-tekton">Kubeflow Pipelines with Tekton</a> instead,
please follow the <a href="/docs/components/pipelines/sdk/pipelines-with-tekton">Kubeflow Pipelines SDK for Tekton</a> documentation.</p>
<h2 id="sdk-packages">SDK packages</h2>
<p>The Kubeflow Pipelines SDK includes the following packages:</p>
<ul>
<li>
<p><a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.compiler.html"><code>kfp.compiler</code></a>
includes classes and methods for compiling pipeline Python DSL into a workflow yaml spec
Methods in this package include, but are not limited
to, the following:</p>
<ul>
<li><code>kfp.compiler.Compiler.compile</code> compiles your Python DSL code into a single
static configuration (in YAML format) that the Kubeflow Pipelines service
can process. The Kubeflow Pipelines service converts the static
configuration into a set of Kubernetes resources for execution.</li>
</ul>
</li>
<li>
<p><a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.components.html"><code>kfp.components</code></a>
includes classes and methods for interacting with pipeline components.
Methods in this package include, but are not limited to, the following:</p>
<ul>
<li>
<p><code>kfp.components.func_to_container_op</code> converts a Python function to a
pipeline component and returns a factory function.
You can then call the factory function to construct an instance of a
pipeline task
(<a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.dsl.html#kfp.dsl.ContainerOp"><code>ContainerOp</code></a>)
that runs the original function in a container.</p>
</li>
<li>
<p><code>kfp.components.load_component_from_file</code> loads a pipeline component from
a file and returns a factory function.
You can then call the factory function to construct an instance of a
pipeline task
(<a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.dsl.html#kfp.dsl.ContainerOp"><code>ContainerOp</code></a>)
that runs the component container image.</p>
</li>
<li>
<p><code>kfp.components.load_component_from_url</code> loads a pipeline component from
a URL and returns a factory function.
You can then call the factory function to construct an instance of a
pipeline task
(<a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.dsl.html#kfp.dsl.ContainerOp"><code>ContainerOp</code></a>)
that runs the component container image.</p>
</li>
</ul>
</li>
<li>
<p><a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.dsl.html"><code>kfp.dsl</code></a>
contains the domain-specific language (DSL) that you can use to define and
interact with pipelines and components.
Methods, classes, and modules in this package include, but are not limited to,
the following:</p>
<ul>
<li>
<p><code>kfp.dsl.PipelineParam</code> represents a pipeline parameter that you can pass
from one pipeline component to another. See the guide to
<a href="/docs/components/pipelines/sdk/parameters/">pipeline parameters</a>.</p>
</li>
<li>
<p><code>kfp.dsl.component</code> is a decorator for DSL functions that returns a
pipeline component.
(<a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.dsl.html#kfp.dsl.ContainerOp"><code>ContainerOp</code></a>).</p>
</li>
<li>
<p><code>kfp.dsl.pipeline</code> is a decorator for Python functions that returns a
pipeline.</p>
</li>
<li>
<p><code>kfp.dsl.python_component</code> is a decorator for Python functions that adds
pipeline component metadata to the function object.</p>
</li>
<li>
<p><a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.dsl.types.html"><code>kfp.dsl.types</code></a>
contains a list of types defined by the Kubeflow Pipelines SDK. Types
include basic types like <code>String</code>, <code>Integer</code>, <code>Float</code>, and <code>Bool</code>, as well
as domain-specific types like <code>GCPProjectID</code> and <code>GCRPath</code>.
See the guide to
<a href="/docs/components/pipelines/sdk/static-type-checking">DSL static type checking</a>.</p>
</li>
<li>
<p><a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.dsl.html#kfp.dsl.ResourceOp"><code>kfp.dsl.ResourceOp</code></a>
represents a pipeline task (op) which lets you directly manipulate
Kubernetes resources (<code>create</code>, <code>get</code>, <code>apply</code>, &hellip;).</p>
</li>
<li>
<p><a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.dsl.html#kfp.dsl.VolumeOp"><code>kfp.dsl.VolumeOp</code></a>
represents a pipeline task (op) which creates a new <code>PersistentVolumeClaim</code>
(PVC). It aims to make the common case of creating a <code>PersistentVolumeClaim</code>
fast.</p>
</li>
<li>
<p><a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.dsl.html#kfp.dsl.VolumeSnapshotOp"><code>kfp.dsl.VolumeSnapshotOp</code></a>
represents a pipeline task (op) which creates a new <code>VolumeSnapshot</code>. It
aims to make the common case of creating a <code>VolumeSnapshot</code> fast.</p>
</li>
<li>
<p><a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.dsl.html#kfp.dsl.PipelineVolume"><code>kfp.dsl.PipelineVolume</code></a>
represents a volume used to pass data between pipeline steps. <code>ContainerOp</code>s
can mount a <code>PipelineVolume</code> either via the constructor&rsquo;s argument
<code>pvolumes</code> or <code>add_pvolumes()</code> method.</p>
</li>
<li>
<p><a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.dsl.html#kfp.dsl.ParallelFor"><code>kfp.dsl.ParallelFor</code></a>
represents a parallel for loop over a static or dynamic set of items in a pipeline.
Each iteration of the for loop is executed in parallel.</p>
</li>
<li>
<p><a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.dsl.html#kfp.dsl.ExitHandler"><code>kfp.dsl.ExitHandler</code></a>
represents an exit handler that is invoked upon exiting a pipeline. A typical
usage of <code>ExitHandler</code> is garbage collection.</p>
</li>
<li>
<p><a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.dsl.html#kfp.dsl.Condition"><code>kfp.dsl.Condition</code></a>
represents a group of ops, that will only be executed when a certain condition is met.
The condition specified need to be determined at runtime, by incorporating at least one task output,
or PipelineParam in the boolean expression.</p>
</li>
</ul>
</li>
<li>
<p><a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.client.html"><code>kfp.Client</code></a>
contains the Python client libraries for the <a href="/docs/components/pipelines/reference/api/kubeflow-pipeline-api-spec/">Kubeflow Pipelines
API</a>.
Methods in this package include, but are not limited to, the following:</p>
<ul>
<li><code>kfp.Client.create_experiment</code> creates a pipeline
<a href="/docs/components/pipelines/concepts/experiment/">experiment</a> and returns an
experiment object.</li>
<li><code>kfp.Client.run_pipeline</code> runs a pipeline and returns a run object.</li>
<li><code>kfp.Client.create_run_from_pipeline_func</code> compiles a pipeline function and submits it
for execution on Kubeflow Pipelines.</li>
<li><code>kfp.Client.create_run_from_pipeline_package</code> runs a local pipeline package on Kubeflow Pipelines.</li>
<li><code>kfp.Client.upload_pipeline</code> uploads a local file to create a new pipeline in Kubeflow Pipelines.</li>
<li><code>kfp.Client.upload_pipeline_version</code> uploads a local file to create a pipeline version. <a href="/docs/components/pipelines/tutorials/sdk-examples">Follow an example to learn more about creating a pipeline version</a>.</li>
</ul>
</li>
<li>
<p><a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.extensions.html">Kubeflow Pipelines extension modules</a>
include classes and functions for specific platforms on which you can use
Kubeflow Pipelines. Examples include utility functions for on premises,
Google Cloud Platform (GCP), Amazon Web Services (AWS), and Microsoft Azure.</p>
</li>
<li>
<p><a href="https://github.com/kubeflow/pipelines/tree/sdk/release-1.8/sdk/python/kfp/cli/diagnose_me">Kubeflow Pipelines diagnose_me modules</a> include classes and functions that help with environment diagnostic tasks.</p>
<ul>
<li><code>kfp.cli.diagnose_me.dev_env</code> reports on diagnostic metadata from your development environment, such as your python library version.</li>
<li><code>kfp.cli.diagnose_me.kubernetes_cluster</code> reports on diagnostic data from your Kubernetes cluster, such as Kubernetes secrets.</li>
<li><code>kfp.cli.diagnose_me.gcp</code> reports on diagnostic data related to your GCP environment.</li>
</ul>
</li>
</ul>
<h2 id="kubeflow-pipelines-cli-tool">Kubeflow Pipelines CLI tool</h2>
<p>The Kubeflow Pipelines CLI tool enables you to use a subset of the Kubeflow Pipelines SDK directly from the command line. The Kubeflow Pipelines CLI tool provides the following commands:</p>
<ul>
<li>
<p><code>kfp diagnose_me</code> runs environment diagnostic with specified parameters.</p>
<ul>
<li><code>--json</code> - Indicates that this command must return its results as JSON. Otherwise, results are returned in human readable format.</li>
<li><code>--namespace TEXT</code> - Specifies the Kubernetes namespace to use. all-namespaces is the default value.</li>
<li><code>--project-id TEXT</code> - For GCP deployments, this value specifies the GCP project to use. If this value is not specified, the environment default is used.</li>
</ul>
</li>
<li>
<p><code>kfp pipeline &lt;COMMAND&gt;</code> provides the following commands to help you manage pipelines.</p>
<ul>
<li><code>get</code>  - Gets detailed information about a Kubeflow pipeline from your Kubeflow Pipelines cluster.</li>
<li><code>list</code> - Lists the pipelines that have been uploaded to your Kubeflow Pipelines cluster.</li>
<li><code>upload</code> - Uploads a pipeline to your Kubeflow Pipelines cluster.</li>
</ul>
</li>
<li>
<p><code>kfp run &lt;COMMAND&gt;</code> provides the following commands to help you manage pipeline runs.</p>
<ul>
<li><code>get</code> - Displays the details of a pipeline run.</li>
<li><code>list</code> - Lists recent pipeline runs.</li>
<li><code>submit</code> - Submits a pipeline run.</li>
</ul>
</li>
<li>
<p><code>kfp --endpoint &lt;ENDPOINT&gt;</code> - Specifies the endpoint that the Kubeflow Pipelines CLI should connect to.</p>
</li>
</ul>
<h2 id="installing-the-sdk">Installing the SDK</h2>
<p>Follow the guide to
<a href="/docs/components/pipelines/sdk/install-sdk/">installing the Kubeflow Pipelines SDK</a>.</p>
<h2 id="building-pipelines-and-components">Building pipelines and components</h2>
<p>This section summarizes the ways you can use the SDK to build pipelines and
components.</p>
<p>A Kubeflow <em>pipeline</em> is a portable and scalable definition of an ML workflow.
Each step in your ML workflow, such as preparing data or training a model,
is an instance of a pipeline component.</p>
<p><a href="/docs/components/pipelines/sdk/build-pipeline">Learn more about building pipelines</a>.</p>
<p>A pipeline <em>component</em> is a self-contained set of code that performs one step
in your ML workflow. Components are defined in a component specification, which
defines the following:</p>
<ul>
<li>The component’s interface, its inputs and outputs.</li>
<li>The component’s implementation, the container image and the command to
execute.</li>
<li>The component’s metadata, such as the name and description of the
component.</li>
</ul>
<p>Use the following options to create or reuse pipeline components.</p>
<ul>
<li>
<p>You can build components by defining a component specification for a
containerized application.</p>
<p><a href="/docs/components/pipelines/sdk/component-development">Learn more about building pipeline components</a>.</p>
</li>
<li>
<p>Lightweight Python function-based components make it easier to build a
component by using the Kubeflow Pipelines SDK to generate the component
specification for a Python function.</p>
<p><a href="/docs/components/pipelines/sdk/python-function-components">Learn how to build a Python function-based component</a>.</p>
</li>
<li>
<p>You can reuse prebuilt components in your pipeline.</p>
<p><a href="/docs/examples/shared-resources/">Learn more about reusing prebuilt components</a>.</p>
</li>
</ul>
<h2 id="next-steps">Next steps</h2>
<ul>
<li>Learn how to <a href="/docs/components/pipelines/sdk/dsl-recursion">write recursive functions in the
DSL</a>.</li>
<li>Build a <a href="/docs/components/pipelines/sdk/component-development/">pipeline component</a>.</li>
<li>Find out how to use the DSL to <a href="/docs/components/pipelines/sdk/manipulate-resources/">manipulate Kubernetes resources dynamically
as steps of your pipeline</a>.</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-18204851ea0a52843d149feaa73750b8">2 - Install the Kubeflow Pipelines SDK</h1>
    <div class="lead">Setting up your Kubeflow Pipelines development environment</div>
	<p>This guide tells you how to install the
<a href="https://github.com/kubeflow/pipelines/tree/sdk/release-1.8/sdk">Kubeflow Pipelines SDK</a>
which you can use to build machine learning pipelines. You can use the SDK
to execute your pipeline, or alternatively you can upload the pipeline to
the Kubeflow Pipelines UI for execution.</p>
<p>All of the SDK&rsquo;s classes and methods are described in the auto-generated <a href="https://kubeflow-pipelines.readthedocs.io/en/stable/">SDK reference docs</a>.</p>
<p><strong>Note:</strong> If you are running <a href="https://github.com/kubeflow/kfp-tekton">Kubeflow Pipelines with Tekton</a>,
instead of the default <a href="https://github.com/kubeflow/pipelines">Kubeflow Pipelines with Argo</a>, you should use the
<a href="/docs/components/pipelines/sdk/pipelines-with-tekton">Kubeflow Pipelines SDK for Tekton</a>.</p>
<h2 id="set-up-python">Set up Python</h2>
<p>You need <strong>Python 3.5</strong> or later to use the Kubeflow Pipelines SDK. This
guide uses Python 3.7.</p>
<p>If you haven&rsquo;t yet set up a Python 3 environment, do so now. This guide
recommends <a href="https://conda.io/miniconda.html">Miniconda</a>, but you can use
a virtual environment manager of your choice, such as <code>virtualenv</code>.</p>
<p>Follow the steps below to set
up Python using <a href="https://conda.io/miniconda.html">Miniconda</a>:</p>
<ol>
<li>
<p>Choose one of the following methods to install Miniconda, depending on your
environment:</p>
<ul>
<li>
<p>Debian/Ubuntu/<a href="https://console.cloud.google.com/cloudshell">Cloud Shell</a>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">apt-get update<span class="p">;</span> apt-get install -y wget bzip2
</span></span><span class="line"><span class="cl">wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh
</span></span><span class="line"><span class="cl">bash Miniconda3-latest-Linux-x86_64.sh
</span></span></code></pre></div></li>
<li>
<p>Windows: Download the
<a href="https://repo.continuum.io/miniconda/Miniconda3-latest-Windows-x86_64.exe">installer</a>
and make sure you select the option to
<strong>Add Miniconda to my PATH environment variable</strong> during the installation.</p>
</li>
<li>
<p>MacOS: Download the
<a href="https://repo.continuum.io/miniconda/Miniconda3-latest-MacOSX-x86_64.sh">installer</a>
and run the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">bash Miniconda3-latest-MacOSX-x86_64.sh
</span></span></code></pre></div></li>
</ul>
</li>
<li>
<p>Check that the <code>conda</code> command is available:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">which conda
</span></span></code></pre></div><p>If the <code>conda</code> command is not found, add Miniconda to your path:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span>&lt;YOUR_MINICONDA_PATH&gt;/bin:<span class="nv">$PATH</span>
</span></span></code></pre></div></li>
<li>
<p>Create a clean Python 3 environment with a name of your choosing. This
example uses Python 3.7 and an environment name of <code>mlpipeline</code>.:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">conda create --name mlpipeline <span class="nv">python</span><span class="o">=</span>3.7
</span></span><span class="line"><span class="cl">conda activate mlpipeline
</span></span></code></pre></div></li>
</ol>
<h2 id="install-the-kubeflow-pipelines-sdk">Install the Kubeflow Pipelines SDK</h2>
<p>Run the following command to install the Kubeflow Pipelines SDK:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">pip3 install kfp --upgrade
</span></span></code></pre></div><p><strong>Note:</strong> If you are not using a virtual environment, such as <code>conda</code>, when installing the Kubeflow Pipelines SDK, you may receive the following error:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ERROR: Could not install packages due to an EnvironmentError: <span class="o">[</span>Errno 13<span class="o">]</span> Permission denied: <span class="s1">&#39;/usr/local/lib/python3.5/dist-packages/kfp-&lt;version&gt;.dist-info&#39;</span>
</span></span><span class="line"><span class="cl">Consider using the <span class="sb">`</span>--user<span class="sb">`</span> option or check the permissions.
</span></span></code></pre></div><p>If you get this error, install <code>kfp</code> with the <code>--user</code> option:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">pip3 install kfp --upgrade --user
</span></span></code></pre></div><p>This command installs the <code>dsl-compile</code> and <code>kfp</code> binaries under <code>~/.local/bin</code>, which is not part of the PATH in some Linux distributions, such as Ubuntu. You can add <code>~/.local/bin</code> to your PATH by appending the following to a new line at the end of your <code>.bashrc</code> file:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:~/.local/bin
</span></span></code></pre></div><p>After successful installation, the command <code>dsl-compile</code> should be available.
You can use this command to verify it:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">which dsl-compile
</span></span></code></pre></div><p>The response should be something like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/&lt;PATH_TO_YOUR_USER_BIN&gt;/miniconda3/envs/mlpipeline/bin/dsl-compile
</span></span></code></pre></div><h2 id="next-steps">Next steps</h2>
<ul>
<li><a href="/docs/components/pipelines/sdk/sdk-overview/">See how to use the SDK</a>.</li>
<li><a href="/docs/components/pipelines/sdk/component-development/">Build a component and a pipeline</a>.</li>
<li><a href="/docs/components/pipelines/overview/quickstart">Get started with the UI</a>.</li>
<li><a href="/docs/components/pipelines/concepts/">Understand pipeline concepts</a>.</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-16043ffea1aee8a9b986cc1dc4598463">3 - Connect the Pipelines SDK to Kubeflow Pipelines</h1>
    <div class="lead">How to connect the Pipelines SDK to Kubeflow Pipelines in various ways</div>
	<p>How to connect Pipelines SDK to Kubeflow Pipelines will depend on <strong>what kind</strong> of Kubeflow deployment you have, and <strong>from where you are running your code</strong>.</p>
<ul>
<li><a href="#full-kubeflow-subfrom-inside-clustersub">Full Kubeflow (from inside cluster)</a></li>
<li><a href="#full-kubeflow-subfrom-outside-clustersub">Full Kubeflow (from outside cluster)</a></li>
<li><a href="#standalone-kubeflow-pipelines-subfrom-inside-clustersub">Standalone Kubeflow Pipelines (from inside cluster)</a></li>
<li><a href="#standalone-kubeflow-pipelines-subfrom-outside-clustersub">Standalone Kubeflow Pipelines (from outside cluster)</a></li>
</ul>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Tip</h4>

    <p>Before you begin, you will need to:</p>
<ul>
<li><a href="/docs/components/pipelines/installation/overview/">Deploy Kubeflow Pipelines</a></li>
<li><a href="/docs/components/pipelines/sdk/install-sdk/">Install the Kubeflow Pipelines SDK</a></li>
</ul>


</div>

<h2 id="full-kubeflow-subfrom-inside-clustersub">Full Kubeflow <sub>(from inside cluster)</sub></h2>
<details>
<summary>Click to expand</summary>
<hr>
<p>When running the Pipelines SDK inside a multi-user Kubeflow cluster, a <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/#service-account-token-volume-projection">ServiceAccount token volume</a>
can be mounted to the Pod, the Kubeflow Pipelines SDK can use this token to authenticate itself with the Kubeflow Pipelines API.</p>
<p>The following code creates a <code>kfp.Client()</code> using a ServiceAccount token for authentication.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">kfp</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># the namespace in which you deployed Kubeflow Pipelines</span>
</span></span><span class="line"><span class="cl"><span class="n">namespace</span> <span class="o">=</span> <span class="s2">&#34;kubeflow&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># the KF_PIPELINES_SA_TOKEN_PATH environment variable is used when no `path` is set</span>
</span></span><span class="line"><span class="cl"><span class="c1"># the default KF_PIPELINES_SA_TOKEN_PATH is /var/run/secrets/kubeflow/pipelines/token</span>
</span></span><span class="line"><span class="cl"><span class="n">credentials</span> <span class="o">=</span> <span class="n">kfp</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">ServiceAccountTokenVolumeCredentials</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">client</span> <span class="o">=</span> <span class="n">kfp</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="sa">f</span><span class="s2">&#34;http://ml-pipeline-ui.</span><span class="si">{</span><span class="n">namespace</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">credentials</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">list_experiments</span><span class="p">())</span>
</span></span></code></pre></div><p>The following Pod demonstrates mounting a ServiceAccount token volume.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">access-kfp-example</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">hello-world:latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">hello-world</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">env</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="c">## this environment variable is automatically read by `kfp.Client()`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c">## this is the default value, but we show it here for clarity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">KF_PIPELINES_SA_TOKEN_PATH</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">/var/run/secrets/kubeflow/pipelines/token</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/var/run/secrets/kubeflow/pipelines</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">volume-kf-pipeline-token</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">readOnly</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">volume-kf-pipeline-token</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">projected</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">sources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="nt">serviceAccountToken</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">token</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">expirationSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">7200</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="c">## defined by the `TOKEN_REVIEW_AUDIENCE` environment variable on the `ml-pipeline` deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">audience</span><span class="p">:</span><span class="w"> </span><span class="l">pipelines.kubeflow.org      </span><span class="w">
</span></span></span></code></pre></div><p>You may use Kubeflow&rsquo;s <a href="https://github.com/kubeflow/kubeflow/tree/master/components/admission-webhook"><code>PodDefaults</code></a> to inject the required ServiceAccount token volume into your Pods:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">kubeflow.org/v1alpha1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">PodDefault</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">access-ml-pipeline</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;&lt;YOUR_USER_PROFILE_NAMESPACE&gt;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">desc</span><span class="p">:</span><span class="w"> </span><span class="l">Allow access to Kubeflow Pipelines</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">access-ml-pipeline</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;true&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">env</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="c">## this environment variable is automatically read by `kfp.Client()`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c">## this is the default value, but we show it here for clarity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">KF_PIPELINES_SA_TOKEN_PATH</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">/var/run/secrets/kubeflow/pipelines/token</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">volume-kf-pipeline-token</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">projected</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">sources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="nt">serviceAccountToken</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">token</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">expirationSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">7200</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="c">## defined by the `TOKEN_REVIEW_AUDIENCE` environment variable on the `ml-pipeline` deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">audience</span><span class="p">:</span><span class="w"> </span><span class="l">pipelines.kubeflow.org      </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/var/run/secrets/kubeflow/pipelines</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">volume-kf-pipeline-token</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">readOnly</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span></code></pre></div>

<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Tip</h4>

    <ul>
<li><code>PodDefaults</code> are namespaced resources, so you need to create one inside <strong>each</strong> of your Kubeflow <code>Profile</code> namespaces.</li>
<li>The Notebook Spawner UI will be aware of any <code>PodDefaults</code> in the user&rsquo;s namespace (they are selectable under the &ldquo;configurations&rdquo; section).</li>
</ul>


</div>

<h3 id="rbac-authorization">RBAC Authorization</h3>
<p>The Kubeflow Pipelines API respects Kubernetes RBAC, and will check RoleBindings assigned to the ServiceAccount before allowing it to take Pipelines API actions.</p>
<p>For example, this RoleBinding allows Pods with the <code>default-editor</code> ServiceAccount in <code>namespace-2</code> to manage Kubeflow Pipelines in <code>namespace-1</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">RoleBinding</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">allow-namespace-2-kubeflow-edit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c">## this RoleBinding is in `namespace-1`, because it grants access to `namespace-1`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">namespace-1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">roleRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l">rbac.authorization.k8s.io</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterRole</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">kubeflow-edit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">subjects</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ServiceAccount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">default-editor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c">## the ServiceAccount lives in `namespace-2`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">namespace-2</span><span class="w">
</span></span></span></code></pre></div>

<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Tip</h4>

    <ul>
<li>Review the ClusterRole called <a href="https://github.com/kubeflow/pipelines/blob/efb96135033fc6e6e55078d33814c45a98566e68/manifests/kustomize/base/installs/multi-user/view-edit-cluster-roles.yaml#L36-L99"><code>aggregate-to-kubeflow-pipelines-edit</code></a>
for a list of some important <code>pipelines.kubeflow.org</code> RBAC verbs.</li>
<li>Kubeflow Notebooks pods run as the <code>default-editor</code> ServiceAccount by default, so the RoleBindings for <code>default-editor</code> apply to them
and give them access to submit pipelines in their own namespace.</li>
</ul>


</div>

</details>
<h2 id="full-kubeflow-subfrom-outside-clustersub">Full Kubeflow <sub>(from outside cluster)</sub></h2>
<details>
<summary>Click to expand</summary>
<hr>
<p>The process to authenticate the Pipelines SDK from outside the cluster in multi-user mode will vary by distribution:</p>
<ul>
<li><a href="/docs/distributions/gke/pipelines/authentication-sdk/#connecting-to-kubeflow-pipelines-in-a-full-kubeflow-deployment">Kubeflow on Google Cloud</a></li>
<li><a href="/docs/distributions/aws/pipeline/#authenticate-kubeflow-pipeline-using-sdk-outside-cluster">Kubeflow on AWS</a></li>
<li><a href="https://awslabs.github.io/kubeflow-manifests/docs/component-guides/pipelines/">Kubeflow on Azure</a></li>
<li><a href="/docs/distributions/ibm/pipelines/#2-authenticating-multi-user-kubeflow-pipelines-with-the-sdk">Kubeflow on IBM Cloud</a></li>
</ul>
<h3 id="example-for-dex">Example for Dex</h3>
<p>For the deployments that use <a href="https://dexidp.io/">Dex</a> as their identity provider, this example demonstrates how to authenticate the Pipelines SDK from outside the cluster.</p>
<p><strong>Step 1:</strong> expose your <code>istio-ingressgateway</code> service locally (if your Kubeflow Istio gateway is not already exposed on a domain)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># `svc/istio-ingressgateway` may be called something else, or use different ports</span>
</span></span><span class="line"><span class="cl">kubectl port-forward --namespace istio-system svc/istio-ingressgateway 8080:80
</span></span></code></pre></div><p><strong>Step 2:</strong> this Python code defines a <code>get_istio_auth_session()</code> function that returns a session cookie by authenticating with dex</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlsplit</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_istio_auth_session</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Determine if the specified URL is secured by Dex and try to obtain a session cookie.
</span></span></span><span class="line"><span class="cl"><span class="s2">    WARNING: only Dex `staticPasswords` and `LDAP` authentication are currently supported
</span></span></span><span class="line"><span class="cl"><span class="s2">             (we default default to using `staticPasswords` if both are enabled)
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    :param url: Kubeflow server URL, including protocol
</span></span></span><span class="line"><span class="cl"><span class="s2">    :param username: Dex `staticPasswords` or `LDAP` username
</span></span></span><span class="line"><span class="cl"><span class="s2">    :param password: Dex `staticPasswords` or `LDAP` password
</span></span></span><span class="line"><span class="cl"><span class="s2">    :return: auth session information
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># define the default return object</span>
</span></span><span class="line"><span class="cl">    <span class="n">auth_session</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;endpoint_url&#34;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>    <span class="c1"># KF endpoint URL</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;redirect_url&#34;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>   <span class="c1"># KF redirect URL, if applicable</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;dex_login_url&#34;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Dex login URL (for POST of credentials)</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;is_secured&#34;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>     <span class="c1"># True if KF endpoint is secured</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;session_cookie&#34;</span><span class="p">:</span> <span class="kc">None</span>  <span class="c1"># Resulting session cookies in the form &#34;key1=value1; key2=value2&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># use a persistent session (for cookies)</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">################</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Determine if Endpoint is Secured</span>
</span></span><span class="line"><span class="cl">        <span class="c1">################</span>
</span></span><span class="line"><span class="cl">        <span class="n">resp</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="sa">f</span><span class="s2">&#34;HTTP status code &#39;</span><span class="si">{</span><span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&#39; for GET against: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">auth_session</span><span class="p">[</span><span class="s2">&#34;redirect_url&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">url</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># if we were NOT redirected, then the endpoint is UNSECURED</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">history</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">auth_session</span><span class="p">[</span><span class="s2">&#34;is_secured&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">auth_session</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">auth_session</span><span class="p">[</span><span class="s2">&#34;is_secured&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">################</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Get Dex Login URL</span>
</span></span><span class="line"><span class="cl">        <span class="c1">################</span>
</span></span><span class="line"><span class="cl">        <span class="n">redirect_url_obj</span> <span class="o">=</span> <span class="n">urlsplit</span><span class="p">(</span><span class="n">auth_session</span><span class="p">[</span><span class="s2">&#34;redirect_url&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># if we are at `/auth?=xxxx` path, we need to select an auth type</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;/auth$&#34;</span><span class="p">,</span> <span class="n">redirect_url_obj</span><span class="o">.</span><span class="n">path</span><span class="p">):</span> 
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1">#######</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># TIP: choose the default auth type by including ONE of the following</span>
</span></span><span class="line"><span class="cl">            <span class="c1">#######</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># OPTION 1: set &#34;staticPasswords&#34; as default auth type</span>
</span></span><span class="line"><span class="cl">            <span class="n">redirect_url_obj</span> <span class="o">=</span> <span class="n">redirect_url_obj</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">path</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;/auth$&#34;</span><span class="p">,</span> <span class="s2">&#34;/auth/local&#34;</span><span class="p">,</span> <span class="n">redirect_url_obj</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># OPTION 2: set &#34;ldap&#34; as default auth type </span>
</span></span><span class="line"><span class="cl">            <span class="c1"># redirect_url_obj = redirect_url_obj._replace(</span>
</span></span><span class="line"><span class="cl">            <span class="c1">#     path=re.sub(r&#34;/auth$&#34;, &#34;/auth/ldap&#34;, redirect_url_obj.path)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># )</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="c1"># if we are at `/auth/xxxx/login` path, then no further action is needed (we can use it for login POST)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;/auth/.*/login$&#34;</span><span class="p">,</span> <span class="n">redirect_url_obj</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">auth_session</span><span class="p">[</span><span class="s2">&#34;dex_login_url&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">redirect_url_obj</span><span class="o">.</span><span class="n">geturl</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># else, we need to be redirected to the actual login page</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># this GET should redirect us to the `/auth/xxxx/login` path</span>
</span></span><span class="line"><span class="cl">            <span class="n">resp</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">redirect_url_obj</span><span class="o">.</span><span class="n">geturl</span><span class="p">(),</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="sa">f</span><span class="s2">&#34;HTTP status code &#39;</span><span class="si">{</span><span class="n">resp</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&#39; for GET against: </span><span class="si">{</span><span class="n">redirect_url_obj</span><span class="o">.</span><span class="n">geturl</span><span class="p">()</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># set the login url</span>
</span></span><span class="line"><span class="cl">            <span class="n">auth_session</span><span class="p">[</span><span class="s2">&#34;dex_login_url&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">url</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">################</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Attempt Dex Login</span>
</span></span><span class="line"><span class="cl">        <span class="c1">################</span>
</span></span><span class="line"><span class="cl">        <span class="n">resp</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">auth_session</span><span class="p">[</span><span class="s2">&#34;dex_login_url&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;login&#34;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span> <span class="s2">&#34;password&#34;</span><span class="p">:</span> <span class="n">password</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">history</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="sa">f</span><span class="s2">&#34;Login credentials were probably invalid - &#34;</span>
</span></span><span class="line"><span class="cl">                <span class="sa">f</span><span class="s2">&#34;No redirect after POST to: </span><span class="si">{</span><span class="n">auth_session</span><span class="p">[</span><span class="s1">&#39;dex_login_url&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># store the session cookies in a &#34;key1=value1; key2=value2&#34; string</span>
</span></span><span class="line"><span class="cl">        <span class="n">auth_session</span><span class="p">[</span><span class="s2">&#34;session_cookie&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;; &#34;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&#34;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">cookies</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">auth_session</span>
</span></span></code></pre></div><p><strong>Step 3:</strong> this Python code uses the above <code>get_istio_auth_session()</code> function to create a <code>kfp.Client()</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">kfp</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">KUBEFLOW_ENDPOINT</span> <span class="o">=</span> <span class="s2">&#34;http://localhost:8080&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">KUBEFLOW_USERNAME</span> <span class="o">=</span> <span class="s2">&#34;user@example.com&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">KUBEFLOW_PASSWORD</span> <span class="o">=</span> <span class="s2">&#34;12341234&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">auth_session</span> <span class="o">=</span> <span class="n">get_istio_auth_session</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span><span class="o">=</span><span class="n">KUBEFLOW_ENDPOINT</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">username</span><span class="o">=</span><span class="n">KUBEFLOW_USERNAME</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">password</span><span class="o">=</span><span class="n">KUBEFLOW_PASSWORD</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">client</span> <span class="o">=</span> <span class="n">kfp</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">KUBEFLOW_ENDPOINT</span><span class="si">}</span><span class="s2">/pipeline&#34;</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">auth_session</span><span class="p">[</span><span class="s2">&#34;session_cookie&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">list_experiments</span><span class="p">())</span>
</span></span></code></pre></div></details>
<h2 id="standalone-kubeflow-pipelines-subfrom-inside-clustersub">Standalone Kubeflow Pipelines <sub>(from inside cluster)</sub></h2>
<details>
<summary>Click to expand</summary>
<hr>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    This information only applies to <em>Standalone Kubeflow Pipelines</em>.

</div>

<p>When running inside the Kubernetes cluster, you may connect Pipelines SDK directly to the <code>ml-pipeline-ui</code> service via <a href="https://kubernetes.io/docs/concepts/services-networking/service/#discovering-services">cluster-internal service DNS resolution</a>.</p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Tip</h4>

    In <a href="/docs/components/pipelines/installation/standalone-deployment/">standalone deployments</a> of Kubeflow Pipelines, there is no authentication enforced on the <code>ml-pipeline-ui</code> service.

</div>

<p>For example, when running in the <strong>same namespace</strong> as Kubeflow:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">kfp</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">client</span> <span class="o">=</span> <span class="n">kfp</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&#34;http://ml-pipeline-ui:80&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">list_experiments</span><span class="p">())</span>
</span></span></code></pre></div><p>For example, when running in a <strong>different namespace</strong> to Kubeflow:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">kfp</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># the namespace in which you deployed Kubeflow Pipelines</span>
</span></span><span class="line"><span class="cl"><span class="n">namespace</span> <span class="o">=</span> <span class="s2">&#34;kubeflow&#34;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">client</span> <span class="o">=</span> <span class="n">kfp</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="sa">f</span><span class="s2">&#34;http://ml-pipeline-ui.</span><span class="si">{</span><span class="n">namespace</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">list_experiments</span><span class="p">())</span>
</span></span></code></pre></div></details>
<h2 id="standalone-kubeflow-pipelines-subfrom-outside-clustersub">Standalone Kubeflow Pipelines <sub>(from outside cluster)</sub></h2>
<details>
<summary>Click to expand</summary>
<hr>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    This information only applies to <em>Standalone Kubeflow Pipelines</em>.

</div>

<p>When running outside the Kubernetes cluster, you may connect Pipelines SDK to the <code>ml-pipeline-ui</code> service by using <a href="https://kubernetes.io/docs/tasks/access-application-cluster/port-forward-access-application-cluster/">kubectl port-forwarding</a>.</p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Tip</h4>

    In <a href="/docs/components/pipelines/installation/standalone-deployment/">standalone deployments</a> of Kubeflow Pipelines, there is no authentication enforced on the <code>ml-pipeline-ui</code> service.

</div>

<p><strong>Step 1:</strong> run the following command on your external system to initiate port-forwarding:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># change `--namespace` if you deployed Kubeflow Pipelines into a different namespace</span>
</span></span><span class="line"><span class="cl">kubectl port-forward --namespace kubeflow svc/ml-pipeline-ui 3000:80
</span></span></code></pre></div><p><strong>Step 2:</strong> the following code will create a <code>kfp.Client()</code> against your port-forwarded <code>ml-pipeline-ui</code> service:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">kfp</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">client</span> <span class="o">=</span> <span class="n">kfp</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&#34;http://localhost:3000&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">list_experiments</span><span class="p">())</span>
</span></span></code></pre></div></details>
<h2 id="next-steps">Next Steps</h2>
<ul>
<li><a href="/docs/components/pipelines/tutorials/sdk-examples/">Using the Kubeflow Pipelines SDK</a></li>
<li><a href="https://kubeflow-pipelines.readthedocs.io/en/stable/">Kubeflow Pipelines SDK Reference</a></li>
<li><a href="/docs/components/pipelines/tutorials/api-pipelines/">Experiment with the Kubeflow Pipelines API</a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-95de41d77d62a53dd61ef8fe4dcf3c80">4 - Build a Pipeline</h1>
    <div class="lead">A tutorial on building pipelines to orchestrate your ML workflow</div>
	<!--
AUTOGENERATED FROM content/en/docs/components/pipelines/sdk/build-pipeline.ipynb
PLEASE UPDATE THE JUPYTER NOTEBOOK AND REGENERATE THIS FILE USING scripts/nb_to_md.py.-->
<style>
.notebook-links {display: flex; margin: 1em 0;}
.notebook-links a {padding: .75em; margin-right: .75em; font-weight: bold;}
a.colab-link {
padding-left: 3.25em;
background-image: url(/docs/images/logos/colab.ico);
background-repeat: no-repeat;
background-size: contain;
}
a.github-link {
padding-left: 2.75em;
background-image: url(/docs/images/logos/github.png);
background-repeat: no-repeat;
background-size: auto 75%;
background-position: left center;
}
</style>
<div class="notebook-links">
<a class="colab-link" href="https://colab.research.google.com/github/kubeflow/website/blob/master/content/en/docs/components/pipelines/sdk/build-pipeline.ipynb">Run in Google Colab</a>
<a class="github-link" href="https://github.com/kubeflow/website/blob/master/content/en/docs/components/pipelines/sdk/build-pipeline.ipynb">View source on GitHub</a>
</div>
<p>A Kubeflow pipeline is a portable and scalable definition of a machine learning
(ML) workflow. Each step in your ML workflow, such as preparing data or
training a model, is an instance of a pipeline component. This document
provides an overview of pipeline concepts and best practices, and instructions
describing how to build an ML pipeline.</p>
<h2 id="before-you-begin">Before you begin</h2>
<ol>
<li>Run the following command to install the Kubeflow Pipelines SDK. If you run this command in a Jupyter
notebook, restart the kernel after installing the SDK.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">kfp</span> <span class="o">--</span><span class="n">upgrade</span>
</span></span></code></pre></div><ol start="2">
<li>Import the <code>kfp</code> and <code>kfp.components</code> packages.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">kfp</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">kfp.components</span> <span class="k">as</span> <span class="nn">comp</span>
</span></span></code></pre></div><h2 id="understanding-pipelines">Understanding pipelines</h2>
<p>A Kubeflow pipeline is a portable and scalable definition of an ML workflow,
based on containers. A pipeline is composed of a set of input parameters and a
list of the steps in this workflow. Each step in a pipeline is an instance of a
component, which is represented as an instance of
<a href="https://kubeflow-pipelines.readthedocs.io/en/latest/source/kfp.dsl.html#kfp.dsl.ContainerOp"><code>ContainerOp</code></a>.</p>
<p>You can use pipelines to:</p>
<ul>
<li>Orchestrate repeatable ML workflows.</li>
<li>Accelerate experimentation by running a workflow with different sets of
hyperparameters.</li>
</ul>
<h3 id="understanding-pipeline-components">Understanding pipeline components</h3>
<p>A pipeline component is a containerized application that performs one step in a
pipeline&rsquo;s workflow. Pipeline components are defined in
<a href="https://www.kubeflow.org/docs/components/pipelines/reference/component-spec/">component specifications</a>, which define the following:</p>
<ul>
<li>The component&rsquo;s interface, its inputs and outputs.</li>
<li>The component&rsquo;s implementation, the container image and the command to
execute.</li>
<li>The component&rsquo;s metadata, such as the name and description of the
component.</li>
</ul>
<p>You can build components by <a href="https://www.kubeflow.org/docs/components/pipelines/sdk/component-development/">defining a component specification for a
containerized application</a>, or you can <a href="https://www.kubeflow.org/docs/components/pipelines/sdk/python-function-components/">use the Kubeflow
Pipelines SDK to generate a component specification for a Python
function</a>. You can also <a href="https://www.kubeflow.org/docs/examples/shared-resources/">reuse prebuilt components
in your pipeline</a>.</p>
<h3 id="understanding-the-pipeline-graph">Understanding the pipeline graph</h3>
<p>Each step in your pipeline&rsquo;s workflow is an instance of a component. When
you define your pipeline, you specify the source of each step&rsquo;s inputs. Step
inputs can be set from the pipeline&rsquo;s input arguments, constants, or step
inputs can depend on the outputs of other steps in this pipeline. Kubeflow
Pipelines uses these dependencies to define your pipeline&rsquo;s workflow as
a graph.</p>
<p>For example, consider a pipeline with the following steps: ingest data,
generate statistics, preprocess data, and train a model. The following
describes the data dependencies between each step.</p>
<ul>
<li><strong>Ingest data</strong>: This step loads data from an external source which is
specified using a pipeline argument, and it outputs a dataset. Since
this step does not depend on the output of any other steps, this step
can run first.</li>
<li><strong>Generate statistics</strong>: This step uses the ingested dataset to generate
and output a set of statistics. Since this step depends on the dataset
produced by the ingest data step, it must run after the ingest data step.</li>
<li><strong>Preprocess data</strong>: This step preprocesses the ingested dataset and
transforms the data into a preprocessed dataset. Since this step depends
on the dataset produced by the ingest data step, it must run after the
ingest data step.</li>
<li><strong>Train a model</strong>: This step trains a model using the preprocessed dataset,
the generated statistics, and pipeline parameters, such as the learning
rate. Since this step depends on the preprocessed data and the generated
statistics, it must run after both the preprocess data and generate
statistics steps are complete.</li>
</ul>
<p>Since the generate statistics and preprocess data steps both depend on the
ingested data, the generate statistics and preprocess data steps can run in
parallel. All other steps are executed once their data dependencies are
available.</p>
<h2 id="designing-your-pipeline">Designing your pipeline</h2>
<p>When designing your pipeline, think about how to split your ML workflow into
pipeline components. The process of splitting an ML workflow into pipeline
components is similar to the process of splitting a monolithic script into
testable functions. The following rules can help you define the components
that you need to build your pipeline.</p>
<ul>
<li>
<p>Components should have a single responsibility. Having a single
responsibility makes it easier to test and reuse a component. For example,
if you have a component that loads data you can reuse that for similar
tasks that load data. If you have a component that loads and transforms
a dataset, the component can be less useful since you can use it only when
you need to load and transform that dataset.</p>
</li>
<li>
<p>Reuse components when possible. Kubeflow Pipelines provides <a href="https://www.kubeflow.org/docs/examples/shared-resources/">components for
common pipeline tasks and for access to cloud
services</a>.</p>
</li>
<li>
<p>Consider what you need to know to debug your pipeline and research the
lineage of the models that your pipeline produces. Kubeflow Pipelines
stores the inputs and outputs of each pipeline step. By interrogating the
artifacts produced by a pipeline run, you can better understand the
variations in model quality between runs or track down bugs in your
workflow.</p>
</li>
</ul>
<p>In general, you should design your components with composability in mind.</p>
<p>Pipelines are composed of component instances, also called steps. Steps can
define their inputs as depending on the output of another step. The
dependencies between steps define the pipeline workflow graph.</p>
<h3 id="building-pipeline-components">Building pipeline components</h3>
<p>Kubeflow pipeline components are containerized applications that perform a
step in your ML workflow. Here are the ways that you can define pipeline
components:</p>
<ul>
<li>
<p>If you have a containerized application that you want to use as a
pipeline component, create a component specification to define this
container image as a pipeline component.</p>
<p>This option provides the flexibility to include code written in any
language in your pipeline, so long as you can package the application
as a container image. Learn more about <a href="https://www.kubeflow.org/docs/components/pipelines/sdk/component-development/">building pipeline
components</a>.</p>
</li>
<li>
<p>If your component code can be expressed as a Python function, <a href="https://www.kubeflow.org/docs/components/pipelines/sdk/python-function-components/">evaluate if
your component can be built as a Python function-based
component</a>. The Kubeflow Pipelines SDK makes it
easier to build lightweight Python function-based components by saving you
the effort of creating a component specification.</p>
</li>
</ul>
<p>Whenever possible, <a href="https://www.kubeflow.org/docs/examples/shared-resources/">reuse prebuilt components</a> to save
yourself the effort of building custom components.</p>
<p>The example in this guide demonstrates how to build a pipeline that uses a
Python function-based component and reuses a prebuilt component.</p>
<h3 id="understanding-how-data-is-passed-between-components">Understanding how data is passed between components</h3>
<p>When Kubeflow Pipelines runs a component, a container image is started in a
Kubernetes Pod and your component’s inputs are passed in as command-line
arguments. When your component has finished, the component&rsquo;s outputs are
returned as files.</p>
<p>In your component&rsquo;s specification, you define the components inputs and outputs
and how the inputs and output paths are passed to your program as command-line
arguments. You can pass small inputs, such as short strings or numbers, to your
component by value. Large inputs, such as datasets, must be passed to your
component as file paths. Outputs are written to the paths that Kubeflow
Pipelines provides.</p>
<p>Python function-based components make it easier to build pipeline components
by building the component specification for you. Python function-based
components also handle the complexity of passing inputs into your component
and passing your function’s outputs back to your pipeline.</p>
<p>Learn more about how <a href="https://www.kubeflow.org/docs/components/pipelines/sdk/python-function-components/#understanding-how-data-is-passed-between-components">Python function-based components handle inputs and
outputs</a>.</p>
<h2 id="getting-started-building-a-pipeline">Getting started building a pipeline</h2>
<p>The following sections demonstrate how to get started building a Kubeflow
pipeline by walking through the process of converting a Python script into
a pipeline.</p>
<h3 id="design-your-pipeline">Design your pipeline</h3>
<p>The following steps walk through some of the design decisions you may face
when designing a pipeline.</p>
<ol>
<li>Evaluate the process. In the following example, a Python function downloads
a zipped tar file (<code>.tar.gz</code>) that contains several CSV files, from a
public website. The function extracts the CSV files and then merges them
into a single file.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">glob</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">tarfile</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">urllib.request</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">download_and_merge_csv</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_csv</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="k">with</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">res</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fileobj</span><span class="o">=</span><span class="n">res</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&#34;r|gz&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_file</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">       <span class="k">for</span> <span class="n">csv_file</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;data/*.csv&#39;</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl">  <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_csv</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span></code></pre></div><ol start="2">
<li>Run the following Python command to test the function.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">download_and_merge_csv</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span><span class="o">=</span><span class="s1">&#39;https://storage.googleapis.com/ml-pipeline-playground/iris-csv-files.tar.gz&#39;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">output_csv</span><span class="o">=</span><span class="s1">&#39;merged_data.csv&#39;</span><span class="p">)</span>
</span></span></code></pre></div><ol start="3">
<li>Run the following to print the first few rows of the
merged CSV file.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">head</span> <span class="n">merged_data</span><span class="o">.</span><span class="n">csv</span>
</span></span></code></pre></div><ol start="4">
<li>
<p>Design your pipeline. For example, consider the following pipeline designs.</p>
<ul>
<li>
<p>Implement the pipeline using a single step. In this case, the pipeline
contains one component that works similarly to the example function.
This is a straightforward function, and implementing a single-step
pipeline is a reasonable approach in this case.</p>
<p>The down side of this approach is that the zipped tar file would not be
an artifact of your pipeline runs. Not having this artifact available
could make it harder to debug this component in production.</p>
</li>
<li>
<p>Implement this as a two-step pipeline. The first step downloads a file
from a website. The second step extracts the CSV files from a zipped
tar file and merges them into a single file.</p>
<p>This approach has a few benefits:</p>
<ul>
<li>You can reuse the <a href="https://github.com/kubeflow/pipelines/blob/sdk/release-1.8/components/web/Download/component.yaml">Web Download component</a>
to implement the first step.</li>
<li>Each step has a single responsibility, which makes the components
easier to reuse.</li>
<li>The zipped tar file is an artifact of the first pipeline step.
This means that you can examine this artifact when debugging
pipelines that use this component.</li>
</ul>
</li>
</ul>
<p>This example implements a two-step pipeline.</p>
</li>
</ol>
<h3 id="build-your-pipeline-components">Build your pipeline components</h3>
<ol>
<li>
<p>Build your pipeline components. This example modifies the initial script to
extract the contents of a zipped tar file, merge the CSV files that were
contained in the zipped tar file, and return the merged CSV file.</p>
<p>This example builds a Python function-based component. You can also package
your component&rsquo;s code as a Docker container image and define the component
using a ComponentSpec.</p>
<p>In this case, the following modifications were required to the original
function.</p>
<ul>
<li>The file download logic was removed. The path to the zipped tar file
is passed as an argument to this function.</li>
<li>The import statements were moved inside of the function. Python
function-based components require standalone Python functions. This
means that any required import statements must be defined within the
function, and any helper functions must be defined within the function.
Learn more about <a href="https://www.kubeflow.org/docs/components/pipelines/sdk/python-function-components/">building Python function-based
components</a>.</li>
<li>The function&rsquo;s arguments are decorated with the
<a href="https://kubeflow-pipelines.readthedocs.io/en/latest/source/kfp.components.html?highlight=inputpath#kfp.components.InputPath"><code>kfp.components.InputPath</code></a> and the
<a href="https://kubeflow-pipelines.readthedocs.io/en/latest/source/kfp.components.html?highlight=outputpath#kfp.components.OutputPath"><code>kfp.components.OutputPath</code></a> annotations. These
annotations let Kubeflow Pipelines know to provide the path to the
zipped tar file and to create a path where your function stores the
merged CSV file.</li>
</ul>
<p>The following example shows the updated <code>merge_csv</code> function.</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="n">comp</span><span class="o">.</span><span class="n">InputPath</span><span class="p">(</span><span class="s1">&#39;Tarball&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">              <span class="n">output_csv</span><span class="p">:</span> <span class="n">comp</span><span class="o">.</span><span class="n">OutputPath</span><span class="p">(</span><span class="s1">&#39;CSV&#39;</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">  <span class="kn">import</span> <span class="nn">glob</span>
</span></span><span class="line"><span class="cl">  <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl">  <span class="kn">import</span> <span class="nn">tarfile</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&#34;r|gz&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_file</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">       <span class="k">for</span> <span class="n">csv_file</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;data/*.csv&#39;</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl">  <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_csv</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span></code></pre></div><ol start="2">
<li>Use <a href="https://kubeflow-pipelines.readthedocs.io/en/latest/source/kfp.components.html#kfp.components.create_component_from_func"><code>kfp.components.create_component_from_func</code></a>
to return a factory function that you can use to create pipeline steps.
This example also specifies the base container image to run this function
in, the path to save the component specification to, and a list of PyPI
packages that need to be installed in the container at runtime.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">create_step_merge_csv</span> <span class="o">=</span> <span class="n">kfp</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">create_component_from_func</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">func</span><span class="o">=</span><span class="n">merge_csv</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">output_component_file</span><span class="o">=</span><span class="s1">&#39;component.yaml&#39;</span><span class="p">,</span> <span class="c1"># This is optional. It saves the component spec for future use.</span>
</span></span><span class="line"><span class="cl">    <span class="n">base_image</span><span class="o">=</span><span class="s1">&#39;python:3.7&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">packages_to_install</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;pandas==1.1.4&#39;</span><span class="p">])</span>
</span></span></code></pre></div><h3 id="build-your-pipeline">Build your pipeline</h3>
<ol>
<li>Use <a href="https://kubeflow-pipelines.readthedocs.io/en/latest/source/kfp.components.html?highlight=load_component_from_url#kfp.components.load_component_from_url"><code>kfp.components.load_component_from_url</code></a>
to load the component specification YAML for any components that you are
reusing in this pipeline.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">web_downloader_op</span> <span class="o">=</span> <span class="n">kfp</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">load_component_from_url</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;https://raw.githubusercontent.com/kubeflow/pipelines/master/components/contrib/web/Download/component.yaml&#39;</span><span class="p">)</span>
</span></span></code></pre></div><ol start="2">
<li>
<p>Define your pipeline as a Python function.</p>
<p>Your pipeline function&rsquo;s arguments define your pipeline&rsquo;s parameters. Use
pipeline parameters to experiment with different hyperparameters, such as
the learning rate used to train a model, or pass run-level inputs, such as
the path to an input file, into a pipeline run.</p>
<p>Use the factory functions created by
<code>kfp.components.create_component_from_func</code> and
<code>kfp.components.load_component_from_url</code> to create your pipeline&rsquo;s tasks.
The inputs to the component factory functions can be pipeline parameters,
the outputs of other tasks, or a constant value. In this case, the
<code>web_downloader_task</code> task uses the <code>url</code> pipeline parameter, and the
<code>merge_csv_task</code> uses the <code>data</code> output of the <code>web_downloader_task</code>.</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Define a pipeline and create a task from a component:</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">my_pipeline</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="n">web_downloader_task</span> <span class="o">=</span> <span class="n">web_downloader_op</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">merge_csv_task</span> <span class="o">=</span> <span class="n">create_step_merge_csv</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">web_downloader_task</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># The outputs of the merge_csv_task can be referenced using the</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># merge_csv_task.outputs dictionary: merge_csv_task.outputs[&#39;output_csv&#39;]</span>
</span></span></code></pre></div><h3 id="compile-and-run-your-pipeline">Compile and run your pipeline</h3>
<p>After defining the pipeline in Python as described in the preceding section, use one of the following options to compile the pipeline and submit it to the Kubeflow Pipelines service.</p>
<h4 id="option-1-compile-and-then-upload-in-ui">Option 1: Compile and then upload in UI</h4>
<ol>
<li>Run the following to compile your pipeline and save it as <code>pipeline.yaml</code>.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">kfp</span><span class="o">.</span><span class="n">compiler</span><span class="o">.</span><span class="n">Compiler</span><span class="p">()</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">pipeline_func</span><span class="o">=</span><span class="n">my_pipeline</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">package_path</span><span class="o">=</span><span class="s1">&#39;pipeline.yaml&#39;</span><span class="p">)</span>
</span></span></code></pre></div><ol start="2">
<li>Upload and run your <code>pipeline.yaml</code> using the Kubeflow Pipelines user interface.
See the guide to <a href="https://www.kubeflow.org/docs/components/pipelines/overview/quickstart">getting started with the UI</a>.</li>
</ol>
<h4 id="option-2-run-the-pipeline-using-kubeflow-pipelines-sdk-client">Option 2: run the pipeline using Kubeflow Pipelines SDK client</h4>
<ol>
<li>Create an instance of the <a href="https://kubeflow-pipelines.readthedocs.io/en/latest/source/kfp.client.html#kfp.Client"><code>kfp.Client</code> class</a> following steps in <a href="https://www.kubeflow.org/docs/components/pipelines/sdk/connect-api">connecting to Kubeflow Pipelines using the SDK client</a>.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">client</span> <span class="o">=</span> <span class="n">kfp</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span> <span class="c1"># change arguments accordingly</span>
</span></span></code></pre></div><ol start="2">
<li>Run the pipeline using the <code>kfp.Client</code> instance:</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">client</span><span class="o">.</span><span class="n">create_run_from_pipeline_func</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">my_pipeline</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">arguments</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;https://storage.googleapis.com/ml-pipeline-playground/iris-csv-files.tar.gz&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span></code></pre></div><h2 id="next-steps">Next steps</h2>
<ul>
<li>Learn about advanced pipeline features, such as <a href="https://www.kubeflow.org/docs/components/pipelines/sdk/dsl-recursion/">authoring recursive
components</a> and <a href="https://github.com/kubeflow/pipelines/blob/sdk/release-1.8/samples/tutorials/DSL%20-%20Control%20structures/DSL%20-%20Control%20structures.py">using conditional execution in a
pipeline</a>.</li>
<li>Learn how to <a href="https://www.kubeflow.org/docs/components/pipelines/sdk/manipulate-resources/">manipulate Kubernetes resources in a
pipeline</a> (Experimental).</li>
</ul>
<div class="notebook-links">
<a class="colab-link" href="https://colab.research.google.com/github/kubeflow/website/blob/master/content/en/docs/components/pipelines/sdk/build-pipeline.ipynb">Run in Google Colab</a>
<a class="github-link" href="https://github.com/kubeflow/website/blob/master/content/en/docs/components/pipelines/sdk/build-pipeline.ipynb">View source on GitHub</a>
</div>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-201764e91fc94af83f5f9784d2243490">5 - Building Components</h1>
    <div class="lead">A tutorial on how to create components and use them in a pipeline</div>
	<p>A pipeline component is a self-contained set of code that performs one step in
your ML workflow. This document describes the concepts required to build
components, and demonstrates how to get started building components.</p>
<h2 id="before-you-begin">Before you begin</h2>
<p>Run the following command to install the Kubeflow Pipelines SDK.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">pip3</span> <span class="n">install</span> <span class="n">kfp</span> <span class="o">--</span><span class="n">upgrade</span>
</span></span></code></pre></div><p>For more information about the Kubeflow Pipelines SDK, see the <a href="https://kubeflow-pipelines.readthedocs.io/en/latest/index.html">SDK reference guide</a>.</p>
<h2 id="understanding-pipeline-components">Understanding pipeline components</h2>
<p>Pipeline components are self-contained sets of code that perform one step in
your ML workflow, such as preprocessing data or training a model. To create a
component, you must <em>build the component&rsquo;s implementation</em> and <em>define the
component specification</em>.</p>
<p>Your component&rsquo;s implementation includes the component&rsquo;s executable code and
the Docker container image that the code runs in.  <a href="#design">Learn more about designing
a pipeline component</a>.</p>
<p>Once you have built your component&rsquo;s implementation, you can define your
component&rsquo;s interface as a component specification. A component specification
defines:</p>
<ul>
<li>The component&rsquo;s inputs and outputs.</li>
<li>The container image that your component&rsquo;s code runs in, the command to use
to run your component&rsquo;s code, and the command-line arguments to pass to
your component&rsquo;s code.</li>
<li>The component&rsquo;s metadata, such as the name and description.</li>
</ul>
<p><a href="#component-spec">Learn more about creating a component specification</a>.</p>
<p>If your component&rsquo;s code is implemented as a Python function, use the
Kubeflow Pipelines SDK to package your function as a component. <a href="https://www.kubeflow.org/docs/pipelines/sdk/python-function-components/">Learn more
about building Python function-based components</a>.</p>
<p><a name="design"></a></p>
<h2 id="designing-a-pipeline-component">Designing a pipeline component</h2>
<p>When Kubeflow Pipelines executes a component, a container image is started in a
Kubernetes Pod and your component&rsquo;s inputs are passed in as command-line
arguments. You can pass small inputs, such as strings and numbers, by value.
Larger inputs, such as CSV data, must be passed as paths to files. When your
component has finished, the component&rsquo;s outputs are returned as files.</p>
<p>When you design your component&rsquo;s code, consider the following:</p>
<ul>
<li>Which inputs can be passed to your component by value? Examples of inputs that you
can pass by value include numbers, booleans, and short strings. Any value that you
could reasonably pass as a command-line argument can be passed to your component by
value.  All other inputs are passed to your component by a reference to the input&rsquo;s path.</li>
<li>To return an output from your component, the output&rsquo;s data must be stored as a file.
When you define your component, you let Kubeflow Pipelines know what outputs your
component produces. When your pipeline runs, Kubeflow Pipelines passes the
paths that you use to store your component&rsquo;s outputs as inputs to your component.</li>
<li>Outputs are typically written to a single file. In some cases, you may need to
return a directory of files as an output. In this case, create a directory at the
output path and write the output files to that location. In both cases, it may be
necessary to create parent directories if they do not exist.</li>
<li>Your component&rsquo;s goal may be to create a dataset in an external service,
such as a BigQuery table. In this case, it may make sense for the component
to output an identifier for the produced data, such as a table name,
instead of the data itself. We recommend that you limit this pattern to
cases where the data must be put into an external system instead of keeping it
inside the Kubeflow Pipelines system.</li>
<li>Since your inputs and output paths are passed in as command-line
arguments, your component&rsquo;s code must be able to read inputs from the
command line. If your component is built with Python, libraries such as
<a href="https://docs.python.org/3/library/argparse.html">argparse</a> and
<a href="https://abseil.io/docs/python/guides/flags">absl.flags</a> make it easier to
read your component&rsquo;s inputs.</li>
<li>Your component&rsquo;s code can be implemented in any language, so long as it can
run in a container image.</li>
</ul>
<p>The following is an example program written using Python3. This program reads a
given number of lines from an input file and writes those lines to an output
file. This means that this function accepts three command-line parameters:</p>
<ul>
<li>The path to the input file.</li>
<li>The number of lines to read.</li>
<li>The path to the output file.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/env python3</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">argparse</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Function doing the actual work (Outputs first N lines from a text file)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">do_work</span><span class="p">(</span><span class="n">input1_file</span><span class="p">,</span> <span class="n">output1_file</span><span class="p">,</span> <span class="n">param1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">input1_file</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="n">param1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="k">break</span>
</span></span><span class="line"><span class="cl">    <span class="n">_</span> <span class="o">=</span> <span class="n">output1_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="c1"># Defining and parsing the command-line arguments</span>
</span></span><span class="line"><span class="cl"><span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;My program description&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Paths must be passed in, not hardcoded</span>
</span></span><span class="line"><span class="cl"><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--input1-path&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Path of the local file containing the Input 1 data.&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--output1-path&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Path of the local file where the Output 1 data should be written.&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--param1&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The number of lines to read from the input and write to the output.&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Creating the directory where the output file is created (the directory</span>
</span></span><span class="line"><span class="cl"><span class="c1"># may or may not exist).</span>
</span></span><span class="line"><span class="cl"><span class="n">Path</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">output1_path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">input1_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">input1_file</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">output1_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output1_file</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">do_work</span><span class="p">(</span><span class="n">input1_file</span><span class="p">,</span> <span class="n">output1_file</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">param1</span><span class="p">)</span>
</span></span></code></pre></div><p>If this program is saved as <code>program.py</code>, the command-line invocation of this
program is:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">python3 program.py --input1-path &lt;path-to-the-input-file&gt; <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --param1 &lt;number-of-lines-to-read&gt; <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --output1-path &lt;path-to-write-the-output-to&gt; 
</span></span></code></pre></div><h2 id="containerize-your-components-code">Containerize your component&rsquo;s code</h2>
<p>For Kubeflow Pipelines to run your component, your component must be packaged
as a <a href="https://docs.docker.com/get-started/">Docker</a> container image and published to a container registry
that your Kubernetes cluster can access. The steps to create a container image
are not specific to Kubeflow Pipelines. To make things easier for you, this
section provides some guidelines on standard container creation.</p>
<ol>
<li>
<p>Create a <a href="https://docs.docker.com/engine/reference/builder/">Dockerfile</a> for your container. A Dockerfile
specifies:</p>
<ul>
<li>The base container image. For example, the operating system that your
code runs on.</li>
<li>Any dependencies that need to be installed for your code to run.</li>
<li>Files to copy into the container, such as the runnable code for this
component.</li>
</ul>
<p>The following is an example Dockerfile.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">FROM python:3.7
</span></span><span class="line"><span class="cl">RUN python3 -m pip install keras
</span></span><span class="line"><span class="cl">COPY ./src /pipelines/component/src
</span></span></code></pre></div><p>In this example:</p>
<ul>
<li>The base container image is <a href="https://hub.docker.com/_/python"><code>python:3.7</code></a>.</li>
<li>The <code>keras</code> Python package is installed in the container image.</li>
<li>Files in your <code>./src</code> directory are copied into
<code>/pipelines/component/src</code> in the container image.</li>
</ul>
</li>
<li>
<p>Create a script named <code>build_image.sh</code> that uses Docker to build your
container image and push your container image to a container registry.
Your Kubernetes cluster must be able to access your container registry
to run your component. Examples of container registries include <a href="https://cloud.google.com/container-registry/docs/">Google
Container Registry</a> and
<a href="https://hub.docker.com/">Docker Hub</a>.</p>
<p>The following example builds a container image, pushes it to a container
registry, and outputs the strict image name. It is a best practice to use
the strict image name in your component specification to ensure that you
are using the expected version of a container image in each component
execution.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/bash -e
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="nv">image_name</span><span class="o">=</span>gcr.io/my-org/my-image
</span></span><span class="line"><span class="cl"><span class="nv">image_tag</span><span class="o">=</span>latest
</span></span><span class="line"><span class="cl"><span class="nv">full_image_name</span><span class="o">=</span><span class="si">${</span><span class="nv">image_name</span><span class="si">}</span>:<span class="si">${</span><span class="nv">image_tag</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> <span class="s2">&#34;</span><span class="k">$(</span>dirname <span class="s2">&#34;</span><span class="nv">$0</span><span class="s2">&#34;</span><span class="k">)</span><span class="s2">&#34;</span> 
</span></span><span class="line"><span class="cl">docker build -t <span class="s2">&#34;</span><span class="si">${</span><span class="nv">full_image_name</span><span class="si">}</span><span class="s2">&#34;</span> .
</span></span><span class="line"><span class="cl">docker push <span class="s2">&#34;</span><span class="nv">$full_image_name</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Output the strict image name, which contains the sha256 image digest</span>
</span></span><span class="line"><span class="cl">docker inspect --format<span class="o">=</span><span class="s2">&#34;{{index .RepoDigests 0}}&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">full_image_name</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span></code></pre></div><p>In the preceding example:</p>
<ul>
<li>The <code>image_name</code> specifies the full name of your container image in the
container registry.</li>
<li>The <code>image_tag</code> specifies that this image should be tagged as
<strong>latest</strong>.</li>
</ul>
<p>Save this file and run the following to make this script executable.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">chmod +x build_image.sh
</span></span></code></pre></div></li>
<li>
<p>Run your <code>build_image.sh</code> script to build your container image and push it
to a container registry.</p>
</li>
<li>
<p><a href="https://docs.docker.com/engine/reference/commandline/run/">Use <code>docker run</code> to test your container image locally</a>. If
necessary, revise your application and Dockerfile until your application
works as expected in the container.</p>
</li>
</ol>
<p><a name="component-spec"></a></p>
<h2 id="creating-a-component-specification">Creating a component specification</h2>
<p>To create a component from your containerized program, you must create a
component specification that defines the component&rsquo;s interface and
implementation. The following sections provide an overview of how to create a
component specification by demonstrating how to define the component&rsquo;s
implementation, interface, and metadata.</p>
<p>To learn more about defining a component specification, see the
<a href="/docs/components/pipelines/reference/component-spec/">component specification reference guide</a>.</p>
<h3 id="define-your-components-implementation">Define your component&rsquo;s implementation</h3>
<p>The following example creates a component specification YAML and defines the
component&rsquo;s implementation.</p>
<ol>
<li>
<p>Create a file named <code>component.yaml</code> and open it in a text editor.</p>
</li>
<li>
<p>Create your component&rsquo;s implementation section and specify the strict name
of your container image. The strict image name is provided when you run
your <code>build_image.sh</code> script.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">implementation</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">container</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># The strict name of a container image that you&#39;ve pushed to a container registry.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">gcr.io/my-org/my-image@sha256:a172..752f</span><span class="w">
</span></span></span></code></pre></div></li>
<li>
<p>Define a <code>command</code> for your component&rsquo;s implementation. This field
specifies the command-line arguments that are used to run your program in
the container.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">implementation</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">container</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">gcr.io/my-org/my-image@sha256:a172..752f</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># command is a list of strings (command-line arguments). </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># The YAML language has two syntaxes for lists and you can use either of them. </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># Here we use the &#34;flow syntax&#34; - comma-separated strings inside square brackets.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="l">python3, </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># Path of the program inside the container</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="l">/pipelines/component/src/program.py,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>--<span class="l">input1-path,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>{<span class="nt">inputPath</span><span class="p">:</span><span class="w"> </span><span class="l">Input 1},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>--<span class="l">param1, </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>{<span class="nt">inputValue</span><span class="p">:</span><span class="w"> </span><span class="l">Parameter 1},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>--<span class="l">output1-path, </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>{<span class="nt">outputPath</span><span class="p">:</span><span class="w"> </span><span class="l">Output 1},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">]</span><span class="w">
</span></span></span></code></pre></div><p>The <code>command</code> is formatted as a list of strings. Each string in the
<code>command</code> is a command-line argument or a placeholder. At runtime,
placeholders are replaced with an input or output. In the preceding
example, two inputs and one output path are passed into a Python script at
<code>/pipelines/component/src/program.py</code>.</p>
<p>There are three types of input/output placeholders:</p>
<ul>
<li>
<p><code>{inputValue: &lt;input-name&gt;}</code>:
This placeholder is replaced with the value of the specified input.
This is useful for small pieces of input data, such as numbers or small
strings.</p>
</li>
<li>
<p><code>{inputPath: &lt;input-name&gt;}</code>:
This placeholder is replaced with the path to this input as a file.
Your component can read the contents of that input at that path during
the pipeline run.</p>
</li>
<li>
<p><code>{outputPath: &lt;output-name&gt;}</code>:
This placeholder is replaced with the path where your program writes
this output&rsquo;s data. This lets the Kubeflow Pipelines system read the
contents of the file and store it as the value of the specified output.</p>
</li>
</ul>
<p>The <code>&lt;input-name&gt;</code> name must match the name of an input in the <code>inputs</code>
section of your component specification. The <code>&lt;output-name&gt;</code> name must
match the name of an output in the <code>outputs</code> section of your component
specification.</p>
</li>
</ol>
<h3 id="define-your-components-interface">Define your component&rsquo;s interface</h3>
<p>The following examples demonstrate how to specify your component&rsquo;s interface.</p>
<ol>
<li>
<p>To define an input in your <code>component.yaml</code>, add an item to the
<code>inputs</code> list with the following attributes:</p>
<ul>
<li><code>name</code>: Human-readable name of this input. Each input&rsquo;s name must be
unique.</li>
<li><code>description</code>: (Optional.) Human-readable description of the input.</li>
<li><code>default</code>: (Optional.) Specifies the default value for this input.</li>
<li><code>type</code>: (Optional.) Specifies the input’s type. Learn more about the
<a href="https://github.com/kubeflow/pipelines/blob/sdk/release-1.8/sdk/python/kfp/dsl/types.py">types defined in the Kubeflow Pipelines SDK</a> and <a href="https://www.kubeflow.org/docs/components/pipelines/sdk/static-type-checking/">how type
checking works in pipelines and components</a>.</li>
<li><code>optional</code>: Specifies if this input is optional. The value of this
attribute is of type <code>Bool</code>, and defaults to <strong>False</strong>.</li>
</ul>
<p>In this example, the Python program has two inputs:</p>
<ul>
<li><code>Input 1</code> contains <code>String</code> data.</li>
<li><code>Parameter 1</code> contains an <code>Integer</code>.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">inputs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- {<span class="nt">name: Input 1, type: String, description</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;Data for input 1&#39;</span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- {<span class="nt">name: Parameter 1, type: Integer, default: &#39;100&#39;, description</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;Number of lines to copy&#39;</span>}<span class="w">
</span></span></span></code></pre></div><p>Note: <code>Input 1</code> and <code>Parameter 1</code> do not specify any details about how they
are stored or how much data they contain. Consider using naming conventions
to indicate if inputs are expected to be small enough to pass by value.</p>
</li>
<li>
<p>After your component finishes its task, the component&rsquo;s outputs are passed
to your pipeline as paths. At runtime, Kubeflow Pipelines creates a
path for each of your component&rsquo;s outputs. These paths are passed as inputs
to your component&rsquo;s implementation.</p>
<p>To define an output in your component specification YAML, add an item to
the <code>outputs</code> list with the following attributes:</p>
<ul>
<li><code>name</code>: Human-readable name of this output. Each output&rsquo;s name must be
unique.</li>
<li><code>description</code>: (Optional.) Human-readable description of the output.</li>
<li><code>type</code>: (Optional.) Specifies the output&rsquo;s type. Learn more about the
<a href="https://github.com/kubeflow/pipelines/blob/sdk/release-1.8/sdk/python/kfp/dsl/types.py">types defined in the Kubeflow Pipelines SDK</a> and <a href="https://www.kubeflow.org/docs/components/pipelines/sdk/static-type-checking/">how type
checking works in pipelines and components</a>.</li>
</ul>
<p>In this example, the Python program returns one output. The output is named
<code>Output 1</code> and it contains <code>String</code> data.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">outputs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- {<span class="nt">name: Output 1, type: String, description</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;Output 1 data.&#39;</span>}<span class="w">
</span></span></span></code></pre></div><p>Note: Consider using naming conventions to indicate if this output is
expected to be small enough to pass by value. You should limit the amount
of data that is passed by value to 200 KB per pipeline run.</p>
</li>
<li>
<p>After you define your component&rsquo;s interface, the <code>component.yaml</code> should be
something like the following:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">inputs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- {<span class="nt">name: Input 1, type: String, description</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;Data for input 1&#39;</span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- {<span class="nt">name: Parameter 1, type: Integer, default: &#39;100&#39;, description</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;Number of lines to copy&#39;</span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">outputs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- {<span class="nt">name: Output 1, type: String, description</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;Output 1 data.&#39;</span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">implementation</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">container</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">gcr.io/my-org/my-image@sha256:a172..752f</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># command is a list of strings (command-line arguments). </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># The YAML language has two syntaxes for lists and you can use either of them. </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># Here we use the &#34;flow syntax&#34; - comma-separated strings inside square brackets.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="l">python3, </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># Path of the program inside the container</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="l">/pipelines/component/src/program.py,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>--<span class="l">input1-path,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>{<span class="nt">inputPath</span><span class="p">:</span><span class="w"> </span><span class="l">Input 1},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>--<span class="l">param1, </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>{<span class="nt">inputValue</span><span class="p">:</span><span class="w"> </span><span class="l">Parameter 1},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>--<span class="l">output1-path, </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>{<span class="nt">outputPath</span><span class="p">:</span><span class="w"> </span><span class="l">Output 1},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">]</span><span class="w">
</span></span></span></code></pre></div></li>
</ol>
<h3 id="specify-your-components-metadata">Specify your component&rsquo;s metadata</h3>
<p>To define your component&rsquo;s metadata, add the <code>name</code> and <code>description</code>
fields to your <code>component.yaml</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Get Lines</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l">Gets the specified number of lines from the input file.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">inputs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- {<span class="nt">name: Input 1, type: String, description</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;Data for input 1&#39;</span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- {<span class="nt">name: Parameter 1, type: Integer, default: &#39;100&#39;, description</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;Number of lines to copy&#39;</span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">outputs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- {<span class="nt">name: Output 1, type: String, description</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;Output 1 data.&#39;</span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">implementation</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">container</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">gcr.io/my-org/my-image@sha256:a172..752f</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># command is a list of strings (command-line arguments). </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># The YAML language has two syntaxes for lists and you can use either of them. </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># Here we use the &#34;flow syntax&#34; - comma-separated strings inside square brackets.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="l">python3, </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># Path of the program inside the container</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="l">/pipelines/component/src/program.py,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>--<span class="l">input1-path,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>{<span class="nt">inputPath</span><span class="p">:</span><span class="w"> </span><span class="l">Input 1},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>--<span class="l">param1, </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>{<span class="nt">inputValue</span><span class="p">:</span><span class="w"> </span><span class="l">Parameter 1},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>--<span class="l">output1-path, </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>{<span class="nt">outputPath</span><span class="p">:</span><span class="w"> </span><span class="l">Output 1},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">]</span><span class="w">
</span></span></span></code></pre></div><h2 id="using-your-component-in-a-pipeline">Using your component in a pipeline</h2>
<p>You can use the Kubeflow Pipelines SDK to load your component using methods
such as the following:</p>
<ul>
<li><a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.components.html#kfp.components.load_component_from_file"><code>kfp.components.load_component_from_file</code></a>:
Use this method to load your component from a <code>component.yaml</code> path.</li>
<li><a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.components.html#kfp.components.load_component_from_url"><code>kfp.components.load_component_from_url</code></a>:
Use this method to load a <code>component.yaml</code> from a URL.</li>
<li><a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.components.html#kfp.components.load_component_from_text"><code>kfp.components.load_component_from_text</code></a>:
Use this method to load your component specification YAML from a string.
This method is useful for rapidly iterating on your component
specification.</li>
</ul>
<p>These functions create a factory function that you can use to create
<a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.dsl.html#kfp.dsl.ContainerOp"><code>ContainerOp</code></a> instances to use as steps in your pipeline.
This factory function&rsquo;s input arguments include your component&rsquo;s inputs and
the paths to your component&rsquo;s outputs. The function signature may be modified
in the following ways to ensure that it is valid and Pythonic.</p>
<ul>
<li>Inputs with default values will come after the inputs without default
values and outputs.</li>
<li>Input and output names are converted to Pythonic names (spaces and symbols
are replaced with underscores and letters are converted to lowercase). For
example, an input named <code>Input 1</code> is converted to <code>input_1</code>.</li>
</ul>
<p>The following example demonstrates how to load the text of your component
specification and run it in a two-step pipeline. Before you run this
example, update the component specification to use the component
specification you defined in the previous sections.</p>
<p>To demonstrate data passing between components, we create another component
that simply uses bash commands to write some text value to an output file.
And the output file can be passed to our previous component as an input.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">kfp</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">kfp.components</span> <span class="k">as</span> <span class="nn">comp</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">create_step_get_lines</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">load_component_from_text</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">name: Get Lines
</span></span></span><span class="line"><span class="cl"><span class="s2">description: Gets the specified number of lines from the input file.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">inputs:
</span></span></span><span class="line"><span class="cl"><span class="s2">- {name: Input 1, type: Data, description: &#39;Data for input 1&#39;}
</span></span></span><span class="line"><span class="cl"><span class="s2">- {name: Parameter 1, type: Integer, default: &#39;100&#39;, description: &#39;Number of lines to copy&#39;}
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">outputs:
</span></span></span><span class="line"><span class="cl"><span class="s2">- {name: Output 1, type: Data, description: &#39;Output 1 data.&#39;}
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">implementation:
</span></span></span><span class="line"><span class="cl"><span class="s2">  container:
</span></span></span><span class="line"><span class="cl"><span class="s2">    image: gcr.io/my-org/my-image@sha256:a172..752f
</span></span></span><span class="line"><span class="cl"><span class="s2">    # command is a list of strings (command-line arguments). 
</span></span></span><span class="line"><span class="cl"><span class="s2">    # The YAML language has two syntaxes for lists and you can use either of them. 
</span></span></span><span class="line"><span class="cl"><span class="s2">    # Here we use the &#34;flow syntax&#34; - comma-separated strings inside square brackets.
</span></span></span><span class="line"><span class="cl"><span class="s2">    command: [
</span></span></span><span class="line"><span class="cl"><span class="s2">      python3, 
</span></span></span><span class="line"><span class="cl"><span class="s2">      # Path of the program inside the container
</span></span></span><span class="line"><span class="cl"><span class="s2">      /pipelines/component/src/program.py,
</span></span></span><span class="line"><span class="cl"><span class="s2">      --input1-path,
</span></span></span><span class="line"><span class="cl"><span class="s2">      {inputPath: Input 1},
</span></span></span><span class="line"><span class="cl"><span class="s2">      --param1, 
</span></span></span><span class="line"><span class="cl"><span class="s2">      {inputValue: Parameter 1},
</span></span></span><span class="line"><span class="cl"><span class="s2">      --output1-path, 
</span></span></span><span class="line"><span class="cl"><span class="s2">      {outputPath: Output 1},
</span></span></span><span class="line"><span class="cl"><span class="s2">    ]&#34;&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># create_step_get_lines is a &#34;factory function&#34; that accepts the arguments</span>
</span></span><span class="line"><span class="cl"><span class="c1"># for the component&#39;s inputs and output paths and returns a pipeline step</span>
</span></span><span class="line"><span class="cl"><span class="c1"># (ContainerOp instance).</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1"># To inspect the get_lines_op function in Jupyter Notebook, enter </span>
</span></span><span class="line"><span class="cl"><span class="c1"># &#34;get_lines_op(&#34; in a cell and press Shift+Tab.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># You can also get help by entering `help(get_lines_op)`, `get_lines_op?`,</span>
</span></span><span class="line"><span class="cl"><span class="c1"># or `get_lines_op??`.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a simple component using only bash commands. The output of this component</span>
</span></span><span class="line"><span class="cl"><span class="c1"># can be passed to a downstream component that accepts an input with the same type.</span>
</span></span><span class="line"><span class="cl"><span class="n">create_step_write_lines</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">load_component_from_text</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">name: Write Lines
</span></span></span><span class="line"><span class="cl"><span class="s2">description: Writes text to a file.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">inputs:
</span></span></span><span class="line"><span class="cl"><span class="s2">- {name: text, type: String}
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">outputs:
</span></span></span><span class="line"><span class="cl"><span class="s2">- {name: data, type: Data}
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">implementation:
</span></span></span><span class="line"><span class="cl"><span class="s2">  container:
</span></span></span><span class="line"><span class="cl"><span class="s2">    image: busybox
</span></span></span><span class="line"><span class="cl"><span class="s2">    command:
</span></span></span><span class="line"><span class="cl"><span class="s2">    - sh
</span></span></span><span class="line"><span class="cl"><span class="s2">    - -c
</span></span></span><span class="line"><span class="cl"><span class="s2">    - |
</span></span></span><span class="line"><span class="cl"><span class="s2">      mkdir -p &#34;$(dirname &#34;$1&#34;)&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">      echo &#34;$0&#34; &gt; &#34;$1&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    args:
</span></span></span><span class="line"><span class="cl"><span class="s2">    - {inputValue: text}
</span></span></span><span class="line"><span class="cl"><span class="s2">    - {outputPath: data}
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Define your pipeline </span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">my_pipeline</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">write_lines_step</span> <span class="o">=</span> <span class="n">create_step_write_lines</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">text</span><span class="o">=</span><span class="s1">&#39;one</span><span class="se">\n</span><span class="s1">two</span><span class="se">\n</span><span class="s1">three</span><span class="se">\n</span><span class="s1">four</span><span class="se">\n</span><span class="s1">five</span><span class="se">\n</span><span class="s1">six</span><span class="se">\n</span><span class="s1">seven</span><span class="se">\n</span><span class="s1">eight</span><span class="se">\n</span><span class="s1">nine</span><span class="se">\n</span><span class="s1">ten&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">get_lines_step</span> <span class="o">=</span> <span class="n">create_step_get_lines</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Input name &#34;Input 1&#34; is converted to pythonic parameter name &#34;input_1&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">input_1</span><span class="o">=</span><span class="n">write_lines_step</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="n">parameter_1</span><span class="o">=</span><span class="s1">&#39;5&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># If you run this command on a Jupyter notebook running on Kubeflow,</span>
</span></span><span class="line"><span class="cl"><span class="c1"># you can exclude the host parameter.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># client = kfp.Client()</span>
</span></span><span class="line"><span class="cl"><span class="n">client</span> <span class="o">=</span> <span class="n">kfp</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;&lt;your-kubeflow-pipelines-host-name&gt;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Compile, upload, and submit this pipeline for execution.</span>
</span></span><span class="line"><span class="cl"><span class="n">client</span><span class="o">.</span><span class="n">create_run_from_pipeline_func</span><span class="p">(</span><span class="n">my_pipeline</span><span class="p">,</span> <span class="n">arguments</span><span class="o">=</span><span class="p">{})</span>
</span></span></code></pre></div><h2 id="organizing-the-component-files">Organizing the component files</h2>
<p>This section provides a recommended way to organize a component&rsquo;s files. There
is no requirement that you must organize the files in this way. However, using
the standard organization makes it possible to reuse the same scripts for
testing, image building, and component versioning.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zed" data-lang="zed"><span class="line"><span class="cl"><span class="nn">components/</span><span class="o">&lt;</span><span class="n">component</span><span class="w"> </span><span class="n">group</span><span class="o">&gt;/&lt;</span><span class="n">component</span><span class="w"> </span><span class="n">name</span><span class="o">&gt;/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nn">src/</span><span class="o">*</span><span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="n">Component</span><span class="w"> </span><span class="n">source</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="n">files</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nn">tests/</span><span class="o">*</span><span class="w">          </span><span class="err">#</span><span class="w"> </span><span class="n">Unit</span><span class="w"> </span><span class="n">tests</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">run_tests</span><span class="p">.</span><span class="n">sh</span><span class="w">     </span><span class="err">#</span><span class="w"> </span><span class="n">Small</span><span class="w"> </span><span class="n">script</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">runs</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">tests</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">README</span><span class="p">.</span><span class="n">md</span><span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Documentation</span><span class="p">.</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">multiple</span><span class="w"> </span><span class="n">files</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">needed</span><span class="p">,</span><span class="w"> </span><span class="n">move</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="nn">docs/</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Dockerfile</span><span class="w">       </span><span class="err">#</span><span class="w"> </span><span class="n">Dockerfile</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="n">container</span><span class="w"> </span><span class="n">image</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">build_image</span><span class="p">.</span><span class="n">sh</span><span class="w">   </span><span class="err">#</span><span class="w"> </span><span class="n">Small</span><span class="w"> </span><span class="n">script</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">runs</span><span class="w"> </span><span class="n">docker</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">docker</span><span class="w"> </span><span class="n">push</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">component</span><span class="p">.</span><span class="n">yaml</span><span class="w">   </span><span class="err">#</span><span class="w"> </span><span class="n">Component</span><span class="w"> </span><span class="kt">definition</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">YAML</span><span class="w"> </span><span class="n">format</span><span class="w">
</span></span></span></code></pre></div><p>See this <a href="https://github.com/kubeflow/pipelines/tree/sdk/release-1.8/components/sample/keras/train_classifier">sample component</a> for a real-life component example.</p>
<h2 id="next-steps">Next steps</h2>
<ul>
<li>Consolidate what you&rsquo;ve learned by reading the
<a href="/docs/components/pipelines/sdk/best-practices">best practices</a> for designing and
writing components.</li>
<li>For quick iteration,
<a href="/docs/components/pipelines/sdk/python-function-components/">build lightweight Python function-based components</a>
directly from Python functions.</li>
<li>See how to <a href="/docs/components/pipelines/sdk/pipelines-metrics/">export metrics from your
pipeline</a>.</li>
<li>Visualize the output of your component by
<a href="/docs/components/pipelines/sdk/output-viewer/">adding metadata for an output
viewer</a>.</li>
<li>Explore the <a href="/docs/examples/shared-resources/">reusable components and other shared
resources</a>.</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ec0a69a45422dd2b502a48a36d15bf24">6 - Building Python function-based components</h1>
    <div class="lead">Building your own lightweight pipelines components using Python</div>
	<!--
AUTOGENERATED FROM content/en/docs/components/pipelines/sdk/python-function-components.ipynb
PLEASE UPDATE THE JUPYTER NOTEBOOK AND REGENERATE THIS FILE USING scripts/nb_to_md.py.-->
<style>
.notebook-links {display: flex; margin: 1em 0;}
.notebook-links a {padding: .75em; margin-right: .75em; font-weight: bold;}
a.colab-link {
padding-left: 3.25em;
background-image: url(/docs/images/logos/colab.ico);
background-repeat: no-repeat;
background-size: contain;
}
a.github-link {
padding-left: 2.75em;
background-image: url(/docs/images/logos/github.png);
background-repeat: no-repeat;
background-size: auto 75%;
background-position: left center;
}
</style>
<div class="notebook-links">
<a class="colab-link" href="https://colab.research.google.com/github/kubeflow/website/blob/master/content/en/docs/components/pipelines/sdk/python-function-components.ipynb">Run in Google Colab</a>
<a class="github-link" href="https://github.com/kubeflow/website/blob/master/content/en/docs/components/pipelines/sdk/python-function-components.ipynb">View source on GitHub</a>
</div>
<p>A Kubeflow Pipelines component is a self-contained set of code that performs one step in your
ML workflow. A pipeline component is composed of:</p>
<ul>
<li>
<p>The component code, which implements the logic needed to perform a step in your ML workflow.</p>
</li>
<li>
<p>A component specification, which defines the following:</p>
<ul>
<li>The component&rsquo;s metadata, its name and description.</li>
<li>The component&rsquo;s interface, the component&rsquo;s inputs and outputs.</li>
<li>The component&rsquo;s implementation, the Docker container image
to run, how to pass inputs to your component code, and how
to get the component&rsquo;s outputs.</li>
</ul>
</li>
</ul>
<p>Python function-based components make it easier to iterate quickly by letting you build your
component code as a Python function and generating the <a href="https://www.kubeflow.org/docs/components/pipelines/reference/component-spec/">component specification</a> for you.
This document describes how to build Python function-based components and use them in your pipeline.</p>
<h2 id="before-you-begin">Before you begin</h2>
<ol>
<li>Run the following command to install the Kubeflow Pipelines SDK. If you run this command in a Jupyter
notebook, restart the kernel after installing the SDK.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">pip3</span> <span class="n">install</span> <span class="n">kfp</span> <span class="o">--</span><span class="n">upgrade</span>
</span></span></code></pre></div><ol start="2">
<li>Import the <code>kfp</code> package.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">kfp</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">kfp.components</span> <span class="kn">import</span> <span class="n">create_component_from_func</span>
</span></span></code></pre></div><ol start="3">
<li>Create an instance of the <a href="https://kubeflow-pipelines.readthedocs.io/en/latest/source/kfp.client.html#kfp.Client"><code>kfp.Client</code> class</a> following steps in <a href="https://www.kubeflow.org/docs/components/pipelines/sdk/connect-api">connecting to Kubeflow Pipelines using the SDK client</a>.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">client</span> <span class="o">=</span> <span class="n">kfp</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span> <span class="c1"># change arguments accordingly</span>
</span></span></code></pre></div><p>For more information about the Kubeflow Pipelines SDK, see the <a href="https://kubeflow-pipelines.readthedocs.io/en/stable/index.html">SDK reference guide</a>.</p>
<h2 id="getting-started-with-python-function-based-components">Getting started with Python function-based components</h2>
<p>This section demonstrates how to get started building Python function-based components by walking
through the process of creating a simple component.</p>
<ol>
<li>Define your component&rsquo;s code as a <a href="#standalone">standalone Python function</a>. In this example,
the function adds two floats and returns the sum of the two arguments.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;&#39;&#39;Calculates sum of two arguments&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</span></span></code></pre></div><ol start="2">
<li>Use <code>kfp.components.create_component_from_func</code> to generate the component specification YAML and return a
factory function that you can use to create <a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.dsl.html#kfp.dsl.ContainerOp"><code>kfp.dsl.ContainerOp</code></a> class instances for your pipeline.
The component specification YAML is a reusable and shareable definition of your component.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">add_op</span> <span class="o">=</span> <span class="n">create_component_from_func</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">add</span><span class="p">,</span> <span class="n">output_component_file</span><span class="o">=</span><span class="s1">&#39;add_component.yaml&#39;</span><span class="p">)</span>
</span></span></code></pre></div><ol start="3">
<li>Create and run your pipeline. <a href="https://www.kubeflow.org/docs/components/pipelines/sdk/build-component/">Learn more about creating and running pipelines</a>.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">kfp.dsl</span> <span class="k">as</span> <span class="nn">dsl</span>
</span></span><span class="line"><span class="cl"><span class="nd">@dsl</span><span class="o">.</span><span class="n">pipeline</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Addition pipeline&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">description</span><span class="o">=</span><span class="s1">&#39;An example pipeline that performs addition calculations.&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">add_pipeline</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">a</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">b</span><span class="o">=</span><span class="s1">&#39;7&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># Passes a pipeline parameter and a constant value to the `add_op` factory</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># function.</span>
</span></span><span class="line"><span class="cl">  <span class="n">first_add_task</span> <span class="o">=</span> <span class="n">add_op</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># Passes an output reference from `first_add_task` and a pipeline parameter</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># to the `add_op` factory function. For operations with a single return</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># value, the output reference can be accessed as `task.output` or</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># `task.outputs[&#39;output_name&#39;]`.</span>
</span></span><span class="line"><span class="cl">  <span class="n">second_add_task</span> <span class="o">=</span> <span class="n">add_op</span><span class="p">(</span><span class="n">first_add_task</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Specify argument values for your pipeline run.</span>
</span></span><span class="line"><span class="cl"><span class="n">arguments</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="s1">&#39;7&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="s1">&#39;8&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a pipeline run, using the client you initialized in a prior step.</span>
</span></span><span class="line"><span class="cl"><span class="n">client</span><span class="o">.</span><span class="n">create_run_from_pipeline_func</span><span class="p">(</span><span class="n">add_pipeline</span><span class="p">,</span> <span class="n">arguments</span><span class="o">=</span><span class="n">arguments</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="building-python-function-based-components">Building Python function-based components</h2>
<p>Use the following instructions to build a Python function-based component:</p>
<p><a name="standalone"></a></p>
<ol>
<li>
<p>Define a standalone Python function. This function must meet the following
requirements:</p>
<ul>
<li>It should not use any code declared outside of the function definition.</li>
<li>Import statements must be added inside the function. <a href="#packages">Learn more about
using and installing Python packages in your component</a>.</li>
<li>Helper functions must be defined inside this function.</li>
</ul>
</li>
<li>
<p>Kubeflow Pipelines uses your function&rsquo;s inputs and outputs to define your
component&rsquo;s interface. <a href="#pass-data">Learn more about passing data between
components</a>. Your function&rsquo;s inputs and outputs must meet the
following requirements:</p>
<ul>
<li>If the function accepts or returns large amounts of data or complex
data types, you must pass that data as a file. <a href="#pass-by-file">Learn more about using
large amounts of data as inputs or outputs</a>.</li>
<li>If the function accepts numeric values as parameters, the parameters
must have type hints. Supported types are <code>int</code> and <code>float</code>. Otherwise,
parameters are passed as strings.</li>
<li>If your component returns multiple small outputs (short strings,
numbers, or booleans), annotate your function with the
<a href="https://docs.python.org/3/library/typing.html#typing.NamedTuple"><code>typing.NamedTuple</code></a> type hint and use the
<a href="https://docs.python.org/3/library/collections.html#collections.namedtuple"><code>collections.namedtuple</code></a> function return your function&rsquo;s
outputs as a new subclass of tuple. For an example, read
<a href="#pass-by-value">Passing parameters by value</a>.</li>
</ul>
</li>
<li>
<p>(Optional.) If your function has complex dependencies, choose or build a
container image for your Python function to run in. <a href="#containers">Learn more about
selecting or building your component&rsquo;s container image</a>.</p>
</li>
<li>
<p>Call <a href="https://kubeflow-pipelines.readthedocs.io/en/latest/source/kfp.components.html#kfp.components.create_component_from_func"><code>kfp.components.create_component_from_func(func)</code></a>
to convert your function into a pipeline component.</p>
<ul>
<li><strong>func</strong>: The Python function to convert.</li>
<li><strong>base_image</strong>: (Optional.) Specify the Docker container image to run
this function in. <a href="#containers">Learn more about selecting or building a container
image</a>.</li>
<li><strong>output_component_file</strong>: (Optional.) Writes your component definition
to a file. You can use this file to share the component with colleagues
or reuse it in different pipelines.</li>
<li><strong>packages_to_install</strong>: (Optional.) A list of versioned Python
packages to install before running your function.</li>
</ul>
</li>
</ol>
<p><a name="packages"></a></p>
<h3 id="using-and-installing-python-packages">Using and installing Python packages</h3>
<p>When Kubeflow Pipelines runs your pipeline, each component runs within a Docker
container image on a Kubernetes Pod. To load the packages that your Python
function depends on, one of the following must be true:</p>
<ul>
<li>The package must be installed on the container image.</li>
<li>The package must be defined using the <code>packages_to_install</code> parameter of the
<a href="https://kubeflow-pipelines.readthedocs.io/en/latest/source/kfp.components.html#kfp.components.create_component_from_func"><code>kfp.components.create_component_from_func(func)</code></a>
function.</li>
<li>Your function must install the package. For example, your function can use
the <a href="https://docs.python.org/3/library/subprocess.html"><code>subprocess</code> module</a> to run a command like <code>pip install</code>
that installs a package.</li>
</ul>
<p><a name="containers"></a></p>
<h3 id="selecting-or-building-a-container-image">Selecting or building a container image</h3>
<p>Currently, if you do not specify a container image, your Python-function based
component uses the <a href="https://hub.docker.com/layers/python/library/python/3.7/images/sha256-7eef781ed825f3b95c99f03f4189a8e30e718726e8490651fa1b941c6c815ad1?context=explore"><code>python:3.7</code> container image</a>. If your function
has complex dependencies, you may benefit from using a container image that has
your dependencies preinstalled, or building a custom container image.
Preinstalling your dependencies reduces the amount of time that your component
runs in, since your component does not need to download and install packages
each time it runs.</p>
<p>Many frameworks, such as <a href="https://www.tensorflow.org/install/docker">TensorFlow</a> and <a href="https://hub.docker.com/r/pytorch/pytorch/tags">PyTorch</a>,
and cloud service providers offer prebuilt container images that have common
dependencies installed.</p>
<p>If a prebuilt container is not available, you can build a custom container
image with your Python function&rsquo;s dependencies. For more information about
building a custom container, read the <a href="https://docs.docker.com/engine/reference/builder/">Dockerfile reference guide in the Docker
documentation</a>.</p>
<p>If you build or select a container image, instead of using the default
container image, the container image must use Python 3.5 or later.</p>
<p><a name="pass-data"></a></p>
<h3 id="understanding-how-data-is-passed-between-components">Understanding how data is passed between components</h3>
<p>When Kubeflow Pipelines runs your component, a container image is started in a
Kubernetes Pod and your component&rsquo;s inputs are passed in as command-line
arguments. When your component has finished, the component’s outputs are
returned as files.</p>
<p>Python function-based components make it easier to build pipeline components by
building the component specification for you. Python function-based components
also handle the complexity of passing inputs into your component and passing
your function&rsquo;s outputs back to your pipeline.</p>
<p>The following sections describe how to pass parameters by value and by file.</p>
<ul>
<li>Parameters that are passed by value include numbers, booleans, and short
strings. Kubeflow Pipelines passes parameters to your component by value,
by passing the values as command-line arguments.</li>
<li>Parameters that are passed by file include CSV, images, and complex types.
These files are stored in a location that is accessible to your component
running on Kubernetes, such as a persistent volume claim or a cloud
storage service. Kubeflow Pipelines passes parameters to your component by
file, by passing their paths as a command-line argument.</li>
</ul>
<p><a name="parameter-names"></a></p>
<h4 id="input-and-output-parameter-names">Input and output parameter names</h4>
<p>When you use the Kubeflow Pipelines SDK to convert your Python function to a
pipeline component, the Kubeflow Pipelines SDK uses the function&rsquo;s interface
to define the interface of your component in the following ways:</p>
<ul>
<li>Some arguments define input parameters.</li>
<li>Some arguments define output parameters.</li>
<li>The function&rsquo;s return value is used as an output parameter. If the return
value is a <a href="https://docs.python.org/3/library/collections.html#collections.namedtuple"><code>collections.namedtuple</code></a>, the named tuple is used
to return several small values.</li>
</ul>
<p>Since you can pass parameters between components as a value or as a path, the
Kubeflow Pipelines SDK removes common parameter suffixes that leak the
component&rsquo;s expected implementation. For example, a Python function-based
component that ingests data and outputs CSV data may have an output argument
that is defined as <code>csv_path: comp.OutputPath(str)</code>. In this case, the output
is the CSV data, not the path. So, the Kubeflow Pipelines SDK simplifies the
output name to <code>csv</code>.</p>
<p>The Kubeflow Pipelines SDK uses the following rules to define the input and
output parameter names in your component&rsquo;s interface:</p>
<ul>
<li>If the argument name ends with <code>_path</code> and the argument is annotated as an
<a href="https://kubeflow-pipelines.readthedocs.io/en/latest/source/kfp.components.html#kfp.components.InputPath"><code>kfp.components.InputPath</code></a> or
<a href="https://kubeflow-pipelines.readthedocs.io/en/latest/source/kfp.components.html#kfp.components.OutputPath"><code>kfp.components.OutputPath</code></a>, the parameter name is the
argument name with the trailing <code>_path</code> removed.</li>
<li>If the argument name ends with <code>_file</code>, the parameter name is the argument
name with the trailing <code>_file</code> removed.</li>
<li>If you return a single small value from your component using the <code>return</code>
statement, the output parameter is named <code>output</code>.</li>
<li>If you return several small values from your component by returning a
<a href="https://docs.python.org/3/library/collections.html#collections.namedtuple"><code>collections.namedtuple</code></a>, the Kubeflow Pipelines SDK uses
the tuple&rsquo;s field names as the output parameter names.</li>
</ul>
<p>Otherwise, the Kubeflow Pipelines SDK uses the argument name as the parameter
name.</p>
<p><a name="pass-by-value"></a></p>
<h4 id="passing-parameters-by-value">Passing parameters by value</h4>
<p>Python function-based components make it easier to pass parameters between
components by value (such as numbers, booleans, and short strings), by letting
you define your component’s interface by annotating your Python function. The
supported types are <code>int</code>, <code>float</code>, <code>bool</code>, and <code>str</code>. You can also pass
<code>list</code> or <code>dict</code> instances by value, if they contain small values, such as
<code>int</code>, <code>float</code>, <code>bool</code>, or <code>str</code> values. If you do not annotate your function,
these input parameters are passed as strings.</p>
<p>If your component returns multiple outputs by value, annotate your function
with the <a href="https://docs.python.org/3/library/typing.html#typing.NamedTuple"><code>typing.NamedTuple</code></a> type hint and use the
<a href="https://docs.python.org/3/library/collections.html#collections.namedtuple"><code>collections.namedtuple</code></a> function to return your function&rsquo;s
outputs as a new subclass of <code>tuple</code>.</p>
<p>You can also return metadata and metrics from your function.</p>
<ul>
<li>Metadata helps you visualize pipeline results.
<a href="https://www.kubeflow.org/docs/components/pipelines/sdk/output-viewer/">Learn more about visualizing pipeline metadata</a>.</li>
<li>Metrics help you compare pipeline runs.
<a href="https://www.kubeflow.org/docs/components/pipelines/sdk/pipelines-metrics/">Learn more about using pipeline metrics</a>.</li>
</ul>
<p>The following example demonstrates how to return multiple outputs by value,
including component metadata and metrics.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NamedTuple</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">multiple_return_values_example</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NamedTuple</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;ExampleOutputs&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s1">&#39;product&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s1">&#39;mlpipeline_ui_metadata&#39;</span><span class="p">,</span> <span class="s1">&#39;UI_metadata&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s1">&#39;mlpipeline_metrics&#39;</span><span class="p">,</span> <span class="s1">&#39;Metrics&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">]):</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;&#34;&#34;Example function that demonstrates how to return multiple values.&#34;&#34;&#34;</span>  
</span></span><span class="line"><span class="cl">  <span class="n">sum_value</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</span></span><span class="line"><span class="cl">  <span class="n">product_value</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Export a sample tensorboard</span>
</span></span><span class="line"><span class="cl">  <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;outputs&#39;</span> <span class="p">:</span> <span class="p">[{</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;tensorboard&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="s1">&#39;gs://ml-pipeline-dataset/tensorboard-train&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">}]</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Export two metrics</span>
</span></span><span class="line"><span class="cl">  <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;metrics&#39;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;sum&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;numberValue&#39;</span><span class="p">:</span>  <span class="nb">float</span><span class="p">(</span><span class="n">sum_value</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">      <span class="p">},{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;product&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;numberValue&#39;</span><span class="p">:</span>  <span class="nb">float</span><span class="p">(</span><span class="n">product_value</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>  
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
</span></span><span class="line"><span class="cl">  <span class="n">example_output</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;ExampleOutputs&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">[</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="s1">&#39;product&#39;</span><span class="p">,</span> <span class="s1">&#39;mlpipeline_ui_metadata&#39;</span><span class="p">,</span> <span class="s1">&#39;mlpipeline_metrics&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">example_output</span><span class="p">(</span><span class="n">sum_value</span><span class="p">,</span> <span class="n">product_value</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">metrics</span><span class="p">)</span>
</span></span></code></pre></div><p><a name="pass-by-file"></a></p>
<h4 id="passing-parameters-by-file">Passing parameters by file</h4>
<p>Python function-based components make it easier to pass files to your
component, or to return files from your component, by letting you annotate
your Python function&rsquo;s parameters to specify which parameters refer to a file.
Your Python function&rsquo;s parameters can refer to either input or output files.
If your parameter is an output file, Kubeflow Pipelines passes your function a
path or stream that you can use to store your output file.</p>
<p>The following example accepts a file as an input and returns two files as outputs.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">split_text_lines</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">source_path</span><span class="p">:</span> <span class="n">comp</span><span class="o">.</span><span class="n">InputPath</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">odd_lines_path</span><span class="p">:</span> <span class="n">comp</span><span class="o">.</span><span class="n">OutputPath</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">even_lines_path</span><span class="p">:</span> <span class="n">comp</span><span class="o">.</span><span class="n">OutputPath</span><span class="p">(</span><span class="nb">str</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Splits a text file into two files, with even lines going to one file
</span></span></span><span class="line"><span class="cl"><span class="s2">    and odd lines to the other.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">source_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">odd_lines_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">odd_writer</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">even_lines_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">even_writer</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="n">line</span> <span class="o">==</span> <span class="s2">&#34;&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="k">break</span>
</span></span><span class="line"><span class="cl">                    <span class="n">odd_writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="n">line</span> <span class="o">==</span> <span class="s2">&#34;&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="k">break</span>
</span></span><span class="line"><span class="cl">                    <span class="n">even_writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span></span></code></pre></div><p>In this example, the inputs and outputs are defined as parameters of the
<code>split_text_lines</code> function. This lets Kubeflow Pipelines pass the path to the
source data file and the paths to the output data files into the function.</p>
<p>To accept a file as an input parameter, use one of the following type annotations:</p>
<ul>
<li><a href="https://kubeflow-pipelines.readthedocs.io/en/latest/source/kfp.components.html#kfp.components.InputBinaryFile"><code>kfp.components.InputBinaryFile</code></a>: Use this annotation to
specify that your function expects a parameter to be an
<a href="https://docs.python.org/3/library/io.html#io.BytesIO"><code>io.BytesIO</code></a> instance that this function can read.</li>
<li><a href="https://kubeflow-pipelines.readthedocs.io/en/latest/source/kfp.components.html#kfp.components.InputPath"><code>kfp.components.InputPath</code></a>: Use this annotation to specify that
your function expects a parameter to be the path to the input file as
a <code>string</code>.</li>
<li><a href="https://kubeflow-pipelines.readthedocs.io/en/latest/source/kfp.components.html#kfp.components.InputTextFile"><code>kfp.components.InputTextFile</code></a>: Use this annotation to specify
that your function expects a parameter to be an
<a href="https://docs.python.org/3/library/io.html#io.TextIOWrapper"><code>io.TextIOWrapper</code></a> instance that this function can read.</li>
</ul>
<p>To return a file as an output, use one of the following type annotations:</p>
<ul>
<li><a href="https://kubeflow-pipelines.readthedocs.io/en/latest/source/kfp.components.html#kfp.components.OutputBinaryFile"><code>kfp.components.OutputBinaryFile</code></a>: Use this annotation to
specify that your function expects a parameter to be an
<a href="https://docs.python.org/3/library/io.html#io.BytesIO"><code>io.BytesIO</code></a> instance that this function can write to.</li>
<li><a href="https://kubeflow-pipelines.readthedocs.io/en/latest/source/kfp.components.html#kfp.components.OutputPath"><code>kfp.components.OutputPath</code></a>: Use this annotation to specify that
your function expects a parameter to be the path to store the output file at
as a <code>string</code>.</li>
<li><a href="https://kubeflow-pipelines.readthedocs.io/en/latest/source/kfp.components.html#kfp.components.OutputTextFile"><code>kfp.components.OutputTextFile</code></a>: Use this annotation to specify
that your function expects a parameter to be an
<a href="https://docs.python.org/3/library/io.html#io.TextIOWrapper"><code>io.TextIOWrapper</code></a> that this function can write to.</li>
</ul>
<h2 id="example-python-function-based-component">Example Python function-based component</h2>
<p>This section demonstrates how to build a Python function-based component that uses imports,
helper functions, and produces multiple outputs.</p>
<ol>
<li>Define your function. This example function uses the <code>numpy</code> package to calculate the quotient
and remainder for a given dividend and divisor in a helper function. In addition to the quotient
and remainder, the function also returns metadata for visualization and two metrics.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NamedTuple</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">my_divmod</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">dividend</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">divisor</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NamedTuple</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;MyDivmodOutput&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s1">&#39;quotient&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s1">&#39;remainder&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s1">&#39;mlpipeline_ui_metadata&#39;</span><span class="p">,</span> <span class="s1">&#39;UI_metadata&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s1">&#39;mlpipeline_metrics&#39;</span><span class="p">,</span> <span class="s1">&#39;Metrics&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">]):</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;&#39;&#39;Divides two numbers and calculate  the quotient and remainder&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Import the numpy package inside the component function</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Define a helper function</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">divmod_helper</span><span class="p">(</span><span class="n">dividend</span><span class="p">,</span> <span class="n">divisor</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">divmod</span><span class="p">(</span><span class="n">dividend</span><span class="p">,</span> <span class="n">divisor</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="n">quotient</span><span class="p">,</span> <span class="n">remainder</span><span class="p">)</span> <span class="o">=</span> <span class="n">divmod_helper</span><span class="p">(</span><span class="n">dividend</span><span class="p">,</span> <span class="n">divisor</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">from</span> <span class="nn">tensorflow.python.lib.io</span> <span class="kn">import</span> <span class="n">file_io</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Export a sample tensorboard</span>
</span></span><span class="line"><span class="cl">    <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;outputs&#39;</span> <span class="p">:</span> <span class="p">[{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;tensorboard&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="s1">&#39;gs://ml-pipeline-dataset/tensorboard-train&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">}]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Export two metrics</span>
</span></span><span class="line"><span class="cl">    <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;metrics&#39;</span><span class="p">:</span> <span class="p">[{</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;quotient&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;numberValue&#39;</span><span class="p">:</span>  <span class="nb">float</span><span class="p">(</span><span class="n">quotient</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="p">},{</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;remainder&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;numberValue&#39;</span><span class="p">:</span>  <span class="nb">float</span><span class="p">(</span><span class="n">remainder</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="p">}]}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
</span></span><span class="line"><span class="cl">    <span class="n">divmod_output</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;MyDivmodOutput&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span><span class="s1">&#39;quotient&#39;</span><span class="p">,</span> <span class="s1">&#39;remainder&#39;</span><span class="p">,</span> <span class="s1">&#39;mlpipeline_ui_metadata&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s1">&#39;mlpipeline_metrics&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">divmod_output</span><span class="p">(</span><span class="n">quotient</span><span class="p">,</span> <span class="n">remainder</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">metadata</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                         <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">metrics</span><span class="p">))</span>
</span></span></code></pre></div><ol start="2">
<li>Test your function by running it directly, or with unit tests.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_divmod</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
</span></span></code></pre></div><ol start="3">
<li>
<p>This should return a result like the following:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">MyDivmodOutput(quotient=14, remainder=2, mlpipeline_ui_metadata=&#39;{&#34;outputs&#34;: [{&#34;type&#34;: &#34;tensorboard&#34;, &#34;source&#34;: &#34;gs://ml-pipeline-dataset/tensorboard-train&#34;}]}&#39;, mlpipeline_metrics=&#39;{&#34;metrics&#34;: [{&#34;name&#34;: &#34;quotient&#34;, &#34;numberValue&#34;: 14.0}, {&#34;name&#34;: &#34;remainder&#34;, &#34;numberValue&#34;: 2.0}]}&#39;)
</span></span></code></pre></div></li>
<li>
<p>Use <code>kfp.components.create_component_from_func</code> to return a factory function that you can use to create
<a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.dsl.html#kfp.dsl.ContainerOp"><code>kfp.dsl.ContainerOp</code></a> class instances for your pipeline. This example also specifies the base container
image to run this function in.</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">divmod_op</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">create_component_from_func</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">my_divmod</span><span class="p">,</span> <span class="n">base_image</span><span class="o">=</span><span class="s1">&#39;tensorflow/tensorflow:1.11.0-py3&#39;</span><span class="p">)</span>
</span></span></code></pre></div><ol start="4">
<li>Define your pipeline. This example uses the <code>divmod_op</code> factory function and the <code>add_op</code>
factory function from an earlier example.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">kfp.dsl</span> <span class="k">as</span> <span class="nn">dsl</span>
</span></span><span class="line"><span class="cl"><span class="nd">@dsl</span><span class="o">.</span><span class="n">pipeline</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">   <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Calculation pipeline&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="n">description</span><span class="o">=</span><span class="s1">&#39;An example pipeline that performs arithmetic calculations.&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">calc_pipeline</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">   <span class="n">a</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="n">b</span><span class="o">=</span><span class="s1">&#39;7&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="n">c</span><span class="o">=</span><span class="s1">&#39;17&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Passes a pipeline parameter and a constant value as operation arguments.</span>
</span></span><span class="line"><span class="cl">    <span class="n">add_task</span> <span class="o">=</span> <span class="n">add_op</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="c1"># The add_op factory function returns</span>
</span></span><span class="line"><span class="cl">                            <span class="c1"># a dsl.ContainerOp class instance. </span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Passes the output of the add_task and a pipeline parameter as operation</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># arguments. For an operation with a single return value, the output</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># reference is accessed using `task.output` or</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># `task.outputs[&#39;output_name&#39;]`.</span>
</span></span><span class="line"><span class="cl">    <span class="n">divmod_task</span> <span class="o">=</span> <span class="n">divmod_op</span><span class="p">(</span><span class="n">add_task</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># For an operation with multiple return values, output references are</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># accessed as `task.outputs[&#39;output_name&#39;]`.</span>
</span></span><span class="line"><span class="cl">    <span class="n">result_task</span> <span class="o">=</span> <span class="n">add_op</span><span class="p">(</span><span class="n">divmod_task</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;quotient&#39;</span><span class="p">],</span> <span class="n">c</span><span class="p">)</span>
</span></span></code></pre></div><ol start="5">
<li>Compile and run your pipeline. <a href="https://www.kubeflow.org/docs/components/pipelines/sdk/build-component/">Learn more about compiling and running pipelines</a>.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Specify pipeline argument values</span>
</span></span><span class="line"><span class="cl"><span class="n">arguments</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="s1">&#39;7&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="s1">&#39;8&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Submit a pipeline run</span>
</span></span><span class="line"><span class="cl"><span class="n">client</span><span class="o">.</span><span class="n">create_run_from_pipeline_func</span><span class="p">(</span><span class="n">calc_pipeline</span><span class="p">,</span> <span class="n">arguments</span><span class="o">=</span><span class="n">arguments</span><span class="p">)</span>
</span></span></code></pre></div><div class="notebook-links">
<a class="colab-link" href="https://colab.research.google.com/github/kubeflow/website/blob/master/content/en/docs/components/pipelines/sdk/python-function-components.ipynb">Run in Google Colab</a>
<a class="github-link" href="https://github.com/kubeflow/website/blob/master/content/en/docs/components/pipelines/sdk/python-function-components.ipynb">View source on GitHub</a>
</div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-affaa52b1b38b301a656c06f43992a9c">7 - Best Practices for Designing Components</h1>
    <div class="lead">Designing and writing components for Kubeflow Pipelines</div>
	

<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Out of date</h4>

    This guide contains outdated information pertaining to Kubeflow 1.0. This guide
needs to be updated for Kubeflow 1.1.

</div>

<p>This page describes some recommended practices for designing
components. For an application of these best practices, see the
<a href="/docs/components/pipelines/sdk/component-development">component development guide</a>. If
you&rsquo;re new to pipelines, see the conceptual guides to
<a href="/docs/components/pipelines/concepts/pipeline/">pipelines</a>
and <a href="/docs/components/pipelines/concepts/component/">components</a>.</p>
<p><a id="general"></a></p>
<h3 id="general-component-design-rules">General component design rules</h3>
<ul>
<li>Design your components with composability in mind. Think about
upstream and downstream components. What formats to consume as inputs from
the upstream components. What formats to use for output data so that
downstream components can consume it.</li>
<li>Component code must use local files for input/output data (unless impossible
<ul>
<li>for example, Cloud ML Engine and BigQuery require Cloud Storage staging
paths).</li>
</ul>
</li>
<li>Components must be <em>pure</em> - they must not use any outside data except data
that comes through inputs (unless impossible). Everything should either be
inside the container or come from inputs. Network access is strongly
discouraged unless that&rsquo;s the explicit purpose of a component (for example,
upload/download).</li>
</ul>
<h2 id="writing-component-code">Writing component code</h2>
<ul>
<li>
<p>The program must be runnable both locally and inside the Docker
container.</p>
</li>
<li>
<p>Programming languages:</p>
<ul>
<li>Generally, use the language that makes the most sense. If the
component wraps a Java library, then it may make sense to use Java to
expose that library.</li>
<li>For most new components when the performance is not a concern
the Python language is preferred (use version 3 wherever possible).</li>
<li>If a component wraps an existing program, it&rsquo;s preferred to
directly expose the program in the component command line.</li>
<li>If there needs to be some wrapper around the program (small
pre-processing or post-processing like file renaming), it can be done
with a shell script.</li>
<li>Follow the best practices for the chosen language.</li>
</ul>
</li>
<li>
<p>Each output data piece should be written to a separate file (see next line).</p>
</li>
<li>
<p>The input and output file paths must be passed in the command line and
not hard coded:</p>
<ul>
<li>
<p>Typical command line:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">program.py --input-data &lt;input path&gt; --output-data &lt;output path&gt; --param 42
</span></span></code></pre></div></li>
<li>
<p>Do NOT hardcode paths in the program:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">open(&#34;/output.txt&#34;, &#34;w&#34;)
</span></span></code></pre></div></li>
</ul>
</li>
<li>
<p>For temporary data you should use library functions that create
temporary files. For example, for Python use
<a href="https://docs.python.org/3/library/tempfile.html">https://docs.python.org/3/library/tempfile.html</a>.
Do not just write to the root, or testing will be hard.</p>
</li>
<li>
<p>Design the code to be testable.</p>
</li>
</ul>
<h2 id="writing-tests">Writing tests</h2>
<ul>
<li>
<p>Follow the <a href="#general">general rules</a> section so that writing the tests is
easier.</p>
</li>
<li>
<p>Use the unit testing libraries that are standard for the language you&rsquo;re
using.</p>
</li>
<li>
<p>Try to design the component code so that it can be tested using unit tests.
Do not use network unless necessary.</p>
</li>
<li>
<p>Prepare small input data files so that the component code can be tested in
isolation. For example, for an ML prediction component prepare a small model
and evaluation dataset.</p>
</li>
<li>
<p>Use testing best practices.</p>
<ul>
<li>
<p>Test the expected behavior of the code. Don&rsquo;t just verify that
&ldquo;nothing has changed&rdquo;:</p>
<ul>
<li>For training you can look at loss at final iteration.</li>
<li>For prediction you can look at the result metrics.</li>
<li>For data augmenting you can check for some desired post-invariants.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>If the component cannot be tested locally or in isolation, then create a
small proof-of-concept pipeline that tests the component. You can use
conditionals to verify the output values of a particular task and only
enable the &ldquo;success&rdquo; task if the results are expected.</p>
</li>
</ul>
<h2 id="writing-a-dockerfile">Writing a Dockerfile</h2>
<ul>
<li>
<p>Follow the
<a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/">Docker best practices</a></p>
</li>
<li>
<p>Structure the Dockerfile so that the required packages are installed
first and the main component scripts/binaries are added last. Ideally, split
the Dockerfile in two parts (base image and component code) so that the
main component image build is fast and more reliable (not require network
access).</p>
</li>
</ul>
<h2 id="writing-a-component-specification-yaml-file">Writing a component specification YAML file</h2>
<p>For the complete definition of a Kubeflow Pipelines component, see the
<a href="/docs/components/pipelines/reference/component-spec/">component specification</a>.
When creating your <code>component.yaml</code> file, you can look at the definitions for
some
<a href="https://github.com/kubeflow/pipelines/search?q=filename%3Acomponent.yaml&amp;unscoped_q=filename%3Acomponent.yaml">existing components</a>.</p>
<ul>
<li>Use the <code>{inputValue: Input name}</code> command-line placeholder for small
values that should be directly inserted into the command-line.</li>
<li>Use the <code>{inputPath: Input name}</code> command-line placeholder for input file
locations.</li>
<li>Use the <code>{outputPath: Output name}</code> command-line placeholder for output file
locations.</li>
<li>Specify the full command line in ‘command:&rsquo; instead of just arguments to the
entry point.</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-6a9a2a321d5959620aa38f3f01399c97">8 - Pipeline Parameters</h1>
    <div class="lead">Passing data between pipeline components</div>
	<p>The <a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.dsl.html#kfp.dsl.PipelineParam"><code>kfp.dsl.PipelineParam</code>
class</a>
represents a reference to future data that will be passed to the pipeline or produced by a task.</p>
<p>Your pipeline function should have parameters, so that they can later be configured in the Kubeflow Pipelines UI.</p>
<p>When your pipeline function is called, each function argument will be a <code>PipelineParam</code> object.
You can pass those objects to the components as arguments to instantiate them and create tasks.
A <code>PipelineParam</code> can also represent an intermediate value that you pass between pipeline tasks.
Each task has outputs and you can get references to them from the <code>task.outputs[&lt;output_name&gt;]</code> dictionary.
The task output references can again be passed to other components as arguments.</p>
<p>In most cases you do not need to construct <code>PipelineParam</code> objects manually.</p>
<p>The following code sample shows how to define a pipeline with parameters:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nd">@kfp</span><span class="o">.</span><span class="n">dsl</span><span class="o">.</span><span class="n">pipeline</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;My pipeline&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">description</span><span class="o">=</span><span class="s1">&#39;My machine learning pipeline&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">my_pipeline</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">my_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">my_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;some text&#39;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">my_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;http://example.com&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="o">...</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># In the pipeline function body you can use the `my_num`, `my_name`, </span>
</span></span><span class="line"><span class="cl">  <span class="c1"># `my_url` arguments as PipelineParam objects.</span>
</span></span></code></pre></div><p>For more information, you can refer to the guide on
<a href="/docs/components/pipelines/sdk/component-development/">building components and pipelines</a>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-6c3616d054a1d9bb69a6a3e81e532406">9 - Visualize Results in the Pipelines UI</h1>
    <div class="lead">Visualizing the results of your pipelines component</div>
	<p>This page shows you how to use the Kubeflow Pipelines UI to visualize output
from a Kubeflow Pipelines component.
For details about how to build a component, see the guide to
<a href="/docs/components/pipelines/sdk/build-component/">building your own component</a>.</p>
<p>Kubeflow Pipelines provides a new method of generating visualizations. See the
guide to <a href="/docs/components/pipelines/sdk/python-based-visualizations/">Python Based Visualizations</a>.</p>
<h2 id="introduction">Introduction</h2>
<p>The Kubeflow Pipelines UI offers built-in support for several types of
visualizations, which you can use to provide rich performance evaluation and
comparison data. Follow the instruction below to write visualization output
data to file system. You can do this at any point during the pipeline execution.</p>
<p>You can view the output visualizations in the following places on the Kubeflow
Pipelines UI:</p>
<ul>
<li>
<p>The <strong>Run output</strong> tab shows the visualizations for all pipeline steps in the
selected run. To open the tab in the Kubeflow Pipelines UI:</p>
<ol>
<li>Click <strong>Experiments</strong> to see your current pipeline experiments.</li>
<li>Click the <em>experiment name</em> of the experiment that you want to view.</li>
<li>Click the <em>run name</em> of the run that you want to view.</li>
<li>Click the <strong>Run output</strong> tab.</li>
</ol>
<p><img src="/docs/images/taxi-tip-run-output.png" 
alt="Output visualization from a pipeline run"
class="mt-3 mb-3 border border-info rounded"></p>
</li>
<li>
<p>The <strong>Visualizations</strong> tab shows the visualization for the selected pipeline step.
To open the tab in the Kubeflow Pipelines UI:</p>
<ol>
<li>Click <strong>Experiments</strong> to see your current pipeline experiments.</li>
<li>Click the <em>experiment name</em> of the experiment that you want to view.</li>
<li>Click the <em>run name</em> of the run that you want to view.</li>
<li>On the <strong>Graph</strong> tab, click the step representing the pipeline component
that you want to view. The step details slide into view, showing the
<strong>Visualizations</strong> tab.</li>
</ol>
<p><img src="/docs/images/pipelines/v1/confusion-matrix-task.png" 
alt="Table-based visualization from a pipeline component"
class="mt-3 mb-3 border border-info rounded"></p>
</li>
</ul>
<p>All screenshots and code snippets on this page come from a
sample pipeline that you can run directly from the Kubeflow Pipelines UI.
See the <a href="#example-source">sample description and links below</a>.</p>
<p><a id="v2-visualization"></a></p>
<h2 id="v2-sdk-use-sdk-visualization-apis">v2 SDK: Use SDK visualization APIs</h2>
<p>For KFP <a href="/docs/components/pipelines/sdk-v2/">SDK v2 and v2 compatible mode</a>, you can use
convenient SDK APIs and system artifact types for metrics visualization. Currently KFP
supports ROC Curve, Confusion Matrix and Scalar Metrics formats. Full pipeline example
of all metrics visualizations can be found in <a href="https://github.com/kubeflow/pipelines/blob/sdk/release-1.8/samples/test/metrics_visualization_v2.py">metrics_visualization_v2.py</a>.</p>
<h3 id="requirements">Requirements</h3>
<ul>
<li>Use Kubeflow Pipelines v1.7.0 or above: <a href="/docs/components/pipelines/installation/standalone-deployment/#upgrading-kubeflow-pipelines">upgrade Kubeflow Pipelines</a>.</li>
<li>Use <code>kfp.dsl.PipelineExecutionMode.V2_COMPATIBLE</code> mode when you <a href="/docs/components/pipelines/sdk-v2/build-pipeline/#compile-and-run-your-pipeline">compile and run your pipelines</a>.</li>
<li>Make sure to use the latest environment kustomize manifest <a href="https://github.com/kubeflow/pipelines/blob/sdk/release-1.8/manifests/kustomize/env/dev/kustomization.yaml">pipelines/manifests/kustomize/env/dev/kustomization.yaml</a>.</li>
</ul>
<p>For a usage guide of each metric visualization output, refer to sections below:</p>
<h3 id="confusion-matrix">Confusion Matrix</h3>
<p>Define <code>Output[ClassificationMetrics]</code> argument in your component function, then
output Confusion Matrix data using API
<code>log_confusion_matrix(self, categories: List[str], matrix: List[List[int]])</code>. <code>categories</code>
provides a list of names for each label, <code>matrix</code> provides prediction performance for corresponding
label. There are multiple APIs you can use for logging Confusion Matrix. Refer to
<a href="https://github.com/kubeflow/pipelines/blob/55a2fb5c20011b01945c9867ddff0d39e9db1964/sdk/python/kfp/v2/components/types/artifact_types.py#L255-L256">artifact_types.py</a> for detail.</p>
<p>Refer to example below for logging Confusion Matrix:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">@component(
</span></span><span class="line"><span class="cl">    packages_to_install=[&#39;sklearn&#39;],
</span></span><span class="line"><span class="cl">    base_image=&#39;python:3.9&#39;
</span></span><span class="line"><span class="cl">)
</span></span><span class="line"><span class="cl">def iris_sgdclassifier(test_samples_fraction: float, metrics: Output[ClassificationMetrics]):
</span></span><span class="line"><span class="cl">    from sklearn import datasets, model_selection
</span></span><span class="line"><span class="cl">    from sklearn.linear_model import SGDClassifier
</span></span><span class="line"><span class="cl">    from sklearn.metrics import confusion_matrix
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    iris_dataset = datasets.load_iris()
</span></span><span class="line"><span class="cl">    train_x, test_x, train_y, test_y = model_selection.train_test_split(
</span></span><span class="line"><span class="cl">        iris_dataset[&#39;data&#39;], iris_dataset[&#39;target&#39;], test_size=test_samples_fraction)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    classifier = SGDClassifier()
</span></span><span class="line"><span class="cl">    classifier.fit(train_x, train_y)
</span></span><span class="line"><span class="cl">    predictions = model_selection.cross_val_predict(classifier, train_x, train_y, cv=3)
</span></span><span class="line"><span class="cl">    metrics.log_confusion_matrix(
</span></span><span class="line"><span class="cl">        [&#39;Setosa&#39;, &#39;Versicolour&#39;, &#39;Virginica&#39;],
</span></span><span class="line"><span class="cl">        confusion_matrix(train_y, predictions).tolist() # .tolist() to convert np array to list.
</span></span><span class="line"><span class="cl">    )
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">@dsl.pipeline(
</span></span><span class="line"><span class="cl">    name=&#39;metrics-visualization-pipeline&#39;)
</span></span><span class="line"><span class="cl">def metrics_visualization_pipeline():
</span></span><span class="line"><span class="cl">    iris_sgdclassifier_op = iris_sgdclassifier(test_samples_fraction=0.3)
</span></span></code></pre></div><p>Visualization of Confusion Matrix is as below:</p>
<p><img src="/docs/images/pipelines/v1/v2-compatible/confusion-matrix.png" 
alt="V2 Confusion matrix visualization"
class="mt-3 mb-3 border border-info rounded"></p>
<h3 id="roc-curve">ROC Curve</h3>
<p>Define <code>Output[ClassificationMetrics]</code> argument in your component function, then
output ROC Curve data using API
<code>log_roc_curve(self, fpr: List[float], tpr: List[float], threshold: List[float])</code>.
<code>fpr</code> defines a list of False Positive Rate values, <code>tpr</code> defines a list of
True Positive Rate values, <code>threshold</code> indicates the level of sensitivity and specificity
of this probability curve. There are multiple APIs you can use for logging ROC Curve. Refer to
<a href="https://github.com/kubeflow/pipelines/blob/55a2fb5c20011b01945c9867ddff0d39e9db1964/sdk/python/kfp/v2/components/types/artifact_types.py#L163-L164">artifact_types.py</a> for detail.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">@component(
</span></span><span class="line"><span class="cl">    packages_to_install=[&#39;sklearn&#39;],
</span></span><span class="line"><span class="cl">    base_image=&#39;python:3.9&#39;,
</span></span><span class="line"><span class="cl">)
</span></span><span class="line"><span class="cl">def wine_classification(metrics: Output[ClassificationMetrics]):
</span></span><span class="line"><span class="cl">    from sklearn.ensemble import RandomForestClassifier
</span></span><span class="line"><span class="cl">    from sklearn.metrics import roc_curve
</span></span><span class="line"><span class="cl">    from sklearn.datasets import load_wine
</span></span><span class="line"><span class="cl">    from sklearn.model_selection import train_test_split, cross_val_predict
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    X, y = load_wine(return_X_y=True)
</span></span><span class="line"><span class="cl">    # Binary classification problem for label 1.
</span></span><span class="line"><span class="cl">    y = y == 1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    X_train, X_test, y_train, y_test = train_test_split(X, y, random_state=42)
</span></span><span class="line"><span class="cl">    rfc = RandomForestClassifier(n_estimators=10, random_state=42)
</span></span><span class="line"><span class="cl">    rfc.fit(X_train, y_train)
</span></span><span class="line"><span class="cl">    y_scores = cross_val_predict(rfc, X_train, y_train, cv=3, method=&#39;predict_proba&#39;)
</span></span><span class="line"><span class="cl">    y_predict = cross_val_predict(rfc, X_train, y_train, cv=3, method=&#39;predict&#39;)
</span></span><span class="line"><span class="cl">    fpr, tpr, thresholds = roc_curve(y_true=y_train, y_score=y_scores[:,1], pos_label=True)
</span></span><span class="line"><span class="cl">    metrics.log_roc_curve(fpr, tpr, thresholds)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">@dsl.pipeline(
</span></span><span class="line"><span class="cl">    name=&#39;metrics-visualization-pipeline&#39;)
</span></span><span class="line"><span class="cl">def metrics_visualization_pipeline():
</span></span><span class="line"><span class="cl">    wine_classification_op = wine_classification()
</span></span></code></pre></div><p>Visualization of ROC Curve is as below:</p>
<p><img src="/docs/images/pipelines/v1/v2-compatible/roc-curve.png" 
alt="V2 ROC Curve visualization"
class="mt-3 mb-3 border border-info rounded"></p>
<h3 id="scalar-metrics">Scalar Metrics</h3>
<p>Define <code>Output[Metrics]</code> argument in your component function, then
output Scalar data using API <code>log_metric(self, metric: str, value: float)</code>.
You can define any amount of metric by calling this API multiple times.
<code>metric</code> defines the name of metric, <code>value</code> is the value of this metric. Refer to
<a href="https://github.com/kubeflow/pipelines/blob/55a2fb5c20011b01945c9867ddff0d39e9db1964/sdk/python/kfp/v2/components/types/artifact_types.py#L124">artifacts_types.py</a>
for detail.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">@component(
</span></span><span class="line"><span class="cl">    packages_to_install=[&#39;sklearn&#39;],
</span></span><span class="line"><span class="cl">    base_image=&#39;python:3.9&#39;,
</span></span><span class="line"><span class="cl">)
</span></span><span class="line"><span class="cl">def digit_classification(metrics: Output[Metrics]):
</span></span><span class="line"><span class="cl">    from sklearn import model_selection
</span></span><span class="line"><span class="cl">    from sklearn.linear_model import LogisticRegression
</span></span><span class="line"><span class="cl">    from sklearn import datasets
</span></span><span class="line"><span class="cl">    from sklearn.metrics import accuracy_score
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # Load digits dataset
</span></span><span class="line"><span class="cl">    iris = datasets.load_iris()
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # # Create feature matrix
</span></span><span class="line"><span class="cl">    X = iris.data
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    # Create target vector
</span></span><span class="line"><span class="cl">    y = iris.target
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    #test size
</span></span><span class="line"><span class="cl">    test_size = 0.33
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    seed = 7
</span></span><span class="line"><span class="cl">    #cross-validation settings
</span></span><span class="line"><span class="cl">    kfold = model_selection.KFold(n_splits=10, random_state=seed, shuffle=True)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    #Model instance
</span></span><span class="line"><span class="cl">    model = LogisticRegression()
</span></span><span class="line"><span class="cl">    scoring = &#39;accuracy&#39;
</span></span><span class="line"><span class="cl">    results = model_selection.cross_val_score(model, X, y, cv=kfold, scoring=scoring)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    #split data
</span></span><span class="line"><span class="cl">    X_train, X_test, y_train, y_test = model_selection.train_test_split(X, y, test_size=test_size, random_state=seed)
</span></span><span class="line"><span class="cl">    #fit model
</span></span><span class="line"><span class="cl">    model.fit(X_train, y_train)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    #accuracy on test set
</span></span><span class="line"><span class="cl">    result = model.score(X_test, y_test)
</span></span><span class="line"><span class="cl">    metrics.log_metric(&#39;accuracy&#39;, (result*100.0))
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">@dsl.pipeline(
</span></span><span class="line"><span class="cl">    name=&#39;metrics-visualization-pipeline&#39;)
</span></span><span class="line"><span class="cl">def metrics_visualization_pipeline():
</span></span><span class="line"><span class="cl">    digit_classification_op = digit_classification()
</span></span></code></pre></div><p>Visualization of Scalar Metrics is as below:</p>
<p><img src="/docs/images/pipelines/v1/v2-compatible/scalar-metrics.png" 
alt="V2 Scalar Metrics visualization"
class="mt-3 mb-3 border border-info rounded"></p>
<h3 id="markdown">Markdown</h3>
<p>Define <code>Output[Markdown]</code> argument in your component function, then
write Markdown file to path <code>&lt;artifact_argument_name&gt;.path</code>.
Refer to
<a href="https://github.com/kubeflow/pipelines/blob/55a2fb5c20011b01945c9867ddff0d39e9db1964/sdk/python/kfp/v2/components/types/artifact_types.py#L420-L428">artifact_types.py</a>
for detail.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">@component
</span></span><span class="line"><span class="cl">def markdown_visualization(markdown_artifact: Output[Markdown]):
</span></span><span class="line"><span class="cl">    markdown_content = &#39;## Hello world \n\n Markdown content&#39;
</span></span><span class="line"><span class="cl">    with open(markdown_artifact.path, &#39;w&#39;) as f:
</span></span><span class="line"><span class="cl">        f.write(markdown_content)
</span></span></code></pre></div><p><img src="/docs/images/pipelines/v1/v2-compatible/markdown-visualization.png" 
alt="Markdown visualization in v2 compatible mode"
class="mt-3 mb-3 border border-info rounded"></p>
<h3 id="single-html-file">Single HTML file</h3>
<p>You can specify an HTML file that your component creates, and the Kubeflow Pipelines UI renders that HTML in the output page. The HTML file must be self-contained, with no references to other files in the filesystem. The HTML file can contain absolute references to files on the web. Content running inside the HTML file is sandboxed in an iframe and cannot communicate with the Kubeflow Pipelines UI.</p>
<p>Define <code>Output[HTML]</code> argument in your component function, then
write HTML file to path <code>&lt;artifact_argument_name&gt;.path</code>.
Refer to
<a href="https://github.com/kubeflow/pipelines/blob/55a2fb5c20011b01945c9867ddff0d39e9db1964/sdk/python/kfp/v2/components/types/artifact_types.py#L409-L417">artifact_types.py</a>
for detail.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">@component
</span></span><span class="line"><span class="cl">def html_visualization(html_artifact: Output[HTML]):
</span></span><span class="line"><span class="cl">    html_content = &#39;&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hello world&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&#39;
</span></span><span class="line"><span class="cl">    with open(html_artifact.path, &#39;w&#39;) as f:
</span></span><span class="line"><span class="cl">        f.write(html_content)
</span></span></code></pre></div><p><img src="/docs/images/taxi-tip-analysis-step-output-webapp-popped-out.png" 
alt="Web app output from a pipeline component"
class="mt-3 mb-3 border border-info rounded"></p>
<h2 id="source-of-v2-examples">Source of v2 examples</h2>
<p>The metric visualization in V2 or V2 compatible mode depends on SDK visualization APIs,
refer to <a href="https://github.com/kubeflow/pipelines/blob/sdk/release-1.8/samples/test/metrics_visualization_v2.py">metrics_visualization_v2.py</a>
for a complete pipeline example. Follow instruction
<a href="/docs/components/pipelines/sdk-v2/build-pipeline/#compile-and-run-your-pipeline">Compile and run your pipeline</a>
to compile in V2 compatible mode.</p>
<h2 id="v1-sdk-writing-out-metadata-for-the-output-viewers">v1 SDK: Writing out metadata for the output viewers</h2>
<p>For KFP v1, the pipeline component must write a JSON file specifying metadata
for the output viewer(s) that you want to use for visualizing the results. The
component must also export a file output artifact with an artifact name of
<code>mlpipeline-ui-metadata</code>, or else the Kubeflow Pipelines UI will not render
the visualization. In other words, the <code>.outputs.artifacts</code> setting for the
generated pipeline component should show:
<code>- {name: mlpipeline-ui-metadata, path: /mlpipeline-ui-metadata.json}</code>.
The JSON filepath does not matter, although <code>/mlpipeline-ui-metadata.json</code>
is used for consistency in the examples below.</p>
<p>The JSON specifies an array of <code>outputs</code>. Each <code>outputs</code> entry describes the
metadata for an output viewer. The JSON structure looks like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  &#34;version&#34;: 1,
</span></span><span class="line"><span class="cl">  &#34;outputs&#34;: [
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">      &#34;type&#34;: &#34;confusion_matrix&#34;,
</span></span><span class="line"><span class="cl">      &#34;format&#34;: &#34;csv&#34;,
</span></span><span class="line"><span class="cl">      &#34;source&#34;: &#34;my-dir/my-matrix.csv&#34;,
</span></span><span class="line"><span class="cl">      &#34;schema&#34;: [
</span></span><span class="line"><span class="cl">        {&#34;name&#34;: &#34;target&#34;, &#34;type&#34;: &#34;CATEGORY&#34;},
</span></span><span class="line"><span class="cl">        {&#34;name&#34;: &#34;predicted&#34;, &#34;type&#34;: &#34;CATEGORY&#34;},
</span></span><span class="line"><span class="cl">        {&#34;name&#34;: &#34;count&#34;, &#34;type&#34;: &#34;NUMBER&#34;},
</span></span><span class="line"><span class="cl">      ],
</span></span><span class="line"><span class="cl">      &#34;labels&#34;: &#34;vocab&#34;
</span></span><span class="line"><span class="cl">    },
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">      ...
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">  ]
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></div><p>If the component writes such a file to its container filesystem, the Kubeflow
Pipelines system extracts the file, and the Kubeflow Pipelines UI uses the file
to generate the specified viewer(s). The metadata specifies where to load the
artifact data from. The Kubeflow Pipelines UI loads the data <strong>into memory</strong>
and renders it. <em>Note:</em> You should keep this data at a volume that&rsquo;s manageable
by the UI, for example by running a sampling step before exporting the file as
an artifact.</p>
<p>The table below shows the available metadata fields that you can specify in the
<code>outputs</code> array. Each <code>outputs</code> entry must have a <code>type</code>. Depending on value of
<code>type</code>, other fields may also be required as described in the list of output
viewers later on the page.</p>
<div class="table-responsive">
  <table class="table table-bordered">
    <thead class="thead-light">
      <tr>
        <th>Field name</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>format</code></td>
        <td>The format of the artifact data. The default is <code>csv</code>. 
          <em>Note:</em> The only format currently available is 
          <code>csv</code>.
        </td>
      </tr>
      <tr>
        <td><code>header</code></td>
        <td>A list of strings to be used as headers for the artifact data. For 
          example, in a table these strings are used in the first row.</td>
      </tr>
      <tr>
        <td><code>labels</code></td>
        <td>A list of strings to be used as labels for artifact columns or 
          rows.</td>
      </tr>
      <tr>
        <td><code>predicted_col</code></td>
        <td>Name of the predicted column.</td>
      </tr>
      <tr>
        <td><code>schema</code></td>
        <td>A list of <code>{type, name}</code> objects that specify the schema 
          of the artifact data.</td>
      </tr>
      <tr>
        <td><code>source</code></td>
        <td><p>The full path to the data. The available locations
          include <code>http</code>, <code>https</code>, 
          <a href="https://aws.amazon.com/s3/">Amazon S3</a>, 
          <a href="https://docs.minio.io/">Minio</a>, and 
          <a href="https://cloud.google.com/storage/docs/">Google Cloud 
          Storage</a>.</p>
          <p>The path can contain wildcards ‘*’, in 
          which case the Kubeflow Pipelines UI concatenates the data from the 
          matching source files.</p>
          <p><code>source</code> can also contain inlined string data instead of
          a path when <code>storage='inline'</code>.</p>
          </td>
      </tr>
      <tr>
        <td><code>storage</code></td>
        <td><p>(Optional) When <code>storage</code> is <code>inline</code>, the value of
        <code>source</code> is parsed as inline data instead of a path. This applies
        to all types of outputs except <code>tensorboard</code>. See 
        <a href="#markdown">Markdown</a> or <a href="#web-app">Web app</a>
        below as examples.</p>
        <p><b>Be aware</b>, support for inline visualizations, other than
        markdown, was introduced in Kubeflow Pipelines 0.2.5. Before using these
        visualizations, [upgrade  your Kubeflow Pipelines cluster](/docs/components/pipelines/upgrade/)
        to version 0.2.5 or higher.</p>
        </td>
      </tr>
      <tr>
        <td><code>target_col</code></td>
        <td>Name of the target column.</td>
      </tr>
      <tr>
        <td><code>type</code></td>
        <td>Name of the viewer to be used to visualize the data. The list 
          <a href="#output-types">below</a> shows the available types.</td>
      </tr>
    </tbody>
  </table>
</div>
<p><a id="output-types"></a></p>
<h2 id="available-output-viewers">Available output viewers</h2>
<p>The sections below describe the available viewer types and the <strong>required</strong>
metadata fields for each type.</p>
<h3 id="confusion-matrix-1">Confusion matrix</h3>
<p><strong>Type:</strong> <code>confusion_matrix</code></p>
<p><strong>Required metadata fields:</strong></p>
<ul>
<li><code>format</code></li>
<li><code>labels</code></li>
<li><code>schema</code></li>
<li><code>source</code></li>
</ul>
<p><strong>Optional metadata fields:</strong></p>
<ul>
<li><code>storage</code></li>
</ul>
<p>The <code>confusion_matrix</code> viewer plots a confusion matrix visualization of the data
from the given <code>source</code> path, using the <code>schema</code> to parse the data. The <code>labels</code>
provide the names of the classes to be plotted on the x and y axes.</p>
<p>Specify <code>'storage': 'inline'</code> to embed raw content of the
confusion matrix CSV file as a string in <code>source</code> field directly.</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Python" data-lang="Python"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">confusion_matrix_viz</span><span class="p">(</span><span class="n">mlpipeline_ui_metadata_path</span><span class="p">:</span> <span class="n">kfp</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">OutputPath</span><span class="p">()):</span>
</span></span><span class="line"><span class="cl">  <span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">  <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;outputs&#39;</span> <span class="p">:</span> <span class="p">[{</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;confusion_matrix&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;csv&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;schema&#39;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;CATEGORY&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;predicted&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;CATEGORY&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;NUMBER&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">CONFUSION_MATRIX_CSV_FILE</span><span class="o">&gt;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="c1"># Convert vocab to string because for bealean values we want &#34;True|False&#34; to match csv data.</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;labels&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">vocab</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">    <span class="p">}]</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">mlpipeline_ui_metadata_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">metadata_file</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">metadata_file</span><span class="p">)</span>
</span></span></code></pre></div><p><strong>Visualization on the Kubeflow Pipelines UI:</strong></p>
<p><img src="/docs/images/taxi-tip-confusion-matrix-step-output.png" 
alt="Confusion matrix visualization from a pipeline component"
class="mt-3 mb-3 border border-info rounded"></p>
<p><a id="type-markdown"></a></p>
<h3 id="markdown-1">Markdown</h3>
<p><strong>Type:</strong> <code>markdown</code></p>
<p><strong>Required metadata fields:</strong></p>
<ul>
<li><code>source</code></li>
</ul>
<p><strong>Optional metadata fields:</strong></p>
<ul>
<li><code>storage</code></li>
</ul>
<p>The <code>markdown</code> viewer renders Markdown strings on the Kubeflow Pipelines UI.
The viewer can read the Markdown data from the following locations:</p>
<ul>
<li>A Markdown-formatted string embedded in the <code>source</code> field. The value of the
<code>storage</code> field must be <code>inline</code>.</li>
<li>Markdown code in a remote file, at a path specified in the <code>source</code> field.
The <code>storage</code> field can be empty or contain any value except <code>inline</code>.</li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Python" data-lang="Python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">markdown_vis</span><span class="p">(</span><span class="n">mlpipeline_ui_metadata_path</span><span class="p">:</span> <span class="n">kfp</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">OutputPath</span><span class="p">()):</span>
</span></span><span class="line"><span class="cl">  <span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">  <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;outputs&#39;</span> <span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Markdown that is hardcoded inline</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;storage&#39;</span><span class="p">:</span> <span class="s1">&#39;inline&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="s1">&#39;# Inline Markdown</span><span class="se">\n</span><span class="s1">[A link](https://www.kubeflow.org/)&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;markdown&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Markdown that is read from a file</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="s1">&#39;gs://your_project/your_bucket/your_markdown_file&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;markdown&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">}]</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">mlpipeline_ui_metadata_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">metadata_file</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">metadata_file</span><span class="p">)</span>
</span></span></code></pre></div><p><strong>Visualization on the Kubeflow Pipelines UI:</strong></p>
<p><img src="/docs/images/markdown-output.png" 
alt="Markdown visualization from a pipeline component"
class="mt-3 mb-3 border border-info rounded"></p>
<h3 id="roc-curve-1">ROC curve</h3>
<p><strong>Type:</strong> <code>roc</code></p>
<p><strong>Required metadata fields:</strong></p>
<ul>
<li><code>format</code></li>
<li><code>schema</code></li>
<li><code>source</code></li>
</ul>
<p>The <code>roc</code> viewer plots a receiver operating characteristic
(<a href="https://en.wikipedia.org/wiki/Receiver_operating_characteristic">ROC</a>)
curve using the data from the given source path. The Kubeflow Pipelines UI
assumes that the schema includes three columns with the following names:</p>
<ul>
<li><code>fpr</code> (false positive rate)</li>
<li><code>tpr</code> (true positive rate)</li>
<li><code>thresholds</code></li>
</ul>
<p><strong>Optional metadata fields:</strong></p>
<ul>
<li><code>storage</code></li>
</ul>
<p>When viewing the ROC curve, you can hover your cursor over the ROC curve to see
the threshold value used for the cursor&rsquo;s closest <code>fpr</code> and <code>tpr</code> values.</p>
<p>Specify <code>'storage': 'inline'</code> to embed raw content of the ROC
curve CSV file as a string in <code>source</code> field directly.</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Python" data-lang="Python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">roc_vis</span><span class="p">(</span><span class="n">roc_csv_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">mlpipeline_ui_metadata_path</span><span class="p">:</span> <span class="n">kfp</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">OutputPath</span><span class="p">()):</span>
</span></span><span class="line"><span class="cl">  <span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">df_roc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;fpr&#39;</span><span class="p">:</span> <span class="n">fpr</span><span class="p">,</span> <span class="s1">&#39;tpr&#39;</span><span class="p">:</span> <span class="n">tpr</span><span class="p">,</span> <span class="s1">&#39;thresholds&#39;</span><span class="p">:</span> <span class="n">thresholds</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="n">roc_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">roc_csv_file_path</span><span class="p">,</span> <span class="s1">&#39;roc.csv&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">with</span> <span class="n">file_io</span><span class="o">.</span><span class="n">FileIO</span><span class="p">(</span><span class="n">roc_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_roc</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;fpr&#39;</span><span class="p">,</span> <span class="s1">&#39;tpr&#39;</span><span class="p">,</span> <span class="s1">&#39;thresholds&#39;</span><span class="p">],</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;outputs&#39;</span><span class="p">:</span> <span class="p">[{</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;roc&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;csv&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;schema&#39;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;fpr&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;NUMBER&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;tpr&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;NUMBER&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;thresholds&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;NUMBER&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="n">roc_file</span>
</span></span><span class="line"><span class="cl">    <span class="p">}]</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">mlpipeline_ui_metadata_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">metadata_file</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">metadata_file</span><span class="p">)</span>
</span></span></code></pre></div><p><strong>Visualization on the Kubeflow Pipelines UI:</strong></p>
<p><img src="/docs/images/taxi-tip-roc-step-output.png" 
alt="ROC curve visualization from a pipeline component"
class="mt-3 mb-3 border border-info rounded"></p>
<h3 id="table">Table</h3>
<p><strong>Type:</strong> <code>table</code></p>
<p><strong>Required metadata fields:</strong></p>
<ul>
<li><code>format</code></li>
<li><code>header</code></li>
<li><code>source</code></li>
</ul>
<p><strong>Optional metadata fields:</strong></p>
<ul>
<li><code>storage</code></li>
</ul>
<p>The <code>table</code> viewer builds an HTML table out of the data at the given <code>source</code>
path, where the <code>header</code> field specifies the values to be shown in the first row
of the table. The table supports pagination.</p>
<p>Specify <code>'storage': 'inline'</code> to embed CSV table content string
in <code>source</code> field directly.</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Python" data-lang="Python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">table_vis</span><span class="p">(</span><span class="n">mlpipeline_ui_metadata_path</span><span class="p">:</span> <span class="n">kfp</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">OutputPath</span><span class="p">()):</span>
</span></span><span class="line"><span class="cl">  <span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;outputs&#39;</span> <span class="p">:</span> <span class="p">[{</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;table&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;storage&#39;</span><span class="p">:</span> <span class="s1">&#39;gcs&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;csv&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;header&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">schema</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="n">prediction_results</span>
</span></span><span class="line"><span class="cl">    <span class="p">}]</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">mlpipeline_ui_metadata_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">metadata_file</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">metadata_file</span><span class="p">)</span>
</span></span></code></pre></div><p><strong>Visualization on the Kubeflow Pipelines UI:</strong></p>
<p><img src="/docs/images/pipelines/v1/taxi-tip-prediction-step-output-table.png" 
alt="Table-based visualization from a pipeline component"
class="mt-3 mb-3 border border-info rounded"></p>
<h3 id="tensorboard">TensorBoard</h3>
<p><strong>Type:</strong> <code>tensorboard</code></p>
<p><strong>Required metadata Fields:</strong></p>
<ul>
<li><code>source</code></li>
</ul>
<p>The <code>tensorboard</code> viewer adds a <strong>Start Tensorboard</strong> button to the output page.</p>
<p>When viewing the output page, you can:</p>
<ul>
<li>Click <strong>Start Tensorboard</strong> to start a
<a href="https://www.tensorflow.org/guide/summaries_and_tensorboard">TensorBoard</a> Pod
in your Kubeflow cluster. The button text switches to <strong>Open Tensorboard</strong>.</li>
<li>Click <strong>Open Tensorboard</strong> to open the TensorBoard interface in a new tab,
pointing to the logdir data specified in the <code>source</code> field.</li>
<li>Click <strong>Delete Tensorboard</strong> to shutdown the Tensorboard instance.</li>
</ul>
<p><strong>Note:</strong> The Kubeflow Pipelines UI doesn&rsquo;t fully manage your TensorBoard
instances. The &ldquo;Start Tensorboard&rdquo; button is a convenience feature so that
you don&rsquo;t have to interrupt your workflow when looking at pipeline runs. You&rsquo;re
responsible for recycling or deleting the TensorBoard Pods using your Kubernetes
management tools.</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Python" data-lang="Python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">tensorboard_vis</span><span class="p">(</span><span class="n">mlpipeline_ui_metadata_path</span><span class="p">:</span> <span class="n">kfp</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">OutputPath</span><span class="p">()):</span>
</span></span><span class="line"><span class="cl">  <span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;outputs&#39;</span> <span class="p">:</span> <span class="p">[{</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;tensorboard&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">job_dir</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">}]</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">mlpipeline_ui_metadata_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">metadata_file</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">metadata_file</span><span class="p">)</span>
</span></span></code></pre></div><p><strong>Visualization on the Kubeflow Pipelines UI:</strong></p>
<p><img src="/docs/images/taxi-tip-training-step-output-tensorboard.png" 
alt="TensorBoard option output from a pipeline component"
class="mt-3 mb-3 border border-info rounded"></p>
<h3 id="web-app">Web app</h3>
<p><strong>Type:</strong> <code>web-app</code></p>
<p><strong>Required metadata fields:</strong></p>
<ul>
<li><code>source</code></li>
</ul>
<p><strong>Optional metadata fields:</strong></p>
<ul>
<li><code>storage</code></li>
</ul>
<p>The <code>web-app</code> viewer provides flexibility for rendering custom output. You can
specify an HTML file that your component creates, and the Kubeflow Pipelines UI
renders that HTML in the output page. The HTML file must be self-contained, with
no references to other files in the filesystem. The HTML file can contain
absolute references to files on the web. Content running inside the web app is
sandboxed in an iframe and cannot communicate with the Kubeflow Pipelines UI.</p>
<p>Specify <code>'storage': 'inline'</code> to embed raw html in <code>source</code> field directly.</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Python" data-lang="Python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">tensorboard_vis</span><span class="p">(</span><span class="n">mlpipeline_ui_metadata_path</span><span class="p">:</span> <span class="n">kfp</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">OutputPath</span><span class="p">()):</span>
</span></span><span class="line"><span class="cl">  <span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">static_html_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">_OUTPUT_HTML_FILE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">file_io</span><span class="o">.</span><span class="n">write_string_to_file</span><span class="p">(</span><span class="n">static_html_path</span><span class="p">,</span> <span class="n">rendered_template</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;outputs&#39;</span> <span class="p">:</span> <span class="p">[{</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;web-app&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;storage&#39;</span><span class="p">:</span> <span class="s1">&#39;gcs&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="n">static_html_path</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;web-app&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;storage&#39;</span><span class="p">:</span> <span class="s1">&#39;inline&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;h1&gt;Hello, World!&lt;/h1&gt;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">}]</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">mlpipeline_ui_metadata_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">metadata_file</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">metadata_file</span><span class="p">)</span>
</span></span></code></pre></div><p><strong>Visualization on the Kubeflow Pipelines UI:</strong></p>
<p><img src="/docs/images/taxi-tip-analysis-step-output-webapp-popped-out.png" 
alt="Web app output from a pipeline component"
class="mt-3 mb-3 border border-info rounded"></p>
<p><a id="example-source"></a></p>
<h2 id="source-of-v1-examples">Source of v1 examples</h2>
<p>The v1 examples come from the <em>tax tip prediction</em> sample that is
pre-installed when you deploy Kubeflow.</p>
<p>You can run the sample by selecting
<strong>[Sample] ML - TFX - Taxi Tip Prediction Model Trainer</strong> from the
Kubeflow Pipelines UI. For help getting started with the UI, follow the
<a href="/docs/components/pipelines/overview/quickstart/">Kubeflow Pipelines quickstart</a>.</p>
<!--- TODO: Will replace the tfx cab with tfx oss when it is ready.-->
<p>The pipeline uses a number of prebuilt, reusable components, including:</p>
<ul>
<li>The <a href="https://github.com/kubeflow/pipelines/blob/sdk/release-1.8/components/local/confusion_matrix/src/confusion_matrix.py">Confusion Matrix
component</a>
which writes out the data for the <code>confusion_matrix</code> viewer.</li>
<li>The <a href="https://github.com/kubeflow/pipelines/blob/sdk/release-1.8/components/local/roc/src/roc.py">ROC
component</a>
which writes out the data for the <code>roc</code> viewer.</li>
<li>The <a href="https://github.com/kubeflow/pipelines/blob/sdk/release-1.8/components/kubeflow/dnntrainer/src/trainer/task.py">dnntrainer
component</a>
which writes out the data for the <code>tensorboard</code> viewer.</li>
<li>The <a href="https://github.com/kubeflow/pipelines/blob/sdk/release-1.8/components/deprecated/dataflow/tfma/component.yaml">tfma
component</a>
which writes out the data for the <code>web-app</code> viewer.</li>
</ul>
<h2 id="lightweight-python-component-notebook-example">Lightweight Python component Notebook example</h2>
<p>For a complete example of lightweigh Python component, you can refer to
<a href="https://github.com/kubeflow/pipelines/blob/sdk/release-1.8/samples/core/lightweight_component/lightweight_component.ipynb">the lightweight python component notebook example</a> to learn more about declaring output visualizations.</p>
<h2 id="yaml-component-example">YAML component example</h2>
<p>You can also configure visualization in a component.yaml file. Refer to <code>{name: MLPipeline UI Metadata}</code> output in <a href="https://github.com/kubeflow/pipelines/blob/f61048b5d2e1fb5a6a61782d570446b0ec940ff7/components/tensorflow/tensorboard/prepare_tensorboard/component.yaml#L12">Create Tensorboard Visualization component</a>.</p>
<h2 id="next-step">Next step</h2>
<p>See how to <a href="/docs/components/pipelines/metrics/pipelines-metrics/">export metrics from your
pipeline</a>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-6290e41c026254218090f8aba54b9598">10 - Pipeline Metrics</h1>
    <div class="lead">Export and visualize pipeline metrics</div>
	<p>This page shows you how to export metrics from a Kubeflow Pipelines component.
For details about how to build a component, see the guide to
<a href="/docs/components/pipelines/sdk/component-development/">building your own component</a>.</p>
<h2 id="overview-of-metrics">Overview of metrics</h2>
<p>Kubeflow Pipelines supports the export of scalar metrics. You can write a list
of metrics to a local file to describe the performance of the model. The
pipeline agent uploads the local file as your run-time metrics. You can view the
uploaded metrics as a visualization in the <strong>Runs</strong> page for a particular
experiment in the Kubeflow Pipelines UI.</p>
<h2 id="export-the-metrics-dictionary">Export the metrics dictionary</h2>
<p>To enable metrics, your component must have an output called <code>MLPipeline Metrics</code> and return a JSON-serialized metrics dictionary.
Otherwise the Kubeflow Pipelines UI will
not render the visualization. In other words, the <code>.outputs.artifacts</code> setting
for the generated pipeline template should show:
<code>- {name: mlpipeline-metrics, path: /tmp/outputs/mlpipeline_metrics/data}</code>.
(The file path does not matter.)</p>
<p>An example Lightweight python component that outputs metrics dictionary by writing it to an output file:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Python" data-lang="Python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">kfp.components</span> <span class="kn">import</span> <span class="n">InputPath</span><span class="p">,</span> <span class="n">OutputPath</span><span class="p">,</span> <span class="n">create_component_from_func</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">produce_metrics</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># Note when the `create_component_from_func` method converts the function to a component, the function parameter &#34;mlpipeline_metrics_path&#34; becomes an output with name &#34;mlpipeline_metrics&#34; which is the correct name for metrics output.</span>
</span></span><span class="line"><span class="cl">  <span class="n">mlpipeline_metrics_path</span><span class="p">:</span> <span class="n">OutputPath</span><span class="p">(</span><span class="s1">&#39;Metrics&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">accuracy</span> <span class="o">=</span> <span class="mf">0.9</span>
</span></span><span class="line"><span class="cl">  <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;metrics&#39;</span><span class="p">:</span> <span class="p">[{</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;accuracy-score&#39;</span><span class="p">,</span> <span class="c1"># The name of the metric. Visualized as the column name in the runs table.</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;numberValue&#39;</span><span class="p">:</span>  <span class="n">accuracy</span><span class="p">,</span> <span class="c1"># The value of the metric. Must be a numeric value.</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s2">&#34;PERCENTAGE&#34;</span><span class="p">,</span>   <span class="c1"># The optional format of the metric. Supported values are &#34;RAW&#34; (displayed in raw format) and &#34;PERCENTAGE&#34; (displayed in percentage format).</span>
</span></span><span class="line"><span class="cl">    <span class="p">}]</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">mlpipeline_metrics_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">produce_metrics_op</span> <span class="o">=</span> <span class="n">create_component_from_func</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">produce_metrics</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">base_image</span><span class="o">=</span><span class="s1">&#39;python:3.7&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">packages_to_install</span><span class="o">=</span><span class="p">[],</span>
</span></span><span class="line"><span class="cl">    <span class="n">output_component_file</span><span class="o">=</span><span class="s1">&#39;component.yaml&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></div><p>Here&rsquo;s an example of a lightweight Python component that outputs a metrics dictionary by returning it from the function:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Python" data-lang="Python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NamedTuple</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">kfp.components</span> <span class="kn">import</span> <span class="n">InputPath</span><span class="p">,</span> <span class="n">OutputPath</span><span class="p">,</span> <span class="n">create_component_from_func</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">produce_metrics</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">NamedTuple</span><span class="p">(</span><span class="s1">&#39;Outputs&#39;</span><span class="p">,</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="s1">&#39;mlpipeline_metrics&#39;</span><span class="p">,</span> <span class="s1">&#39;Metrics&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">]):</span>
</span></span><span class="line"><span class="cl">  <span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">accuracy</span> <span class="o">=</span> <span class="mf">0.9</span>
</span></span><span class="line"><span class="cl">  <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;metrics&#39;</span><span class="p">:</span> <span class="p">[{</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;accuracy-score&#39;</span><span class="p">,</span> <span class="c1"># The name of the metric. Visualized as the column name in the runs table.</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;numberValue&#39;</span><span class="p">:</span>  <span class="n">accuracy</span><span class="p">,</span> <span class="c1"># The value of the metric. Must be a numeric value.</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s2">&#34;PERCENTAGE&#34;</span><span class="p">,</span>   <span class="c1"># The optional format of the metric. Supported values are &#34;RAW&#34; (displayed in raw format) and &#34;PERCENTAGE&#34; (displayed in percentage format).</span>
</span></span><span class="line"><span class="cl">    <span class="p">}]</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">[</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">metrics</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">produce_metrics_op</span> <span class="o">=</span> <span class="n">create_component_from_func</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">produce_metrics</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">base_image</span><span class="o">=</span><span class="s1">&#39;python:3.7&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">packages_to_install</span><span class="o">=</span><span class="p">[],</span>
</span></span><span class="line"><span class="cl">    <span class="n">output_component_file</span><span class="o">=</span><span class="s1">&#39;component.yaml&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></div><p>An example script-based <code>component.yaml</code> component:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Produce metrics</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">outputs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- {<span class="nt">name: MLPipeline Metrics, type</span><span class="p">:</span><span class="w"> </span><span class="l">Metrics}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">implementation</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">container</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">alpine</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">sh</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- -<span class="l">exc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">      output_metrics_path=$0
</span></span></span><span class="line"><span class="cl"><span class="sd">      mkdir -p &#34;$(dirname &#34;$output_metrics_path&#34;)&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">      echo &#39;{
</span></span></span><span class="line"><span class="cl"><span class="sd">        &#34;metrics&#34;: [{
</span></span></span><span class="line"><span class="cl"><span class="sd">          &#34;name&#34;: &#34;accuracy-score&#34;,
</span></span></span><span class="line"><span class="cl"><span class="sd">          &#34;numberValue&#34;: 0.8,
</span></span></span><span class="line"><span class="cl"><span class="sd">          &#34;format&#34;: &#34;PERCENTAGE&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">        }]
</span></span></span><span class="line"><span class="cl"><span class="sd">      }&#39; &gt; &#34;$output_metrics_path&#34;</span><span class="w">      
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- {<span class="nt">outputPath</span><span class="p">:</span><span class="w"> </span><span class="l">MLPipeline Metrics}</span><span class="w">
</span></span></span></code></pre></div><p>Refer to the <a href="https://github.com/kubeflow/pipelines/blob/sdk/release-1.8/components/local/confusion_matrix/src/confusion_matrix.py">full example</a> of a component that generates a confusion matrix data from prediction results.</p>
<ul>
<li>
<p>The output name must be <code>MLPipeline Metrics</code> or <code>MLPipeline_Metrics</code> (case does not matter).</p>
</li>
<li>
<p>The <code>name</code> of each metric must match the following pattern: <code>^[a-zA-Z]([-_a-zA-Z0-9]{0,62}[a-zA-Z0-9])?$</code>.</p>
<p>For Kubeflow Pipelines version 0.5.1 or earlier, name must match the following pattern <code>^[a-z]([-a-z0-9]{0,62}[a-z0-9])?$</code></p>
</li>
<li>
<p><code>numberValue</code> must be a numeric value.</p>
</li>
<li>
<p><code>format</code> can only be <code>PERCENTAGE</code>, <code>RAW</code>, or not set.</p>
</li>
</ul>
<h2 id="view-the-metrics">View the metrics</h2>
<p>To see a visualization of the metrics:</p>
<ol>
<li>Open the <strong>Experiments</strong> page in the Kubeflow Pipelines UI.</li>
<li>Click one of your experiments. The <strong>Runs</strong> page opens showing the top two
metrics, where <em>top</em> is determined by prevalence (that is, the metrics with
the highest count) and then by metric name.
The metrics appear as columns for each run.</li>
</ol>
<p>The following example shows the <strong>accuracy-score</strong> and
<strong>roc-auc-score</strong> metrics for two runs within an experiment:</p>
<p><img src="/docs/images/taxi-tip-run-scores.png" 
alt="Metrics from a pipeline run"
class="mt-3 mb-3 border border-info rounded"></p>
<h2 id="next-step">Next step</h2>
<p>Visualize the output of your component by <a href="/docs/components/pipelines/sdk/output-viewer/">writing out metadata for an output
viewer</a>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-4539e2425322e75e85f28e46fbd56edf">11 - DSL Static Type Checking</h1>
    <div class="lead">Statically check the component I/O types</div>
	<p>This page describes how to integrate the type information in the pipeline and utilize the
static type checking for fast development iterations.</p>
<h2 id="motivation">Motivation</h2>
<p>A pipeline is a workflow consisting of <a href="/docs/components/pipelines/sdk/build-component#overview-of-pipelines-and-components">components</a> and each
component contains inputs and outputs. The DSL compiler supports static type checking to ensure the type consistency among the component
I/Os within the same pipeline. Static type checking helps you to identify component I/O inconsistencies without running the pipeline.
It also shortens the development cycles by catching the errors early.
This feature is especially useful in two cases:</p>
<ul>
<li>When the pipeline is huge and manually checking the types is infeasible;</li>
<li>When some components are shared ones and the type information is not immediately available.</li>
</ul>
<h2 id="type-system">Type system</h2>
<p>In Kubeflow pipeline, a type is defined as a type name with an <a href="https://github.com/OAI/OpenAPI-Specification/blob/master/versions/3.0.0.md">OpenAPI Schema</a>
property, which defines the input parameter schema. <strong>Warning</strong>: the pipeline system
currently does not check the input value against the schema when you submit a pipeline run. However, this feature will come in the near
future.</p>
<p>There is a set of <a href="https://github.com/kubeflow/pipelines/blob/sdk/release-1.8/sdk/python/kfp/dsl/types.py">core types</a> defined in the
Pipelines SDK and you can use these core types or define your custom types.</p>
<p>In the component YAML, types are specified as a string or a dictionary with the OpenAPI Schema, as illustrated below.
&ldquo;<em>component a</em>&rdquo; expects an input with Integer type and emits three outputs with the type GCSPath, customized_type and GCRPath.
Among these types, Integer, GCSPath, and GCRPath are core types that are predefined in the SDK while customized_type is a user-defined
type.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">component a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l">component desc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">inputs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- {<span class="nt">name: field_l, type</span><span class="p">:</span><span class="w"> </span><span class="l">Integer}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">outputs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- {<span class="nt">name: field_m, type</span><span class="p">:</span><span class="w"> </span>{<span class="nt">GCSPath</span><span class="p">:</span><span class="w"> </span>{<span class="nt">openapi_schema_validator</span><span class="p">:</span><span class="w"> </span>{<span class="nt">type: string, pattern</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;^gs://.*$&#34;</span><span class="w"> </span>}<span class="w"> </span>}}}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- {<span class="nt">name: field_n, type</span><span class="p">:</span><span class="w"> </span><span class="l">customized_type}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- {<span class="nt">name: field_o, type</span><span class="p">:</span><span class="w"> </span><span class="l">GCRPath} </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">implementation</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">container</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">gcr.io/ml-pipeline/component-a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="l">python3, /pipelines/component/src/train.py]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>--<span class="l">field-l, {inputValue: field_l},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">fileOutputs</span><span class="p">:</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">field_m</span><span class="p">:</span><span class="w"> </span><span class="l">/schema.txt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">field_n</span><span class="p">:</span><span class="w"> </span><span class="l">/feature.txt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">field_o</span><span class="p">:</span><span class="w"> </span><span class="l">/output.txt</span><span class="w">
</span></span></span></code></pre></div><p>Similarly, when you write a component with the decorator, you can annotate I/O with types in the function signature, as shown below.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">kfp.dsl</span> <span class="kn">import</span> <span class="n">component</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">kfp.dsl.types</span> <span class="kn">import</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">GCRPath</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@component</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">task_factory_a</span><span class="p">(</span><span class="n">field_l</span><span class="p">:</span> <span class="n">Integer</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;field_m&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;GCSPath&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;openapi_schema_validator&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;{&#34;type&#34;: &#34;string&#34;, &#34;pattern&#34;: &#34;^gs://.*$&#34;}&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;field_n&#39;</span><span class="p">:</span> <span class="s1">&#39;customized_type&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;field_o&#39;</span><span class="p">:</span> <span class="n">GCRPath</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}:</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">ContainerOp</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="n">name</span><span class="o">=</span><span class="s1">&#39;operator a&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">image</span><span class="o">=</span><span class="s1">&#39;gcr.io/ml-pipeline/component-a&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;python3&#39;</span><span class="p">,</span> <span class="s1">&#39;/pipelines/component/src/train.py&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="n">arguments</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;--field-l&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">field_l</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="n">file_outputs</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;field_m&#39;</span><span class="p">:</span> <span class="s1">&#39;/schema.txt&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;field_n&#39;</span><span class="p">:</span> <span class="s1">&#39;/feature.txt&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;field_o&#39;</span><span class="p">:</span> <span class="s1">&#39;/output.txt&#39;</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span></code></pre></div><p>You can also annotate pipeline inputs with types and the input are checked against the component I/O types as well. For example,</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nd">@component</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">task_factory_a</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">field_m</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;GCSPath&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;openapi_schema_validator&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;{&#34;type&#34;: &#34;string&#34;, &#34;pattern&#34;: &#34;^gs://.*$&#34;}&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span> <span class="n">field_o</span><span class="p">:</span> <span class="s1">&#39;Integer&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">ContainerOp</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="n">name</span><span class="o">=</span><span class="s1">&#39;operator a&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">image</span><span class="o">=</span><span class="s1">&#39;gcr.io/ml-pipeline/component-a&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">arguments</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;--field-l&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">field_m</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;--field-o&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">field_o</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Pipeline input types are also checked against the component I/O types.</span>
</span></span><span class="line"><span class="cl"><span class="nd">@dsl</span><span class="o">.</span><span class="n">pipeline</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;type_check&#39;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">pipeline</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">a</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;GCSPath&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;openapi_schema_validator&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;{&#34;type&#34;: &#34;string&#34;, &#34;pattern&#34;: &#34;^gs://.*$&#34;}&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="o">=</span> <span class="s1">&#39;good&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">b</span><span class="p">:</span> <span class="n">Integer</span><span class="p">()</span> <span class="o">=</span> <span class="mi">12</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="n">task_factory_a</span><span class="p">(</span><span class="n">field_m</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">field_o</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">compiler</span><span class="o">.</span><span class="n">Compiler</span><span class="p">()</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="s1">&#39;pipeline.tar.gz&#39;</span><span class="p">,</span> <span class="n">type_check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">except</span> <span class="n">InconsistentTypeException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="how-does-the-type-checking-work">How does the type checking work?</h2>
<p>The basic checking criterion is the equality checking. In other words, type checking passes only when the type name strings are equal
and the corresponding OpenAPI Schema properties are equal. Examples of type checking failure are:</p>
<ul>
<li>&ldquo;GCSPath&rdquo; vs. &ldquo;GCRPath&rdquo;</li>
<li>&ldquo;Integer&rdquo; vs. &ldquo;Float&rdquo;</li>
<li>{&lsquo;GCSPath&rsquo;: {&lsquo;openapi_schema_validator&rsquo;: &lsquo;{&ldquo;type&rdquo;: &ldquo;string&rdquo;, &ldquo;pattern&rdquo;: &ldquo;^gs://.<em>$&rdquo;}&rsquo;}} vs.<br>
{&lsquo;GCSPath&rsquo;: {&lsquo;openapi_schema_validator&rsquo;: &lsquo;{&ldquo;type&rdquo;: &ldquo;string&rdquo;, &ldquo;pattern&rdquo;: &ldquo;^gcs://.</em>$&rdquo;}&rsquo;}}</li>
</ul>
<p>If inconsistent types are detected, it throws an <a href="https://github.com/kubeflow/pipelines/blob/sdk/release-1.8/sdk/python/kfp/dsl/types.py">InconsistentTypeException</a>.</p>
<h2 id="type-checking-configuration">Type checking configuration</h2>
<p>Type checking is enabled by default and it can be disabled in two ways:</p>
<p>If you compile the pipeline programmably:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">compiler</span><span class="o">.</span><span class="n">Compiler</span><span class="p">()</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pipeline_a</span><span class="p">,</span> <span class="s1">&#39;pipeline_a.tar.gz&#39;</span><span class="p">,</span> <span class="n">type_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span></code></pre></div><p>If you compile the pipeline using the dsl-compiler tool:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">dsl-compiler --py pipeline.py --output pipeline.zip --disable-type-check
</span></span></code></pre></div><h3 id="fine-grained-configuration">Fine-grained configuration</h3>
<p>Sometimes, you might want to enable the type checking but disable certain arguments. For example,
when the upstream component generates an output with type &ldquo;<em>Float</em>&rdquo; and the downstream can ingest either
&ldquo;<em>Float</em>&rdquo; or &ldquo;<em>Integer</em>&rdquo;, it might fail if you define the type as &ldquo;<em>Float_or_Integer</em>&rdquo;.
Disabling the type checking per-argument is also supported as shown below.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nd">@dsl</span><span class="o">.</span><span class="n">pipeline</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;type_check_a&#39;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">pipeline</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">  <span class="n">a</span> <span class="o">=</span> <span class="n">task_factory_a</span><span class="p">(</span><span class="n">field_l</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># For each of the arguments, you can also ignore the types by calling</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># ignore_type function.</span>
</span></span><span class="line"><span class="cl">  <span class="n">b</span> <span class="o">=</span> <span class="n">task_factory_b</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="n">field_x</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;field_n&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="n">field_y</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;field_o&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="n">field_z</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;field_m&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ignore_type</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">compiler</span><span class="o">.</span><span class="n">Compiler</span><span class="p">()</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="s1">&#39;pipeline.tar.gz&#39;</span><span class="p">,</span> <span class="n">type_check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="missing-types">Missing types</h3>
<p>DSL compiler passes the type checking if either of the upstream or the downstream components lack the type information for some parameters.
The effects are the same as that of ignoring the type information. However,
type checking would still fail if some I/Os lack the type information and some I/O types are incompatible.</p>
<h2 id="next-steps">Next steps</h2>
<p>Learn how to define a KubeFlow pipeline with Python DSL and compile the
pipeline with type checking: a
<a href="https://github.com/kubeflow/pipelines/blob/sdk/release-1.8/samples/core/dsl_static_type_checking/dsl_static_type_checking.ipynb">Jupyter notebook demo</a>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-db2b3d927ec2c0b7fed0512c94bc61ae">12 - DSL Recursion</h1>
    <div class="lead">Author a recursive function in DSL</div>
	

<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Out of date</h4>

    This guide contains outdated information pertaining to Kubeflow 1.0. This guide
needs to be updated for Kubeflow 1.1.

</div>

<p>This page describes how to write recursive functions in the domain specific language (DSL) provided by the Kubeflow Pipelines SDK.</p>
<h2 id="motivation">Motivation</h2>
<p>Recursion is a feature that is supported by almost all languages to express complex semantics in a succinct way.
In machine learning workflows, recursions are especially important to enable features such as multiple rounds of training,
iterative model analysis, and hypertuning. The recursion support also covers the loop feature since it enables the same code
block to be executed and exited based on dynamic conditions.</p>
<h2 id="how-to-write-a-recursive-function">How to write a recursive function</h2>
<h3 id="decorator">Decorator</h3>
<p>Decorate the recursive function with <a href="https://github.com/kubeflow/pipelines/blob/sdk/release-1.8/sdk/python/kfp/dsl/_component.py">kfp.dsl.graph_component</a>
as illustrated below. The decorator does not require any arguments.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">kfp.dsl</span> <span class="k">as</span> <span class="nn">dsl</span>
</span></span><span class="line"><span class="cl"><span class="nd">@dsl</span><span class="o">.</span><span class="n">graph_component</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">graph_component_a</span><span class="p">(</span><span class="n">input_x</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="k">with</span> <span class="n">dsl</span><span class="o">.</span><span class="n">Condition</span><span class="p">(</span><span class="n">input_x</span> <span class="o">==</span> <span class="s1">&#39;value_x&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">op_a</span> <span class="o">=</span> <span class="n">task_factory_a</span><span class="p">(</span><span class="n">input_x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">op_b</span> <span class="o">=</span> <span class="n">task_factory_b</span><span class="p">()</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="n">op_a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">graph_component_a</span><span class="p">(</span><span class="n">op_b</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="nd">@dsl</span><span class="o">.</span><span class="n">pipeline</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;pipeline&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">description</span><span class="o">=</span><span class="s1">&#39;shows how to use the recursion.&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">pipeline</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">  <span class="n">op_a</span> <span class="o">=</span> <span class="n">task_factory_a</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="n">op_b</span> <span class="o">=</span> <span class="n">task_factory_b</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="n">graph_op_a</span> <span class="o">=</span> <span class="n">graph_component_a</span><span class="p">(</span><span class="n">op_a</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">graph_op_a</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="n">op_b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">task_factory_c</span><span class="p">(</span><span class="n">op_a</span><span class="o">.</span><span class="n">output</span><span class="p">)</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="n">graph_op_a</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="function-signature">Function signature</h3>
<p>Define the function signature as a standard Python function. The input parameters are <a href="https://github.com/kubeflow/pipelines/blob/sdk/release-1.8/sdk/python/kfp/dsl/_pipeline_param.py">PipelineParams</a>.</p>
<h3 id="function-body">Function body</h3>
<p>Similar to the pipeline function body, you can instantiate components, create <a href="https://github.com/kubeflow/pipelines/blob/f8b0f5bf0cc0b5aceb8aedfd21e93156e363ea48/sdk/python/kfp/dsl/_ops_group.py#L110">conditions</a>,
use the input parameters from the function signature, and specify dependencies explicitly among components.
In the example above, one condition is created inside the recursive function and
two components <em>op_a</em> and <em>op_b</em> are created inside the condition.</p>
<h3 id="call-the-recursive-function-in-the-pipeline-function">Call the recursive function in the pipeline function</h3>
<p>You can pass pipeline/component output to the recursive function and specify the dependencies explicitly with <em>after()</em> function, similar to
the <a href="https://github.com/kubeflow/pipelines/blob/sdk/release-1.8/sdk/python/kfp/dsl/_container_op.py">ContainerOp</a>. In the example above, the output of <em>op_a</em>
defined in the pipeline is passed to the recursive function and the <em>task_factory_c</em> component is specified to depend on the <em>graph_op_a</em>.
The recursive function can also be explicitly specified to depend on the ContainerOps. For example, <em>graph_op_a</em> depends on <em>op_b</em> in the pipeline.</p>
<h3 id="more-examples">More examples</h3>
<p>Here is another example where the recursive function call is at the end of the function body, similar to <a href="https://en.wikipedia.org/wiki/Do_while_loop">do-while</a> loops.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">kfp.dsl</span> <span class="k">as</span> <span class="nn">dsl</span>
</span></span><span class="line"><span class="cl"><span class="nd">@dsl</span><span class="o">.</span><span class="n">graph_component</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">graph_component_a</span><span class="p">(</span><span class="n">input_x</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="n">op_a</span> <span class="o">=</span> <span class="n">task_factory_a</span><span class="p">(</span><span class="n">input_x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">op_b</span> <span class="o">=</span> <span class="n">task_factory_b</span><span class="p">()</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="n">op_a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">with</span> <span class="n">dsl</span><span class="o">.</span><span class="n">Condition</span><span class="p">(</span><span class="n">op_b</span><span class="o">.</span><span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;value_x&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">graph_component_a</span><span class="p">(</span><span class="n">op_b</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="nd">@dsl</span><span class="o">.</span><span class="n">pipeline</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;pipeline&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">description</span><span class="o">=</span><span class="s1">&#39;shows how to use the recursion.&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">pipeline</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">  <span class="n">op_a</span> <span class="o">=</span> <span class="n">task_factory_a</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="n">op_b</span> <span class="o">=</span> <span class="n">task_factory_b</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="n">graph_op_a</span> <span class="o">=</span> <span class="n">graph_component_a</span><span class="p">(</span><span class="n">op_a</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">graph_op_a</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="n">op_b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">task_factory_c</span><span class="p">(</span><span class="n">op_a</span><span class="o">.</span><span class="n">output</span><span class="p">)</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="n">graph_op_a</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="limitations">Limitations</h2>
<ul>
<li><a href="/docs/components/pipelines/sdk/static-type-checking">Type checking</a> does not work for the recursive functions. In other words, The type information that is annotated to the recursive
function signature will not be checked.</li>
<li>Since the output of the recursive functions cannot be dynamically resolved, the downstream ContainerOps cannot
access the output from the recursive functions.</li>
<li>A known <a href="https://github.com/kubeflow/pipelines/issues/1065">issue</a> is that the recursion fails to work when there are
multiple recursive function calls in the function body.</li>
</ul>
<h2 id="next-steps">Next steps</h2>
<ul>
<li>See <a href="https://github.com/kubeflow/pipelines/blob/sdk/release-1.8/samples/core/recursion/recursion.py">recursion sample</a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-6a0dc6801800a3b5b8b4c7cb9a1d4104">13 - Using environment variables in pipelines</h1>
    <div class="lead">How to set and use environment variables in Kubeflow pipelines</div>
	

<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Out of date</h4>

    This guide contains outdated information pertaining to Kubeflow 1.0. This guide
needs to be updated for Kubeflow 1.1.

</div>

<p>This page describes how to pass environment variables to Kubeflow pipeline
components.</p>
<h2 id="before-you-start">Before you start</h2>
<p>Set up your environment:</p>
<ul>
<li><a href="/docs/started/getting-started/">Install Kubeflow</a></li>
<li><a href="/docs/components/pipelines/sdk/install-sdk/">Install the Kubeflow Pipelines SDK</a></li>
</ul>
<h2 id="using-environment-variables">Using environment variables</h2>
<p>In this example, you pass an environment variable to a lightweight Python
component, which writes the variable&rsquo;s value to the log.</p>
<p><a href="/docs/components/pipelines/sdk/lightweight-python-components/">Learn more about lightweight Python components</a></p>
<p>To build a component, define a stand-alone Python function and then call
<a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.components.html#kfp.components.func_to_container_op">kfp.components.func_to_container_op(func)</a> to convert the
function to a component that can be used in a pipeline. The following function gets an
environment variable and writes it to the log.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">logg_env_function</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">  <span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl">  <span class="kn">import</span> <span class="nn">logging</span>
</span></span><span class="line"><span class="cl">  <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">env_variable</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;example_env&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;The environment variable is: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env_variable</span><span class="p">))</span>
</span></span></code></pre></div><p>Transform the function into a component using
<a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.components.html#kfp.components.func_to_container_op">kfp.components.func_to_container_op(func)</a>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">image_name</span> <span class="o">=</span> <span class="s1">&#39;tensorflow/tensorflow:1.11.0-py3&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">logg_env_function_op</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">func_to_container_op</span><span class="p">(</span><span class="n">logg_env_function</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                                 <span class="n">base_image</span><span class="o">=</span><span class="n">image_name</span><span class="p">)</span>
</span></span></code></pre></div><p>Add this component to a pipeline. Use <a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.dsl.html#kfp.dsl.ContainerOp.container">add_env_variable</a> to pass an
environment variable into the component. This code is the same no matter if your
using python lightweight components or a <a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.dsl.html#kfp.dsl.ContainerOp">container operation</a>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">kfp.dsl</span> <span class="k">as</span> <span class="nn">dsl</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">kubernetes.client.models</span> <span class="kn">import</span> <span class="n">V1EnvVar</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@dsl</span><span class="o">.</span><span class="n">pipeline</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Env example&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">description</span><span class="o">=</span><span class="s1">&#39;A pipeline showing how to use environment variables&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">environment_pipeline</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">  <span class="n">env_var</span> <span class="o">=</span> <span class="n">V1EnvVar</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;example_env&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;env_variable&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">#Returns a dsl.ContainerOp class instance. </span>
</span></span><span class="line"><span class="cl">  <span class="n">container_op</span> <span class="o">=</span> <span class="n">logg_env_function_op</span><span class="p">()</span><span class="o">.</span><span class="n">add_env_variable</span><span class="p">(</span><span class="n">env_var</span><span class="p">)</span> 
</span></span></code></pre></div><p>To pass more environment variables into a component, add more instances of
<a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.dsl.html#kfp.dsl.ContainerOp.container">add_env_variable()</a>. Use the following command to run this pipeline using the
Kubeflow Pipelines SDK.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#Specify pipeline argument values</span>
</span></span><span class="line"><span class="cl"><span class="n">arguments</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#Submit a pipeline run</span>
</span></span><span class="line"><span class="cl"><span class="n">kfp</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span><span class="o">.</span><span class="n">create_run_from_pipeline_func</span><span class="p">(</span><span class="n">environment_pipeline</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                           <span class="n">arguments</span><span class="o">=</span><span class="n">arguments</span><span class="p">)</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ad66bcbcfacb2647b3a55cba3d1e76c6">14 - GCP-specific Uses of the SDK</h1>
    <div class="lead">SDK features that are available on Google Cloud Platform (GCP) only</div>
	<p>For pipeline features that are specific to GCP, including SDK features, see the
<a href="/docs/gke/pipelines/">GCP section of the docs</a>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-af8ccd9f5dc570d16c52b5d3e0ba2cf5">15 - Kubeflow Pipelines SDK for Tekton</h1>
    <div class="lead">How to run Kubeflow Pipelines with Tekton</div>
	<p>You can use the <a href="https://github.com/kubeflow/kfp-tekton/tree/master/sdk">KFP-Tekton SDK</a>
to compile, upload and run your Kubeflow Pipeline DSL Python scripts on a
<a href="https://github.com/kubeflow/kfp-tekton/tree/master/tekton_kfp_guide.md">Kubeflow Pipelines with Tekton backend</a>.</p>
<h2 id="sdk-packages">SDK packages</h2>
<p>The <code>kfp-tekton</code> SDK is an extension to the <a href="/docs/components/pipelines/sdk/sdk-overview/">Kubeflow Pipelines SDK</a>
adding the <code>TektonCompiler</code> and the <code>TektonClient</code>:</p>
<ul>
<li>
<p><code>kfp_tekton.compiler</code> includes classes and methods for compiling pipeline
Python DSL into a Tekton PipelineRun YAML spec. The methods in this package
include, but are not limited to, the following:</p>
<ul>
<li><code>kfp_tekton.compiler.TektonCompiler.compile</code> compiles your Python DSL code
into a single static configuration (in YAML format) that the Kubeflow Pipelines service
can process. The Kubeflow Pipelines service converts the static
configuration into a set of Kubernetes resources for execution.</li>
</ul>
</li>
<li>
<p><code>kfp_tekton.TektonClient</code> contains the Python client libraries for the <a href="/docs/components/pipelines/reference/api/kubeflow-pipeline-api-spec/">Kubeflow Pipelines API</a>.
Methods in this package include, but are not limited to, the following:</p>
<ul>
<li><code>kfp_tekton.TektonClient.upload_pipeline</code> uploads a local file to create a new pipeline in Kubeflow Pipelines.</li>
<li><code>kfp_tekton.TektonClient.create_experiment</code> creates a pipeline
<a href="/docs/components/pipelines/concepts/experiment/">experiment</a> and returns an
experiment object.</li>
<li><code>kfp_tekton.TektonClient.run_pipeline</code> runs a pipeline and returns a run object.</li>
<li><code>kfp_tekton.TektonClient.create_run_from_pipeline_func</code> compiles a pipeline
function and submits it for execution on Kubeflow Pipelines.</li>
<li><code>kfp_tekton.TektonClient.create_run_from_pipeline_package</code> runs a local
pipeline package on Kubeflow Pipelines.</li>
</ul>
</li>
</ul>
<h2 id="installing-the-kfp-tekton-sdk">Installing the KFP-Tekton SDK</h2>
<p>You need <strong>Python 3.5</strong> or later to use the Kubeflow Pipelines SDK for Tekton.
We recommend to create a Python virtual environment first using
<a href="https://conda.io/miniconda.html">Miniconda</a> or a virtual environment
manager such as <code>virtualenv</code> or the Python 3 <code>venv</code> module:</p>
<pre><code>python3 -m venv .venv-kfp-tekton
source .venv-kfp-tekton/bin/activate
</code></pre>
<p>You can install the latest release of the <code>kfp-tekton</code> compiler from
<a href="https://pypi.org/project/kfp-tekton/">PyPi</a>:</p>
<pre><code>pip3 install kfp-tekton --upgrade
</code></pre>
<h2 id="compiling-kubeflow-pipelines-dsl-scripts">Compiling Kubeflow Pipelines DSL scripts</h2>
<p>The <code>kfp-tekton</code> Python package comes with the <code>dsl-compile-tekton</code> command line
executable, which should be available in your terminal shell environment after
installing the <code>kfp-tekton</code> Python package.</p>
<p>If you cloned the <code>kfp-tekton</code> project, you can find example pipelines in the
<code>samples</code> folder or in the <code>sdk/python/tests/compiler/testdata</code> folder.</p>
<pre><code>dsl-compile-tekton \
    --py sdk/python/tests/compiler/testdata/parallel_join.py \
    --output pipeline.yaml
</code></pre>
<p><strong>Note</strong>: If the KFP DSL script contains a <code>__main__</code> method calling the
<code>kfp_tekton.compiler.TektonCompiler.compile()</code> function:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Python" data-lang="Python"><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="kn">from</span> <span class="nn">kfp_tekton.compiler</span> <span class="kn">import</span> <span class="n">TektonCompiler</span>
</span></span><span class="line"><span class="cl">    <span class="n">TektonCompiler</span><span class="p">()</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pipeline_func</span><span class="p">,</span> <span class="s2">&#34;pipeline.yaml&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>The pipeline can then be compiled by running the DSL script with <code>python3</code>
directly from the command line, producing a Tekton YAML file <code>pipeline.yaml</code>
in the same directory:</p>
<pre><code>python3 pipeline.py
</code></pre>
<h2 id="additional-documentation">Additional documentation</h2>
<ul>
<li><a href="https://github.com/kubeflow/kfp-tekton/blob/master/guides/kfp_tekton_install.md">Installing Kubeflow Pipelines with Tekton Backend</a></li>
<li><a href="https://github.com/kubeflow/kfp-tekton/blob/master/sdk/FEATURES.md">KFP-Tekton Compiler Features</a></li>
<li><a href="https://github.com/kubeflow/kfp-tekton">Kubeflow Pipelines for Tekton on GitHub</a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-1399671edb649a321c5d364b2a3c2218">16 - Manipulate Kubernetes Resources as Part of a Pipeline</h1>
    <div class="lead">Overview of using the SDK to manipulate Kubernetes resources dynamically as steps of the pipeline</div>
	

<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Out of date</h4>

    This guide contains outdated information pertaining to Kubeflow 1.0. This guide
needs to be updated for Kubeflow 1.1.

</div>

<p>This page describes how to manipulate Kubernetes resources through individual
Kubeflow Pipelines components during a pipeline.
Users may handle any Kubernetes resource, while creating
<a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/">Persistent Volume Claims</a>
and
<a href="https://kubernetes.io/docs/concepts/storage/volume-snapshots/">Volume Snapshots</a>
is rendered easy in the common case.</p>
<h2 id="kubernetes-resources">Kubernetes Resources</h2>
<h3 id="resourceop">ResourceOp</h3>
<p>This class represents a step of the pipeline which manipulates Kubernetes resources.
It implements
<a href="https://github.com/argoproj/argo-workflows/tree/master/examples#kubernetes-resources">Argo&rsquo;s resource template</a>.</p>
<p>This feature allows users to perform some action (<code>get</code>, <code>create</code>, <code>apply</code>,
<code>delete</code>, <code>replace</code>, <code>patch</code>) on Kubernetes resources.
Users are able to set conditions that denote the success or failure of the
step undertaking that action.</p>
<p><a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.dsl.html#kfp.dsl.ResourceOp">Link</a>
to the corresponding Python library.</p>
<h4 id="arguments">Arguments</h4>
<p>Only most significant arguments are presented in this section.
For more information, please refer to the aforementioned link to the library.</p>
<ul>
<li><code>k8s_resource</code>: Definition of the Kubernetes resource.
(<em>required</em>)</li>
<li><code>action</code>: Action to be performed (defaults to <code>create</code>).</li>
<li><code>merge_strategy</code>: Merge strategy when action is <code>patch</code>.
(<em>optional</em>)</li>
<li><code>success_condition</code>: Condition to denote success of the step once it is true.
(<em>optional</em>)</li>
<li><code>failure_condition</code>: Condition to denote failure of the step once it is true.
(<em>optional</em>)</li>
<li><code>attribute_outputs</code>: Similar to <code>file_outputs</code> of
<a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.dsl.html#kfp.dsl.ContainerOp"><code>kfp.dsl.ContainerOp</code></a>.
Maps output parameter names to JSON paths in the Kubernetes object.
More on that in the following section.
(<em>optional</em>)</li>
</ul>
<h4 id="outputs">Outputs</h4>
<p>ResourceOps can produce output parameters.
They can output field values of the resource which is being manipulated.
For example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">job</span> <span class="o">=</span> <span class="n">kubernetes_client</span><span class="o">.</span><span class="n">V1Job</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">rop</span> <span class="o">=</span> <span class="n">kfp</span><span class="o">.</span><span class="n">dsl</span><span class="o">.</span><span class="n">ResourceOp</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span><span class="o">=</span><span class="s2">&#34;create-job&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">k8s_resource</span><span class="o">=</span><span class="n">job</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">action</span><span class="o">=</span><span class="s2">&#34;create&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">attribute_outputs</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;{.metadata.name}&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></div><p>By default, ResourceOps output the resource&rsquo;s name as well as the whole resource
specification.</p>
<h3 id="samples">Samples</h3>
<p>For better understanding, please refer to the following samples:
<a href="https://github.com/kubeflow/pipelines/blob/sdk/release-1.8/samples/core/resource_ops/resource_ops.py">1</a></p>
<hr>
<h2 id="persistent-volume-claims-pvcs">Persistent Volume Claims (PVCs)</h2>
<p>Request the creation of PVC instances simple and fast.</p>
<h3 id="volumeop">VolumeOp</h3>
<p>A ResourceOp specialized in PVC creation.</p>
<p><a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.dsl.html#kfp.dsl.VolumeOp">Link</a>
to the corresponding Python library.</p>
<h4 id="arguments-1">Arguments</h4>
<p>The following arguments are an extension to <code>ResourceOp</code> arguments.
If a <code>k8s_resource</code> is passed, then none of the following should be provided.</p>
<ul>
<li><code>resource_name</code>: The name of the resource which will be created.
This string will be prepended with the workflow name.
This may contain <code>PipelineParam</code>s.
(<em>required</em>)</li>
<li><code>size</code>: The requested size for the PVC.
This may contain <code>PipelineParam</code>s.
(<em>required</em>)</li>
<li><code>storage_class</code>: The storage class to be used.
This may contain <code>PipelineParam</code>s.
(<em>optional</em>)</li>
<li><code>modes</code>: The <code>accessModes</code> of the PVC (defaults to <code>RWM</code>).
Check
<a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#access-modes">this documentation</a>
for further information.
The user may find the following modes built-in:
<ul>
<li><code>VOLUME_MODE_RWO</code>: <code>[&quot;ReadWriteOnce&quot;]</code></li>
<li><code>VOLUME_MODE_RWM</code>: <code>[&quot;ReadWriteMany&quot;]</code></li>
<li><code>VOLUME_MODE_ROM</code>: <code>[&quot;ReadOnlyMany&quot;]</code></li>
</ul>
</li>
<li><code>annotations</code>: Annotations to be patched in the PVC.
These may contain <code>PipelineParam</code>s.
(<em>optional</em>)</li>
<li><code>data_source</code>: It is used to create a PVC from a <code>VolumeSnapshot</code>.
It can be either a <code>string</code> or a <code>V1TypedLocalObjectReference</code>, and may contain
<code>PipelineParam</code>s. (<em>Alpha feature</em>, <em>optional</em>)</li>
</ul>
<h4 id="outputs-1">Outputs</h4>
<p>Additionally to the whole specification of the resource and its name
(<code>ResourceOp</code> defaults), a <code>VolumeOp</code> also outputs the storage size of the
bounded Persistent Volume (as <code>step.outputs[&quot;size&quot;]</code>).
However, this may be empty if the storage provisioner has a
<code>WaitForFirstConsumer</code> binding mode.
This value, if not empty, is always greater than or equal to the requested size.</p>
<h4 id="useful-information">Useful information</h4>
<ol>
<li><code>VolumeOp</code> steps have a <code>.volume</code> attribute which is a <code>PipelineVolume</code>
referencing the created PVC.
More information on Pipeline Volumes in the following section.</li>
<li>A <code>ContainerOp</code> has a <code>pvolumes</code> argument in its constructor.
This is a dictionary with mount paths as keys and volumes as values and
functions similarly to <code>file_outputs</code> (which can then be used as
<code>op.outputs[&quot;key&quot;]</code> or <code>op.output</code>).
For example:</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">vop</span> <span class="o">=</span> <span class="n">dsl</span><span class="o">.</span><span class="n">VolumeOp</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span><span class="o">=</span><span class="s2">&#34;volume_creation&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">resource_name</span><span class="o">=</span><span class="s2">&#34;mypvc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">size</span><span class="o">=</span><span class="s2">&#34;1Gi&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">step1</span> <span class="o">=</span> <span class="n">dsl</span><span class="o">.</span><span class="n">ContainerOp</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span><span class="o">=</span><span class="s2">&#34;step1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="n">pvolumes</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;/mnt&#34;</span><span class="p">:</span> <span class="n">vop</span><span class="o">.</span><span class="n">volume</span><span class="p">}</span>  <span class="c1"># Implies execution after vop</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">step2</span> <span class="o">=</span> <span class="n">dsl</span><span class="o">.</span><span class="n">ContainerOp</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span><span class="o">=</span><span class="s2">&#34;step2&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="n">pvolumes</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;/data&#34;</span><span class="p">:</span> <span class="n">step1</span><span class="o">.</span><span class="n">pvolume</span><span class="p">,</span>  <span class="c1"># Implies execution after step1</span>
</span></span><span class="line"><span class="cl">              <span class="s2">&#34;/mnt&#34;</span><span class="p">:</span> <span class="n">dsl</span><span class="o">.</span><span class="n">PipelineVolume</span><span class="p">(</span><span class="n">pvc</span><span class="o">=</span><span class="s2">&#34;existing-pvc&#34;</span><span class="p">)}</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">step3</span> <span class="o">=</span> <span class="n">dsl</span><span class="o">.</span><span class="n">ContainerOp</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span><span class="o">=</span><span class="s2">&#34;step3&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="n">pvolumes</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;/common&#34;</span><span class="p">:</span> <span class="n">step2</span><span class="o">.</span><span class="n">pvolumes</span><span class="p">[</span><span class="s2">&#34;/mnt&#34;</span><span class="p">]}</span>  <span class="c1"># Implies execution after step2</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></div><h3 id="pipelinevolume">PipelineVolume</h3>
<p>Reference Kubernetes volumes easily, mount them and express dependencies
through them.</p>
<p>A <code>PipelineVolume</code> is essentially a Kubernetes <code>Volume</code>(*) carrying
dependencies, supplemented with an <code>.after()</code> method extending them.
Those dependencies can then be parsed properly by a <code>ContainerOp</code>, when consumed
in <code>pvolumes</code> argument or <code>add_pvolumes()</code> method, to extend the dependencies
of that step.</p>
<p><a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.dsl.html#kfp.dsl.PipelineVolume">Link</a>
to the corresponding Python library.</p>
<p><em>(*) Inherits from V1Volume class of Kubernetes Python client.</em></p>
<h4 id="arguments-2">Arguments</h4>
<p><code>PipelineVolume</code> constructor accepts all arguments <code>V1Volume</code> constructor does.
However, <code>name</code> can be omitted and a pseudo-random name for that volume is
generated instead.</p>
<p>Extra arguments:</p>
<ul>
<li><code>pvc</code>: Name of an existing PVC to be referenced by this <code>PipelineVolume</code>.
This value can be a <code>PipelineParam</code>.</li>
<li><code>volume</code>: Initialize a new <code>PipelineVolume</code> instance from an existing
<code>V1Volume</code>, or its inherited types (e.g. <code>PipelineVolume</code>).</li>
</ul>
<h3 id="samples-1">Samples</h3>
<p>For better understanding, please refer to the following samples:
<a href="https://github.com/kubeflow/pipelines/blob/sdk/release-1.8/samples/core/volume_ops/volume_ops.py">1</a>,
<a href="https://github.com/kubeflow/pipelines/blob/sdk/release-1.8/samples/contrib/volume_ops/volumeop_dag.py">2</a>,
<a href="https://github.com/kubeflow/pipelines/blob/sdk/release-1.8/samples/contrib/volume_ops/volumeop_parallel.py">3</a>,
<a href="https://github.com/kubeflow/pipelines/blob/sdk/release-1.8/samples/contrib/volume_ops/volumeop_sequential.py">4</a></p>
<hr>
<h2 id="volume-snapshots">Volume Snapshots</h2>
<p>Request the creation of Volume Snapshot instances simple and fast.</p>
<h3 id="volumesnapshotop">VolumeSnapshotOp</h3>
<p>A ResourceOp specialized in Volume Snapshot creation.</p>
<p><a href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.dsl.html#kfp.dsl.VolumeSnapshotOp">Link</a>
to the corresponding Python library.</p>
<p><strong>NOTE:</strong> You should check if your Kubernetes cluster admin has Volume Snapshots
enabled in your cluster.</p>
<h4 id="arguments-3">Arguments</h4>
<p>The following arguments are an extension to the <code>ResourceOp</code> arguments.
If a <code>k8s_resource</code> is passed, then none of the following may be provided.</p>
<ul>
<li><code>resource_name</code>: The name of the resource which will be created.
This string will be prepended with the workflow name.
This may contain <code>PipelineParam</code>s.
(<em>required</em>)</li>
<li><code>pvc</code>: The name of the PVC to be snapshotted.
This may contain <code>PipelineParam</code>s.
(<em>optional</em>)</li>
<li><code>snapshot_class</code>: The snapshot storage class to be used.
This may contain <code>PipelineParam</code>s.
(<em>optional</em>)</li>
<li><code>volume</code>: An instance of a <code>V1Volume</code>, or its inherited type (e.g.
<code>PipelineVolume</code>).
This may contain <code>PipelineParam</code>s.
(<em>optional</em>)</li>
<li><code>annotations</code>: Annotations to be patched in the <code>VolumeSnapshot</code>.
These may contain <code>PipelineParam</code>s.
(<em>optional</em>)</li>
</ul>
<p><strong>NOTE:</strong> One of the <code>pvc</code> or <code>volume</code> needs to be provided.</p>
<h4 id="outputs-2">Outputs</h4>
<p>Additionally to the whole specification of the resource and its name
(<code>ResourceOp</code> defaults), a <code>VolumeSnapshotOp</code> also outputs the <code>restoreSize</code> of
the bounded <code>VolumeSnapshot</code> (as <code>step.outputs[&quot;size&quot;]</code>).
This is the minimum size for a PVC clone of that snapshot.</p>
<h4 id="useful-information-1">Useful information</h4>
<p><code>VolumeSnapshotOp</code> steps have a <code>.snapshot</code> attribute which is a
<code>V1TypedLocalObjectReference</code>.
This can be passed as a <code>data_source</code> to create a PVC out of that
<code>VolumeSnapshot</code>.
The user may otherwise use the <code>step.outputs[&quot;name&quot;]</code> as <code>data_source</code>.</p>
<h3 id="samples-2">Samples</h3>
<p>For better understanding, please refer to the following samples:
<a href="https://github.com/kubeflow/pipelines/blob/sdk/release-1.8/samples/core/volume_snapshot_ops/volume_snapshot_ops.py">1</a>,
<a href="https://github.com/kubeflow/pipelines/blob/sdk/release-1.8/samples/contrib/volume_snapshot_ops/volume_snapshotop_rokurl.py">2</a></p>
<h2 id="next-steps">Next steps</h2>
<ul>
<li>See samples in Kubeflow Pipelines
<a href="https://github.com/kubeflow/pipelines/tree/sdk/release-1.8/samples">repository</a>.
For instance, check these samples of
<a href="https://github.com/kubeflow/pipelines/tree/sdk/release-1.8/samples/core/resource_ops">ResourceOps</a>,
<a href="https://github.com/kubeflow/pipelines/tree/sdk/release-1.8/samples/core/volume_ops">VolumeOps</a>
and
<a href="https://github.com/kubeflow/pipelines/tree/sdk/release-1.8/samples/core/volume_snapshot_ops">VolumeSnapshotOps</a>.</li>
<li>Learn more about the
<a href="/docs/components/pipelines/sdk/dsl-overview/">Kubeflow Pipelines domain-specific language (DSL)</a>,
a set of Python libraries that you can use to specify ML pipelines.</li>
<li>For quick iteration,
<a href="/docs/components/pipelines/sdk/build-component/">build components and pipelines</a>.</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-67b05544f3675abcc53d37062cf6583a">17 - Python Based Visualizations (Deprecated)</h1>
    <div class="lead">Predefined and custom visualizations of pipeline outputs</div>
	

<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Deprecated</h4>

    Python based visualization is deprecated. We recommend fetching data via
Kubeflow Pipelines SDK and visualizing from your own notebook instead.

</div>

<p>This page describes Python based visualizations, how to create them, and how to
use them to visualize results within the Kubeflow Pipelines UI. Python based
visualizations are available in Kubeflow Pipelines version
<a href="https://github.com/kubeflow/pipelines/releases/tag/0.1.29">0.1.29</a> and later, and
in Kubeflow version 0.7.0 and later.</p>
<p>While Python based visualizations are intended to be the main method of
visualizing data within the Kubeflow Pipelines UI, they do not replace the
previous method of visualizing data within the Kubeflow Pipelines UI. When
considering which method of visualization to use within your pipeline, check the
limitations of Python based visualizations in the section below and compare
them with the requirements of your visualizations.</p>
<h2 id="introduction">Introduction</h2>
<p>Python based visualizations are a new method to visualize results within the
Kubeflow Pipelines UI. This new method of visualizing results is done through
the usage of <a href="https://github.com/jupyter/nbconvert">nbconvert</a>. Alongside the
usage of nbconvert, results of a pipeline can now be visualized without a
component being included within the pipeline itself because the process of
visualizing results is now decoupled from a pipeline.</p>
<p>Python based visualizations provide two categories of visualizations. The first
being <strong>predefined visualizations</strong>. These visualizations are provided by
default in Kubeflow Pipelines and serve as a way for you and your customers to
easily and quickly generate powerful visualizations. The second category is
<strong>custom visualizations</strong>. Custom visualizations allow for you and your
customers to provided Python visualization code to be used to generate
visualizations. These visualizations allow for rapid development,
experimentation, and customization when visualizing results.</p>
<p><img src="/docs/images/python-based-visualizations1.png"
alt="Confusion matrix visualization from a pipeline component"
class="mt-3 mb-3 border border-info rounded"></p>
<h2 id="using-predefined-visualizations">Using predefined visualizations</h2>
<h3 id="predefined-matrix-visualization">Predefined matrix visualization</h3>
<p><img src="/docs/images/python-based-visualizations2.png"
alt="Confusion matrix visualization from a pipeline component"
class="mt-3 mb-3 border border-info rounded"></p>
<ol>
<li>Open the details of a run.</li>
<li>Select a component.
<ul>
<li>The component that is selected does not matter. But, if you want to
visualize the output of a specific component, it is easier to do that within
that component.</li>
</ul>
</li>
<li>Select the <strong>Artifacts</strong> tab.</li>
<li>At the top of the tab you should see a card named <strong>Visualization Creator</strong>.</li>
<li>Within the card, provide a visualization type, a source, and any necessary
arguments.
<ul>
<li>Any required or optional arguments will be shown as a placeholder.</li>
</ul>
</li>
<li>Click <strong>Generate Visualization</strong>.</li>
<li>View generated visualization by scrolling down.</li>
</ol>
<h3 id="predefined-tfx-visualization">Predefined TFX visualization</h3>
<video width="100%" max-width="100%" height="auto" max-height="100%" controls>
  <source src="/docs/videos/tfdv_example_with_taxi_pipeline.webm" type="video/webm">
</video>
<ol>
<li>On the Pipelines page, click <strong>[Sample] Unified DSL - Taxi Tip Prediction Model Trainer</strong> to open the Pipeline Details page.</li>
<li>On the Pipeline Details page, click <strong>Create run</strong>.</li>
<li>On the Create run page,
<ul>
<li>Use a run name and an experiment name of your choice.</li>
<li>In the <strong>pipeline-root</strong> field, specify a storage bucket that you have permission to write to. For example, enter the path to a Google Cloud Storage bucket or an Amazon S3 bucket.</li>
<li>Click <strong>Start</strong> to create the run.</li>
</ul>
</li>
<li>After the run is complete, on the Run Details page, click any step. For example, click the first step <strong>csvexamplegen</strong> as shown in the video above.</li>
<li>In the side panel of the selected step,
<ul>
<li>Click the <strong>Artifacts</strong> tab.</li>
<li>In the <strong>Visualization Creator</strong> section, choose <strong>TFDV</strong> from the drop down menu.</li>
<li>In the <strong>Source</strong> field, use <strong>gs://ml-pipeline-playground/tfx_taxi_simple/data/data.csv</strong>, which is the input data used for this run.</li>
<li>Click <strong>Generate Visualization</strong> and wait.</li>
</ul>
</li>
<li>Move to the bottom of the <strong>Artifacts</strong> tab to find the generated visualization.</li>
</ol>
<h2 id="using-custom-visualizations">Using custom visualizations</h2>
<p><img src="/docs/images/python-based-visualizations3.png"
alt="Confusion matrix visualization from a pipeline component"
class="mt-3 mb-3 border border-info rounded"></p>
<ol>
<li>Enable custom visualizations within Kubeflow Pipelines.
<ul>
<li>
<p>If you have not yet deployed Kubeflow Pipelines to your cluster,
you can edit the <a href="https://github.com/kubeflow/pipelines/blob/sdk/release-1.8/manifests/kustomize/base/pipeline/ml-pipeline-ui-deployment.yaml">frontend deployment YAML</a>
file to include the following YAML that specifies that custom visualizations
are allowed via environment variables.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">- env:
</span></span><span class="line"><span class="cl">  - name: ALLOW_CUSTOM_VISUALIZATIONS
</span></span><span class="line"><span class="cl">    value: true
</span></span></code></pre></div></li>
<li>
<p>If you already have Kubeflow Pipelines deployed within a cluster, you can
edit the frontend deployment YAML to specify that custom visualizations are
allowed in the same way described above. Details about updating
deployments can be found in the Kubernetes documentation about
<a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#updating-a-deployment">updating a deployment</a>.</p>
</li>
</ul>
</li>
<li>Open the details of a run.</li>
<li>Select a component.
<ul>
<li>The component that is selected does not matter. But, if you want to
visualize the output of a specific component, it is easier to do that within
that component.</li>
</ul>
</li>
<li>Select the <strong>Artifacts</strong> tab.</li>
<li>At the top of the tab you should see a card named <strong>Visualization Creator</strong>.</li>
<li>Within the card, select the <strong>CUSTOM</strong> visualization type then provide a
source, and any necessary arguments (the source and argument variables are
optional for custom visualizations).</li>
<li>Provide the custom visualization code.</li>
<li>Click <strong>Generate Visualization</strong>.</li>
<li>View generated visualization by scrolling down.</li>
</ol>
<p>A demo of the above instructions is as follows.</p>
<video width="100%" max-width="100%" height="auto" max-height="100%" controls>
  <source src="/docs/videos/taxi_custom_visualization.webm" type="video/webm">
</video>
<ol>
<li>On the Pipelines page, click <strong>[Sample] Unified DSL - Taxi Tip Prediction Model Trainer</strong> to open the Pipeline Details page.</li>
<li>On the Pipeline Details page, click <strong>Create run</strong>.</li>
<li>On the Create run page,
<ul>
<li>Use a run name and an experiment name of your choice or simply use the default names chosen for you.</li>
<li>In the <strong>pipeline-root</strong> field, specify a storage bucket that you have permission to write to. For example, enter the path to a Google Cloud Storage bucket or an Amazon S3 bucket.</li>
<li>Click <strong>Start</strong> to create the run.</li>
</ul>
</li>
<li>After the run is complete, on the Run Details page, click the step of <strong>statisticsgen</strong>. This step&rsquo;s output is statistics data generated by Tensorflow Data Validation.</li>
<li>In the side panel of the selected step,
<ul>
<li>Click the <strong>Input/Output</strong> tab to find out the <strong>mlpipeline-ui-metadata</strong> item and click the minio link there. This will open a new browser tab with information on output file path. Copy the output file path as shown in the demo video.</li>
<li>Get back to the Run Details page, and click the <strong>Artifacts</strong> tab.</li>
<li>At the top of the tab you should see a card named <strong>Visualization Creator</strong>, choose <strong>Custom</strong> from the drop down menu.</li>
<li>In the <strong>Custom Visualization Code</strong> field, fill in the following code snippet and replace [output file path] with the output file path you just copied from <strong>mlpipeline-ui-metadata</strong>.</li>
</ul>
 <pre style="overflow-x:scroll;overflow-y:hidden;white-space:pre;">
   import tensorflow_data_validation as tfdv
   stats = tfdv.load_statistics('[output file path]/stats_tfrecord')
   tfdv.visualize_statistics(stats)
 </pre>
<ul>
<li>Click <strong>Generate Visualization</strong> and wait.</li>
</ul>
</li>
<li>Move to the bottom of the <strong>Artifacts</strong> tab to find the generated visualization.</li>
</ol>
<h2 id="known-limitations">Known limitations</h2>
<ul>
<li>
<p>Multiple visualizations cannot be generated concurrently.</p>
<ul>
<li>This is because a single Python kernel is used to generate visualizations.</li>
<li>If visualizations are a major part of your workflow, it is recommended to
increase the number of replicas within the
<a href="https://github.com/kubeflow/pipelines/tree/sdk/release-1.8/manifests/kustomize/base/pipeline/ml-pipeline-visualization-deployment.yaml">visualization deployment YAML</a>
file or within the visualization service deployment itself.
<ul>
<li><em>Please note that this does not directly solve the issue, instead it
decreases the likelihood of experiencing delays when generating
visualizations.</em></li>
</ul>
</li>
</ul>
</li>
<li>
<p>Visualizations that take longer than 30 seconds will fail to generate.</p>
<ul>
<li>
<p>For visualizations where the 30 second timeout is reached, you can add the
<strong>TimeoutValue</strong> header to the request made by the frontend, specifying a
<em>positive integer as ASCII string of at most 8 digits</em> for the length of
time required to generate a visualization as specified by the
<a href="https://github.com/grpc/grpc/blob/master/doc/PROTOCOL-HTTP2.md#requests">grpc documentation</a>.</p>
</li>
<li>
<p>For visualizations that take longer than 100 seconds, you will have to
specify a <strong>TimeoutValue</strong> within the request headers <strong>AND</strong> change the
default kernel timeout of the visualization service. To change the default
kernel timeout of the visualization service, set the <strong>KERNEL_TIMEOUT</strong>
environment variable of the visualization service deployment to be the new
timeout length in seconds within the
<a href="https://github.com/kubeflow/pipelines/tree/sdk/release-1.8/manifests/kustomize/base/pipeline/ml-pipeline-visualization-deployment.yaml">visualization deployment YAML</a>
file or within the visualization service deployment itself.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">- env:
</span></span><span class="line"><span class="cl">  - name: KERNEL_TIMEOUT
</span></span><span class="line"><span class="cl">    value: 100
</span></span></code></pre></div></li>
</ul>
</li>
<li>
<p>The HTML content of the generated visualizations cannot be larger than 4MB.</p>
<ul>
<li>
<p>gRPC by default imposes a limit of 4MB as the maximum size that can be
sent and received by a server. To allow for visualizations that are larger
than 4MB in size to be generated, you must manually set
<strong>MaxCallRecvMsgSize</strong> for gRPC. This can be done by editing the provided
options given to the gRPC server within <a href="https://github.com/kubeflow/pipelines/blob/sdk/release-1.8/backend/src/apiserver/main.go#L128">main.go</a>
to</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-golang" data-lang="golang"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">maxCallRecvMsgSize</span> <span class="p">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">serviceName</span> <span class="o">==</span> <span class="s">&#34;Visualization&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// Only change the maxCallRecvMesSize if it is for visualizations
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">maxCallRecvMsgSize</span> <span class="p">=</span> <span class="mi">50</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">opts</span> <span class="o">:=</span> <span class="p">[]</span><span class="nx">grpc</span><span class="p">.</span><span class="nx">DialOption</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">grpc</span><span class="p">.</span><span class="nf">WithDefaultCallOptions</span><span class="p">(</span><span class="nx">grpc</span><span class="p">.</span><span class="nf">MaxCallRecvMsgSize</span><span class="p">(</span><span class="nx">maxCallRecvMsgSize</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">      <span class="nx">grpc</span><span class="p">.</span><span class="nf">WithInsecure</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></li>
</ul>
</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-6b0621ddf48d2bc7b2827f237fb1eebf">18 - </h1>
    
	<p>approvers:</p>
<ul>
<li>neuromage</li>
<li>Ark-kun</li>
<li>numerology
reviewers:</li>
<li>RFMVasconcelos</li>
</ul>

</div>



    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark pt-3 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Kubeflow mailing list" aria-label="Kubeflow mailing list">
    <a class="text-white" target="_blank" rel="noopener" href="https://www.kubeflow.org/docs/about/community/#kubeflow-mailing-list" aria-label="Kubeflow mailing list">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-white" target="_blank" rel="noopener" href="https://twitter.com/kubeflow" aria-label="Twitter">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Stack Overflow" aria-label="Stack Overflow">
    <a class="text-white" target="_blank" rel="noopener" href="https://stackoverflow.com/questions/tagged/kubeflow" aria-label="Stack Overflow">
      <i class="fab fa-stack-overflow"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/GoogleCloudPlatform/kubeflow-distribution" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-white" target="_blank" rel="noopener" href="https://www.kubeflow.org/docs/about/community/#kubeflow-slack" aria-label="Slack">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-5 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2022 Google | Documentation Distributed under CC BY 4.0</small>
        <p><small class="ml-1"><a href="https://policies.google.com/privacy" target="_blank" rel="noopener">Privacy Policy</a></small></p>
	
		<p class="mt-2"><a href="/kubeflow-docs/docs/about/">About</a></p>
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="/kubeflow-docs/js/main.min.301c0110334bec1b4445867d27dc7dd69b2df859154ccf252005508bc860cc5a.js" integrity="sha256-MBwBEDNL7BtERYZ9J9x91pst&#43;FkVTM8lIAVQi8hgzFo=" crossorigin="anonymous"></script>
<script src='/kubeflow-docs/js/tabpane-persist.js'></script>

  </body>
</html>

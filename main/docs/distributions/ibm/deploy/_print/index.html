<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.105.0">
<link rel="canonical" type="text/html" href="https://gkcalat.github.io/kubeflow-docs/docs/distributions/ibm/deploy/">
<link rel="alternate" type="application/rss&#43;xml" href="https://gkcalat.github.io/kubeflow-docs/docs/distributions/ibm/deploy/index.xml">
<meta name="robots" content="noindex, nofollow">

<script type="application/ld+json">
  {
      "@context" : "http://schema.org",
      "@type" : "WebSite",
      "mainEntityOfPage": {
           "@type": "WebPage",
           "@id": "https:\/\/gkcalat.github.io\/kubeflow-docs"
      },
      "articleSection" : "docs",
      "name" : "Kubeflow Deployment on IBM Cloud",
      "headline" : "Kubeflow Deployment on IBM Cloud",
      "description" : "Instructions for Kubeflow deployment on IBM Cloud",
      "inLanguage" : "en-US",
      "author" : "",
      "creator" : "",
      "publisher": "",
      "accountablePerson" : "",
      "copyrightHolder" : "",
      "copyrightYear" : "0001",
      "datePublished": "0001-01-01 00:00:00 \u002b0000 UTC",
      "dateModified" : "0001-01-01 00:00:00 \u002b0000 UTC",
      "url" : "https:\/\/gkcalat.github.io\/kubeflow-docs\/docs\/distributions\/ibm\/deploy\/",
      "wordCount" : "0",
      "keywords" : [ "Kubeflow" ]
  }
  </script>

<link rel="shortcut icon" href="/kubeflow-docs/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/kubeflow-docs/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/kubeflow-docs/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/kubeflow-docs/favicons/favicon-32x32.png" sizes="32x32">
<link rel="manifest" href="/kubeflow-docs/favicons/manifest.json">
<meta name="msapplication-config" content="/kubeflow-docs/favicons/browserconfig.xml" />
<meta name="msapplication-TileColor" content="#4279f4">
<meta name="theme-color" content="#4279f4">

<title>Kubeflow Deployment on IBM Cloud | Kubeflow on Google Cloud Platform</title>
<meta name="description" content="Instructions for Kubeflow deployment on IBM Cloud">
<meta property="og:title" content="Kubeflow Deployment on IBM Cloud" />
<meta property="og:description" content="Instructions for Kubeflow deployment on IBM Cloud" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://gkcalat.github.io/kubeflow-docs/docs/distributions/ibm/deploy/" /><meta property="og:site_name" content="Kubeflow on Google Cloud Platform" />

<meta itemprop="name" content="Kubeflow Deployment on IBM Cloud">
<meta itemprop="description" content="Instructions for Kubeflow deployment on IBM Cloud"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Kubeflow Deployment on IBM Cloud"/>
<meta name="twitter:description" content="Instructions for Kubeflow deployment on IBM Cloud"/>




<link rel="preload" href="/kubeflow-docs/scss/main.min.5006b434b14f73c3d5537a7ba4c8ecef723ddc93f3a3c8530e19d24f75486ea9.css" as="style">
<link href="/kubeflow-docs/scss/main.min.5006b434b14f73c3d5537a7ba4c8ecef723ddc93f3a3c8530e19d24f75486ea9.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-GK9XL47N6S"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-GK9XL47N6S', { 'anonymize_ip': false });
}
</script>

  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand-md navbar-dark  td-navbar">
        <a class="navbar-brand" href="/kubeflow-docs/">
		<span class="navbar-logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 276.93 274.55"><g data-name="Layer 2"><g data-name="Layer 1"><path d="M95.9 62.15l4.1 102.1 73.75-94.12a6.79 6.79.0 019.6-1.11l46 36.92-15-65.61z" fill="#4279f4"/><path fill="#0028aa" d="M102.55 182.98h65.42l-40.17-32.23-25.25 32.23z"/><path fill="#014bd1" d="M180.18 83.92l-44 56.14 46.88 37.61 44.47-55.76-47.35-37.99z"/><path fill="#bedcff" d="M83.56 52.3l.01-.01 38.69-48.52-62.39 30.05-15.41 67.51 39.1-49.03z"/><path fill="#6ca1ff" d="M45.32 122.05l41.44 51.96-3.95-98.98-37.49 47.02z"/><path fill="#a1c3ff" d="M202.31 28.73 142.65.0l-37.13 46.56 96.79-17.83z"/><path d="M1.6 272v-44.78h5.74v23.41l20.48-23.41h6.4l-17.39 19.7 19 25.07H29.1l-15.92-20.8-5.84 6.65V272zm40.02-9.79V240h5.43v22.39a4.67 4.67.0 002.35 4.19 11 11 0 0011 0 4.69 4.69.0 002.33-4.19V240h5.43v22.19a9.08 9.08.0 01-4.1 7.87 16.2 16.2.0 01-18.37.0 9.07 9.07.0 01-4.07-7.85zM77.46 272v-48h5.43v16.81a29.29 29.29.0 019.32-1.73 13.1 13.1.0 016.2 1.41 10.71 10.71.0 014.18 3.74 18.07 18.07.0 012.23 5.06 21.26 21.26.0 01.73 5.58q0 8.43-4.38 12.79T87.35 272zm5.43-4.87h4.55q6.77.0 9.72-2.95t3-9.51a14.21 14.21.0 00-2-7.52 6.55 6.55.0 00-6-3.22 24.73 24.73.0 00-9.25 1.54zm29.47-11.19q0-7.71 4.09-12.3a13.75 13.75.0 0110.8-4.59q13.35.0 13.36 18.86h-22.82a12.3 12.3.0 002.9 7.07q2.59 3.11 7.9 3.1a24.92 24.92.0 0010.55-2v5a27.74 27.74.0 01-9.86 1.87 19.83 19.83.0 01-7.7-1.37 13.31 13.31.0 01-5.28-3.76 16.21 16.21.0 01-3-5.38 20.84 20.84.0 01-.94-6.5zm5.62-2.12h17.26a14.91 14.91.0 00-2.37-7.12 6.44 6.44.0 00-5.62-2.78 8.2 8.2.0 00-6.21 2.72 12.07 12.07.0 00-3.04 7.18z" fill="#4279f4" stroke="#4279f4" stroke-miterlimit="10" stroke-width="3.2"/><path d="M147.32 244.89V240h5v-7.59a8.14 8.14.0 012.31-6.05 7.79 7.79.0 015.69-2.28h7.86V229h-5c-2.21.0-3.67.45-4.37 1.34s-1.06 2.55-1.06 5V240h8.46v4.87h-8.46V272h-5.44v-27.1zM175.26 272v-48h5.43v48zm19.15-3.95a17.86 17.86.0 1112.33 4.9 16.57 16.57.0 01-12.33-4.9zm3.84-20.65a13.16 13.16.0 000 17.2 12.07 12.07.0 0017 0 13.09 13.09.0 000-17.2 12.07 12.07.0 00-17 0zm30.2-7.4h5.75l7.3 25.32 7.43-25.32h5.36l7.34 25.34L269 240h5.74l-10.04 32h-6.12l-6.83-24.58L245 272h-6.47z" fill="#0028aa" stroke="#0028aa" stroke-miterlimit="10" stroke-width="3.2"/></g></g></svg></span><span class="text-uppercase font-weight-bold">Kubeflow on Google Cloud Platform</span>
	</a>
	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main_navbar" aria-controls="main_navbar" aria-expanded="false" aria-label="Toggle navigation">
		<span class="navbar-toggler-icon"></span>
	</button>
	<div class="collapse navbar-collapse ml-md-auto" id="main_navbar">
		<ul class="navbar-nav ml-auto pt-4 pt-md-0 my-2 my-md-1">
			
			
			<li class="nav-item mr-2 mr-lg-4 mt-1 mt-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/kubeflow-docs/docs/" ><span>Docs</span></a>
			</li>
			
			<li class="nav-item mr-2 mr-lg-4 mt-1 mt-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/kubeflow-docs/news/" ><span>News</span></a>
			</li>
			
			<li class="nav-item mr-2 mr-lg-4 mt-1 mt-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="https://github.com/GoogleCloudPlatform/kubeflow-distribution" target="_blank" ><i class='fa-brands fa-github pr-2'></i><span>Source</span></a>
			</li>
			
			
			<li class="nav-item dropdown mt-1 mt-lg-0 mr-2">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	Releases
</a>
<div class="dropdown-menu dropdown-menu-md-right dropdown-menu-lg-left" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/v1.6-release/docs">latest</a>
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/v1.6-release/docs">v1.6</a>
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/v1.5-release/docs">v1.5</a>
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/v1.4-release/docs">v1.4</a>
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/main/docs">dev</a>
	
</div>

			</li>
			
			
		</ul>
	</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/kubeflow-docs/docs/distributions/ibm/deploy/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Kubeflow Deployment on IBM Cloud</h1>
<div class="lead">Instructions for Kubeflow deployment on IBM Cloud</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-eaa47a4d7381236a0b84e713fc392ffa">Kubeflow Deployment Process</a></li>


    
  
    
    
	
<li>2: <a href="#pg-bb5daad82a3658275d7a80ec50f67eae">IBM Cloud Kubernetes and Kubeflow Compatibility</a></li>


    
  
    
    
	
<li>3: <a href="#pg-73f567b57211c57a9dfb28f8048e2037">Install Kubeflow on IKS</a></li>


    
  
    
    
	
<li>4: <a href="#pg-07a1bb96654c4b0fb7dfd8a4e48f6770">Install Kubeflow on OpenShift</a></li>


    
  
    
    
	
<li>5: <a href="#pg-7c1de18991e035a057289cfa97453b61">Securing the Kubeflow authentication with HTTPS</a></li>


    
  
    
    
	
<li>6: <a href="#pg-4befd9d928cd0502f971527786e1a7ec">Uninstall Kubeflow</a></li>


    
  

    </ul>


<div class="content">
      
</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-eaa47a4d7381236a0b84e713fc392ffa">1 - Kubeflow Deployment Process</h1>
    <div class="lead">How kubeflow installation works</div>
	<h2 id="understanding-the-kubeflow-deployment-process">Understanding the Kubeflow deployment process</h2>
<p>The deployment process is controlled by the following commands:</p>
<ul>
<li><strong>kustomize build</strong> - Use kustomize to generate configuration files defining
the various resources for your deployment. .</li>
<li><strong>kubectl apply</strong> - Apply the resources created by <code>kustomize build</code> to the
kubenetes cluster</li>
</ul>
<h3 id="repository-layout">Repository layout</h3>
<p>IBM manifests repository contains the following files and directories:</p>
<ul>
<li>
<p><strong>iks-single</strong> directory: A kustomize file for single-user deployment</p>
</li>
<li>
<p><strong>iks-multi</strong> directory: A kustomize file for multi-user deployment</p>
</li>
<li>
<p><strong>others</strong> Other files are used to compose Kubeflow resources</p>
</li>
</ul>
<h2 id="kubeflow-installation">Kubeflow installation</h2>
<p>Starting from Kubeflow 1.3, the official installation documentation uses a combination of <code>kustomize</code> and <code>kubectl</code> to install Kubeflow.</p>
<h3 id="install-kubectl-and-kustomize">Install kubectl and kustomize</h3>
<ul>
<li><a href="https://kubernetes.io/docs/tasks/tools/#kubectl">Install kubectl</a></li>
<li><a href="https://github.com/kubernetes-sigs/kustomize/releases/tag/v3.2.0">Download kustomize 3.2.0</a></li>
</ul>
<p>To use the <code>kustomize</code> binary, you need to make it executable and move it to your path.</p>
<p>To add <code>kustomize</code> to your global path, run the following commands:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">wget https://github.com/kubernetes-sigs/kustomize/releases/download/v3.2.0/&lt;distribution&gt;
</span></span><span class="line"><span class="cl">chmod +x &lt;distribution&gt;
</span></span><span class="line"><span class="cl">mv &lt;distribution&gt; /usr/local/bin/kustomize
</span></span></code></pre></div><p>Your machine might already have <code>kustomize</code> installed. If you want to temporarily add this version of <code>kustomize</code> to your path, run the following commands:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">wget https://github.com/kubernetes-sigs/kustomize/releases/download/v3.2.0/&lt;distribution&gt;
</span></span><span class="line"><span class="cl">chmod +x &lt;distribution&gt;
</span></span><span class="line"><span class="cl">mv &lt;distribution&gt; /some/path/kustomize
</span></span><span class="line"><span class="cl"><span class="c1"># /some/path should not already be in path. </span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span>/some/path:<span class="nv">$PATH</span>
</span></span><span class="line"><span class="cl"><span class="c1"># order is important here. $PATH needs to be the last thing. We are trying to put our kustomize before the kustomize installtion in system.</span>
</span></span></code></pre></div><h2 id="next-steps">Next Steps</h2>
<ol>
<li>Check <a href="/docs/distributions/ibm/deploy/iks-compatibility">Kubeflow Compatibility</a></li>
<li>Go here for installing <a href="/docs/distributions/ibm/deploy/install-kubeflow-on-iks">Kubeflow on IKS</a></li>
<li>Go here for installing <a href="/docs/distributions/ibm/deploy/install-kubeflow-on-ibm-openshift">Kubeflow on IBM OpenShift</a></li>
</ol>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-bb5daad82a3658275d7a80ec50f67eae">2 - IBM Cloud Kubernetes and Kubeflow Compatibility</h1>
    <div class="lead">Compatibility matrix for Kubeflow on IBM Cloud by Kubernetes version</div>
	<h2 id="compatibility">Compatibility</h2>
<p>The following table relates compatibility between Kubernetes versions 1.22+ of IBM Cloud Kubernetes service and Kubeflow version 1.6.</p>
<div class="table-responsive">
  <table class="table table-bordered">
    <thead class="thead-light">
      <tr>
        <th>IBM Cloud Kubernetes Versions</th>
        <th>Kubeflow 1.6.0</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>1.22</td>
        <td><b>Compatible</b></td>
      </tr>
      <tr>
        <td>1.23</td>
        <td><b>Compatible</b></td>
      </tr>
      <tr>
        <td>1.24</td>
        <td><b>Compatible</b></td>
      </tr>
    </tbody>
  </table>
</div>
<ul>
<li><strong>Incompatible</strong>: the combination is not known to work together</li>
<li><strong>Compatible</strong>: all Kubeflow features have been tested and verified for the IKS Kubernetes version</li>
<li><strong>No known issues</strong>: the combination has not been fully tested but there are no reported issues</li>
</ul>
<h2 id="next-steps">Next Steps</h2>
<ol>
<li>
<ol start="2">
<li>Go here for installing <a href="/docs/distributions/ibm/deploy/install-kubeflow-on-iks">Kubeflow on IKS</a></li>
</ol>
</li>
</ol>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-73f567b57211c57a9dfb28f8048e2037">3 - Install Kubeflow on IKS</h1>
    <div class="lead">Instructions for deploying Kubeflow on IBM Cloud Kubernetes Service</div>
	<p>This guide describes how to use the kustomize + kubectl to deploy Kubeflow on IBM Cloud Kubernetes Service (IKS).</p>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>
<p>Authenticate with IBM Cloud</p>
<p>Log into IBM Cloud using the <a href="https://www.ibm.com/cloud/cli">IBM Cloud Command Line Interface (CLI)</a> as follows:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ibmcloud login
</span></span></code></pre></div><p>Or, if you have federated credentials, run the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ibmcloud login --sso  
</span></span></code></pre></div></li>
<li>
<p>Create and access a Kubernetes cluster on IKS</p>
<p>To deploy Kubeflow on IBM Cloud, you need a cluster running on IKS. If you don&rsquo;t have a cluster running, follow the <a href="/docs/ibm/create-cluster">Create an IBM Cloud cluster</a> guide.</p>
<p>Run the following command to switch the Kubernetes context and access the cluster:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ibmcloud ks cluster config --cluster &lt;cluster_name&gt;
</span></span></code></pre></div><p>Replace <code>&lt;cluster_name&gt;</code> with your cluster name.</p>
</li>
<li>
<p>kustomize (version 3.2.0) (<a href="https://github.com/kubernetes-sigs/kustomize/releases/tag/v3.2.0">download link</a>)</p>
</li>
<li>
<p><a href="https://www.python.org/downloads/">Python 3</a> with <a href="https://pypi.org/project/passlib/">passlib</a>
and <a href="https://pypi.org/project/bcrypt/">bcrypt</a> packages installed</p>
</li>
</ul>
<h3 id="storage-setup-for-a-classic-ibm-cloud-kubernetes-cluster">Storage setup for a <strong>Classic</strong> IBM Cloud Kubernetes cluster</h3>
<p><strong>Note</strong>: This section is only required when the worker nodes provider <code>WORKER_NODE_PROVIDER</code> is set to <code>classic</code>. For other infrastructures, IBM Cloud Storage with Group ID support is already set up as the cluster&rsquo;s default storage class.</p>
<p>When you use the <code>classic</code> worker node provider of an IBM Cloud Kubernetes cluster, it uses the regular <a href="https://www.ibm.com/cloud/file-storage">IBM Cloud File Storage</a> based on NFS as the default storage class. File Storage is designed to run RWX (read-write multiple nodes) workloads with proper security built around it. Therefore, File Storage <a href="https://cloud.ibm.com/docs/containers?topic=containers-security#container">does not allow <code>fsGroup</code> securityContext</a> unless it&rsquo;s configured with Group ID, which is needed for the <a href="https://github.com/arrikto/oidc-authservice">OIDC authentication service</a> and Kubeflow Jupyter server.</p>
<p>Therefore, you&rsquo;re recommended to set up the default storage class with Group ID support so that you can get the best experience from Kubeflow.</p>
<ol>
<li>
<p>Set the File Storage with Group ID support as the default storage class.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nv">NEW_STORAGE_CLASS</span><span class="o">=</span>ibmc-file-gold-gid
</span></span><span class="line"><span class="cl"><span class="nv">OLD_STORAGE_CLASS</span><span class="o">=</span><span class="k">$(</span>kubectl get sc -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.items[?(@.metadata.annotations.storageclass\.kubernetes\.io\/is-default-class==&#34;true&#34;)].metadata.name}&#39;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">kubectl patch storageclass <span class="si">${</span><span class="nv">NEW_STORAGE_CLASS</span><span class="si">}</span> -p <span class="s1">&#39;{&#34;metadata&#34;: {&#34;annotations&#34;:{&#34;storageclass.kubernetes.io/is-default-class&#34;:&#34;true&#34;}}}&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># List all the (default) storage classes</span>
</span></span><span class="line"><span class="cl">kubectl get storageclass <span class="p">|</span> grep <span class="s2">&#34;(default)&#34;</span>
</span></span></code></pre></div><p>Example output:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ibmc-file-gold-gid (default)   ibm.io/ibmc-file    Delete          Immediate           false                  14h
</span></span></code></pre></div></li>
<li>
<p>Make sure <code>ibmc-file-gold-gid</code> is the only <code>(default)</code> storage class. If there are two or more rows in the above output, unset the previous <code>(default)</code> storage classes with the command below:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl patch storageclass <span class="si">${</span><span class="nv">OLD_STORAGE_CLASS</span><span class="si">}</span> -p <span class="s1">&#39;{&#34;metadata&#34;: {&#34;annotations&#34;:{&#34;storageclass.kubernetes.io/is-default-class&#34;:&#34;false&#34;}}}&#39;</span>
</span></span></code></pre></div></li>
</ol>
<h3 id="storage-setup-for-vpc-gen2-ibm-cloud-kubernetes-cluster">Storage setup for <strong>vpc-gen2</strong> IBM Cloud Kubernetes cluster</h3>
<p><strong>Note</strong>: To deploy Kubeflow, you don&rsquo;t need to change the storage setup for <code>vpc-gen2</code> Kubernetes cluster.</p>
<p>Currently, there is no option available for setting up RWX (read-write multiple nodes) type of storages.
RWX is not a mandatory requirement to run Kubeflow and most pipelines.
It is required by certain sample jobs/pipelines where multiple pods write results to a common storage.
A job or a pipeline can also write to a common object storage like <code>minio</code>, so the absence of this feature is
not a blocker for working with Kubeflow.
Examples of jobs/pipelines that will not work, are:
<a href="https://github.com/kubeflow/training-operator/tree/master/examples/tensorflow/mnist_with_summaries">Distributed training with Kubeflow TFJob</a></p>
<p>If you are on <code>vpc-gen2</code> and still need RWX, you may try <a href="https://portworx.com/products/features/">portworx enterprise product</a>.
To set it up on IBM Cloud use the <a href="https://docs.portworx.com/portworx-install-with-kubernetes/cloud/ibm/">portworx install with IBM Cloud</a> guide.</p>
<h2 id="installation">Installation</h2>
<p>Choose either <strong>single user</strong> or <strong>multi-tenant</strong> section based on your usage.</p>
<p>If you&rsquo;re experiencing issues during the installation because of conflicts on your Kubeflow deployment, you can <a href="/docs/ibm/deploy/uninstall-kubeflow">uninstall Kubeflow</a> and install it again.</p>
<h2 id="single-user">Single user</h2>
<p>Using kustomize together with kubectl to deploy kubeflow:</p>
<ol>
<li>
<p>Clone the manifest repo as follows:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">git clone https://github.com/IBM/manifests.git -b v1.6-branch ibm-manifests-160
</span></span></code></pre></div></li>
<li>
<p>Change directory to <code>ibm-manifests-160</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">cd</span> ibm-manifests-160
</span></span></code></pre></div></li>
<li>
<p>Generate password for default user: <code>user@example.com</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">python3 -c <span class="s1">&#39;from passlib.hash import bcrypt; import getpass; print(bcrypt.using(rounds=12, ident=&#34;2y&#34;).hash(getpass.getpass()))&#39;</span>
</span></span></code></pre></div><p>Type your password and press <code>&lt;Enter&gt;</code> after you see <code>Password:</code> prompt. Copy the hash code for next step.</p>
</li>
<li>
<p>Edit <code>dist/stacks/ibm/application/dex-auth/custom-env.yaml</code> and fill the relevant field
with the hash code from previous step:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">staticPasswords:
</span></span><span class="line"><span class="cl">- email: user@example.com
</span></span><span class="line"><span class="cl">  hash: &lt;enter the generated hash here&gt;
</span></span></code></pre></div><p>You can also change the email value if needed.</p>
</li>
<li>
<p>Apply the <code>kustomize</code> file under <code>iks-single</code> folder for single user deployment:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="k">while</span> ! kustomize build iks-single <span class="p">|</span> kubectl apply -f -<span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="s2">&#34;Retrying to apply resources&#34;</span><span class="p">;</span> sleep 10<span class="p">;</span> <span class="k">done</span>
</span></span></code></pre></div></li>
</ol>
<h3 id="accessing-your-cluster">Accessing your cluster</h3>
<p>The Kubeflow endpoint is exposed with <a href="https://kubernetes.io/docs/concepts/services-networking/service/#nodeport">NodePort</a> <code>30380</code>. To get a static ip, you can <a href="#expose-the-kubeflow-endpoint-as-a-loadbalancer">expose the Kubeflow endpoint as a LoadBalancer</a> and access the <strong>EXTERNAL_IP</strong>.</p>
<p>For single-user Kubeflow, IBM Cloud uses Dex authentication by default. You can access the cluster using
the email and password you specified in step 3 and 4 of <a href="#single-user">Single User</a></p>
<h2 id="multi-user-auth-enabled">Multi-user, auth-enabled</h2>
<p>Run the following steps to deploy Kubeflow with <a href="https://cloud.ibm.com/catalog/services/app-id">IBM Cloud AppID</a>
as an authentication provider.</p>
<p>The scenario is a Kubeflow cluster admin configures Kubeflow as a web
application in AppID and manages user authentication with builtin identity
providers (Cloud Directory, SAML, social log-in with Google or Facebook etc.) or
custom providers.</p>
<h3 id="prerequisites-1">Prerequisites</h3>
<p>For authentication,  IBM Cloud uses <a href="https://cloud.ibm.com/catalog/services/app-id">AppID</a></p>
<ol>
<li>
<p>Follow the <a href="https://cloud.ibm.com/catalog/services/app-id">Creating an App ID service instance on IBM Cloud</a> guide to learn about Kubeflow authentication.
You can also learn <a href="https://cloud.ibm.com/docs/appid?topic=appid-getting-started">how to use App ID</a> with different authentication methods.</p>
</li>
<li>
<p>Follow the <a href="https://cloud.ibm.com/docs/appid?topic=appid-app#app-register">Registering your app</a>
section of the App ID guide to create an application with type
<em>regularwebapp</em> under the provisioned AppID instance. Make sure the <em>scope</em>
contains <em>email</em>. Then retrieve the following configuration parameters from your AppID:</p>
<ul>
<li><code>clientId</code></li>
<li><code>secret</code></li>
<li><code>oAuthServerUrl</code></li>
</ul>
<p>You will be using these information in the subsequent sections.</p>
</li>
<li>
<p>Register the Kubeflow OIDC redirect page. The Kubeflow <code>REDIRECT_URL</code> URL is
<code>[http|https]://&lt;kubeflow-FQDN&gt;/login/oidc</code>, depends on if you enable the HTTPS or not.
<code>&lt;kubeflow-FQDN&gt;</code> is the endpoint for accessing Kubeflow. By default, the <code>&lt;kubeflow-FQDN&gt;</code>
on IBM Cloud is <code>&lt;worker_node_external_ip&gt;:30380</code>. To get a static ip, you can
<a href="#expose-the-kubeflow-endpoint-as-a-loadbalancer">expose the Kubeflow endpoint as a LoadBalancer</a>
and use the <strong>EXTERNAL_IP</strong> for your <code>&lt;kubeflow-FQDN&gt;</code>. Or use <code>ibmcloud ks nlb-dns</code> command
to map the <strong>EXTERNAL_IP</strong> to the generated FQDN for your cluster. In this case, you use the
generated FQDN as <code>kubeflow-FQDN</code>. If you enable HTTPS, you shall use generated FQDN.</p>
</li>
<li>
<p>Then, you need to place the Kubeflow OIDC <code>REDIRECT_URL</code> under <strong>Manage Authentication</strong> &gt; <strong>Authentication settings</strong> &gt; <strong>Add web redirect URLs</strong>.</p>
<img src="/docs/images/ibm/appid-redirect-settings.png" alt="APP ID Redirect Settings" class="mt-3 mb-3 border border-info rounded">
<p>Example:
<code>https://my-kubeflow-442dbba0442be6c8c50f31ed96b00601-0000.sjc04.containers.appdomain.cloud/login/oidc</code></p>
</li>
</ol>
<h3 id="deploy-using-kustomize-together-with-kubectl">Deploy: Using kustomize together with kubectl</h3>
<ol>
<li>
<p>Clone the manifest repo as follows:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">git clone https://github.com/IBM/manifests.git -b v1.6-branch ibm-manifests-160
</span></span></code></pre></div></li>
<li>
<p>Change directory to <code>ibm-manifests-160</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">cd</span> ibm-manifests-160
</span></span></code></pre></div></li>
<li>
<p>Update the <code>dist/stacks/ibm/application/oidc-authservice-appid/params.env</code>
with values collected in <a href="#prerequisites-1">Prereq</a> section.
You will need the following values:</p>
<ul>
<li><code>&lt;oAuthServerUrl&gt;</code> - replace <code>&lt;APP_ID_oauthServerUrl&gt;</code></li>
<li><code>&lt;kubeflow-FQDN&gt;</code> - fill in the FQDN of Kubeflow, if you don&rsquo;t know yet, just give a dummy one like
<code>localhost</code>. Then change it after you got one. Or get default FQDN of your cluster by this command:
<code>ibmcloud ks nlb-dns ls -c &lt;cluster name&gt;</code> (replace <code>&lt;cluter name&gt;</code> with your cluster name)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">OIDC_PROVIDER=https://us-south.appid.cloud.ibm.com/oauth/v4/f341ff8b-a088-497a-same-5da4628df7fd
</span></span><span class="line"><span class="cl">REDIRECT_URL=https://my-kubeflow-442dbba0442be6c8c50f31ed96b00601-0000.sjc04.containers.appdomain.cloud/login/oidc
</span></span><span class="line"><span class="cl">OIDC_AUTH_URL=https://us-south.appid.cloud.ibm.com/oauth/v4/f341ff8b-a088-497a-same-5da4628df7fd/authorization
</span></span></code></pre></div></li>
<li>
<p>Update the <code>dist/stacks/ibm/application/oidc-authservice-appid/secret_params.env</code>
with values collected in <a href="#prerequisites-1">Prereq</a> section.
You will need the following values:</p>
<ul>
<li><code>&lt;clientId&gt;</code> - replace the <code>&lt;APP_ID_clientId&gt;</code></li>
<li><code>&lt;secret&gt;</code> - replace the <code>&lt;APP_ID_secret&gt;</code></li>
</ul>
<p>Example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">CLIENT_SECRET=NjNhZDA3ODAtM2I3MCSECRETLTkwN2QtNDdhYmU5ZGIyMTBl
</span></span><span class="line"><span class="cl">CLIENT_ID=52b3e496-8888-8888-ABC9-c0da309cdf52
</span></span></code></pre></div></li>
<li>
<p>You can apply the <code>kustomize</code> file in <code>iks-multi</code> folder:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="k">while</span> ! kustomize build iks-multi <span class="p">|</span> kubectl apply -f -<span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="s2">&#34;Retrying to apply resources&#34;</span><span class="p">;</span> sleep 10<span class="p">;</span> <span class="k">done</span>
</span></span></code></pre></div></li>
<li>
<p>If at any point the values change and you have to change them, you can either patch the
<a href="#patch-configmap">configmap</a> and <a href="#patch-secret">secret</a> or change the content in the
files and apply the kustomize again. You will need to restart authservice with
<code>kubectl delete pod -l app=authservice -n istio-system</code> .</p>
<p>To apply just the <code>oidc-authservice-appid</code> you can use this command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kustomize build dist/stacks/ibm/application/oidc-authservice-appid <span class="p">|</span> kubectl apply -f -
</span></span><span class="line"><span class="cl">kubectl delete pod -l <span class="nv">app</span><span class="o">=</span>authservice -n istio-system
</span></span></code></pre></div></li>
</ol>
<h3 id="verify-mutli-user-installation">Verify mutli-user installation</h3>
<p>Check the pod <code>authservice-0</code> is in running state in namespace <code>istio-system</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SHELL" data-lang="SHELL"><span class="line"><span class="cl">kubectl get pod -l <span class="nv">app</span><span class="o">=</span>authservice -n istio-system
</span></span></code></pre></div><h3 id="extra-network-setup-requirement-for-vpc-gen2-clusters-only">Extra network setup requirement for <strong>vpc-gen2</strong> clusters only</h3>
<p><strong>Note</strong>: These steps are not required for <code>classic</code> clusters, i.e. where <code>WORKER_NODE_PROVIDER</code> is set to <code>classic</code>.</p>
<p>A <code>vpc-gen2</code> cluster does not assign a public IP address to the Kubernetes master node by default.
It provides access via a Load Balancer, which is configured to allow only a set of ports over public internet.
Access the cluster&rsquo;s resources in a <code>vpc-gen2</code> cluster, using one of the following options,</p>
<ul>
<li>
<p>Load Balancer method: To configure via a Load Balancer, go to <a href="#expose-the-kubeflow-endpoint-as-a-loadbalancer">Expose the Kubeflow endpoint as a LoadBalancer</a>.
This method is recommended when you have Kubeflow deployed with <a href="#multi-user-auth-enabled">Multi-user, auth-enabled</a> support — otherwise it will expose
cluster resources to the public.</p>
</li>
<li>
<p>Socks proxy method: If you need access to nodes or NodePort in the <code>vpc-gen2</code> cluster, this can be achieved by starting another instance in the
same <code>vpc-gen2</code> cluster and assigning it a public IP (i.e. the floating IP). Next, use SSH to log into the instance or create an SSH socks proxy,
such as <code>ssh -D9999 root@new-instance-public-ip</code>.</p>
</li>
</ul>
<p>Then, configure the socks proxy at <code>localhost:9999</code> and access cluster services.</p>
<ul>
<li><code>kubectl port-forward</code> method: To access Kubeflow dashboard, run <code>kubectl -n istio-system port-forward service/istio-ingressgateway 7080:http2</code>.
Then in a browser, go to<a href="http://127.0.0.1:7080/">http://127.0.0.1:7080/</a></li>
</ul>
<p><em><strong>Important notice</strong>: Exposing cluster/compute resources publicly without setting up a proper user authentication mechanism
is very insecure and can have very serious consequences(even legal). If there is no need to expose cluster services publicly,
Socks proxy method or <code>kubectl port-forward</code> method are recommended.</em></p>
<h2 id="next-steps-secure-the-kubeflow-dashboard-with-https">Next steps: secure the Kubeflow dashboard with HTTPS</h2>
<h3 id="prerequisites-2">Prerequisites</h3>
<p>For both <code>classic</code> and <code>vpc-gen2</code> cluster providers, make sure you have <a href="#multi-user-auth-enabled">Multi-user, auth-enabled</a> Kubeflow set up.</p>
<h3 id="setup">Setup</h3>
<p>Follow the steps in <a href="../authentication/#exposing-the-kubeflow-dashboard-with-dns-and-tls-termination">Exposing the Kubeflow dashboard with DNS and TLS termination</a>.
Then, you will have the required DNS name as Kubeflow FQDN to enable the OIDC flow for AppID:</p>
<ol>
<li>
<p>Follow the step <a href="https://cloud.ibm.com/docs/appid?topic=appid-managing-idp#add-redirect-uri">Adding redirect URIs</a>
to fill a URL for AppID to redirect to Kubeflow. The URL should look like <code>https://&lt;kubeflow-FQDN&gt;/login/oidc</code>.</p>
</li>
<li>
<p>Update the secret <code>appid-application-configuration</code> with the updated Kubeflow FQDN to replace <code>&lt;kubeflow-FQDN&gt;</code> in below command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SHELL" data-lang="SHELL"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">REDIRECT_URL</span><span class="o">=</span>https://&lt;kubeflow-FQDN&gt;/login/oidc
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">PATCH</span><span class="o">=</span><span class="k">$(</span><span class="nb">printf</span> <span class="s1">&#39;{&#34;data&#34;: {&#34;REDIRECT_URL&#34;: &#34;%s&#34;}}&#39;</span> <span class="s2">&#34;</span><span class="nv">$REDIRECT_URL</span><span class="s2">&#34;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubectl patch configmap/oidc-authservice-parameters -n istio-system -p<span class="o">=</span><span class="s2">&#34;</span><span class="nv">$PATCH</span><span class="s2">&#34;</span>
</span></span></code></pre></div></li>
<li>
<p>Restart the pod <code>authservice-0</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl delete pod -l <span class="nv">app</span><span class="o">=</span>authservice -n istio-system
</span></span></code></pre></div></li>
</ol>
<p>Then, visit <code>https://&lt;kubeflow-FQDN&gt;/</code>. The page should redirect you to AppID for authentication.</p>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="expose-the-kubeflow-endpoint-as-a-loadbalancer">Expose the Kubeflow endpoint as a LoadBalancer</h3>
<p>By default, the Kubeflow deployment on IBM Cloud only exposes the endpoint as <a href="https://kubernetes.io/docs/concepts/services-networking/service/#nodeport">NodePort</a> 30380. If you want to expose the endpoint as a <a href="https://kubernetes.io/docs/concepts/services-networking/service/#loadbalancer">LoadBalancer</a>, run:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl patch svc istio-ingressgateway -n istio-system -p <span class="s1">&#39;{&#34;spec&#34;: {&#34;type&#34;: &#34;LoadBalancer&#34;}}&#39;</span>
</span></span></code></pre></div><p>Then, you can locate the LoadBalancer in the <strong>EXTERNAL_IP</strong> column when you run the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl get svc istio-ingressgateway -n istio-system
</span></span></code></pre></div><p>There is a small delay, usually ~5 mins, for above commands to take effect.</p>
<h3 id="authservice-pod-taking-too-long-to-restart">Authservice pod taking too long to restart</h3>
<p>You might see the <code>authservice-0</code> pod taking some time to restart. If that happens you can delete to pod which will kick off restart from kubernetes reconciler.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl delete pod -l <span class="nv">app</span><span class="o">=</span>authservice -n istio-system
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-07a1bb96654c4b0fb7dfd8a4e48f6770">4 - Install Kubeflow on OpenShift</h1>
    <div class="lead">Instructions for deploying Kubeflow on IBM Cloud OpenShift</div>
	<p><strong>This guide has not yet been updated for Kubeflow 1.3</strong></p>
<p>This guide describes how to use the kfctl binary to deploy Kubeflow on IBM Cloud Kubernetes Service (IKS).</p>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>
<p>Authenticate with IBM Cloud</p>
<p>Log into IBM Cloud at <a href="https://cloud.ibm.com">IBM Cloud</a></p>
</li>
<li>
<p>Install OpenShift CLI</p>
<p>OpenShift CLI is the way to manage and access OpenShift cluster. You can <a href="https://cloud.ibm.com/docs/openshift?topic=openshift-openshift-cli">Install OpenShift CLI</a> from this instructions.</p>
</li>
<li>
<p>Create and access a OpenShift cluster on IKS</p>
<p>To deploy Kubeflow on IBM Cloud, you need a cluster running OpenShift on IKS. If you don&rsquo;t have a cluster running, follow the <a href="https://cloud.ibm.com/docs/openshift?topic=openshift-clusters">Create an IBM Cloud OpenShift cluster</a> guide.</p>
<p>To access the cluster follow these directions <a href="https://cloud.ibm.com/docs/openshift?topic=openshift-access_cluster">Access OpenShift Cluster</a>. We can easily get access from the openshift console on IBM Cloud<a href="https://cloud.ibm.com/docs/openshift?topic=openshift-access_cluster#access_oc_console">Connecting to the cluster from the console</a>.</p>
</li>
</ul>
<h2 id="installation">Installation</h2>
<p>If you&rsquo;re experiencing issues during the installation because of conflicts on your Kubeflow deployment, you can <a href="/docs/ibm/deploy/uninstall-kubeflow">uninstall Kubeflow</a> and install it again.</p>
<h3 id="single-user">Single user</h3>
<p>Run the following commands to set up and deploy Kubeflow for a single user without any authentication.</p>
<p><strong>Note</strong>: By default, Kubeflow deployment on IBM Cloud uses the <a href="https://github.com/kubeflow/kfp-tekton#kubeflow-pipelines-with-tekton">Kubeflow pipeline with the Tekton backend</a>.
If you want to use the Kubeflow pipeline with the Argo backend, you can change <code>CONFIG_URI</code> to this kfdef instead</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">https://raw.githubusercontent.com/kubeflow/manifests/v1.2-branch/kfdef/kfctl_openshift.v1.2.0.yaml
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># Set KF_NAME to the name of your Kubeflow deployment. This also becomes the</span>
</span></span><span class="line"><span class="cl"><span class="c1"># name of the directory containing your configuration.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># For example, your deployment name can be &#39;my-kubeflow&#39; or &#39;kf-test&#39;.</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">KF_NAME</span><span class="o">=</span>&lt;your choice of name <span class="k">for</span> the Kubeflow deployment&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Set the path to the base directory where you want to store one or more </span>
</span></span><span class="line"><span class="cl"><span class="c1"># Kubeflow deployments. For example, /opt/.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Then set the Kubeflow application directory for this deployment.</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">BASE_DIR</span><span class="o">=</span>&lt;path to a base directory&gt;
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">KF_DIR</span><span class="o">=</span><span class="si">${</span><span class="nv">BASE_DIR</span><span class="si">}</span>/<span class="si">${</span><span class="nv">KF_NAME</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Set the configuration file to use, such as:</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">CONFIG_FILE</span><span class="o">=</span>kfctl_ibm.yaml
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">CONFIG_URI</span><span class="o">=</span><span class="s2">&#34;https://raw.githubusercontent.com/kubeflow/manifests/master/distributions/kfdef/kfctl_openshift.master.kfptekton.yaml&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Generate Kubeflow:</span>
</span></span><span class="line"><span class="cl">mkdir -p <span class="si">${</span><span class="nv">KF_DIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> <span class="si">${</span><span class="nv">KF_DIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">wget <span class="si">${</span><span class="nv">CONFIG_URI</span><span class="si">}</span> -O <span class="si">${</span><span class="nv">CONFIG_FILE</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># On MacOS</span>
</span></span><span class="line"><span class="cl">sed -i <span class="s1">&#39;&#39;</span> -e <span class="s1">&#39;s#https://github.com/kubeflow/manifests/archive/master.tar.gz#https://github.com/kubeflow/manifests/archive/552a4ba84567ed8c0f9abca12f15b8eed000426c.tar.gz#g&#39;</span> <span class="si">${</span><span class="nv">CONFIG_FILE</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># On Linux</span>
</span></span><span class="line"><span class="cl">sed -i -e <span class="s1">&#39;s#https://github.com/kubeflow/manifests/archive/master.tar.gz#https://github.com/kubeflow/manifests/archive/552a4ba84567ed8c0f9abca12f15b8eed000426c.tar.gz#g&#39;</span> <span class="si">${</span><span class="nv">CONFIG_FILE</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Deploy Kubeflow. You can customize the CONFIG_FILE if needed.</span>
</span></span><span class="line"><span class="cl">kfctl apply -V -f <span class="si">${</span><span class="nv">CONFIG_FILE</span><span class="si">}</span>
</span></span></code></pre></div><ul>
<li>
<p><strong>${KF_NAME}</strong> - The name of your Kubeflow deployment.
If you want a custom deployment name, specify that name here.
For example,  <code>my-kubeflow</code> or <code>kf-test</code>.
The value of KF_NAME must consist of lower case alphanumeric characters or
&lsquo;-&rsquo;, and must start and end with an alphanumeric character.
The value of this variable cannot be greater than 25 characters. It must
contain just a name, not a directory path.
This value also becomes the name of the directory where your Kubeflow
configurations are stored, that is, the Kubeflow application directory.</p>
</li>
<li>
<p><strong>${KF_DIR}</strong> - The full path to your Kubeflow application directory.</p>
</li>
</ul>
<p>The Kubeflow deployment is exposed with a Route. To find the Route you can use</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">oc get route -n istio-system istio-ingressgateway -o=jsonpath=&#39;{.spec.host}&#39;
</span></span></code></pre></div><h2 id="next-steps">Next steps</h2>
<p>To secure the Kubeflow dashboard with HTTPS, follow the steps in <a href="/docs/ibm/deploy/authentication/#setting-up-an-nlb">Exposing the Kubeflow dashboard with DNS and TLS termination</a>.</p>
<h2 id="additional-information">Additional information</h2>
<p>You can find general information about Kubeflow configuration in the guide to <a href="/docs/other-guides/kustomize/">configuring Kubeflow with kfctl and kustomize</a>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-7c1de18991e035a057289cfa97453b61">5 - Securing the Kubeflow authentication with HTTPS</h1>
    <div class="lead">How to secure the Kubeflow authentication with HTTPS using the network load balancer</div>
	<p>This guide describes how to secure the Kubeflow authentication with HTTPS.
You can enable HTTPS for Kubeflow dashboard (and other web UIs) using the
network load balancer (NLB) feature of the IBM Cloud Kubernetes service—choose
the <code>classic</code> worker nodes provider in the
<a href="../../create-cluster#setting-environment-variables">Setting environment variables</a>
section of the Create an IBM Cloud cluster guide.</p>
<p><strong>Note</strong>: For details on NLB, go to the official
<a href="https://cloud.ibm.com/docs/containers?topic=containers-loadbalancer-about">Classic: About network load balancers</a>
guide.</p>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>Install and configure the
<a href="https://cloud.ibm.com/docs/cli?topic=cli-getting-started">IBM Cloud CLI</a>.</li>
<li>Install
<a href="../install-kubeflow-on-iks/#multi-user-auth-enabled">multi-user, auth-enabled Kubeflow</a>.</li>
</ul>
<h2 id="setting-up-an-nlb">Setting up an NLB</h2>
<p>To set up an NLB for your Kubernetes cluster, follow the official
<a href="https://cloud.ibm.com/docs/containers?topic=containers-loadbalancer">Classic: Setting up basic load balancing with an NLB 1.0</a>
guide. Notice that the setup process for a multi-zone cluster differs from that
of a single-zone cluster. For details, go to
<a href="https://cloud.ibm.com/docs/containers?topic=containers-loadbalancer#multi_zone_config">Setting up an NLB 1.0 in a multi-zone cluster</a>.</p>
<ol>
<li>
<p>To use the existing Istio ingress gateway (instead of creating a new
service), you need to update the service type of <code>istio-ingressgateway</code> to
<code>LoadBalancer</code> from <code>NodePort</code>. Run the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl patch svc istio-ingressgateway -n istio-system -p <span class="s1">&#39;{&#34;spec&#34;:{&#34;type&#34;:&#34;LoadBalancer&#34;}}&#39;</span>
</span></span></code></pre></div></li>
<li>
<p>Verify that the NLB was created successfully. It might take a few minutes for
the service to be created and an IP address to be made available. Run the
command below and check if you can see the <code>LoadBalancer Ingress</code> IP address:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl describe service istio-ingressgateway -n istio-system <span class="p">|</span> grep <span class="s2">&#34;LoadBalancer Ingress&#34;</span>
</span></span></code></pre></div></li>
<li>
<p>Store the external IP of the <code>istio-ingressgateway</code> service in an environment
variable:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">INGRESS_GATEWAY_IP</span><span class="o">=</span><span class="k">$(</span>kubectl -n istio-system get service istio-ingressgateway -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.status.loadBalancer.ingress[0].ip}&#39;</span><span class="k">)</span>
</span></span></code></pre></div></li>
</ol>
<h2 id="exposing-the-kubeflow-dashboard-with-dns-and-tls-termination">Exposing the Kubeflow dashboard with DNS and TLS termination</h2>
<p>The following instructions use the Kubeflow dashboard as an example. However,
they apply to other web UI applications, since they all go through the Istio
ingress gateway.</p>
<ol>
<li>
<p>Store the Kubernetes cluster name in an environment variable by running the
following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">CLUSTER_NAME</span><span class="o">=</span>&lt;cluster_name&gt;
</span></span></code></pre></div></li>
<li>
<p>Create a DNS domain and certificates for the IP of the service
<code>istio-ingressgateway</code> in namespace <code>istio-system</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ibmcloud ks nlb-dns create classic --cluster <span class="nv">$CLUSTER_NAME</span> --ip <span class="nv">$INGRESS_GATEWAY_IP</span> --secret-namespace istio-system
</span></span></code></pre></div></li>
<li>
<p>List the registered domain names:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ibmcloud ks nlb-dns ls --cluster <span class="nv">$CLUSTER_NAME</span>
</span></span></code></pre></div></li>
<li>
<p>Wait until the status of the certificate—the fourth field—of the new domain
name becomes <code>created</code>. Then, save the value of the column <code>SSL Cert Secret Name</code> in environment variables by running these commands (replace
<code>{SECRET_NAME}</code> with the secret&rsquo;s name as shown in the <code>SSL Cert Secret Name</code>
column):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">INGRESS_GATEWAY_SECRET</span><span class="o">={</span>SECRET_NAME<span class="o">}</span>
</span></span></code></pre></div><p><strong>Note</strong>: If there is more than one entry in the output, choose the one
that matches the IP address from <code>LoadBalancer Ingress</code> (step 2) of service
<code>istio-ingressgateway</code>.</p>
</li>
<li>
<p>Create a secret named <code>istio-ingressgateway-certs</code> for the
<code>istio-ingressgateway</code> pods in namespace <code>istio-system</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl get secret <span class="nv">$INGRESS_GATEWAY_SECRET</span> -n istio-system -o yaml &gt; istio-ingressgateway-certs.yaml
</span></span></code></pre></div></li>
<li>
<p>Update the <code>istio-ingressgateway-certs.yaml</code> file by changing the value of
<code>metadata.name</code> to <code>istio-ingressgateway-certs</code> and the value of
<code>metadata.namespace</code> to <code>istio-system</code>. Then, run the following commands:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl apply -f istio-ingressgateway-certs.yaml -n istio-system
</span></span><span class="line"><span class="cl">kubectl rollout restart deploy istio-ingressgateway -n istio-system
</span></span><span class="line"><span class="cl">rm istio-ingressgateway-certs.yaml
</span></span></code></pre></div></li>
<li>
<p>Update the gateway <code>kubeflow-gateway</code> to expose port <code>443</code>. Create a resource
file <code>kubeflow-gateway.yaml</code> as follows by replacing <code>&lt;hostname&gt;</code> with the value
of the column <code>Hostname</code> in step 4:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-YAML" data-lang="YAML"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">networking.istio.io/v1alpha3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">kubeflow-gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">kubeflow</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">istio</span><span class="p">:</span><span class="w"> </span><span class="l">ingressgateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">servers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">hosts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="s1">&#39;&lt;hostname&gt;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">https</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="m">443</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">HTTPS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">tls</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l">SIMPLE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">privateKey</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/istio/ingressgateway-certs/tls.key</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">serverCertificate</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/istio/ingressgateway-certs/tls.crt</span><span class="w">
</span></span></span></code></pre></div></li>
<li>
<p>Verify that the traffic is routed via HTTPS by using the value of
above-mentioned <code>Hostname</code> in your browser. It should redirect traffic from an
HTTP address to HTTPS address automatically.</p>
</li>
</ol>
<p><strong>Note</strong>: The certificates for the NLB DNS host secret expire every <strong>90</strong> days.
The secret in the <code>default</code> namespace is automatically renewed by IBM Cloud
Kubernetes Service 37 days before it expires. After this secret is updated, you
must manually copy it to the <code>istio-ingressgateway-certs</code> secret by repeating
commands in step 5 and 6.</p>
<h2 id="optional---kserve-configuration">Optional - KServe configuration</h2>
<p>With this HTTPS setup, you need to make additional changes to get KServe to work.</p>
<ol>
<li>
<p>First, update the Knative domain that is used for the KServe routes to the
hostname that you used when updating <code>kubeflow-gateway</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl edit configmap config-domain -n knative-serving
</span></span></code></pre></div><p>This will open your default text editor, and you will see something like:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-YAML" data-lang="YAML"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">_example</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">    ################################
</span></span></span><span class="line"><span class="cl"><span class="sd">    #                              #
</span></span></span><span class="line"><span class="cl"><span class="sd">    #    EXAMPLE CONFIGURATION     #
</span></span></span><span class="line"><span class="cl"><span class="sd">    #                              #
</span></span></span><span class="line"><span class="cl"><span class="sd">    ################################
</span></span></span><span class="line"><span class="cl"><span class="sd">    # ...
</span></span></span><span class="line"><span class="cl"><span class="sd">    example.com: |</span><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ConfigMap</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">...</span><span class="w">
</span></span></span></code></pre></div><p>Add a line above the <code>_example</code> key with your hostname as the key and an empty string value.
Be sure to update <code>&lt;hostname&gt;</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-YAML" data-lang="YAML"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">&lt;hostname&gt;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">_example</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">   </span><span class="w">   </span><span class="l">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ConfigMap</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">...</span><span class="w">
</span></span></span></code></pre></div><p>Then, save and exit. The routes for your InferenceServices will start using this new domain.</p>
</li>
<li>
<p>Since the certificates provided by IBM Cloud only allow for a single level of domain name added
to the base domain, the domain template for Knative needs to be adjusted so that the certificates
will be valid for the InferenceService routes.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl edit configmap config-network -n knative-serving
</span></span></code></pre></div><p>This will open your default text editor, and you will again see something like:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-YAML" data-lang="YAML"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">_example</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">    ################################
</span></span></span><span class="line"><span class="cl"><span class="sd">    #                              #
</span></span></span><span class="line"><span class="cl"><span class="sd">    #    EXAMPLE CONFIGURATION     #
</span></span></span><span class="line"><span class="cl"><span class="sd">    #                              #
</span></span></span><span class="line"><span class="cl"><span class="sd">    ################################
</span></span></span><span class="line"><span class="cl"><span class="sd">    # ...</span><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ConfigMap</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">...</span><span class="w">
</span></span></span></code></pre></div><p>Add a line above the <code>_example</code> key with the <code>domainTemplate</code> key like the following:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-YAML" data-lang="YAML"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">domainTemplate</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;{{.Name}}-{{.Namespace}}.{{.Domain}}&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">_example</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">   </span><span class="w">   </span><span class="l">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ConfigMap</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">...</span><span class="w">
</span></span></span></code></pre></div><p>Save and exit. The default template uses a two-level subdomain (i.e. <code>{{.Name}}.{{.Namespace}}.{{.Domain}}</code>),
so this just adjusts it to use one.</p>
</li>
<li>
<p>Adjust <code>kubeflow-gateway</code> one more time, adding a wildcard host in the HTTPS <code>hosts</code> section.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl edit gateway kubeflow-gateway -n kubeflow
</span></span></code></pre></div><p>This will open your default text editor, but you can also optionally edit <code>kubeflow-gateway.yaml</code> file
you created previously. Here, just add another entry to the HTTPS <code>hosts</code> list containing your hostname prepended
with a <code>*.</code> so that the Knative subdomains are properly routed.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-YAML" data-lang="YAML"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">networking.istio.io/v1alpha3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">kubeflow-gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">kubeflow</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">istio</span><span class="p">:</span><span class="w"> </span><span class="l">ingressgateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">servers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">hosts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="s1">&#39;&lt;hostname&gt;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="s1">&#39;*.&lt;hostname&gt;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">https</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="m">443</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">HTTPS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">tls</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l">SIMPLE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">privateKey</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/istio/ingressgateway-certs/tls.key</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">serverCertificate</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/istio/ingressgateway-certs/tls.crt</span><span class="w">
</span></span></span></code></pre></div><p>Save and exit.</p>
</li>
</ol>
<p>After these adjustments, InferenceServices should now be reachable via HTTPS. To test out an external
prediction, you can use the <code>authservice_session</code> cookie for the Kubeflow dashboard site from the browser. Once
the content of the cookie is retrieved from the browser, it can be added as a header in your request
(e.g. <code>&quot;Cookie: authservice_session=MTYwNz...&quot;</code>). For example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">curl -v https://sklearn-iris-kserve-test.kf-dev-442dbba0442be6c8c50f31ed96b00532-0001.sjc03.containers.appdomain.cloud/v1/models/sklearn-iris:predict -d <span class="s1">&#39;{&#34;instances&#34;: [[6.8,  2.8,  4.8,  1.4],[6.0,  3.4,  4.5,  1.6]]}&#39;</span> -H <span class="s2">&#34;Cookie: authservice_session=MTYwODMyODk5M3xOd3dBTkVzeU5VSlJRazlQVnpWT1dGUldWa0ZXVDBRMVFsY3pVVFZHVVVGV01rWkRORmd6VmxCVVNsQkVSa2xaUlZVMFRUVldVMEU9fJBHfRCAvs6nSh_J04VlBEq_yqhkUvc5Z1Mqahe9klOd&#34;</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-4befd9d928cd0502f971527786e1a7ec">6 - Uninstall Kubeflow</h1>
    <div class="lead">Instructions for uninstalling Kubeflow</div>
	<p>Uninstall Kubeflow on your IBM Cloud IKS cluster.</p>
<ol>
<li>
<p>Go to your Kubeflow deployment directory where you download the
IBM manifests repository: <a href="https://github.com/IBM/manifests.git">https://github.com/IBM/manifests.git</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">cd</span> ibm-manifests-160
</span></span></code></pre></div></li>
<li>
<p>Run the following command to get Kubeflow Profiles:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl get profile
</span></span></code></pre></div></li>
<li>
<p>Delete all Kubeflow Profiles manually:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl delete profile --all
</span></span></code></pre></div><p>Use the following command to check all namespaces for Kubeflow Profiles
are removed properly:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl get ns
</span></span></code></pre></div><p>Make sure no namespace is in the <code>Terminating</code> state.</p>
</li>
<li>
<p>Remove Kubeflow:</p>
<p>For single-user deployment:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kustomize build iks-single <span class="p">|</span> kubectl delete -f -
</span></span></code></pre></div><p>For multi-user deployment:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kustomize build iks-multi <span class="p">|</span> kubectl delete -f -
</span></span></code></pre></div></li>
</ol>

</div>



    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark pt-3 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Kubeflow mailing list" aria-label="Kubeflow mailing list">
    <a class="text-white" target="_blank" rel="noopener" href="https://www.kubeflow.org/docs/about/community/#kubeflow-mailing-list" aria-label="Kubeflow mailing list">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-white" target="_blank" rel="noopener" href="https://twitter.com/kubeflow" aria-label="Twitter">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Stack Overflow" aria-label="Stack Overflow">
    <a class="text-white" target="_blank" rel="noopener" href="https://stackoverflow.com/questions/tagged/kubeflow" aria-label="Stack Overflow">
      <i class="fab fa-stack-overflow"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/GoogleCloudPlatform/kubeflow-distribution" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-white" target="_blank" rel="noopener" href="https://www.kubeflow.org/docs/about/community/#kubeflow-slack" aria-label="Slack">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-5 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2022 Google | Documentation Distributed under CC BY 4.0</small>
        <p><small class="ml-1"><a href="https://policies.google.com/privacy" target="_blank" rel="noopener">Privacy Policy</a></small></p>
	
		<p class="mt-2"><a href="/kubeflow-docs/docs/about/">About</a></p>
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="/kubeflow-docs/js/main.min.301c0110334bec1b4445867d27dc7dd69b2df859154ccf252005508bc860cc5a.js" integrity="sha256-MBwBEDNL7BtERYZ9J9x91pst&#43;FkVTM8lIAVQi8hgzFo=" crossorigin="anonymous"></script>
<script src='/kubeflow-docs/js/tabpane-persist.js'></script>

  </body>
</html>

<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.105.0">
<link rel="canonical" type="text/html" href="https://gkcalat.github.io/kubeflow-docs/docs/distributions/azure/">
<link rel="alternate" type="application/rss&#43;xml" href="https://gkcalat.github.io/kubeflow-docs/docs/distributions/azure/index.xml">
<meta name="robots" content="noindex, nofollow">

<script type="application/ld+json">
  {
      "@context" : "http://schema.org",
      "@type" : "WebSite",
      "mainEntityOfPage": {
           "@type": "WebPage",
           "@id": "https:\/\/gkcalat.github.io\/kubeflow-docs"
      },
      "articleSection" : "docs",
      "name" : "Kubeflow on Azure",
      "headline" : "Kubeflow on Azure",
      "description" : "Running Kubeflow on Kubernetes Engine and Microsoft Azure",
      "inLanguage" : "en-US",
      "author" : "",
      "creator" : "",
      "publisher": "",
      "accountablePerson" : "",
      "copyrightHolder" : "",
      "copyrightYear" : "0001",
      "datePublished": "0001-01-01 00:00:00 \u002b0000 UTC",
      "dateModified" : "0001-01-01 00:00:00 \u002b0000 UTC",
      "url" : "https:\/\/gkcalat.github.io\/kubeflow-docs\/docs\/distributions\/azure\/",
      "wordCount" : "0",
      "keywords" : [ "Kubeflow" ]
  }
  </script>

<link rel="shortcut icon" href="/kubeflow-docs/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/kubeflow-docs/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/kubeflow-docs/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/kubeflow-docs/favicons/favicon-32x32.png" sizes="32x32">
<link rel="manifest" href="/kubeflow-docs/favicons/manifest.json">
<meta name="msapplication-config" content="/kubeflow-docs/favicons/browserconfig.xml" />
<meta name="msapplication-TileColor" content="#4279f4">
<meta name="theme-color" content="#4279f4">

<title>Kubeflow on Azure | Kubeflow on Google Cloud Platform</title>
<meta name="description" content="Running Kubeflow on Kubernetes Engine and Microsoft Azure">
<meta property="og:title" content="Kubeflow on Azure" />
<meta property="og:description" content="Running Kubeflow on Kubernetes Engine and Microsoft Azure" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://gkcalat.github.io/kubeflow-docs/docs/distributions/azure/" /><meta property="og:site_name" content="Kubeflow on Google Cloud Platform" />

<meta itemprop="name" content="Kubeflow on Azure">
<meta itemprop="description" content="Running Kubeflow on Kubernetes Engine and Microsoft Azure"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Kubeflow on Azure"/>
<meta name="twitter:description" content="Running Kubeflow on Kubernetes Engine and Microsoft Azure"/>




<link rel="preload" href="/kubeflow-docs/scss/main.min.5006b434b14f73c3d5537a7ba4c8ecef723ddc93f3a3c8530e19d24f75486ea9.css" as="style">
<link href="/kubeflow-docs/scss/main.min.5006b434b14f73c3d5537a7ba4c8ecef723ddc93f3a3c8530e19d24f75486ea9.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-GK9XL47N6S"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-GK9XL47N6S', { 'anonymize_ip': false });
}
</script>

  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand-md navbar-dark  td-navbar">
        <a class="navbar-brand" href="/kubeflow-docs/">
		<span class="navbar-logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 276.93 274.55"><g data-name="Layer 2"><g data-name="Layer 1"><path d="M95.9 62.15l4.1 102.1 73.75-94.12a6.79 6.79.0 019.6-1.11l46 36.92-15-65.61z" fill="#4279f4"/><path fill="#0028aa" d="M102.55 182.98h65.42l-40.17-32.23-25.25 32.23z"/><path fill="#014bd1" d="M180.18 83.92l-44 56.14 46.88 37.61 44.47-55.76-47.35-37.99z"/><path fill="#bedcff" d="M83.56 52.3l.01-.01 38.69-48.52-62.39 30.05-15.41 67.51 39.1-49.03z"/><path fill="#6ca1ff" d="M45.32 122.05l41.44 51.96-3.95-98.98-37.49 47.02z"/><path fill="#a1c3ff" d="M202.31 28.73 142.65.0l-37.13 46.56 96.79-17.83z"/><path d="M1.6 272v-44.78h5.74v23.41l20.48-23.41h6.4l-17.39 19.7 19 25.07H29.1l-15.92-20.8-5.84 6.65V272zm40.02-9.79V240h5.43v22.39a4.67 4.67.0 002.35 4.19 11 11 0 0011 0 4.69 4.69.0 002.33-4.19V240h5.43v22.19a9.08 9.08.0 01-4.1 7.87 16.2 16.2.0 01-18.37.0 9.07 9.07.0 01-4.07-7.85zM77.46 272v-48h5.43v16.81a29.29 29.29.0 019.32-1.73 13.1 13.1.0 016.2 1.41 10.71 10.71.0 014.18 3.74 18.07 18.07.0 012.23 5.06 21.26 21.26.0 01.73 5.58q0 8.43-4.38 12.79T87.35 272zm5.43-4.87h4.55q6.77.0 9.72-2.95t3-9.51a14.21 14.21.0 00-2-7.52 6.55 6.55.0 00-6-3.22 24.73 24.73.0 00-9.25 1.54zm29.47-11.19q0-7.71 4.09-12.3a13.75 13.75.0 0110.8-4.59q13.35.0 13.36 18.86h-22.82a12.3 12.3.0 002.9 7.07q2.59 3.11 7.9 3.1a24.92 24.92.0 0010.55-2v5a27.74 27.74.0 01-9.86 1.87 19.83 19.83.0 01-7.7-1.37 13.31 13.31.0 01-5.28-3.76 16.21 16.21.0 01-3-5.38 20.84 20.84.0 01-.94-6.5zm5.62-2.12h17.26a14.91 14.91.0 00-2.37-7.12 6.44 6.44.0 00-5.62-2.78 8.2 8.2.0 00-6.21 2.72 12.07 12.07.0 00-3.04 7.18z" fill="#4279f4" stroke="#4279f4" stroke-miterlimit="10" stroke-width="3.2"/><path d="M147.32 244.89V240h5v-7.59a8.14 8.14.0 012.31-6.05 7.79 7.79.0 015.69-2.28h7.86V229h-5c-2.21.0-3.67.45-4.37 1.34s-1.06 2.55-1.06 5V240h8.46v4.87h-8.46V272h-5.44v-27.1zM175.26 272v-48h5.43v48zm19.15-3.95a17.86 17.86.0 1112.33 4.9 16.57 16.57.0 01-12.33-4.9zm3.84-20.65a13.16 13.16.0 000 17.2 12.07 12.07.0 0017 0 13.09 13.09.0 000-17.2 12.07 12.07.0 00-17 0zm30.2-7.4h5.75l7.3 25.32 7.43-25.32h5.36l7.34 25.34L269 240h5.74l-10.04 32h-6.12l-6.83-24.58L245 272h-6.47z" fill="#0028aa" stroke="#0028aa" stroke-miterlimit="10" stroke-width="3.2"/></g></g></svg></span><span class="text-uppercase font-weight-bold">Kubeflow on Google Cloud Platform</span>
	</a>
	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main_navbar" aria-controls="main_navbar" aria-expanded="false" aria-label="Toggle navigation">
		<span class="navbar-toggler-icon"></span>
	</button>
	<div class="collapse navbar-collapse ml-md-auto" id="main_navbar">
		<ul class="navbar-nav ml-auto pt-4 pt-md-0 my-2 my-md-1">
			
			
			<li class="nav-item mr-2 mr-lg-4 mt-1 mt-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/kubeflow-docs/docs/" ><span>Docs</span></a>
			</li>
			
			<li class="nav-item mr-2 mr-lg-4 mt-1 mt-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/kubeflow-docs/news/" ><span>News</span></a>
			</li>
			
			<li class="nav-item mr-2 mr-lg-4 mt-1 mt-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="https://github.com/GoogleCloudPlatform/kubeflow-distribution" target="_blank" ><i class='fa-brands fa-github pr-2'></i><span>Source</span></a>
			</li>
			
			
			<li class="nav-item dropdown mt-1 mt-lg-0 mr-2">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	Releases
</a>
<div class="dropdown-menu dropdown-menu-md-right dropdown-menu-lg-left" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/v1.6-release/docs">latest</a>
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/v1.6-release/docs">v1.6</a>
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/v1.5-release/docs">v1.5</a>
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/v1.4-release/docs">v1.4</a>
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/main/docs">dev</a>
	
</div>

			</li>
			
			
		</ul>
	</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/kubeflow-docs/docs/distributions/azure/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Kubeflow on Azure</h1>
<div class="lead">Running Kubeflow on Kubernetes Engine and Microsoft Azure</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-296b8f4fb73897b806532822e3f3a641">Deployment</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>1.1: <a href="#pg-ae0075ca9e9477c52b15bd0ce935d756">Install Kubeflow</a></li>


    
  
    
    
	
<li>1.2: <a href="#pg-d80a4f1149392569f5fa32bfeab74ec8">Initial cluster setup for existing cluster</a></li>


    
  
    
    
	
<li>1.3: <a href="#pg-cca4667a521d523791f9eca2edebf780">Uninstall Kubeflow</a></li>


    
  

    </ul>
    
  
    
    
	
<li>2: <a href="#pg-ceb950e97fd05a822eae67c3c1550705">Authentication using OIDC in Azure</a></li>


    
  
    
    
	
<li>3: <a href="#pg-a7982f9de61c52e0a0d173d95c15010d">Azure Machine Learning Components</a></li>


    
  
    
    
	
<li>4: <a href="#pg-76b20e0deb3b1a126cffda28d5d7870f">End-to-End Pipeline Example on Azure</a></li>


    
  
    
    
	
<li>5: <a href="#pg-8db8e540d9b02097d039dac1656bed32">Access Control for Azure Deployment</a></li>


    
  
    
    
	
<li>6: <a href="#pg-ef86fdffe53ad5bdd20b56381dd21142">Configure Azure MySQL database to store metadata</a></li>


    
  
    
    
	
<li>7: <a href="#pg-f40c9e23375af11c53e0a087013f0bf9">Troubleshooting Deployments on Azure AKS</a></li>


    
  

    </ul>


<div class="content">
      
</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-296b8f4fb73897b806532822e3f3a641">1 - Deployment</h1>
    <div class="lead">Instructions for deploying Kubeflow on Azure</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-ae0075ca9e9477c52b15bd0ce935d756">1.1 - Install Kubeflow</h1>
    <div class="lead">Instructions for deploying Kubeflow</div>
	<p>This guide describes how to use the kfctl binary to
deploy Kubeflow on Azure.</p>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>Install <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/#install-kubectl-on-linux">kubectl</a></li>
<li>Install and configure the <a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Azure Command Line Interface (Az)</a>
<ul>
<li>Log in with <code>az login</code></li>
</ul>
</li>
<li>Install Docker
<ul>
<li>For Windows and WSL: <a href="https://docs.docker.com/docker-for-windows/wsl/">Guide</a></li>
<li>For other OS: <a href="https://docs.docker.com/docker-hub/">Docker Desktop</a></li>
</ul>
</li>
</ul>
<p>You do not need to have an existing Azure Resource Group or Cluster for AKS (Azure Kubernetes Service). You can create a cluster in the deployment process.</p>
<h2 id="understanding-the-deployment-process">Understanding the deployment process</h2>
<p>The deployment process is controlled by the following commands:</p>
<ul>
<li><strong>build</strong> - (Optional) Creates configuration files defining the various
resources in your deployment. You only need to run <code>kfctl build</code> if you want
to edit the resources before running <code>kfctl apply</code>.</li>
<li><strong>apply</strong> - Creates or updates the resources.</li>
<li><strong>delete</strong> - Deletes the resources.</li>
</ul>
<h3 id="app-layout">App layout</h3>
<p>Your Kubeflow application directory <strong>${KF_DIR}</strong> contains the following files and
directories:</p>
<ul>
<li>
<p><strong>${CONFIG_FILE}</strong> is a YAML file that defines configurations related to your
Kubeflow deployment.</p>
<ul>
<li>This file is a copy of the GitHub-based configuration YAML file that
you used when deploying Kubeflow. For example, <a href="https://raw.githubusercontent.com/kubeflow/manifests/v1.2-branch/kfdef/kfctl_azure.v1.2.0.yaml">https://raw.githubusercontent.com/kubeflow/manifests/v1.2-branch/kfdef/kfctl_azure.v1.2.0.yaml</a>
.</li>
<li>When you run <code>kfctl apply</code> or <code>kfctl build</code>, kfctl creates
a local version of the configuration file, <code>${CONFIG_FILE}</code>,
which you can further customize if necessary.</li>
</ul>
</li>
<li>
<p><strong>kustomize</strong> is a directory that contains the kustomize packages for Kubeflow applications.</p>
<ul>
<li>The directory is created when you run <code>kfctl build</code> or <code>kfctl apply</code>.</li>
<li>You can customize the Kubernetes resources (modify the manifests and run <code>kfctl apply</code> again).</li>
</ul>
</li>
</ul>
<p>If you experience any issues running these scripts, see the <a href="/docs/azure/troubleshooting-azure">troubleshooting guidance</a> for more information.</p>
<h2 id="azure-setup">Azure setup</h2>
<h3 id="to-log-into-azure-from-the-command-line-interface-run-the-following-commands">To log into Azure from the command line interface, run the following commands</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">az login
</span></span><span class="line"><span class="cl">az account set --subscription &lt;NAME OR ID OF SUBSCRIPTION&gt;
</span></span></code></pre></div><h3 id="initial-cluster-setup-for-new-cluster">Initial cluster setup for new cluster</h3>
<p>Create a resource group:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">az group create -n &lt;RESOURCE_GROUP_NAME&gt; -l &lt;LOCATION&gt;
</span></span></code></pre></div><p>Example variables:</p>
<ul>
<li><code>RESOURCE_GROUP_NAME=KubeTest</code></li>
<li><code>LOCATION=westus</code></li>
</ul>
<p>Create a specifically defined cluster:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">az aks create -g &lt;RESOURCE_GROUP_NAME&gt; -n &lt;NAME&gt; -s &lt;AGENT_SIZE&gt; -c &lt;AGENT_COUNT&gt; -l &lt;LOCATION&gt; --generate-ssh-keys
</span></span></code></pre></div><p>Example variables:</p>
<ul>
<li><code>NAME=KubeTestCluster</code></li>
<li><code>AGENT_SIZE=Standard_D4s_v3</code></li>
<li><code>AGENT_COUNT=2</code></li>
<li><code>RESOURCE_GROUP_NAME=KubeTest</code></li>
</ul>
<p><strong>NOTE</strong>:  If you are using a GPU based AKS cluster (For example: AGENT_SIZE=Standard_NC6), you also need to <a href="https://docs.microsoft.com/azure/aks/gpu-cluster#install-nvidia-drivers">install the NVidia drivers</a> on the cluster nodes before you can use GPUs with Kubeflow.</p>
<h2 id="kubeflow-installation">Kubeflow installation</h2>
<p><strong>Important</strong>: To deploy Kubeflow on Azure with multi-user authentication and namespace separation, use the instructions for <a href="/docs/azure/authentication-oidc">Authentication using OICD in Azure</a>. The instructions in this guide apply only to a single-user Kubeflow deployment. Such a deployment cannot be upgraded to a multi-user deployment at this time.</p>
<p><strong>Note</strong>: kfctl is currently available for Linux and macOS users only. If you use Windows, you can install kfctl on Windows Subsystem for Linux (WSL). Refer to the official <a href="https://docs.microsoft.com/en-us/windows/wsl/install-win10">instructions</a> for setting up WSL.</p>
<p>Run the following commands to set up and deploy Kubeflow.</p>
<ol>
<li>
<p>Create user credentials. You only need to run this command once.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">az aks get-credentials -n &lt;NAME&gt; -g &lt;RESOURCE_GROUP_NAME&gt;
</span></span></code></pre></div></li>
<li>
<p>Download the kfctl v1.2.0 release from the
<a href="https://github.com/kubeflow/kfctl/releases/tag/v1.2.0">Kubeflow releases
page</a>.</p>
</li>
<li>
<p>Unpack the tar ball:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">tar -xvf kfctl_v1.2.0_&lt;platform&gt;.tar.gz
</span></span></code></pre></div></li>
<li>
<p>Run the following commands to set up and deploy Kubeflow. The code below includes an optional command to add the
binary kfctl to your path. If you don’t add the binary to your path, you must use the full path to the kfctl binary each time you run it.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># The following command is optional. It adds the kfctl binary to your path.
</span></span><span class="line"><span class="cl"># If you don&#39;t add kfctl to your path, you must use the full path
</span></span><span class="line"><span class="cl"># each time you run kfctl.
</span></span><span class="line"><span class="cl"># Use only alphanumeric characters or - in the directory name.
</span></span><span class="line"><span class="cl">export PATH=$PATH:&#34;&lt;path-to-kfctl&gt;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Set KF_NAME to the name of your Kubeflow deployment. You also use this
</span></span><span class="line"><span class="cl"># value as directory name when creating your configuration directory.
</span></span><span class="line"><span class="cl"># For example, your deployment name can be &#39;my-kubeflow&#39; or &#39;kf-test&#39;.
</span></span><span class="line"><span class="cl">export KF_NAME=&lt;your choice of name for the Kubeflow deployment&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Set the path to the base directory where you want to store one or more 
</span></span><span class="line"><span class="cl"># Kubeflow deployments. For example, /opt/.
</span></span><span class="line"><span class="cl"># Then set the Kubeflow application directory for this deployment.
</span></span><span class="line"><span class="cl">export BASE_DIR=&lt;path to a base directory&gt;
</span></span><span class="line"><span class="cl">export KF_DIR=${BASE_DIR}/${KF_NAME}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Set the configuration file to use when deploying Kubeflow.
</span></span><span class="line"><span class="cl"># The following configuration installs Istio by default. Comment out 
</span></span><span class="line"><span class="cl"># the Istio components in the config file to skip Istio installation. 
</span></span><span class="line"><span class="cl"># See https://github.com/kubeflow/kubeflow/pull/3663
</span></span><span class="line"><span class="cl">export CONFIG_URI=&#34;https://raw.githubusercontent.com/kubeflow/manifests/v1.2-branch/kfdef/kfctl_k8s_istio.v1.2.0.yaml&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">mkdir -p ${KF_DIR}
</span></span><span class="line"><span class="cl">cd ${KF_DIR}
</span></span><span class="line"><span class="cl">kfctl apply -V -f ${CONFIG_URI}
</span></span></code></pre></div><ul>
<li>
<p><strong>${KF_NAME}</strong> - The name of your Kubeflow deployment.
If you want a custom deployment name, specify that name here.
For example,  <code>my-kubeflow</code> or <code>kf-test</code>.
The value of KF_NAME must consist of lower case alphanumeric characters or
&lsquo;-&rsquo;, and must start and end with an alphanumeric character.
The value of this variable cannot be greater than 25 characters. It must
contain just a name, not a directory path.
You also use this value as directory name when creating the directory where
your Kubeflow  configurations are stored, that is, the Kubeflow application
directory.</p>
</li>
<li>
<p><strong>${KF_DIR}</strong> - The full path to your Kubeflow application directory.</p>
</li>
<li>
<p><strong>${CONFIG_URI}</strong> - The GitHub address of the configuration YAML file that
you want to use to deploy Kubeflow. The URI used in this guide is
<a href="https://raw.githubusercontent.com/kubeflow/manifests/v1.2-branch/kfdef/kfctl_k8s_istio.v1.2.0.yaml">https://raw.githubusercontent.com/kubeflow/manifests/v1.2-branch/kfdef/kfctl_k8s_istio.v1.2.0.yaml</a>.
When you run <code>kfctl apply</code> or <code>kfctl build</code> (see the next step), kfctl creates
a local version of the configuration YAML file which you can further
customize if necessary.</p>
</li>
</ul>
</li>
<li>
<p>Run this command to check that the resources have been deployed correctly in namespace <code>kubeflow</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl get all -n kubeflow
</span></span></code></pre></div></li>
<li>
<p>Open the Kubeflow Dashboard</p>
<p>The default installation does not create an external endpoint but you can use port-forwarding to visit your cluster.
Run the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl port-forward svc/istio-ingressgateway -n istio-system 8080:80
</span></span></code></pre></div><p>Next, open <code>http://localhost:8080</code> in your browser.</p>
<p>To open the dashboard to a public IP address, you should first implement a solution to prevent unauthorized access.
You can read more about Azure authentication options from <a href="/docs/azure/authentication">Access Control for Azure Deployment</a>.</p>
</li>
</ol>
<h2 id="additional-information">Additional information</h2>
<p>You can find general information about Kubeflow configuration in the guide to <a href="/docs/methods/kfctl/kustomize/">configuring Kubeflow with kfctl and kustomize</a>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-d80a4f1149392569f5fa32bfeab74ec8">1.2 - Initial cluster setup for existing cluster</h1>
    <div class="lead">Set up a cluster if you already have one</div>
	<h2 id="initial-setup-for-existing-cluster">Initial Setup for Existing Cluster</h2>
<p>Get the Kubeconfig file:</p>
<pre><code>az aks get-credentials -n &lt;NAME&gt; -g &lt;RESOURCE_GROUP_NAME&gt;
</code></pre>
<p>From here on, please see <a href="/docs/azure/deploy/install-kubeflow">Install Kubeflow</a>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-cca4667a521d523791f9eca2edebf780">1.3 - Uninstall Kubeflow</h1>
    <div class="lead">Instructions for uninstalling Kubeflow</div>
	<p>Uninstall Kubeflow on your Azure AKS cluster.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># Go to your Kubeflow deployment directory
</span></span><span class="line"><span class="cl">cd ${KF_DIR}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Remove Kubeflow
</span></span><span class="line"><span class="cl">kfctl delete -f ${CONFIG_FILE}
</span></span></code></pre></div>
</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ceb950e97fd05a822eae67c3c1550705">2 - Authentication using OIDC in Azure</h1>
    <div class="lead">Authentication and authorization support through OIDC for Kubeflow in Azure</div>
	<p>This section shows the how to set up Kubeflow with authentication and authorization support through OIDC in Azure using <a href="https://azure.microsoft.com/en-us/services/active-directory/">Azure Active Directory</a>.</p>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>
<p>Install the <a href="/docs/azure/deploy/install-kubeflow">prerequisites for Kubeflow in Azure</a></p>
</li>
<li>
<p><a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-register-app#register-an-application">Register an application with the Microsoft Identity Platform</a></p>
</li>
<li>
<p><a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-register-app#add-a-client-secret">Add a client secret</a></p>
<p><strong>Note:</strong>  Save your client ID, client secret, and tenant ID in a secure place to be used in the next steps to configure OIDC Auth Service.
<strong>Note:</strong> The following installation steps automatically install a specific Istio version that must be used.</p>
</li>
</ul>
<h2 id="kubeflow-configuration">Kubeflow configuration</h2>
<ol>
<li>
<p>Download the kfctl v1.2.0 release from the
<a href="https://github.com/kubeflow/kfctl/releases/tag/v1.2.0">Kubeflow releases
page</a>.</p>
</li>
<li>
<p>Unpack the tar ball:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">tar -xvf kfctl_v1.2.0_&lt;platform&gt;.tar.gz
</span></span></code></pre></div></li>
<li>
<p>Run the below commands to build configuration files before deploying Kubeflow. The code below includes an optional command to add the binary kfctl to your path - if you don’t add it, you must use the full path to the kfctl binary each time you run it.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># The following command is optional, to make kfctl binary easier to use.
</span></span><span class="line"><span class="cl">export PATH=$PATH:&lt;path to where kfctl was unpacked&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Set KF_NAME to the name of your Kubeflow deployment. This also becomes the
</span></span><span class="line"><span class="cl"># name of the directory containing your configuration.
</span></span><span class="line"><span class="cl"># For example, your deployment name can be &#39;my-kubeflow&#39; or &#39;kf-test&#39;.
</span></span><span class="line"><span class="cl">export KF_NAME=&lt;your choice of name for the Kubeflow deployment&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Set the path to the base directory where you want to store one or more
</span></span><span class="line"><span class="cl"># Kubeflow deployments. For example, &#39;/opt/&#39;.
</span></span><span class="line"><span class="cl"># Then set the Kubeflow application directory for this deployment.
</span></span><span class="line"><span class="cl">export BASE_DIR=&lt;path to a base directory&gt;
</span></span><span class="line"><span class="cl">export KF_DIR=${BASE_DIR}/${KF_NAME}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Set the configuration file to use, such as the file specified below:
</span></span><span class="line"><span class="cl">export CONFIG_URI=&#34;https://raw.githubusercontent.com/kubeflow/manifests/v1.2-branch/kfdef/kfctl_azure_aad.v1.2.0.yaml
</span></span></code></pre></div></li>
</ol>
<p>&quot;</p>
<pre><code># Generate and deploy Kubeflow:
mkdir -p ${KF_DIR}
cd ${KF_DIR}
kfctl build -V -f ${CONFIG_URI}
```

* **${KF_NAME}** - The name of your Kubeflow deployment.
  If you want a custom deployment name, specify that name here.
  For example,  `my-kubeflow` or `kf-test`.
  The value of `KF_NAME` must consist of lower case alphanumeric characters or
  '-', and must start and end with an alphanumeric character.
  The value of this variable cannot be greater than 25 characters. It must
  contain just a name, not a directory path.
  This value also becomes the name of the directory where your Kubeflow
  configurations are stored, that is, the Kubeflow application directory.

* **${KF_DIR}** - The full path to your Kubeflow application directory.
</code></pre>
<ol>
<li>
<p>Configure OIDC Auth service settings:</p>
<p>In <code>.cache/manifests/manifests-{kubeflow version}-branch/stacks/azure/application/oidc-authservice/kustomization.yaml</code> update the settings with values corresponding your app registration as follows:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">- client_id=&lt;client_id&gt;
</span></span><span class="line"><span class="cl">- oidc_provider=https://login.microsoftonline.com/&lt;tenant_id&gt;/v2.0
</span></span><span class="line"><span class="cl">- oidc_redirect_uri=https://&lt;load_balancer_ip&gt; or dns_name&gt;/login/oidc
</span></span><span class="line"><span class="cl">- oidc_auth_url=https://login.microsoftonline.com/&lt;tenant_id&gt;/oauth2/v2.0/authorize
</span></span><span class="line"><span class="cl">- application_secret=&lt;client_secret&gt;
</span></span><span class="line"><span class="cl">- skip_auth_uri=
</span></span><span class="line"><span class="cl">- namespace=istio-system
</span></span><span class="line"><span class="cl">- userid-header=kubeflow-userid
</span></span><span class="line"><span class="cl">- userid-prefix=
</span></span></code></pre></div></li>
<li>
<p>Configure OIDC scopes:</p>
<p>In <code>.cache/manifests/manifests-{kkubeflow version}-branch/istio/oidc-authservice/base/statefulset.yaml</code> update <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-permissions-and-consent#openid-connect-scopes">OIDC scopes</a> to remove groups and keep profile and email.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">- name: OIDC_SCOPES
</span></span><span class="line"><span class="cl"> value: &#34;profile email&#34;
</span></span></code></pre></div></li>
<li>
<p>Deploy Kubeflow:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kfctl apply -V -f <span class="si">${</span><span class="nv">CONFIG_URI</span><span class="si">}</span>
</span></span></code></pre></div></li>
<li>
<p>Check that the resources were deployed correctly in namespace <code>kubeflow</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl get all -n kubeflow
</span></span></code></pre></div></li>
</ol>
<h2 id="expose-kubeflow-securely-over-https">Expose Kubeflow securely over HTTPS</h2>
<ol>
<li>
<p>Update Istio Gateway to expose port 443 with HTTPS and make port 80 redirect to 443:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl edit -n kubeflow gateways.networking.istio.io kubeflow-gateway
</span></span></code></pre></div><p>The Gateway spec should look like the following:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">networking.istio.io/v1alpha3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">kubeflow-gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">kubeflow</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">istio</span><span class="p">:</span><span class="w"> </span><span class="l">ingressgateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">servers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">hosts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="s1">&#39;*&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">HTTP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># Upgrade HTTP to HTTPS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">tls</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">httpsRedirect</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">hosts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="s1">&#39;*&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">https</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="m">443</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">HTTPS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">tls</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l">SIMPLE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">privateKey</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/istio/ingressgateway-certs/tls.key</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">serverCertificate</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/istio/ingressgateway-certs/tls.crt</span></span></span></code></pre></div>
</li>
<li>
<p>Expose Kubeflow with a load balancer service:</p>
<p>To expose Kubeflow with a load balancer service, change the type of the <code>istio-ingressgateway</code> service to <code>LoadBalancer</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl patch service -n istio-system istio-ingressgateway -p <span class="s1">&#39;{&#34;spec&#34;: {&#34;type&#34;: &#34;LoadBalancer&#34;}}&#39;</span>
</span></span></code></pre></div><p>After that, obtain the <code>LoadBalancer</code> IP address or Hostname from its status and create the necessary certificate.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl get svc -n istio-system istio-ingressgateway -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.status.loadBalancer.ingress[0]}&#39;</span>
</span></span></code></pre></div><p><strong>Note</strong>: If you are exposing <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/">Ingress</a> gateway through public IP, make sure it matches the IP address of the OIDC <code>REDIRECT_URL</code> by running:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl get statefulset authservice -n istio-system -o yaml
</span></span></code></pre></div><p>If it doesn&rsquo;t match, update <code>REDIRECT_URL</code> in the StatefulSet to be the public IP address from the last step, by running:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl edit statefulset authservice -n istio-system
</span></span><span class="line"><span class="cl">kubectl rollout restart statefulset authservice -n istio-system
</span></span></code></pre></div></li>
<li>
<p>Create a self-signed Certificate with cert-manager:</p>
<p>Create a new file <code>certficate.yaml</code> with the YAML below to create a self-signed Certificate with cert-manager. For production environments, you should use appropriate trusted CA Certificate.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">cert-manager.io/v1alpha2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Certificate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">istio-ingressgateway-certs</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">istio-system</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">commonName</span><span class="p">:</span><span class="w"> </span><span class="l">istio-ingressgateway.istio-system.svc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Use ipAddresses if your LoadBalancer issues an IP address</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">ipAddresses</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="l">&lt;LoadBalancer IP&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Use dnsNames if your LoadBalancer issues a hostname</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">dnsNames</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="l">&lt;LoadBalancer HostName&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">isCA</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">issuerRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterIssuer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">kubeflow-self-signing-issuer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l">istio-ingressgateway-certs</span></span></span></code></pre></div>
<p>Apply <code>certificate.yaml</code> in <code>istio-system</code> namespace</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl apply -f certificate.yaml -n istio-system
</span></span></code></pre></div><p>After applying the above Certificate, cert-manager will generate the TLS certificate inside the istio-ingressgateway-certs secrets. The istio-ingressgateway-certs secret is mounted on the istio-ingressgateway deployment and used to serve HTTPS.</p>
</li>
<li>
<p><a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-register-app#add-a-redirect-uri">Configure Redirect URI for your registered App</a></p>
<p>Add the redirect URI below to the app registered with Microsoft Identity:</p>
<p><code>https://&lt;YOUR_LOADBALANCER_IP_ADDRESS_OR_DNS_NAME&gt;/login/oidc</code></p>
<p><strong>Note:</strong> Make sure the app&rsquo;s redirect URI matches the <code>oidc_redirect_uri</code> value in OIDC auth service settings.</p>
<p>Navigate to <code>https://&lt;YOUR_LOADBALANCER_IP_ADDRESS_OR_DNS_NAME&gt;/</code> and start using Kubeflow.</p>
</li>
</ol>
<h2 id="authenticate-kubeflow-pipelines-using-kubeflow-pipelines-sdkhttpswwwkubefloworgdocscomponentspipelinessdksdk-overview">Authenticate Kubeflow pipelines using <a href="https://www.kubeflow.org/docs/components/pipelines/sdk/sdk-overview/">Kubeflow Pipelines SDK</a></h2>
<p>Perform interactive login from browser by visitng <code>https://&lt;YOUR_LOADBALANCER_IP_ADDRESS_OR_DNS_NAME&gt;/</code> and copy the value of cookie <code>authservice_session</code> to authenticate using SDK with below code:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">import kfp
</span></span><span class="line"><span class="cl"><span class="nv">authservice_session_cookie</span><span class="o">=</span><span class="s1">&#39;authservice_session=&lt;cookie&gt;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nv">client</span> <span class="o">=</span> kfp.Client<span class="o">(</span><span class="nv">host</span><span class="o">=</span><span class="s1">&#39;https://&lt;YOUR_LOADBALANCER_IP_ADDRESS_OR_DNS_NAME&gt;/pipeline&#39;</span>,
</span></span><span class="line"><span class="cl">                    <span class="nv">cookies</span><span class="o">=</span>authservice_session_cookie<span class="o">)</span>
</span></span><span class="line"><span class="cl">client.list_experiments<span class="o">(</span><span class="nv">namespace</span><span class="o">=</span><span class="s1">&#39;&lt;your_namespace&gt;&#39;</span><span class="o">)</span>
</span></span></code></pre></div><p><strong>Limitation:</strong> The current OIDC auth service in Kubeflow system supports only <a href="https://openid.net/specs/openid-connect-basic-1_0.html#CodeFlow">Authorization Code Flow</a>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a7982f9de61c52e0a0d173d95c15010d">3 - Azure Machine Learning Components</h1>
    <div class="lead">Overview of Azure Machine Learning pipeline components for workflow improvements</div>
	<p>Azure Machine Learning (Azure ML) components are pipeline components that integrate with <a href="https://docs.microsoft.com/en-us/azure/machine-learning/">Azure ML</a> to manage the lifecycle of your machine learning (ML) models to improve the quality and consistency of your machine learning solution. A pipeline component is a self-contained set of code that performs one step in the ML workflow. A component is analogous to a function, in that it has a name, parameters, return value and a body.</p>
<p>You can use Azure Machine Learning components to increase the efficiency of your workflow with Azure Machine Learning, such as continuous integration, delivery, and deployment.</p>
<p>The components provide capabilities for:</p>
<ul>
<li>Faster experimentation and development of models</li>
<li>Faster deployment of models into production</li>
<li>Quality assurance</li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>You should have Kubeflow installed on your AKS cluster. If you don&rsquo;t, follow the <a href="https://www.kubeflow.org/docs/azure/deploy/install-kubeflow/">Kubeflow installation (for Azure) guide</a>.</li>
<li>To interact with Azure resources, you may need to configure them before using a particular pipeline component. Check the README for each component to learn about what Azure resources are required.</li>
<li>The <code>kfp.azure</code> extension can be used to create a secret to interact with Azure resources. To create Azure credentials, run:</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># Initialize variables:</span>
</span></span><span class="line"><span class="cl"><span class="nv">AZ_SUBSCRIPTION_ID</span><span class="o">={</span>Your_Azure_subscription_ID<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">AZ_TENANT_ID</span><span class="o">={</span>Your_Tenant_ID<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">AZ_CLIENT_ID</span><span class="o">={</span>Your_client_ID<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">AZ_CLIENT_SECRET</span><span class="o">={</span>Your_client_secret<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">KUBEFLOW_NAMESPACE</span><span class="o">=</span>kubeflow
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubectl create secret generic azcreds --from-literal<span class="o">=</span><span class="nv">AZ_SUBSCRIPTION_ID</span><span class="o">=</span><span class="nv">$AZ_SUBSCRIPTION_ID</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>                                      --from-literal<span class="o">=</span><span class="nv">AZ_TENANT_ID</span><span class="o">=</span><span class="nv">$AZ_TENANT_ID</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>                                      --from-literal<span class="o">=</span><span class="nv">AZ_CLIENT_ID</span><span class="o">=</span><span class="nv">$AZ_CLIENT_ID</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>                                      --from-literal<span class="o">=</span><span class="nv">AZ_CLIENT_SECRET</span><span class="o">=</span><span class="nv">$AZ_CLIENT_SECRET</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>                                      -n <span class="nv">$KUBEFLOW_NAMESPACE</span>
</span></span></code></pre></div><h2 id="azure-ml-register-model-component">Azure ML Register Model component</h2>
<p>Model registration allows you to store and version your models in Azure Machine Learning in your workspace. The model registry makes it easy to organize and keep track of your trained models. After you register the model, you can then download or deploy it and receive all the registered files.</p>
<p>To learn more about the Azure ML Register Model pipeline component, refer to the <a href="https://github.com/kubeflow/pipelines/tree/sdk/release-1.8/components/azure/azureml/aml-register-model">official repository</a>.</p>
<p>To learn more about using Azure ML to manage the lifecycle of your models, go to <a href="https://docs.microsoft.com/en-us/azure/machine-learning/concept-model-management-and-deployment">Model management, deployment, and monitoring</a>.</p>
<h2 id="azure-ml-deploy-model-component">Azure ML Deploy Model component</h2>
<p>Trained machine learning models are deployed as web services in the cloud and you can use your model by accessing its endpoint. When using the model as a web service, the following items are included in the Azure ML Deploy Model component:</p>
<ul>
<li>An entry script</li>
<li>Azure ML environment configurations</li>
</ul>
<p>For more information about the Azure ML Deploy Model pipeline component, check the <a href="https://github.com/kubeflow/pipelines/tree/sdk/release-1.8/components/azure/azureml/aml-deploy-model">official repository</a>.</p>
<p>To learn more about using Azure ML to manage the lifecycle of your models, go to <a href="https://docs.microsoft.com/en-us/azure/machine-learning/concept-model-management-and-deployment">Model management, deployment, and monitoring</a>.</p>
<h2 id="other-azure-ml-capabilities">Other Azure ML capabilities</h2>
<p>You can learn more about the capabilities of Azure ML and how to improve your ML workflow by checking the <a href="https://docs.microsoft.com/en-us/azure/machine-learning/">Azure ML documentation</a></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-76b20e0deb3b1a126cffda28d5d7870f">4 - End-to-End Pipeline Example on Azure</h1>
    <div class="lead">An end-to-end guide to creating a pipeline in Azure that can train, register, and deploy an ML model that can recognize the difference between tacos and burritos</div>
	<h2 id="introductions">Introductions</h2>
<h3 id="overview-of-azure-and-aks">Overview of Azure and AKS</h3>
<p>Microsoft Azure is an open, flexible, enterprise-grade cloud computing platform running on Microsoft infrastructure. The platform has various services, many of which are extremely useful in a pipeline that works with ML models.</p>
<p>The <a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Azure CLI</a> is a set of tools that you can use to interact with Azure from the command line.</p>
<p>Azure Kubernetes Service (AKS) on Azure allows you to deploy containerized applications, within which you describe the resources your application needs, and AKS will manage the underlying resources automatically. This workflow is especially efficient at scale.</p>
<h3 id="the-overall-workflow">The overall workflow</h3>
<p>This guide takes you through using your Kubeflow deployment to build a machine learning (ML) pipeline on Azure. This guide uses a sample pipeline to detail the process of creating an ML workflow from scratch. You will learn how to create and run a pipeline that processes data, trains a model, and then registers and deploys that model as a webservice.</p>
<p>To build your pipeline, you must create and build containers using Docker images. Containers are used to abstract the dependencies for each step of the pipeline. You can manage your containers using <a href="https://ms.portal.azure.com/#home">Azure&rsquo;s portal</a>, specifically using the Container Registry to store the containers in the cloud. Kubeflow pulls the containers from this registry as they are needed in each step of the pipeline.</p>
<p>By following this guide, you will learn how to:</p>
<ul>
<li>Set up Kubeflow in an AKS Cluster</li>
<li>Create and compile a pipeline that can:
<ul>
<li>Preprocess data</li>
<li>Train a model</li>
<li>Register the model to ACR (<a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/languages/acr-template?view=azure-devops">Azure Container Registry</a>)</li>
<li>Profile the model to optimize compute resources in AML (Azure Machine Learning)</li>
<li>Deploy the model to AML</li>
</ul>
</li>
<li>Interact with and customize your deployment</li>
<li>Test and use your deployed model</li>
</ul>
<p>When your pipeline has finished running, you will be able to see a registered image, model, and deployment in your Azure ML workspace. You will then be able to visit the scoring URI and upload images for scoring in real time.</p>
<h2 id="set-up-your-environment">Set up your environment</h2>
<h3 id="download-the-project-files">Download the project files</h3>
<p>This tutorial uses the Azure Pipelines example in the Kubeflow examples repo. You can optionally use a pipeline of your own, but several key steps may differ.</p>
<p>Clone the project files and go to the directory containing the <a href="https://github.com/kubeflow/examples/tree/master/pipelines">Azure Pipelines (Tacos and Burritos)</a> example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">git clone https://github.com/kubeflow/examples.git
</span></span><span class="line"><span class="cl">cd examples/pipelines/azurepipeline
</span></span></code></pre></div><p>As an alternative to cloning, you can download the <a href="https://github.com/kubeflow/examples/archive/master.zip">Kubeflow examples repository zip file</a>.</p>
<h2 id="deploy-kubeflow">Deploy Kubeflow</h2>
<p>If you don&rsquo;t already have one, create an Azure account. If you have not used Azure services before, you can receive up to <a href="https://azure.microsoft.com/en-ca/free/">1 year of free services and free credits.</a></p>
<blockquote>
<p>Note: that some of the services used in this guide may not be included in the free services, but can be covered by free credits.</p>
</blockquote>
<p>First, install the <a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Azure CLI</a>, then follow the instructions in the <a href="https://www.kubeflow.org/docs/azure/deploy/install-kubeflow/">guide to deploying Kubeflow on Azure</a>.</p>
<blockquote>
<p>Ensure that the agent size you use has the proper memory and storage requirements. For the Azure Pipelines example, most machine sizes will work, but <strong>premium storage</strong> is required. Use <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/windows/sizes">this guide</a> to choose the right agent size for your deployment. (We chose an agent size of Standard_D4s_v3.)</p>
</blockquote>
<h2 id="configuring-azure-resources">Configuring Azure resources</h2>
<h3 id="create-an-ml-workspace-in-azure">Create an ML workspace in Azure</h3>
<p>Throughout your pipeline&rsquo;s run, all of your models, images, and deployments will be pushed to your ML workspace in Azure. Your ML workspace also has support for managing your active deployments, which will be displayed later in this tutorial.</p>
<p>To create an ML workspace:</p>
<ol>
<li>Go to <a href="https://portal.azure.com">the Azure portal</a> and click on your resource group.</li>
<li>Select the <strong>add a new resource</strong> option.</li>
<li>Search for <strong>Machine Learning Studio Workspace</strong> and use the default options, taking note of the name you decide for it.</li>
</ol>
<p><img src="/docs/azure/images/creatingWS.PNG"
alt="Creating a Workspace"
class="mt-3 mb-3 p-3 border border-info rounded"></p>
<h3 id="create-an-azure-container-registry">Create an Azure container registry</h3>
<p>Kubeflow uses Docker images to describe each pipeline step&rsquo;s dependencies. You need to create a container registry to store those images in the cloud so that Kubeflow can pull the images as they are needed.</p>
<p>To create a container registry:</p>
<ol>
<li>Go to <a href="https://portal.azure.com">the Azure portal</a> and click on your resource group.</li>
<li>From there, select the <strong>add a new resource</strong> option.</li>
<li>Search for <strong>Container Registry</strong> and add it to your resource group.</li>
<li>Configure your registry by selecting and noting the name you use for it. Enable an <strong>admin user</strong>, and change the SKU option to <strong>Premium</strong>.</li>
</ol>
<p><img src="/docs/azure/images/createContainerReg.PNG"
alt="Creating a Container Registry"
class="mt-3 mb-3 p-3 border border-info rounded"></p>
<h3 id="allow-your-aks-cluster-access-to-your-azure-container-registry">Allow your AKS Cluster access to your Azure Container Registry</h3>
<p>In order for the AKS cluster to have access to pulling images created for execution of the pipeline, you will need to update your cluster so that it is able to pull the images from the container registry we just created. More references can be found <a href="https://docs.microsoft.com/en-us/azure/aks/cluster-container-registry-integration">here</a>, on the Microsoft web site.</p>
<p>Using a bash shell, use the following commands to attach the container registry created above to your AKS cluster, using the proper AKS cluster name and resource group:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">az aks update -n &lt;myAKSCluster&gt; -g &lt;MyResourceGroup&gt; --attach-acr &lt;REGISTRY_NAME&gt;
</span></span></code></pre></div><p>The execution of the command will take a few minutes.</p>
<h3 id="create-a-persistent-volume-claim-pvc">Create a persistent volume claim (PVC)</h3>
<p>A persistent volume claim is a dynamically provisioned storage resource attached to a Kubernetes cluster. It is used in the pipeline to store data and files across pipeline steps.</p>
<p>Using a bash shell, navigate to the <code>azurepipeline</code> directory. Use the following commands to create a persistent volume claim for your cluster.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cd kubernetes
</span></span><span class="line"><span class="cl">kubectl apply -f pvc.yaml
</span></span></code></pre></div><h2 id="authenticate-your-service-principal">Authenticate your service principal</h2>
<p>A service principal is used to allow your pipeline to securely interface with your Azure services without having to directly login in the pipeline and use admin privileges. To create a service principal with Contributor access to your Azure account, use the following steps.</p>
<h3 id="create-an-app-registration">Create an App Registration</h3>
<p>To create an app registration:</p>
<ol>
<li>
<p>In the Azure Portal, navigate to <a href="https://ms.portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview"><strong>Azure Active Directory</strong></a>.</p>
</li>
<li>
<p>Select <strong>App registrations</strong> and click <strong>New registration</strong>. Name it, noting the name and use the default options.</p>
</li>
<li>
<p>Click <strong>Register</strong>. <img src="/docs/azure/images/appReg.PNG"
alt="Creating a App Registration"
class="mt-3 mb-3 p-3 border border-info rounded"></p>
</li>
<li>
<p>You should be redirected to your app registration’s dashboard. Select <strong>Overview</strong> from the sidebar.</p>
</li>
<li>
<p>Make note of the <strong>Application (client) ID</strong> and the <strong>Directory (tenant) ID</strong>. The client ID is your service principal username. Save these in a secure location. <img src="/docs/azure/images/clientID2.PNG"
alt="Client ID location"
class="mt-3 mb-3 p-3 border border-info rounded"></p>
</li>
<li>
<p>Select <strong>Certificates and Secrets</strong> from the sidebar.</p>
</li>
<li>
<p>Select <strong>New client secret</strong>. Give the client secret a description and select how long you would like it to remain active for. Once you click the <strong>Add</strong> button, make sure you take note of the client secret value and save it in a secure place. This is your service principal password. <img src="/docs/azure/images/password.PNG"
alt="Client secret location"
class="mt-3 mb-3 p-3 border border-info rounded"></p>
</li>
</ol>
<h3 id="add-a-role-assignment">Add a role assignment</h3>
<p>To add a role assignment for your service principal:</p>
<ol>
<li>Go to your resource group page on the Azure Portal.</li>
<li>Select <strong>Access control (IAM)</strong> from the sidebar. Select <strong>Add a role assignment</strong>.</li>
<li>Set the role to <strong>Contributor</strong> and search for the name you gave your app registration in the <strong>Select</strong> dropdown.</li>
<li>Click <strong>Save</strong>.</li>
</ol>
<p><img src="/docs/azure/images/roleAssign.PNG"
alt="Creating a Role Assignment"
class="mt-3 mb-3 p-3 border border-info rounded"></p>
<h2 id="creating-containers-from-docker-images">Creating containers from Docker images</h2>
<h3 id="install-docker">Install Docker</h3>
<p>You need to install Docker to be able to push and pull images to/from your Container registry.</p>
<p>For Windows and WSL: <a href="https://nickjanetakis.com/blog/setting-up-docker-for-windows-and-wsl-to-work-flawlessly">Guide</a></p>
<p>For other OS: <a href="https://hub.docker.com/?overlay=onboarding">Docker Desktop</a></p>
<h3 id="build-images">Build images</h3>
<p>To deploy your code to Kubernetes, you must build your local project’s Docker images and push the containers to your Container Registry so that they are available in the cloud.</p>
<ol>
<li>Set the path in Container Registry that you want to push the containers to:</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">export REGISTRY_PATH=&lt;REGISTRY_NAME&gt;.azurecr.io
</span></span></code></pre></div><ol start="2">
<li>Run the following command to authenticate your Container Registry:</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">az acr login --name &lt;REGISTRY_NAME&gt;
</span></span></code></pre></div><ol start="3">
<li>Create a version, to be associated with your model each time it runs (change this accordingly):</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">export VERSION_TAG=1
</span></span></code></pre></div><p>Each docker image will be built and uploaded to the cloud using the Container Registry.</p>
<blockquote>
<p>Note: If you would like to test a container locally, you can use the <code>docker run -it ${REGISTRY_PATH}&lt;CONTAINER NAME&gt;:$(VERSION_TAG}</code> before pushing to Container Registry.</p>
</blockquote>
<pre><code>//Starting in the 'code' directory of the azurepipeline folder

cd preprocess
docker build . -t ${REGISTRY_PATH}/preprocess:${VERSION_TAG}
docker push ${REGISTRY_PATH}/preprocess:${VERSION_TAG}

cd ../training
docker build . -t ${REGISTRY_PATH}/training:${VERSION_TAG}
docker push ${REGISTRY_PATH}/training:${VERSION_TAG}

cd ../register
docker build . -t ${REGISTRY_PATH}/register:${VERSION_TAG}
docker push ${REGISTRY_PATH}/register:${VERSION_TAG}

cd ../deploy
docker build . -t ${REGISTRY_PATH}/deploy:${VERSION_TAG}
docker push ${REGISTRY_PATH}/deploy:${VERSION_TAG}
</code></pre>
<p>When all of the images are pushed successfully, modify the <code>pipeline.py</code> file to use the appropriate image for each pipeline step.</p>
<h2 id="running-and-deploying-your-pipeline">Running and deploying your pipeline</h2>
<h3 id="compile">Compile</h3>
<p>To compile the pipeline, simply open a terminal and navigate to the azurepipeline/code folder. Run the following command to generate a pipeline in the tar.gz format:
<code>python pipeline.py</code></p>
<h3 id="run-and-deploy">Run and deploy</h3>
<p>Upload the pipeline.tar.gz file to the pipelines dashboard on your Kubeflow deployment.</p>
<p><img src="/docs/azure/images/pipelinedash.PNG"
alt="Pipeline Dashboard"
class="mt-3 mb-3 p-3 border border-info rounded"></p>
<p>Create an experiment and then create a run using the pipeline you just uploaded.</p>
<p><img src="/docs/azure/images/pipelinesInput.png"
alt="Pipelines input example"
class="mt-3 mb-3 p-3 border border-info rounded"></p>
<p>The finished pipeline should have four completed steps.</p>
<p><img src="/docs/azure/images/finishedRunning.PNG"
alt="Finished Pipeline"
class="mt-3 mb-3 p-3 border border-info rounded"></p>
<h3 id="pushing-images-for-scoring">Pushing images for scoring</h3>
<p>Once your pipeline has finished successfully, you can visit the Azure portal to find your deployment url. Go to your ML workspace dashboard and select “Deployments” from the sidebar. Click on the most recent deployment. You should see a link under “Scoring URI”. You can whatever method you know best to send a GET/POST request with an image of a taco or a burrito to this url and it should return whether or not the image is of a taco or a burrito.</p>
<p>The easiest method is to find a url of an image of a taco or a burrito and append it to your scoring url as follows: <code>&lt;scoring_url&gt;?image=&lt;image_url&gt;</code></p>
<p><img src="/docs/azure/images/finalOutput.PNG"
alt="Final ML model deployment"
class="mt-3 mb-3 p-3 border border-info rounded"></p>
<h2 id="clean-up-your-azure-environment">Clean up your Azure environment</h2>
<p>When you are done, make sure you delete your resource group to avoid extra charges.</p>
<pre><code>az group delete -n MyResourceGroup
</code></pre>
<p>You can optionally choose to delete individual resources on your clusters using the <a href="https://docs.microsoft.com/en-us/azure/service-fabric/service-fabric-tutorial-delete-cluster">Azure cluster docs</a>.</p>
<h2 id="next-steps">Next steps</h2>
<p>Build your own pipeline using the <a href="/docs/components/pipelines/sdk/sdk-overview/">Kubeflow Pipelines SDK</a>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-8db8e540d9b02097d039dac1656bed32">5 - Access Control for Azure Deployment</h1>
    <div class="lead">Restrict access of your deployment to specified IP addresses</div>
	<p>This section shows how to restrict access to only certain IP addresses for your LoadBalancer Service on Azure. At a later date, it will also include formal authentication through Azure. This method is not the most ideal way to secure your Kubernetes cluster, as it requires that you access the service from the same IP address every time. This process was adapted from <a href="https://kubernetes.io/docs/tasks/access-application-cluster/configure-cloud-provider-firewall/#restrict-access-for-loadbalancer-service">the Kubernetes guide to configuring a firewall</a>.</p>
<p>When using a service with <code>spec.type: LoadBalancer</code>, you can specify the IP ranges that are allowed to access the load balancer by using <code>spec.loadBalancerSourceRanges</code>. This is currently supported on all major cloud providers.</p>
<h2 id="editing-the-loadbalancer-service">Editing the LoadBalancer Service</h2>
<p>Use the <code>kubectl edit svc &lt;loadbalancer-name&gt; -n kubeflow</code> to add your source ranges. This command will open the editor defined by you KUBE_EDITOR or EDITOR environment variables or fall back to &lsquo;vi&rsquo; for Linux or &rsquo;notepad&rsquo; for Windows. More information about using alternative editors and options for this command can be found in <a href="https://www.mankier.com/1/kubectl-edit">the kubectl edit documentation</a>.</p>
<h2 id="internal-subnet-access">Internal Subnet Access</h2>
<p>Assuming 10.0.0.0/8 is the address for the internal subnet, a load balancer will be created such that the deployment is only accessible from internal Kubernetes cluster IPs. This will not allow clients from outside your Kubernetes cluster to access the load balancer.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">apiVersion: v1
</span></span><span class="line"><span class="cl">kind: Service
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  name: myapp
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  ports:
</span></span><span class="line"><span class="cl">  - port: 8765
</span></span><span class="line"><span class="cl">    targetPort: 9376
</span></span><span class="line"><span class="cl">  selector:
</span></span><span class="line"><span class="cl">    app: example
</span></span><span class="line"><span class="cl">  type: LoadBalancer
</span></span><span class="line"><span class="cl">  loadBalancerSourceRanges:
</span></span><span class="line"><span class="cl">  - 10.0.0.0/8
</span></span></code></pre></div><h2 id="external-ip-addresses">External IP Addresses</h2>
<p>In the following example, a load balancer will be created that is only accessible to clients with IP addresses from 130.211.204.1 and 130.211.204.2.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">apiVersion: v1
</span></span><span class="line"><span class="cl">kind: Service
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  name: myapp
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  ports:
</span></span><span class="line"><span class="cl">  - port: 8765
</span></span><span class="line"><span class="cl">    targetPort: 9376
</span></span><span class="line"><span class="cl">  selector:
</span></span><span class="line"><span class="cl">    app: example
</span></span><span class="line"><span class="cl">  type: LoadBalancer
</span></span><span class="line"><span class="cl">  loadBalancerSourceRanges:
</span></span><span class="line"><span class="cl">  - 130.211.204.1/32
</span></span><span class="line"><span class="cl">  - 130.211.204.2/32
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ef86fdffe53ad5bdd20b56381dd21142">6 - Configure Azure MySQL database to store metadata</h1>
    <div class="lead">How to configure an external Azure Database for MySQL with kustomize to store metadata</div>
	<p>This section shows how to use Kubeflow kustomize to configure an external Azure
MySQL database to store metadata.</p>
<p>Microsoft <a href="https://docs.microsoft.com/en-us/azure/mysql">Azure Database for
MySQL</a> is a relational database
service based on <a href="https://www.mysql.com/products/community/">MySQL</a>. It provides
built-in high availability, data protection using automatic backups and
point-in-time-restore for up to 35 days, and automated maintenance for
underlying hardware, operating system and database engine to keep the service
secure and up to date. <a href="https://docs.microsoft.com/en-us/azure/mysql/overview">Learn more about Azure Database for
MySQL</a>.</p>
<p>Table of contents:</p>
<ol>
<li>Create an Azure database for MySQL</li>
<li>Deploy Kubeflow to use the Azure metadata overlay</li>
<li>Update Kubeflow resources</li>
</ol>
<h1 id="create-an-azure-database-for-mysql">Create an Azure database for MySQL</h1>
<p>First, you need to create an Azure database for MySQL on Azure through either Azure
Portal or using Azure CLI:</p>
<ul>
<li>
<p><strong>Azure Portal</strong>: follow the
<a href="https://docs.microsoft.com/en-us/azure/mysql/quickstart-create-mysql-server-database-using-azure-portal">quickstart</a>
in the Azure documentation.</p>
</li>
<li>
<p><strong>Azure CLI</strong>: follow the
<a href="https://docs.microsoft.com/en-us/azure/mysql/quickstart-create-mysql-server-database-using-azure-cli">quickstart</a>.</p>
</li>
</ul>
<p>Remember your <code>Server Name</code>, <code>Admin username</code>, and <code>Password</code> - you&rsquo;ll be using
them later in this guide.</p>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    By default, the created server is protected with a firewall and is not
accessible publicly. You can refer to the section on <a href="https://docs.microsoft.com/en-us/azure/mysql/quickstart-create-mysql-server-database-using-azure-portal#configure-a-server-level-firewall-rule">configuring a server-level
firewall
rule</a>
in the official documentation to allow your database to be accessible from
external IP addresses. Depending on your configuration, you may also be able to
enable all IP addresses and disable <code>Enforce SSL connection</code>.

</div>

<h1 id="deploy-kubeflow-to-use-the-azure-metadata-overlay">Deploy Kubeflow to use the Azure metadata overlay</h1>
<p>You have created the MySQL server database. Next, you need to deploy Kubeflow
to use the Azure metadata overlay.</p>
<ol>
<li>
<p>Follow the <a href="https://www.kubeflow.org/docs/azure/deploy/install-kubeflow/">Install
Kubeflow</a> on
AKS (Azure Kubernetes Service) guide until the step where you have to build
and apply the <code>CONFIG_URI</code>.</p>
</li>
<li>
<p>If you followed the previous step, you should have downloaded the
configuration file. Next, you need to customize the configuration before
deploying Kubeflow. Run the following command:</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">wget -O kfctl_azure.yaml <span class="si">${</span><span class="nv">CONFIG_URI</span><span class="si">}</span>
</span></span></code></pre></div><p>where the <code>${CONFIG_URL}</code> is the URL pointing to Kubeflow manifest for Azure
(for example,
<code>.../kubeflow/manifests/v1.1-branch/kfdef/kfctl_azure.v1.1.0.yaml</code>) that you
specified in step 1.</p>
<ol start="3">
<li>Before deploying Kubeflow, use <code>kfctl build</code> to create configuration files:</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kfctl build -V -f kfctl_azure.yaml
</span></span></code></pre></div><ol start="4">
<li>Under <code>/stacks/azure</code> and <code>resources</code> replace <code>- ../../metadata/v3</code> with
<code>metadata</code> to  enable using Azure MySQL.</li>
</ol>
<p>The updated <code>kustomization.yaml</code> in <code>stacks/azure</code> should look similar to this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  # Metadata
</span></span><span class="line"><span class="cl">  # - ../../metadata/v3
</span></span><span class="line"><span class="cl">  # Uncomment the line below if you want to use Azure MySQL
</span></span><span class="line"><span class="cl">  - ./metadata
</span></span></code></pre></div><ol start="5">
<li>Edit <code>params.env</code> to provide parameters to configuration map as follows:</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">MYSQL_HOST={YOUR_DB_SERVER_NAME}.mysql.database.azure.com
</span></span><span class="line"><span class="cl">MYSQL_DATABASE=mlmetadata
</span></span><span class="line"><span class="cl">MYSQL_PORT=3306
</span></span><span class="line"><span class="cl">MYSQL_ALLOW_EMPTY_PASSWORD=true
</span></span></code></pre></div><p>where <code>{YOUR_DB_SERVER_NAME}</code> is your server name.</p>
<ol start="6">
<li>Edit <code>secrets.env</code> to create a secret with the admin username and password
based on your database configuration. Make sure the user name follows the
pattern with an &ldquo;@&rdquo;, like the one showed below:</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">MYSQL_USERNAME={ADMIN_USERNAME}@{YOUR_DB_SERVER_NAME}
</span></span><span class="line"><span class="cl">MYSQL_PASSWORD={ADMIN_PASSWORD}
</span></span></code></pre></div><h1 id="deploy-kubeflow">Deploy Kubeflow</h1>
<p>Having completed the previous steps to set up the MySQL server, you can deploy
Kubeflow:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kfctl apply -V -f kfctl_azure.yaml
</span></span></code></pre></div><p>Your metadata database should now be using the Azure Database for MySQL.</p>
<p>To configure the pipeline database using an external Azure Database for MySQL,
go to <a href="https://github.com/kubeflow/pipelines/tree/sdk/release-1.8/manifests/kustomize/env/azure">KFP customizations for
Azure</a>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f40c9e23375af11c53e0a087013f0bf9">7 - Troubleshooting Deployments on Azure AKS</h1>
    <div class="lead">Help diagnose and fix issues you may encounter in your Kubeflow deployment</div>
	<h3 id="jupyter-notebook-is-not-a-valid-page-when-accessing-notebook">Jupyter Notebook ‘is not a valid page’ when accessing notebook</h3>
<p>Restarting the ambassador pods will often fix this issue:
<code>kubectl delete pods -l service=ambassador</code></p>
<h3 id="the-client-does-not-have-authorization-to-perform-action">The client does not have authorization to perform action&hellip;</h3>
<p>This is likely an issue with ensuring your subscriptions are correctly setup. To fix the issue, list your subscriptions and then change the active subscription.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#list subscription 
</span></span><span class="line"><span class="cl">az account list --output table 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#change the active subscription 
</span></span><span class="line"><span class="cl">az account set --subscription &#34;My Demos&#34;
</span></span></code></pre></div>
</div>



    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark pt-3 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Kubeflow mailing list" aria-label="Kubeflow mailing list">
    <a class="text-white" target="_blank" rel="noopener" href="https://www.kubeflow.org/docs/about/community/#kubeflow-mailing-list" aria-label="Kubeflow mailing list">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-white" target="_blank" rel="noopener" href="https://twitter.com/kubeflow" aria-label="Twitter">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Stack Overflow" aria-label="Stack Overflow">
    <a class="text-white" target="_blank" rel="noopener" href="https://stackoverflow.com/questions/tagged/kubeflow" aria-label="Stack Overflow">
      <i class="fab fa-stack-overflow"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/GoogleCloudPlatform/kubeflow-distribution" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-white" target="_blank" rel="noopener" href="https://www.kubeflow.org/docs/about/community/#kubeflow-slack" aria-label="Slack">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-5 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2022 Google | Documentation Distributed under CC BY 4.0</small>
        <p><small class="ml-1"><a href="https://policies.google.com/privacy" target="_blank" rel="noopener">Privacy Policy</a></small></p>
	
		<p class="mt-2"><a href="/kubeflow-docs/docs/about/">About</a></p>
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="/kubeflow-docs/js/main.min.301c0110334bec1b4445867d27dc7dd69b2df859154ccf252005508bc860cc5a.js" integrity="sha256-MBwBEDNL7BtERYZ9J9x91pst&#43;FkVTM8lIAVQi8hgzFo=" crossorigin="anonymous"></script>
<script src='/kubeflow-docs/js/tabpane-persist.js'></script>

  </body>
</html>

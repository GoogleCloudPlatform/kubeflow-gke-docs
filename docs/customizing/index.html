<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.105.0">
<meta name="robots" content="index, follow">

<script type="application/ld+json">
  {
      "@context" : "http://schema.org",
      "@type" : "WebSite",
      "mainEntityOfPage": {
           "@type": "WebPage",
           "@id": "https:\/\/gkcalat.github.io\/kubeflow-docs"
      },
      "articleSection" : "docs",
      "name" : "Customize Kubeflow on GKE",
      "headline" : "Customize Kubeflow on GKE",
      "description" : "Tailoring a GKE deployment of Kubeflow",
      "inLanguage" : "en-US",
      "author" : "",
      "creator" : "",
      "publisher": "",
      "accountablePerson" : "",
      "copyrightHolder" : "",
      "copyrightYear" : "0001",
      "datePublished": "0001-01-01 00:00:00 \u002b0000 UTC",
      "dateModified" : "0001-01-01 00:00:00 \u002b0000 UTC",
      "url" : "https:\/\/gkcalat.github.io\/kubeflow-docs\/docs\/customizing\/",
      "wordCount" : "1209",
      "keywords" : [ "Kubeflow on GCP" ]
  }
  </script>

<link rel="shortcut icon" href="/kubeflow-docs/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/kubeflow-docs/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/kubeflow-docs/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/kubeflow-docs/favicons/favicon-32x32.png" sizes="32x32">
<link rel="manifest" href="/kubeflow-docs/favicons/manifest.json">
<meta name="msapplication-config" content="/kubeflow-docs/favicons/browserconfig.xml" />
<meta name="msapplication-TileColor" content="#4279f4">
<meta name="theme-color" content="#4279f4">

<title>Customize Kubeflow on GKE | Kubeflow on Google Cloud Platform</title>
<meta name="description" content="Tailoring a GKE deployment of Kubeflow">
<meta property="og:title" content="Customize Kubeflow on GKE" />
<meta property="og:description" content="Tailoring a GKE deployment of Kubeflow" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://gkcalat.github.io/kubeflow-docs/docs/customizing/" /><meta property="article:section" content="docs" />

<meta property="article:modified_time" content="2022-11-10T00:03:02+00:00" /><meta property="og:site_name" content="Kubeflow on Google Cloud Platform" />

<meta itemprop="name" content="Customize Kubeflow on GKE">
<meta itemprop="description" content="Tailoring a GKE deployment of Kubeflow">
<meta itemprop="dateModified" content="2022-11-10T00:03:02+00:00" />
<meta itemprop="wordCount" content="1209">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Customize Kubeflow on GKE"/>
<meta name="twitter:description" content="Tailoring a GKE deployment of Kubeflow"/>




<link rel="preload" href="/kubeflow-docs/scss/main.min.5006b434b14f73c3d5537a7ba4c8ecef723ddc93f3a3c8530e19d24f75486ea9.css" as="style">
<link href="/kubeflow-docs/scss/main.min.5006b434b14f73c3d5537a7ba4c8ecef723ddc93f3a3c8530e19d24f75486ea9.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-GK9XL47N6S"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-GK9XL47N6S', { 'anonymize_ip': false });
}
</script>

  </head>
  <body class="td-page">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand-md navbar-dark  td-navbar">
        <a class="navbar-brand" href="/kubeflow-docs/">
		<span class="navbar-logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 276.93 274.55"><g data-name="Layer 2"><g data-name="Layer 1"><path d="M95.9 62.15l4.1 102.1 73.75-94.12a6.79 6.79.0 019.6-1.11l46 36.92-15-65.61z" fill="#4279f4"/><path fill="#0028aa" d="M102.55 182.98h65.42l-40.17-32.23-25.25 32.23z"/><path fill="#014bd1" d="M180.18 83.92l-44 56.14 46.88 37.61 44.47-55.76-47.35-37.99z"/><path fill="#bedcff" d="M83.56 52.3l.01-.01 38.69-48.52-62.39 30.05-15.41 67.51 39.1-49.03z"/><path fill="#6ca1ff" d="M45.32 122.05l41.44 51.96-3.95-98.98-37.49 47.02z"/><path fill="#a1c3ff" d="M202.31 28.73 142.65.0l-37.13 46.56 96.79-17.83z"/><path d="M1.6 272v-44.78h5.74v23.41l20.48-23.41h6.4l-17.39 19.7 19 25.07H29.1l-15.92-20.8-5.84 6.65V272zm40.02-9.79V240h5.43v22.39a4.67 4.67.0 002.35 4.19 11 11 0 0011 0 4.69 4.69.0 002.33-4.19V240h5.43v22.19a9.08 9.08.0 01-4.1 7.87 16.2 16.2.0 01-18.37.0 9.07 9.07.0 01-4.07-7.85zM77.46 272v-48h5.43v16.81a29.29 29.29.0 019.32-1.73 13.1 13.1.0 016.2 1.41 10.71 10.71.0 014.18 3.74 18.07 18.07.0 012.23 5.06 21.26 21.26.0 01.73 5.58q0 8.43-4.38 12.79T87.35 272zm5.43-4.87h4.55q6.77.0 9.72-2.95t3-9.51a14.21 14.21.0 00-2-7.52 6.55 6.55.0 00-6-3.22 24.73 24.73.0 00-9.25 1.54zm29.47-11.19q0-7.71 4.09-12.3a13.75 13.75.0 0110.8-4.59q13.35.0 13.36 18.86h-22.82a12.3 12.3.0 002.9 7.07q2.59 3.11 7.9 3.1a24.92 24.92.0 0010.55-2v5a27.74 27.74.0 01-9.86 1.87 19.83 19.83.0 01-7.7-1.37 13.31 13.31.0 01-5.28-3.76 16.21 16.21.0 01-3-5.38 20.84 20.84.0 01-.94-6.5zm5.62-2.12h17.26a14.91 14.91.0 00-2.37-7.12 6.44 6.44.0 00-5.62-2.78 8.2 8.2.0 00-6.21 2.72 12.07 12.07.0 00-3.04 7.18z" fill="#4279f4" stroke="#4279f4" stroke-miterlimit="10" stroke-width="3.2"/><path d="M147.32 244.89V240h5v-7.59a8.14 8.14.0 012.31-6.05 7.79 7.79.0 015.69-2.28h7.86V229h-5c-2.21.0-3.67.45-4.37 1.34s-1.06 2.55-1.06 5V240h8.46v4.87h-8.46V272h-5.44v-27.1zM175.26 272v-48h5.43v48zm19.15-3.95a17.86 17.86.0 1112.33 4.9 16.57 16.57.0 01-12.33-4.9zm3.84-20.65a13.16 13.16.0 000 17.2 12.07 12.07.0 0017 0 13.09 13.09.0 000-17.2 12.07 12.07.0 00-17 0zm30.2-7.4h5.75l7.3 25.32 7.43-25.32h5.36l7.34 25.34L269 240h5.74l-10.04 32h-6.12l-6.83-24.58L245 272h-6.47z" fill="#0028aa" stroke="#0028aa" stroke-miterlimit="10" stroke-width="3.2"/></g></g></svg></span><span class="text-uppercase font-weight-bold">Kubeflow on Google Cloud Platform</span>
	</a>
	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main_navbar" aria-controls="main_navbar" aria-expanded="false" aria-label="Toggle navigation">
		<span class="navbar-toggler-icon"></span>
	</button>
	<div class="collapse navbar-collapse ml-md-auto" id="main_navbar">
		<ul class="navbar-nav ml-auto pt-4 pt-md-0 my-2 my-md-1">
			
			
			<li class="nav-item mr-2 mr-lg-4 mt-1 mt-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/kubeflow-docs/docs/" ><span>Docs</span></a>
			</li>
			
			<li class="nav-item mr-2 mr-lg-4 mt-1 mt-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/kubeflow-docs/news/" ><span>News</span></a>
			</li>
			
			<li class="nav-item mr-2 mr-lg-4 mt-1 mt-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="https://github.com/GoogleCloudPlatform/kubeflow-distribution" target="_blank" ><i class='fa-brands fa-github pr-2'></i><span>Manifests</span></a>
			</li>
			
			
			<li class="nav-item dropdown mt-1 mt-lg-0 mr-2">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	Versions
</a>
<div class="dropdown-menu dropdown-menu-md-right dropdown-menu-lg-left" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/docs">latest</a>
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/v1.5/docs">v1.5</a>
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/v1.4/docs">v1.4</a>
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/dev/docs">dev</a>
	
</div>

			</li>
			
			
		</ul>
	</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            
<div id="td-sidebar-menu" class="td-sidebar__inner">
  <form class="td-sidebar__search d-flex align-items-center">
    
    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-section-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  <nav class="collapse td-sidebar-nav" id="td-section-nav">
    <ul class="td-sidebar-nav__section pr-md-3 ul-0">
      <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-kubeflow-docsdocs-li">
  <a href="/kubeflow-docs/docs/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id="m-kubeflow-docsdocs"><span class="">Kubeflow on Google Cloud</span></a>
  <ul class="ul-1">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-kubeflow-docsdocsdeploy-li">
  <a href="/kubeflow-docs/docs/deploy/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-kubeflow-docsdocsdeploy"><span class="">Deployment</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-docsdocsdeployoverview-li">
  <a href="/kubeflow-docs/docs/deploy/overview/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-kubeflow-docsdocsdeployoverview"><span class="">Overview</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-docsdocsdeployproject-setup-li">
  <a href="/kubeflow-docs/docs/deploy/project-setup/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-kubeflow-docsdocsdeployproject-setup"><span class="">Setting up GCP Project</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-docsdocsdeployoauth-setup-li">
  <a href="/kubeflow-docs/docs/deploy/oauth-setup/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-kubeflow-docsdocsdeployoauth-setup"><span class="">Setting up OAuth client</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-docsdocsdeploymanagement-setup-li">
  <a href="/kubeflow-docs/docs/deploy/management-setup/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-kubeflow-docsdocsdeploymanagement-setup"><span class="">Deploying Management cluster</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-docsdocsdeploydeploy-cli-li">
  <a href="/kubeflow-docs/docs/deploy/deploy-cli/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-kubeflow-docsdocsdeploydeploy-cli"><span class="">Deploying Kubeflow cluster</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-docsdocsdeployupgrade-li">
  <a href="/kubeflow-docs/docs/deploy/upgrade/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-kubeflow-docsdocsdeployupgrade"><span class="">Upgrade Kubeflow</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-docsdocsdeploymonitor-iap-setup-li">
  <a href="/kubeflow-docs/docs/deploy/monitor-iap-setup/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-kubeflow-docsdocsdeploymonitor-iap-setup"><span class="">Monitoring Cloud IAP Setup</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-docsdocsdeploydelete-cli-li">
  <a href="/kubeflow-docs/docs/deploy/delete-cli/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-kubeflow-docsdocsdeploydelete-cli"><span class="">Deleting Kubeflow</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-kubeflow-docsdocspipelines-li">
  <a href="/kubeflow-docs/docs/pipelines/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-kubeflow-docsdocspipelines"><span class="">Pipelines on Google Cloud</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-docsdocspipelinesauthentication-sdk-li">
  <a href="/kubeflow-docs/docs/pipelines/authentication-sdk/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-kubeflow-docsdocspipelinesauthentication-sdk"><span class="">Connecting to Kubeflow Pipelines on Google Cloud using the SDK</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-docsdocspipelinesauthentication-pipelines-li">
  <a href="/kubeflow-docs/docs/pipelines/authentication-pipelines/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-kubeflow-docsdocspipelinesauthentication-pipelines"><span class="">Authenticating Pipelines to Google Cloud</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-docsdocspipelinesupgrade-li">
  <a href="/kubeflow-docs/docs/pipelines/upgrade/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-kubeflow-docsdocspipelinesupgrade"><span class="">Upgrading</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-docsdocspipelinesenable-gpu-and-tpu-li">
  <a href="/kubeflow-docs/docs/pipelines/enable-gpu-and-tpu/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-kubeflow-docsdocspipelinesenable-gpu-and-tpu"><span class="">Enabling GPU and TPU</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-docsdocspipelinespreemptible-li">
  <a href="/kubeflow-docs/docs/pipelines/preemptible/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-kubeflow-docsdocspipelinespreemptible"><span class="">Using Preemptible VMs and GPUs on Google Cloud</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id="m-kubeflow-docsdocscustomizing-li">
  <a href="/kubeflow-docs/docs/customizing/" class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id="m-kubeflow-docsdocscustomizing"><span class="td-sidebar-nav-active-item">Customize Kubeflow on GKE</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-docsdocscustom-domain-li">
  <a href="/kubeflow-docs/docs/custom-domain/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-kubeflow-docsdocscustom-domain"><span class="">Using Your Own Domain</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-docsdocsauthentication-li">
  <a href="/kubeflow-docs/docs/authentication/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-kubeflow-docsdocsauthentication"><span class="">Authenticating Kubeflow to Google Cloud</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-docsdocsprivate-clusters-li">
  <a href="/kubeflow-docs/docs/private-clusters/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-kubeflow-docsdocsprivate-clusters"><span class="">Securing Your Clusters</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-docsdocstroubleshooting-li">
  <a href="/kubeflow-docs/docs/troubleshooting/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-kubeflow-docsdocstroubleshooting"><span class="">Troubleshooting Deployments on GKE</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-docsdocsanthos-li">
  <a href="/kubeflow-docs/docs/anthos/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-kubeflow-docsdocsanthos"><span class="">Kubeflow On-premises on Anthos</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-docsdocschangelog-li">
  <a href="/kubeflow-docs/docs/changelog/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-kubeflow-docsdocschangelog"><span class="">Changelog</span></a>
</li>
  </ul>
</li>
    </ul>
  </nav>
</div>

          </aside>
          <aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none">
            
<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">
<a id="print" href="https://gkcalat.github.io/kubeflow-docs/docs/_print/"><i class="fa-solid fa-print fa-fw"></i> Print entire section</a>

</div>

            <div class="td-toc">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#before-you-start">Before you start</a></li>
    <li><a href="#customizing-kubeflow-before-deployment">Customizing Kubeflow before deployment</a></li>
    <li><a href="#customizing-an-existing-deployment">Customizing an existing deployment</a></li>
    <li><a href="#before-you-start-1">Before you start</a></li>
    <li><a href="#customizing-google-cloud-resources">Customizing Google Cloud resources</a></li>
    <li><a href="#customizing-kubeflow-resources">Customizing Kubeflow resources</a></li>
    <li><a href="#common-customizations">Common customizations</a>
      <ul>
        <li><a href="#add-users-to-kubeflow">Add users to Kubeflow</a></li>
        <li><a href="#add-gpu-nodes-to-your-cluster">Add GPU nodes to your cluster</a></li>
        <li><a href="#add-cloud-tpus-to-your-cluster">Add Cloud TPUs to your cluster</a></li>
      </ul>
    </li>
    <li><a href="#more-customizations">More customizations</a></li>
  </ul>
</nav>
      </div>
    
            

	
		
			
				
			
			



  
  

		
			
				
			
			



  
  

		
	

          </aside>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            
  

            <nav aria-label="breadcrumb" class="td-breadcrumbs">
  <ol class="breadcrumb">
  <li class="breadcrumb-item">
    <a href="https://gkcalat.github.io/kubeflow-docs/docs/">Kubeflow on Google Cloud</a>
  </li>
  <li class="breadcrumb-item active" aria-current="page">
    <a href="https://gkcalat.github.io/kubeflow-docs/docs/customizing/" aria-disabled="true" class="btn-link disabled">Customize Kubeflow on GKE</a>
  </li>
  </ol>
</nav>
            
<div class="td-content">
	<h1>Customize Kubeflow on GKE</h1>
	<div class="lead">Tailoring a GKE deployment of Kubeflow</div>
	<header class="article-meta">
		

  
    
      


    
      


    
  

		
			<p class="reading-time"><i class="fa-solid fa-clock" aria-hidden="true"></i>&nbsp; 6 minute read &nbsp;</p>

		
	</header>    
	<p>This guide describes how to customize your deployment of Kubeflow on Google
Kubernetes Engine (GKE) on Google Cloud.</p>
<h2 id="before-you-start">Before you start</h2>
<p>The variables defined in this page can be found in <a href="https://github.com/GoogleCloudPlatform/kubeflow-distribution/blob/master/kubeflow/env.sh">kubeflow-distribution/kubeflow/env.sh</a>. They are the same value as you set based on your <a href="/docs/deploy/deploy-cli/#environment-variables">Kubeflow deployment</a>.</p>
<h2 id="customizing-kubeflow-before-deployment">Customizing Kubeflow before deployment</h2>
<p>The Kubeflow deployment process is divided into two steps, <strong>hydrate</strong> and
<strong>apply</strong>, so that you can modify your configuration before deploying your
Kubeflow cluster.</p>
<p>Follow the guide to <a href="/docs/gke/deploy/deploy-cli/">deploying Kubeflow on Google Cloud</a>. You can add your patches in corresponding component folder, and include those patches in <code>kustomization.yaml</code> file. Learn more about the usage of <a href="https://kubectl.docs.kubernetes.io/references/kustomize/kustomization/">kustomize</a>. You can also find the existing kustomization in <a href="https://github.com/GoogleCloudPlatform/kubeflow-distribution">GoogleCloudPlatform/kubeflow-distribution</a> as example. After adding the patches, you can run <code>make hydrate</code> to validate the resulting resources. Finally, you can run <code>make apply</code> to deploy the customized Kubeflow.</p>
<h2 id="customizing-an-existing-deployment">Customizing an existing deployment</h2>
<p>You can also customize an existing Kubeflow deployment. In that case, this
guide assumes that you have already followed the guide to
<a href="/docs/gke/deploy/deploy-cli/">deploying Kubeflow on Google Cloud</a> and have deployed
Kubeflow to a GKE cluster.</p>
<h2 id="before-you-start-1">Before you start</h2>
<p>This guide assumes the following settings:</p>
<ul>
<li>
<p>The <code>${KF_DIR}</code> environment variable contains the path to
your Kubeflow application directory, which holds your Kubeflow configuration
files. For example, <code>/opt/kubeflow-distribution/kubeflow/</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">export KF_DIR=&lt;path to your Kubeflow application directory&gt;
</span></span><span class="line"><span class="cl">cd &#34;${KF_DIR}&#34;
</span></span></code></pre></div></li>
<li>
<p>Make sure your environment variables are set up for the Kubeflow cluster you want to customize. For further background about the settings, see the guide to
<a href="/docs/gke/deploy/deploy-cli">deploying Kubeflow with the CLI</a>.</p>
</li>
</ul>
<h2 id="customizing-google-cloud-resources">Customizing Google Cloud resources</h2>
<p>To customize Google Cloud resources, such as your Kubernetes Engine cluster, you can
modify the Deployment settings starting in <code>${KF_DIR}/common/cnrm</code>.</p>
<p>This folder contains multiple dependencies on sibling directories for Google Cloud resources. So you can start from here by reviewing <code>kustomization.yaml</code>. Depends on the type of Google Cloud resources you want to customize, you can add patches in corresponding directory.</p>
<ol>
<li>
<p>Make sure you checkin the existing resources in <code>/build</code> folder to source control.</p>
</li>
<li>
<p>Add the patches in corresponding directory, and update <code>kustomization.yaml</code> to include patches.</p>
</li>
<li>
<p>Run <code>make hydrate</code> to build new resources in <code>/build</code> folder.</p>
</li>
<li>
<p>Carefully examine the result resources in <code>/build</code> folder. If the customization is addition only, you can run <code>make apply</code> to directly patch the resources.</p>
</li>
<li>
<p>It is possible that you are modifying immutable resources. In this case, you will need to delete existing resource and applying new resources. Note that this might mean lost of your service and data, please execute carefully. General approach to delete and deploy Google Cloud resources:</p>
<ol>
<li>
<p>Revert to old resources in <code>/build</code> using source control.</p>
</li>
<li>
<p>Carefully delete the resource you need to delete by using <code>kubectl delete</code>.</p>
</li>
<li>
<p>Rebuild and apply new Google Cloud resources</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> common/cnrm
</span></span><span class="line"><span class="cl"><span class="nv">NAME</span><span class="o">=</span><span class="k">$(</span>NAME<span class="k">)</span> <span class="nv">KFCTXT</span><span class="o">=</span><span class="k">$(</span>KFCTXT<span class="k">)</span> <span class="nv">LOCATION</span><span class="o">=</span><span class="k">$(</span>LOCATION<span class="k">)</span> <span class="nv">PROJECT</span><span class="o">=</span><span class="k">$(</span>PROJECT<span class="k">)</span> make apply
</span></span></code></pre></div></li>
</ol>
<h2 id="customizing-kubeflow-resources">Customizing Kubeflow resources</h2>
<p>You can use <a href="https://kustomize.io/">kustomize</a> to customize Kubeflow.
Make sure that you have the minimum required version of kustomize:
<b>2.0.3</b> or later. For more information about
kustomize in Kubeflow, see
<a href="/docs/methods/kfctl/kustomize/">how Kubeflow uses kustomize</a>.</p>
<p>To customize the Kubernetes resources running within the cluster, you can modify
the kustomize manifests in corresponding component under <code>${KF_DIR}</code>.</p>
<p>For example, to modify settings for the Jupyter web app:</p>
<ol>
<li>
<p>Open <code>${KF_DIR}/apps/jupyter/jupyter-web-app/kustomization.yaml</code> in a text editor.</p>
</li>
<li>
<p>Review the file&rsquo;s inclusion of <code>deployment-patch.yaml</code>, and add your modification to <code>deployment-patch.yaml</code> based on the original content in <code>${KF_DIR}/apps/jupyter/jupyter-web-app/upstream/base/deployment.yaml</code>. For example: change <code>volumeMounts</code>&rsquo;s <code>mountPath</code> if you need to customize it.</p>
</li>
<li>
<p>Verify the output resources in <code>/build</code> folder using <code>Makefile</code>&quot;</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">KF_DIR</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">make hydrate
</span></span></code></pre></div></li>
<li>
<p>Redeploy Kubeflow using <code>Makefile</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">KF_DIR</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">make apply
</span></span></code></pre></div></li>
</ol>
<h2 id="common-customizations">Common customizations</h2>
<h3 id="add-users-to-kubeflow">Add users to Kubeflow</h3>
<p>You must grant each user the minimal permission scope that allows them to
connect to the Kubernetes cluster.</p>
<p>For Google Cloud, you should grant the following Cloud Identity and Access Management (IAM) roles.</p>
<p>In the following commands, replace <code>[PROJECT]</code> with your Google Cloud project and replace <code>[EMAIL]</code> with the user&rsquo;s email address:</p>
<ul>
<li>
<p>To access the Kubernetes cluster, the user needs the <a href="https://cloud.google.com/kubernetes-engine/docs/how-to/iam">Kubernetes Engine
Cluster Viewer</a>
role:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">gcloud projects add-iam-policy-binding [PROJECT] --member=user:[EMAIL] --role=roles/container.clusterViewer
</span></span></code></pre></div></li>
<li>
<p>To access the Kubeflow UI through IAP, the user needs the
<a href="https://cloud.google.com/iap/docs/managing-access">IAP-secured Web App User</a>
role:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">gcloud projects add-iam-policy-binding [PROJECT] --member=user:[EMAIL] --role=roles/iap.httpsResourceAccessor
</span></span></code></pre></div><p>Note, you need to grant the user <code>IAP-secured Web App User</code> role even if the user is already an owner or editor of the project. <code>IAP-secured Web App User</code> role is not implied by the <code>Project Owner</code> or <code>Project Editor</code> roles.</p>
</li>
<li>
<p>To be able to run <code>gcloud container clusters get-credentials</code> and see logs in Cloud Logging
(formerly Stackdriver), the user needs viewer access on the project:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">gcloud projects add-iam-policy-binding [PROJECT] --member=user:[EMAIL] --role=roles/viewer
</span></span></code></pre></div></li>
</ul>
<p>Alternatively, you can also grant these roles on the <a href="https://console.cloud.google.com/iam-admin/iam">IAM page in the Cloud Console</a>. Make sure you are in the same project as your Kubeflow deployment.</p>
<p><a id="gpu-config"></a></p>
<h3 id="add-gpu-nodes-to-your-cluster">Add GPU nodes to your cluster</h3>
<p>To add GPU accelerators to your Kubeflow cluster, you have the following
options:</p>
<ul>
<li>Pick a Google Cloud zone that provides NVIDIA Tesla K80 Accelerators
(<code>nvidia-tesla-k80</code>).</li>
<li>Or disable node-autoprovisioning in your Kubeflow cluster.</li>
<li>Or change your node-autoprovisioning configuration.</li>
</ul>
<p>To see which accelerators are available in each zone, run the following
command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">gcloud compute accelerator-types list
</span></span></code></pre></div><p>Create the <a href="https://cloud.google.com/config-connector/docs/reference/resource-docs/container/containernodepool">ContainerNodePool</a> resource adopting GPU, for exmaple, create a new file <code>containernodepool-gpu.yaml</code> file and fulfill the value <code>KUBEFLOW-NAME</code>, <code>KF-PROJECT</code>, <code>LOCATION</code> based on your <a href="/docs/deploy/deploy-cli/#environment-variables">Kubeflow deployment</a>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">apiVersion: container.cnrm.cloud.google.com/v1beta1
</span></span><span class="line"><span class="cl">kind: ContainerNodePool
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  labels:
</span></span><span class="line"><span class="cl">    kf-name: KF_NAME # kpt-set: ${name}
</span></span><span class="line"><span class="cl">  name: containernodepool-gpu
</span></span><span class="line"><span class="cl">  namespace: KF_PROJECT # kpt-set: ${gcloud.core.project}
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  location: LOCATION # kpt-set: ${location}
</span></span><span class="line"><span class="cl">  initialNodeCount: 1
</span></span><span class="line"><span class="cl">  autoscaling:
</span></span><span class="line"><span class="cl">    minNodeCount: 0
</span></span><span class="line"><span class="cl">    maxNodeCount: 5
</span></span><span class="line"><span class="cl">  nodeConfig:
</span></span><span class="line"><span class="cl">    machineType: n1-standard-4
</span></span><span class="line"><span class="cl">    diskSizeGb: 100
</span></span><span class="line"><span class="cl">    diskType: pd-standard
</span></span><span class="line"><span class="cl">    preemptible: true
</span></span><span class="line"><span class="cl">    oauthScopes:
</span></span><span class="line"><span class="cl">    - &#34;https://www.googleapis.com/auth/logging.write&#34;
</span></span><span class="line"><span class="cl">    - &#34;https://www.googleapis.com/auth/monitoring&#34;
</span></span><span class="line"><span class="cl">    - &#34;https://www.googleapis.com/auth/devstorage.read_only&#34;
</span></span><span class="line"><span class="cl">    guestAccelerator:
</span></span><span class="line"><span class="cl">    - type: &#34;nvidia-tesla-k80&#34;
</span></span><span class="line"><span class="cl">      count: 1
</span></span><span class="line"><span class="cl">    metadata:
</span></span><span class="line"><span class="cl">      disable-legacy-endpoints: &#34;true&#34;
</span></span><span class="line"><span class="cl">  management:
</span></span><span class="line"><span class="cl">    autoRepair: true
</span></span><span class="line"><span class="cl">    autoUpgrade: true
</span></span><span class="line"><span class="cl">  clusterRef:
</span></span><span class="line"><span class="cl">    name: KF_NAME # kpt-set: ${name}
</span></span><span class="line"><span class="cl">    namespace: KF_PROJECT # kpt-set: ${gcloud.core.project}
</span></span></code></pre></div><p>Note that the <code>metadata:name</code> must be unique in your Kubeflow project. Because the management cluster uses this as ID and your Google Cloud project as a namespace to identify a node pool.</p>
<p>Apply the node pool patch file above by running:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl --context<span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">MGMTCTXT</span><span class="si">}</span><span class="s2">&#34;</span> --namespace<span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">KF_PROJECT</span><span class="si">}</span><span class="s2">&#34;</span> apply -f &lt;path-to-gpu-nodepool-file&gt;
</span></span></code></pre></div><p>After adding GPU nodes to your cluster, you need to install NVIDIA&rsquo;s device drivers to the nodes. Google provides a DaemonSet that automatically installs the drivers for you.
To deploy the installation DaemonSet, run the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl --context<span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">KF_NAME</span><span class="si">}</span><span class="s2">&#34;</span> apply -f https://raw.githubusercontent.com/GoogleCloudPlatform/container-engine-accelerators/master/nvidia-driver-installer/cos/daemonset-preloaded.yaml
</span></span></code></pre></div><p>To disable node-autoprovisioning, edit <code>${KF_DIR}/common/cluster/upstream/cluster.yaml</code> to set
<a href="https://github.com/GoogleCloudPlatform/kubeflow-distribution/blob/v1.3.0/kubeflow/common/cluster/upstream/cluster.yaml#L30"><code>enabled</code></a>
to <code>false</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">    clusterAutoscaling:
</span></span><span class="line"><span class="cl">      enabled: false
</span></span><span class="line"><span class="cl">      autoProvisioningDefaults:
</span></span><span class="line"><span class="cl">    ...
</span></span></code></pre></div><h3 id="add-cloud-tpus-to-your-cluster">Add Cloud TPUs to your cluster</h3>
<p>Note: The following instruction should be used when creating GKE cluster, because the TPU enablement flag <code>enableTpu</code> is immutable once cluster is created. You need to create new cluster if existing cluster doesn&rsquo;t have TPU enabled.</p>
<p>Set <a href="https://cloud.google.com/config-connector/docs/reference/resource-docs/container/containercluster"><code>enableTpu:true</code></a>
in <code>${KF_DIR}/common/cluster/upstream/cluster.yaml</code> and enable alias IP (VPC-native traffic routing):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">apiVersion: container.cnrm.cloud.google.com/v1beta1
</span></span><span class="line"><span class="cl">kind: ContainerCluster
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  ...
</span></span><span class="line"><span class="cl">  enableTpu: true
</span></span><span class="line"><span class="cl">  networkingMode: VPC_NATIVE
</span></span><span class="line"><span class="cl">  networkRef:
</span></span><span class="line"><span class="cl">    name: containercluster-dep-vpcnative
</span></span><span class="line"><span class="cl">  subnetworkRef:
</span></span><span class="line"><span class="cl">    name: containercluster-dep-vpcnative
</span></span><span class="line"><span class="cl">  ipAllocationPolicy:
</span></span><span class="line"><span class="cl">    servicesSecondaryRangeName: servicesrange
</span></span><span class="line"><span class="cl">    clusterSecondaryRangeName: clusterrange
</span></span><span class="line"><span class="cl">  ...
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">---
</span></span><span class="line"><span class="cl">apiVersion: compute.cnrm.cloud.google.com/v1beta1
</span></span><span class="line"><span class="cl">kind: ComputeNetwork
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  name: containercluster-dep-vpcnative
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  routingMode: REGIONAL
</span></span><span class="line"><span class="cl">  autoCreateSubnetworks: false
</span></span><span class="line"><span class="cl">---
</span></span><span class="line"><span class="cl">apiVersion: compute.cnrm.cloud.google.com/v1beta1
</span></span><span class="line"><span class="cl">kind: ComputeSubnetwork
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  name: containercluster-dep-vpcnative
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  ipCidrRange: 10.2.0.0/16
</span></span><span class="line"><span class="cl">  region: us-west1
</span></span><span class="line"><span class="cl">  networkRef:
</span></span><span class="line"><span class="cl">    name: containercluster-dep-vpcnative
</span></span><span class="line"><span class="cl">  secondaryIpRange:
</span></span><span class="line"><span class="cl">  - rangeName: servicesrange
</span></span><span class="line"><span class="cl">    ipCidrRange: 10.3.0.0/16
</span></span><span class="line"><span class="cl">  - rangeName: clusterrange
</span></span><span class="line"><span class="cl">    ipCidrRange: 10.4.0.0/16
</span></span></code></pre></div><p>You can learn more at <a href="https://cloud.google.com/tpu/docs/kubernetes-engine-setup#new-cluster">Creating a new cluster with Cloud TPU support</a>, and view an example <a href="https://cloud.google.com/config-connector/docs/reference/resource-docs/container/containercluster">Vpc Native Container Cluster</a> config connector yaml file.</p>
<h2 id="more-customizations">More customizations</h2>
<p>Refer to the navigation panel on the left of these docs for more customizations,
including <a href="/docs/custom-domain">using your own domain</a>,
<a href="/docs/cloud-filestore">setting up Cloud Filestore</a>, and more.</p>

	
		<style>
  .feedback--answer {
    display: inline-block;
  }
  .feedback--answer-no {
    margin-left: 1em;
  }
  .feedback--response {
    display: none;
    margin-top: 1em;
  }
  .feedback--response__visible {
    display: block;
  }
</style>
<div class="card mt-4 col-12 col-sm-6">
  <div class="card-body">
    <h3 class="card-title">Feedback</h3>
    <p class="card-text">Was this page helpful?</p>
    <button class="btn btn-primary feedback--answer feedback--answer-yes" style="width: 5rem;">Yes</button>
    <button class="btn btn-primary feedback--answer feedback--answer-no" style="width: 5rem;">No</button>
    <p class="feedback--response feedback--response-yes">
      Thank you! <a href="https://github.com/gkcalat/kubeflow-docs/issues/new">Send your feedback to us</a>.
    </p>
    <p class="feedback--response feedback--response-no">
      Sorry to hear that. Please <a href="https://github.com/gkcalat/kubeflow-docs/issues/new">tell us how we can improve</a>.
    </p>
  </div>
</div>
<script>
  const yesButton = document.querySelector('.feedback--answer-yes');
  const noButton = document.querySelector('.feedback--answer-no');
  const yesResponse = document.querySelector('.feedback--response-yes');
  const noResponse = document.querySelector('.feedback--response-no');
  const disableButtons = () => {
    yesButton.disabled = true;
    noButton.disabled = true;
  };
  const sendFeedback = (value) => {
    if (typeof ga !== 'function') return;
    const args = {
      command: 'send',
      hitType: 'event',
      category: 'Helpful',
      action: 'click',
      label: window.location.pathname,
      value: value
    };
    ga(args.command, args.hitType, args.category, args.action, args.label, args.value);
  };
  yesButton.addEventListener('click', () => {
    yesResponse.classList.add('feedback--response__visible');
    disableButtons();
    sendFeedback(1);
  });
  noButton.addEventListener('click', () => {
    noResponse.classList.add('feedback--response__visible');
    disableButtons();
    sendFeedback(0);
  });
</script>

		<br />
	
	
	
</div>


          </main>
        </div>
      </div>
      
<footer class="bg-dark pt-3 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Kubeflow mailing list" aria-label="Kubeflow mailing list">
    <a class="text-white" target="_blank" rel="noopener" href="https://www.kubeflow.org/docs/about/community/#kubeflow-mailing-list" aria-label="Kubeflow mailing list">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-white" target="_blank" rel="noopener" href="https://www.kubeflow.org/docs/about/community/#kubeflow-slack" aria-label="Slack">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-white" target="_blank" rel="noopener" href="https://twitter.com/kubeflow" aria-label="Twitter">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Stack Overflow" aria-label="Stack Overflow">
    <a class="text-white" target="_blank" rel="noopener" href="https://stackoverflow.com/questions/tagged/kubeflow" aria-label="Stack Overflow">
      <i class="fab fa-stack-overflow"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2022 Kubeflow on GCP authors | Documentation Distributed under CC BY 4.0</small>
        <p><small class="ml-1"><a href="https://policies.google.com/privacy" target="_blank" rel="noopener">Privacy Policy</a></small></p>
	
		
	
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/GoogleCloudPlatform/kubeflow-distribution" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Kubeflow community calendar" aria-label="Kubeflow community calendar">
    <a class="text-white" target="_blank" rel="noopener" href="https://www.kubeflow.org/docs/about/community/#kubeflow-community-calendars" aria-label="Kubeflow community calendar">
      <i class="fa fa-calendar"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="/kubeflow-docs/js/main.min.301c0110334bec1b4445867d27dc7dd69b2df859154ccf252005508bc860cc5a.js" integrity="sha256-MBwBEDNL7BtERYZ9J9x91pst&#43;FkVTM8lIAVQi8hgzFo=" crossorigin="anonymous"></script>
<script src='/kubeflow-docs/js/tabpane-persist.js'></script>

  </body>
</html>
<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.105.0">
<link rel="canonical" type="text/html" href="https://gkcalat.github.io/kubeflow-docs/docs/components/multi-tenancy/">
<link rel="alternate" type="application/rss&#43;xml" href="https://gkcalat.github.io/kubeflow-docs/docs/components/multi-tenancy/index.xml">
<meta name="robots" content="noindex, nofollow">

<script type="application/ld+json">
  {
      "@context" : "http://schema.org",
      "@type" : "WebSite",
      "mainEntityOfPage": {
           "@type": "WebPage",
           "@id": "https:\/\/gkcalat.github.io\/kubeflow-docs"
      },
      "articleSection" : "docs",
      "name" : "Multi-Tenancy",
      "headline" : "Multi-Tenancy",
      "description" : "Multi-user isolation and identity access management (IAM)",
      "inLanguage" : "en-US",
      "author" : "",
      "creator" : "",
      "publisher": "",
      "accountablePerson" : "",
      "copyrightHolder" : "",
      "copyrightYear" : "0001",
      "datePublished": "0001-01-01 00:00:00 \u002b0000 UTC",
      "dateModified" : "0001-01-01 00:00:00 \u002b0000 UTC",
      "url" : "https:\/\/gkcalat.github.io\/kubeflow-docs\/docs\/components\/multi-tenancy\/",
      "wordCount" : "0",
      "keywords" : [ "Kubeflow" ]
  }
  </script>

<link rel="shortcut icon" href="/kubeflow-docs/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/kubeflow-docs/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/kubeflow-docs/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/kubeflow-docs/favicons/favicon-32x32.png" sizes="32x32">
<link rel="manifest" href="/kubeflow-docs/favicons/manifest.json">
<meta name="msapplication-config" content="/kubeflow-docs/favicons/browserconfig.xml" />
<meta name="msapplication-TileColor" content="#4279f4">
<meta name="theme-color" content="#4279f4">

<title>Multi-Tenancy | Kubeflow on Google Cloud Platform</title>
<meta name="description" content="Multi-user isolation and identity access management (IAM)">
<meta property="og:title" content="Multi-Tenancy" />
<meta property="og:description" content="Multi-user isolation and identity access management (IAM)" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://gkcalat.github.io/kubeflow-docs/docs/components/multi-tenancy/" /><meta property="og:site_name" content="Kubeflow on Google Cloud Platform" />

<meta itemprop="name" content="Multi-Tenancy">
<meta itemprop="description" content="Multi-user isolation and identity access management (IAM)"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Multi-Tenancy"/>
<meta name="twitter:description" content="Multi-user isolation and identity access management (IAM)"/>




<link rel="preload" href="/kubeflow-docs/scss/main.min.5006b434b14f73c3d5537a7ba4c8ecef723ddc93f3a3c8530e19d24f75486ea9.css" as="style">
<link href="/kubeflow-docs/scss/main.min.5006b434b14f73c3d5537a7ba4c8ecef723ddc93f3a3c8530e19d24f75486ea9.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-GK9XL47N6S"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-GK9XL47N6S', { 'anonymize_ip': false });
}
</script>

  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand-md navbar-dark  td-navbar">
        <a class="navbar-brand" href="/kubeflow-docs/">
		<span class="navbar-logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 276.93 274.55"><g data-name="Layer 2"><g data-name="Layer 1"><path d="M95.9 62.15l4.1 102.1 73.75-94.12a6.79 6.79.0 019.6-1.11l46 36.92-15-65.61z" fill="#4279f4"/><path fill="#0028aa" d="M102.55 182.98h65.42l-40.17-32.23-25.25 32.23z"/><path fill="#014bd1" d="M180.18 83.92l-44 56.14 46.88 37.61 44.47-55.76-47.35-37.99z"/><path fill="#bedcff" d="M83.56 52.3l.01-.01 38.69-48.52-62.39 30.05-15.41 67.51 39.1-49.03z"/><path fill="#6ca1ff" d="M45.32 122.05l41.44 51.96-3.95-98.98-37.49 47.02z"/><path fill="#a1c3ff" d="M202.31 28.73 142.65.0l-37.13 46.56 96.79-17.83z"/><path d="M1.6 272v-44.78h5.74v23.41l20.48-23.41h6.4l-17.39 19.7 19 25.07H29.1l-15.92-20.8-5.84 6.65V272zm40.02-9.79V240h5.43v22.39a4.67 4.67.0 002.35 4.19 11 11 0 0011 0 4.69 4.69.0 002.33-4.19V240h5.43v22.19a9.08 9.08.0 01-4.1 7.87 16.2 16.2.0 01-18.37.0 9.07 9.07.0 01-4.07-7.85zM77.46 272v-48h5.43v16.81a29.29 29.29.0 019.32-1.73 13.1 13.1.0 016.2 1.41 10.71 10.71.0 014.18 3.74 18.07 18.07.0 012.23 5.06 21.26 21.26.0 01.73 5.58q0 8.43-4.38 12.79T87.35 272zm5.43-4.87h4.55q6.77.0 9.72-2.95t3-9.51a14.21 14.21.0 00-2-7.52 6.55 6.55.0 00-6-3.22 24.73 24.73.0 00-9.25 1.54zm29.47-11.19q0-7.71 4.09-12.3a13.75 13.75.0 0110.8-4.59q13.35.0 13.36 18.86h-22.82a12.3 12.3.0 002.9 7.07q2.59 3.11 7.9 3.1a24.92 24.92.0 0010.55-2v5a27.74 27.74.0 01-9.86 1.87 19.83 19.83.0 01-7.7-1.37 13.31 13.31.0 01-5.28-3.76 16.21 16.21.0 01-3-5.38 20.84 20.84.0 01-.94-6.5zm5.62-2.12h17.26a14.91 14.91.0 00-2.37-7.12 6.44 6.44.0 00-5.62-2.78 8.2 8.2.0 00-6.21 2.72 12.07 12.07.0 00-3.04 7.18z" fill="#4279f4" stroke="#4279f4" stroke-miterlimit="10" stroke-width="3.2"/><path d="M147.32 244.89V240h5v-7.59a8.14 8.14.0 012.31-6.05 7.79 7.79.0 015.69-2.28h7.86V229h-5c-2.21.0-3.67.45-4.37 1.34s-1.06 2.55-1.06 5V240h8.46v4.87h-8.46V272h-5.44v-27.1zM175.26 272v-48h5.43v48zm19.15-3.95a17.86 17.86.0 1112.33 4.9 16.57 16.57.0 01-12.33-4.9zm3.84-20.65a13.16 13.16.0 000 17.2 12.07 12.07.0 0017 0 13.09 13.09.0 000-17.2 12.07 12.07.0 00-17 0zm30.2-7.4h5.75l7.3 25.32 7.43-25.32h5.36l7.34 25.34L269 240h5.74l-10.04 32h-6.12l-6.83-24.58L245 272h-6.47z" fill="#0028aa" stroke="#0028aa" stroke-miterlimit="10" stroke-width="3.2"/></g></g></svg></span><span class="text-uppercase font-weight-bold">Kubeflow on Google Cloud Platform</span>
	</a>
	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main_navbar" aria-controls="main_navbar" aria-expanded="false" aria-label="Toggle navigation">
		<span class="navbar-toggler-icon"></span>
	</button>
	<div class="collapse navbar-collapse ml-md-auto" id="main_navbar">
		<ul class="navbar-nav ml-auto pt-4 pt-md-0 my-2 my-md-1">
			
			
			<li class="nav-item mr-2 mr-lg-4 mt-1 mt-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/kubeflow-docs/docs/" ><span>Docs</span></a>
			</li>
			
			<li class="nav-item mr-2 mr-lg-4 mt-1 mt-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/kubeflow-docs/news/" ><span>News</span></a>
			</li>
			
			<li class="nav-item mr-2 mr-lg-4 mt-1 mt-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="https://github.com/GoogleCloudPlatform/kubeflow-distribution" target="_blank" ><i class='fa-brands fa-github pr-2'></i><span>Source</span></a>
			</li>
			
			
			<li class="nav-item dropdown mt-1 mt-lg-0 mr-2">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	Releases
</a>
<div class="dropdown-menu dropdown-menu-md-right dropdown-menu-lg-left" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/v1.6-release/docs">latest</a>
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/v1.6-release/docs">v1.6</a>
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/v1.5-release/docs">v1.5</a>
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/v1.4-release/docs">v1.4</a>
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/main/docs">dev</a>
	
</div>

			</li>
			
			
		</ul>
	</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/kubeflow-docs/docs/components/multi-tenancy/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Multi-Tenancy</h1>
<div class="lead">Multi-user isolation and identity access management (IAM)</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-e87786fc6cd6ef512d86583d427d2d72">Introduction to Multi-user Isolation</a></li>


    
  
    
    
	
<li>2: <a href="#pg-ddca94c4aa141a8f92713881d827f9d7">Design for Multi-user Isolation</a></li>


    
  
    
    
	
<li>3: <a href="#pg-e865bd308ad26da3a77cd89815745e7f">Getting Started with Multi-user Isolation</a></li>


    
  

    </ul>


<div class="content">
      
</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-e87786fc6cd6ef512d86583d427d2d72">1 - Introduction to Multi-user Isolation</h1>
    <div class="lead">Why do Kubeflow administrators need multi-user isolation?</div>
	<div class="alert alert-primary" role="alert">
This Kubeflow component has <b>stable</b> status. See the
<a href="/docs/started/support/#application-status">Kubeflow versioning policies</a>.
</div>
<p>In Kubeflow clusters, users often need to be isolated into a group, where a group includes one or more users.   Additionally, a user may need to belong to multiple groups.  Kubeflowâ€™s multi-user isolation simplifies user operations because each user only views and edited\s the Kubeflow components and model artifacts defined in their configuration.  A userâ€™s view is not cluttered by components or model artifacts that are not in their configuration. This isolation also provides for efficient infrastructure and operations i.e. a single cluster supports multiple isolated users, and does not require the administrator to operate different clusters to isolate users.</p>
<h2 id="key-concepts">Key concepts</h2>
<p><strong>Administrator</strong>: An Administrator is someone who creates and maintains the Kubeflow cluster. This person configures permissions (i.e. view, edit) for other users.</p>
<p><strong>User</strong>: A User is someone who has access to some set of resources in the cluster. A user needs to be granted access permissions by the administrator.</p>
<p><strong>Profile</strong>: A Profile is a unique configuration for a user, which determines their access privileges and is defined by the Administrator.</p>
<p><strong>Isolation</strong>: Isolation uses Kubernetes Namespaces.  Namespaces isolate users or a group of users i.e. Bobâ€™s namespace or ML Eng namespace that is shared by Bob and Sara.</p>
<p><strong>Authentication</strong>: Authentication is provided by an integration of Istio and OIDC and is secured by mTLS.  More details can be found <a href="https://journal.arrikto.com/kubeflow-authentication-with-istio-dex-5eafdfac4782">here</a></p>
<p><strong>Authorization</strong>: Authorization is provided by an integration with Kubernetes RBAC.</p>
<p>Kubeflow multi-user isolation is configured by Kubeflow administrators.   Administrators configure Kubeflow User Profiles for each user.  After the configuration is created and applied, a User can only access the Kubeflow components that the Administrator has configured for them.  The configuration limits non-authorized UI users from viewing or accidentally deleting model artifacts.</p>
<p>With multi-user isolation, Users are authenticated and authorized, and then provided with a time-based token i.e. a json web token (JWT).   The access token is carried as a web header in user requests, and authorizes the user to access the resources configured in their Profile.  The Profile configures several items including the Userâ€™s namespace(s), RBAC RoleBinding, Istio ServiceRole and ServiceRoleBindings along with Resource Quotas and Custom Plug-ins.   More information on the Profile definition and related CRD can be found <a href="https://github.com/kubeflow/kubeflow/blob/master/components/profile-controller/README.md">here</a></p>
<h2 id="current-integration">Current integration</h2>
<p>These Kubeflow Components can support multi-user isolation: Central Dashboard, Notebooks, Pipelines, AutoML (Katib), KFServing.  Furthermore, resources created by the notebooks (for example, training jobs and deployments) also inherit the same access.</p>
<p>Important notes: Multi-user isolation has several configurable dependencies, especially those related to how Kubeflow is configured with the underlying Kubernetes clusterâ€™s identity management system.   Additionally, Kubeflow multi-user isolation doesnâ€™t provide hard security guarantees against malicious attempts to infiltrate another userâ€™s profile.</p>
<p>When configuring multi-user isolation along with your security and identity management requirements, it is recommended that you consult with your <a href="https://www.kubeflow.org/docs/distributions/">distribution provider</a>.   This KubeCon <a href="https://www.youtube.com/watch?v=U8yWOKOhzes">presentation</a> provides a detailed review of the architecture and implementation.   For on-premise deployments, Kubeflow uses Dex as a federated OpenID connection provider and can be integrated with LDAP or Active Directory to provide authentication and identity services.   This can be an advanced configuration and it is recommended that you consult with a distribution provider, or a team that provides advanced technical support for on-premise Kubeflow.</p>
<h2 id="next-steps">Next steps</h2>
<ul>
<li>Learn more about <a href="/docs/components/multi-tenancy/design/">multi-user isolation design</a>.</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ddca94c4aa141a8f92713881d827f9d7">2 - Design for Multi-user Isolation</h1>
    <div class="lead">In-depth design for supporting multi-user isolation</div>
	<div class="alert alert-primary" role="alert">
This Kubeflow component has <b>stable</b> status. See the
<a href="/docs/started/support/#application-status">Kubeflow versioning policies</a>.
</div>
<h2 id="design-overview">Design overview</h2>
<p>Kubeflow multi-tenancy is currently built around <em>user namespaces</em>.
Specifically, Kubeflow defines user-specific namespaces and uses Kubernetes
<a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/">role-based access control (RBAC) policies</a>
to manage user access.</p>
<p>This feature enables users to share access to their workspaces.
Workspace owners can share/revoke workspace access with other users through the
Kubeflow UI.
After being invited, users have permissions to edit the workspace and operate
Kubeflow custom resources.</p>
<p>Kubeflow multi-tenancy is self-served - a new user can self-register to create and own
their workspace through the UI.</p>
<p>Kubeflow uses Istio to control in-cluster traffic. By default, requests to user
workspaces are denied unless allowed by Istio RBAC. In-bound user requests are
identified using an identity provider (for example, Identity Aware Proxy (IAP) on
Google Cloud or Dex for on-premises deployments), and then validated by Istio RBAC rules.</p>
<p>Internally, Kubeflow uses the <em>Profile</em> custom resource to control all policies, roles, and bindings involved,
and to guarantee consistency. Kubeflow also offers a plugin interface to manage external resource/policy outside Kubernetes,
for example interfacing with Amazon Web Services APIs for identity management.</p>
<p>The following diagram illustrates a Kubeflow multi-tenancy cluster with two user-access routes:
via the Kubeflow central dashboard and via the kubectl command-line interface (CLI).</p>
<p><img src="/docs/images/multi-tenancy-cluster.png"
alt="multi tenancy cluster "
class="mt-3 mb-3 border border-info rounded"></p>
<h2 id="feature-requirements">Feature requirements</h2>
<ul>
<li>Kubeflow uses <a href="https://istio.io/">Istio</a> to apply access control over in-cluster traffic.</li>
<li>Kubeflow profile controller needs <code>cluster admin</code> permission.</li>
<li>Kubeflow UI needs to be served behind an identity aware proxy. The identity aware proxy and Kubernetes
master should share the same identity management.</li>
<li>The Kubeflow installation on Google Cloud uses <a href="https://cloud.google.com/kubernetes-engine">GKE</a> and <a href="https://cloud.google.com/iap/docs/concepts-overview">IAP</a>.</li>
<li>On-premises installations of Kubeflow make use of <a href="https://github.com/dexidp/dex">Dex</a>, a flexible OpenID Connect (OIDC) provider.</li>
</ul>
<h2 id="supported-platforms">Supported platforms</h2>
<ul>
<li>Kubeflow multi-tenancy is enabled by default if you deploy Kubeflow on GCP with <a href="/docs/gke/deploy">IAP</a>.</li>
</ul>
<h2 id="next-steps">Next steps</h2>
<ul>
<li>Learn <a href="/docs/components/multi-tenancy/getting-started/">how to use multi-user isolation and profiles</a>.</li>
<li>Read more about <a href="/docs/external-add-ons/istio/istio-in-kubeflow/">Istio in Kubeflow</a>.</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-e865bd308ad26da3a77cd89815745e7f">3 - Getting Started with Multi-user Isolation</h1>
    <div class="lead">How to use multi-user isolation with profiles</div>
	<div class="alert alert-primary" role="alert">
This Kubeflow component has <b>stable</b> status. See the
<a href="/docs/started/support/#application-status">Kubeflow versioning policies</a>.
</div>
<h2 id="usage-overview">Usage overview</h2>
<p>After Kubeflow is installed and configured, you will by default
be accessing your <em>primary profile</em>. A <em>profile</em> owns a Kubernetes namespace of
the same name along with a collection of Kubernetes resources. Users have view
and modify access to their primary profiles. You can share
access to your profile with another user in the system. When sharing the access
to a profile with another user, you can choose to whether to provide only read access or read/modify
access. For all practical purposes when working
through the Kubeflow central dashboard, the active namespace is directly tied
with the active profile.</p>
<h2 id="example-of-usage">Example of usage</h2>
<p>You can select your active profile from the top bar on the Kubeflow central
dashboard.  Note that you can only see the profiles
to which you have view or modify access.</p>
<p><img src="/docs/images/select-profile.png"
alt="Select active profile "
class="mt-3 mb-3 border border-info rounded"></p>
<p>This guide illustrates the user isolation functionality using the Jupyter
notebooks service which is the first service in the system to have full
integration with the multi-user isolation functionality.</p>
<p>After you select an active profile, the Notebooks Servers UI
displays only the active notebook servers in the currently selected
profile. All other notebook servers remain hidden from you. If you switch
the active profile, the view switches the list of active notebooks
appropriately. You can connect to any of the listed notebook servers and
view and modify the existing Jupyter notebooks available in the server.</p>
<p>For example, the following image shows the list of notebook servers available
in a user&rsquo;s primary profile:</p>
<p><img src="/docs/images/notebooks-in-profile.png"
alt="List of notebooks in active profile "
class="mt-3 mb-3 border border-info rounded"></p>
<p>When an unauthorized user accesses the notebooks in this profile, they see an
error:</p>
<p><img src="/docs/images/notebook-access-error.png"
alt="Error listing notebooks in inacessible profile"
class="mt-3 mb-3 border border-info rounded"></p>
<p>When you create Jupyter notebook servers from the Notebooks Servers UI,
the notebook pods are created in your active profile. If you don&rsquo;t have
modify access to the active profile, you can only browse currently active
notebook servers and access the existing notebooks but cannot create
new notebook servers in that profile. You can create notebook
servers in your primary profile which you have view and modify access to.</p>
<h2 id="onboarding-a-new-user">Onboarding a new user</h2>
<p>An <strong>administrator</strong> can manually create a profile for any user in the Kubeflow cluster.
Here an administrator is a person who has <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/#user-facing-roles"><em>cluster-admin</em></a>
role binding in the Kubernetes cluster. This person has permissions to create
and modify Kubernetes resources in the cluster. For example, the person who
deployed Kubeflow will have administration privileges in the cluster.</p>
<p>We recommend this approach, since it encourages the adoption of GitOps processes for handling the Profile creation.</p>
<p>Kubeflow v1.6.0 optionally provides automatic Profile creation workflow for authenticated users on first login.</p>
<h3 id="pre-requisites-grant-user-minimal-kubernetes-cluster-access">Pre-requisites: grant user minimal Kubernetes cluster access</h3>
<p>You must grant each user the minimal permission scope that allows them to
connect to the Kubernetes cluster.</p>
<p>For example, for Google Cloud users, you should grant the
following Cloud Identity and Access Management (IAM) roles. In the following
commands, replace <code>[PROJECT]</code> with your Google Cloud project and replace <code>[EMAIL]</code> with
the user&rsquo;s email address:</p>
<ul>
<li>
<p>To access the Kubernetes cluster, the user needs the <a href="https://cloud.google.com/kubernetes-engine/docs/how-to/iam">Kubernetes Engine
Cluster Viewer</a>
role:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">gcloud projects add-iam-policy-binding [PROJECT] --member=user:[EMAIL] --role=roles/container.clusterViewer
</span></span></code></pre></div></li>
<li>
<p>To access the Kubeflow UI through IAP, the user needs the
<a href="https://cloud.google.com/iap/docs/managing-access">IAP-secured Web App User</a>
role:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">gcloud projects add-iam-policy-binding [PROJECT] --member=user:[EMAIL] --role=roles/iap.httpsResourceAccessor
</span></span></code></pre></div><p><strong>Note:</strong> you need to grant the user <code>IAP-secured Web App User</code> role even if the user is already an owner or editor of the project. <code>IAP-secured Web App User</code> role is not implied by just <code>Project Owner</code> or <code>Project Editor</code> roles.</p>
</li>
<li>
<p>To be able to run <code>gcloud get credentials</code> and see logs in Cloud Logging
(formerly Stackdriver), the user needs viewer access on the project:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">gcloud projects add-iam-policy-binding [PROJECT] --member=user:[EMAIL] --role=roles/viewer
</span></span></code></pre></div></li>
</ul>
<h3 id="manual-profile-creation">Manual profile creation</h3>
<p>An administrator can manually create profiles for users as described below.</p>
<p>Create a
<code>profile.yaml</code> file with the following content on your local machine:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">apiVersion: kubeflow.org/v1beta1
</span></span><span class="line"><span class="cl">kind: Profile
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  name: profileName   # replace with the name of profile you want, this will be user&#39;s namespace name
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  owner:
</span></span><span class="line"><span class="cl">    kind: User
</span></span><span class="line"><span class="cl">    name: userid@email.com   # replace with the email of the user
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  resourceQuotaSpec:    # resource quota can be set optionally
</span></span><span class="line"><span class="cl">   hard:
</span></span><span class="line"><span class="cl">     cpu: &#34;2&#34;
</span></span><span class="line"><span class="cl">     memory: 2Gi
</span></span><span class="line"><span class="cl">     requests.nvidia.com/gpu: &#34;1&#34;
</span></span><span class="line"><span class="cl">     persistentvolumeclaims: &#34;1&#34;
</span></span><span class="line"><span class="cl">     requests.storage: &#34;5Gi&#34;
</span></span></code></pre></div><p>Run the following command to create the corresponding profile resource:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl create -f profile.yaml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubectl apply -f profile.yaml  #if you are modifying the profile
</span></span></code></pre></div><p>The above command creates a profile named <em>profileName</em>. The profile owner is
<em><a href="mailto:userid@email.com">userid@email.com</a></em> and has view and modify access to that profile.
The following resources are created as part of the profile creation:</p>
<ul>
<li>A Kubernetes namespace that shares the same name with the corresponding
profile.</li>
<li>Kubernetes RBAC (<a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/">Role-based access control</a>)
role binding role binding for the namespace: <em>Admin</em>. This makes the
profile owner the namespace administrator, thus giving them access to the
namespace using kubectl (via the Kubernetes API).</li>
<li>Istio namespace-scoped AuthorizationPolicy: <em>user-userid-email-com-clusterrole-edit</em>.
This allows the <code>user</code> to access data belonging to the namespace the AuthorizationPolicy was created in</li>
<li>Namespace-scoped service-accounts <em>default-editor</em> and <em>default-viewer</em> to be used by
user-created pods in the namespace.</li>
<li>Namespace scoped resource quota limits will be placed.</li>
</ul>
<p><strong>Note</strong>: Due to a one-to-one correspondence of profiles with Kubernetes
namespaces, the terms <em>profile</em> and <em>namespace</em> are sometimes used interchangeably in the
documentation.</p>
<h3 id="batch-creation-of-user-profiles">Batch creation of user profiles</h3>
<p>Administrators might want to create profiles for multiple users as a batch. You can
do this by creating a <code>profile.yaml</code> on the local machine with multiple sections of
profile descriptions as shown below:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">apiVersion: kubeflow.org/v1beta1
</span></span><span class="line"><span class="cl">kind: Profile
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  name: profileName1   # replace with the name of profile you want
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  owner:
</span></span><span class="line"><span class="cl">    kind: User
</span></span><span class="line"><span class="cl">    name: userid1@email.com   # replace with the email of the user
</span></span><span class="line"><span class="cl">---
</span></span><span class="line"><span class="cl">apiVersion: kubeflow.org/v1beta1
</span></span><span class="line"><span class="cl">kind: Profile
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  name: profileName2   # replace with the name of profile you want
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  owner:
</span></span><span class="line"><span class="cl">    kind: User
</span></span><span class="line"><span class="cl">    name: userid2@email.com   # replace with the email of the user
</span></span></code></pre></div><p>Run the following command to apply the namespaces to the Kubernetes cluster:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl create -f profile.yaml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubectl apply -f profile.yaml  #if you are modifying the profiles
</span></span></code></pre></div><p>This will create multiple profiles, one for each individual listed in the sections
in <code>profile.yaml</code>.</p>
<h3 id="automatic-profile-creation">Automatic profile creation</h3>
<p>Kubeflow v1.6.0 provides automatic profile creation:</p>
<ul>
<li>Automatic profile creation is not activated by default, and needs to be explicitly included as part of deployment. After turning on automatic user profile creation during deployment, a new user profile is created for authenticated users on their first login. Users will be able to see their new profile in the dropdown list of the Kubeflow central dashboard.</li>
<li>The automatic profile creation can be enabled as part of the deployment by setting the <code>CD_REGISTRATION_FLOW</code> env variable to <code>true</code>. Modify the <code>&lt;manifests-path&gt;/apps/centraldashboard/upstream/base/params.env</code> to set the registration variable to <code>true</code></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">CD_CLUSTER_DOMAIN=cluster.local
</span></span><span class="line"><span class="cl">CD_USERID_HEADER=kubeflow-userid
</span></span><span class="line"><span class="cl">CD_USERID_PREFIX=
</span></span><span class="line"><span class="cl">CD_REGISTRATION_FLOW=true
</span></span></code></pre></div><ul>
<li>When an authenticated user logs into the system and visits the central
dashboard for the first time, they trigger a profile creation automatically.
<ul>
<li>A brief message introduces profiles: <img
src="/docs/images/auto-profile1.png" alt="Automatic profile creation
step 1" class="mt-3 mb-3 border border-info rounded"></li>
<li>The user can name their profile and click <em>Finish</em>:  <img
src="/docs/images/auto-profile2.png" alt="Automatic profile creation
step 2" class="mt-3 mb-3 border border-info rounded"></li>
<li>This redirects the user to the dashboard where they can view and select
their profile in the dropdown list.</li>
</ul>
</li>
</ul>
<h2 id="listing-and-describing-profiles">Listing and describing profiles</h2>
<p>An administrator can list the existing profiles in the system:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ kubectl get profiles
</span></span></code></pre></div><p>and describe a specific profile using:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ kubectl describe profile profileName
</span></span></code></pre></div><h2 id="deleting-an-existing-profile">Deleting an existing profile</h2>
<p>An administrator can delete an existing profile using:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ kubectl delete profile profileName
</span></span></code></pre></div><p>This will delete the profile, the corresponding namespace and any Kubernetes
resources associated with the profile. The profile&rsquo;s owner or other users with
access to the profile will no longer have access to the profile and will not see
it in the dropdown list on the central dashboard.</p>
<h2 id="managing-contributors-through-the-kubeflow-ui">Managing contributors through the Kubeflow UI</h2>
<p>Kubeflow v1.6.0 allows sharing of profiles with other users in the
system.  An owner of a profile can share access to their profile using the
<strong>Manage Contributors</strong> tab available through the dashboard.</p>
<p><img src="/docs/images/multi-user-contributors.png"
alt="Manage Contributors in Profiles"
class="mt-3 mb-3 border border-info rounded"></p>
<p>Here is an example of the Manage Contributors tab view:</p>
<p><img src="/docs/images/manage-contributors.png"
alt="Manage Contributors in Profiles"
class="mt-3 mb-3 border border-info rounded"></p>
<p>Notice that in the above view the account associated with the profile is a
cluster administrator (<em>Cluster Admin</em>)
as this account was used to deploy Kubeflow. The view lists the
profiles accessible to the user along with the role associated with that
profile.</p>
<p>To add or remove a contributor, add/remove the
email address or the user identifier in the <strong>Contributors to your namespace</strong> field.</p>
<p><img src="/docs/images/add-contributors.png"
alt="Add Contributors"
class="mt-3 mb-3 border border-info rounded"></p>
<p>The Manage Contributors tab shows the contributors that the namespace owner has
added. Note that the cluster administrator can view all the
profiles in the system along with their contributors.</p>
<p><img src="/docs/images/view-contributors.png"
alt="View Contributors"
class="mt-3 mb-3 border border-info rounded"></p>
<p>The contributors have access to all the Kubernetes resources in the
namespace and can create notebook servers as well as access
existing notebooks.</p>
<h2 id="managing-contributors-manually">Managing contributors manually</h2>
<p>An administrator can manually add contributors to an existing profile as described below.</p>
<p>Create a rolebinding.yaml file with the following content on your local machine:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">apiVersion: rbac.authorization.k8s.io/v1
</span></span><span class="line"><span class="cl">kind: RoleBinding
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  annotations:
</span></span><span class="line"><span class="cl">    role: edit
</span></span><span class="line"><span class="cl">    user: userid@email.com   # replace with the email of the user from your Active Directory case sensitive
</span></span><span class="line"><span class="cl">  name: user-userid-email-com-clusterrole-edit
</span></span><span class="line"><span class="cl">  # Ex: if the user email is lalith.vaka@kp.org the name should be user-lalith-vaka-kp-org-clusterrole-edit
</span></span><span class="line"><span class="cl">  # Note: if the user email is Lalith.Vaka@kp.org from your Active Directory, the name should be user-lalith-vaka-kp-org-clusterrole-edit
</span></span><span class="line"><span class="cl">  namespace: profileName # replace with the namespace/profile name that you are adding contributors to
</span></span><span class="line"><span class="cl">roleRef:
</span></span><span class="line"><span class="cl">  apiGroup: rbac.authorization.k8s.io
</span></span><span class="line"><span class="cl">  kind: ClusterRole
</span></span><span class="line"><span class="cl">  name: kubeflow-edit
</span></span><span class="line"><span class="cl">subjects:
</span></span><span class="line"><span class="cl">- apiGroup: rbac.authorization.k8s.io
</span></span><span class="line"><span class="cl">  kind: User
</span></span><span class="line"><span class="cl">  name: userid@email.com   # replace with the email of the user from your Active Directory case sensitive
</span></span></code></pre></div><p>Create an authorizationpolicy.yaml file with the following content on your local machine:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">apiVersion: security.istio.io/v1beta1
</span></span><span class="line"><span class="cl">kind: AuthorizationPolicy
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  annotations:
</span></span><span class="line"><span class="cl">    role: edit
</span></span><span class="line"><span class="cl">    user: userid@email.com # replace with the email of the user from your Active Directory case sensitive
</span></span><span class="line"><span class="cl">  name: user-userid-email-com-clusterrole-edit
</span></span><span class="line"><span class="cl">  namespace: profileName # replace with the namespace/profile name that you are adding contributors to
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  action: ALLOW
</span></span><span class="line"><span class="cl">  rules:
</span></span><span class="line"><span class="cl">  - when:
</span></span><span class="line"><span class="cl">    - key: request.headers[kubeflow-userid] # for GCP, use x-goog-authenticated-user-email instead of kubeflow-userid for authentication purpose
</span></span><span class="line"><span class="cl">      values:
</span></span><span class="line"><span class="cl">      - accounts.google.com:userid@email.com   # replace with the email of the user from your Active Directory case sensitive
</span></span></code></pre></div><p>Run the following command to create the corresponding contributor resources:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl create -f rolebinding.yaml
</span></span><span class="line"><span class="cl">kubectl create -f authorizationpolicy.yaml
</span></span></code></pre></div><p>The above command adds a contributor <em><a href="mailto:userid@email.com">userid@email.com</a></em> to the profile named <em>profileName</em>. The contributor
<em><a href="mailto:userid@email.com">userid@email.com</a></em> has view and modify access to that profile.</p>

</div>



    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark pt-3 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Kubeflow mailing list" aria-label="Kubeflow mailing list">
    <a class="text-white" target="_blank" rel="noopener" href="https://www.kubeflow.org/docs/about/community/#kubeflow-mailing-list" aria-label="Kubeflow mailing list">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-white" target="_blank" rel="noopener" href="https://twitter.com/kubeflow" aria-label="Twitter">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Stack Overflow" aria-label="Stack Overflow">
    <a class="text-white" target="_blank" rel="noopener" href="https://stackoverflow.com/questions/tagged/kubeflow" aria-label="Stack Overflow">
      <i class="fab fa-stack-overflow"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/GoogleCloudPlatform/kubeflow-distribution" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-white" target="_blank" rel="noopener" href="https://www.kubeflow.org/docs/about/community/#kubeflow-slack" aria-label="Slack">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-5 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2022 Google | Documentation Distributed under CC BY 4.0</small>
        <p><small class="ml-1"><a href="https://policies.google.com/privacy" target="_blank" rel="noopener">Privacy Policy</a></small></p>
	
		<p class="mt-2"><a href="/kubeflow-docs/docs/about/">About</a></p>
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="/kubeflow-docs/js/main.min.301c0110334bec1b4445867d27dc7dd69b2df859154ccf252005508bc860cc5a.js" integrity="sha256-MBwBEDNL7BtERYZ9J9x91pst&#43;FkVTM8lIAVQi8hgzFo=" crossorigin="anonymous"></script>
<script src='/kubeflow-docs/js/tabpane-persist.js'></script>

  </body>
</html>

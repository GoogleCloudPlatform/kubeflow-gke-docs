<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.105.0">
<link rel="canonical" type="text/html" href="https://gkcalat.github.io/kubeflow-docs/docs/external-add-ons/kserve/">
<link rel="alternate" type="application/rss&#43;xml" href="https://gkcalat.github.io/kubeflow-docs/docs/external-add-ons/kserve/index.xml">
<meta name="robots" content="noindex, nofollow">

<script type="application/ld+json">
  {
      "@context" : "http://schema.org",
      "@type" : "WebSite",
      "mainEntityOfPage": {
           "@type": "WebPage",
           "@id": "https:\/\/gkcalat.github.io\/kubeflow-docs"
      },
      "articleSection" : "docs",
      "name" : "KServe",
      "headline" : "KServe",
      "description" : "Highly scalable and standards based Model Inference Platform on Kubernetes for Trusted AI",
      "inLanguage" : "en-US",
      "author" : "",
      "creator" : "",
      "publisher": "",
      "accountablePerson" : "",
      "copyrightHolder" : "",
      "copyrightYear" : "0001",
      "datePublished": "0001-01-01 00:00:00 \u002b0000 UTC",
      "dateModified" : "0001-01-01 00:00:00 \u002b0000 UTC",
      "url" : "https:\/\/gkcalat.github.io\/kubeflow-docs\/docs\/external-add-ons\/kserve\/",
      "wordCount" : "0",
      "keywords" : [ "Kubeflow" ]
  }
  </script>

<link rel="shortcut icon" href="/kubeflow-docs/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/kubeflow-docs/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/kubeflow-docs/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/kubeflow-docs/favicons/favicon-32x32.png" sizes="32x32">
<link rel="manifest" href="/kubeflow-docs/favicons/manifest.json">
<meta name="msapplication-config" content="/kubeflow-docs/favicons/browserconfig.xml" />
<meta name="msapplication-TileColor" content="#4279f4">
<meta name="theme-color" content="#4279f4">

<title>KServe | Kubeflow on Google Cloud Platform</title>
<meta name="description" content="Highly scalable and standards based Model Inference Platform on Kubernetes for Trusted AI">
<meta property="og:title" content="KServe" />
<meta property="og:description" content="Highly scalable and standards based Model Inference Platform on Kubernetes for Trusted AI" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://gkcalat.github.io/kubeflow-docs/docs/external-add-ons/kserve/" /><meta property="og:site_name" content="Kubeflow on Google Cloud Platform" />

<meta itemprop="name" content="KServe">
<meta itemprop="description" content="Highly scalable and standards based Model Inference Platform on Kubernetes for Trusted AI"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="KServe"/>
<meta name="twitter:description" content="Highly scalable and standards based Model Inference Platform on Kubernetes for Trusted AI"/>




<link rel="preload" href="/kubeflow-docs/scss/main.min.5006b434b14f73c3d5537a7ba4c8ecef723ddc93f3a3c8530e19d24f75486ea9.css" as="style">
<link href="/kubeflow-docs/scss/main.min.5006b434b14f73c3d5537a7ba4c8ecef723ddc93f3a3c8530e19d24f75486ea9.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-GK9XL47N6S"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-GK9XL47N6S', { 'anonymize_ip': false });
}
</script>

  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand-md navbar-dark  td-navbar">
        <a class="navbar-brand" href="/kubeflow-docs/">
		<span class="navbar-logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 276.93 274.55"><g data-name="Layer 2"><g data-name="Layer 1"><path d="M95.9 62.15l4.1 102.1 73.75-94.12a6.79 6.79.0 019.6-1.11l46 36.92-15-65.61z" fill="#4279f4"/><path fill="#0028aa" d="M102.55 182.98h65.42l-40.17-32.23-25.25 32.23z"/><path fill="#014bd1" d="M180.18 83.92l-44 56.14 46.88 37.61 44.47-55.76-47.35-37.99z"/><path fill="#bedcff" d="M83.56 52.3l.01-.01 38.69-48.52-62.39 30.05-15.41 67.51 39.1-49.03z"/><path fill="#6ca1ff" d="M45.32 122.05l41.44 51.96-3.95-98.98-37.49 47.02z"/><path fill="#a1c3ff" d="M202.31 28.73 142.65.0l-37.13 46.56 96.79-17.83z"/><path d="M1.6 272v-44.78h5.74v23.41l20.48-23.41h6.4l-17.39 19.7 19 25.07H29.1l-15.92-20.8-5.84 6.65V272zm40.02-9.79V240h5.43v22.39a4.67 4.67.0 002.35 4.19 11 11 0 0011 0 4.69 4.69.0 002.33-4.19V240h5.43v22.19a9.08 9.08.0 01-4.1 7.87 16.2 16.2.0 01-18.37.0 9.07 9.07.0 01-4.07-7.85zM77.46 272v-48h5.43v16.81a29.29 29.29.0 019.32-1.73 13.1 13.1.0 016.2 1.41 10.71 10.71.0 014.18 3.74 18.07 18.07.0 012.23 5.06 21.26 21.26.0 01.73 5.58q0 8.43-4.38 12.79T87.35 272zm5.43-4.87h4.55q6.77.0 9.72-2.95t3-9.51a14.21 14.21.0 00-2-7.52 6.55 6.55.0 00-6-3.22 24.73 24.73.0 00-9.25 1.54zm29.47-11.19q0-7.71 4.09-12.3a13.75 13.75.0 0110.8-4.59q13.35.0 13.36 18.86h-22.82a12.3 12.3.0 002.9 7.07q2.59 3.11 7.9 3.1a24.92 24.92.0 0010.55-2v5a27.74 27.74.0 01-9.86 1.87 19.83 19.83.0 01-7.7-1.37 13.31 13.31.0 01-5.28-3.76 16.21 16.21.0 01-3-5.38 20.84 20.84.0 01-.94-6.5zm5.62-2.12h17.26a14.91 14.91.0 00-2.37-7.12 6.44 6.44.0 00-5.62-2.78 8.2 8.2.0 00-6.21 2.72 12.07 12.07.0 00-3.04 7.18z" fill="#4279f4" stroke="#4279f4" stroke-miterlimit="10" stroke-width="3.2"/><path d="M147.32 244.89V240h5v-7.59a8.14 8.14.0 012.31-6.05 7.79 7.79.0 015.69-2.28h7.86V229h-5c-2.21.0-3.67.45-4.37 1.34s-1.06 2.55-1.06 5V240h8.46v4.87h-8.46V272h-5.44v-27.1zM175.26 272v-48h5.43v48zm19.15-3.95a17.86 17.86.0 1112.33 4.9 16.57 16.57.0 01-12.33-4.9zm3.84-20.65a13.16 13.16.0 000 17.2 12.07 12.07.0 0017 0 13.09 13.09.0 000-17.2 12.07 12.07.0 00-17 0zm30.2-7.4h5.75l7.3 25.32 7.43-25.32h5.36l7.34 25.34L269 240h5.74l-10.04 32h-6.12l-6.83-24.58L245 272h-6.47z" fill="#0028aa" stroke="#0028aa" stroke-miterlimit="10" stroke-width="3.2"/></g></g></svg></span><span class="text-uppercase font-weight-bold">Kubeflow on Google Cloud Platform</span>
	</a>
	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main_navbar" aria-controls="main_navbar" aria-expanded="false" aria-label="Toggle navigation">
		<span class="navbar-toggler-icon"></span>
	</button>
	<div class="collapse navbar-collapse ml-md-auto" id="main_navbar">
		<ul class="navbar-nav ml-auto pt-4 pt-md-0 my-2 my-md-1">
			
			
			<li class="nav-item mr-2 mr-lg-4 mt-1 mt-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/kubeflow-docs/docs/" ><span>Docs</span></a>
			</li>
			
			<li class="nav-item mr-2 mr-lg-4 mt-1 mt-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/kubeflow-docs/news/" ><span>News</span></a>
			</li>
			
			<li class="nav-item mr-2 mr-lg-4 mt-1 mt-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="https://github.com/GoogleCloudPlatform/kubeflow-distribution" target="_blank" ><i class='fa-brands fa-github pr-2'></i><span>Source</span></a>
			</li>
			
			
			<li class="nav-item dropdown mt-1 mt-lg-0 mr-2">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	Releases
</a>
<div class="dropdown-menu dropdown-menu-md-right dropdown-menu-lg-left" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/v1.6-release/docs">latest</a>
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/v1.6-release/docs">v1.6</a>
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/v1.5-release/docs">v1.5</a>
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/v1.4-release/docs">v1.4</a>
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/main/docs">dev</a>
	
</div>

			</li>
			
			
		</ul>
	</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/kubeflow-docs/docs/external-add-ons/kserve/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">KServe</h1>
<div class="lead">Highly scalable and standards based Model Inference Platform on Kubernetes for Trusted AI</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-15bbdeccd5d20c0050c4ae305ffd6218">KServe</a></li>


    
  
    
    
	
<li>2: <a href="#pg-acff66d23d7c7d3586b4d8ff94e133a5">Migration</a></li>


    
  
    
    
	
<li>3: <a href="#pg-1d68cdc0f643957989aed2fc989e0ede">Models UI</a></li>


    
  
    
    
	
<li>4: <a href="#pg-ec2ce5b333fb900fdc270d79e3d82c1b">Run your first InferenceService</a></li>


    
  

    </ul>


<div class="content">
      
</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-15bbdeccd5d20c0050c4ae305ffd6218">1 - KServe</h1>
    <div class="lead">Model serving using KServe</div>
	<img src="/docs/external-add-ons/kserve/pics/kserve.png" alt="KServe" width="640px">
<p>KServe enables serverless inferencing on Kubernetes and provides performant, high abstraction interfaces for common machine learning (ML) frameworks like TensorFlow, XGBoost, scikit-learn, PyTorch, and ONNX to solve production model serving use cases.</p>
<h3 id="kfserving-is-now-kservehttpskservegithubiowebsite07blogarticles2021-09-27-kfserving-transition"><a href="https://kserve.github.io/website/0.7/blog/articles/2021-09-27-kfserving-transition/">KFServing is now KServe</a></h3>
<p>The KFServing GitHub repository has been transferred to an independent KServe GitHub organization under the stewardship of the Kubeflow Serving Working Group leads.</p>
<h3 id="kserve-docshttpskservegithubiowebsite07"><a href="https://kserve.github.io/website/0.7/">KServe Docs</a></h3>
<p>The majority of KServe docs will be available on the new docs website and it is recommended to refer to the docs on the KServe website rather than this website</p>
<p>You can use KServe to do the following:</p>
<ul>
<li>
<p>Provide a Kubernetes <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/">Custom Resource Definition</a> for serving ML models on arbitrary frameworks.</p>
</li>
<li>
<p>Encapsulate the complexity of autoscaling, networking, health checking, and server configuration to bring cutting edge serving features like GPU autoscaling, scale to zero, and canary rollouts to your ML deployments.</p>
</li>
<li>
<p>Enable a simple, pluggable, and complete story for your production ML inference server by providing prediction, pre-processing, post-processing and explainability out of the box.</p>
</li>
</ul>
<p>Our strong community contributions help KServe to grow. We have a Technical Steering Committee driven by Bloomberg, IBM Cloud, Seldon, Amazon Web Services (AWS) and NVIDIA.  Please browse the <a href="https://github.com/KServe/KServe">KServe GitHub repo</a> and <a href="https://github.com/KServe/KServe/issues">raise issues</a> to give us feedback!</p>
<h2 id="install-with-kubeflow">Install with Kubeflow</h2>
<p>KServe works with Kubeflow 1.5. Kustomize installation files are <a href="https://github.com/kubeflow/manifests/tree/master/contrib/kserve">located in the manifests repo</a>.
Check the examples running KServe on Istio/Dex in the <a href="https://github.com/KServe/KServe/tree/master/docs/samples/istio-dex"><code>KServe/KServe</code></a> repository. For installation on major cloud providers with Kubeflow, follow their installation docs.</p>
<p>Kubeflow 1.5 includes KServe v0.7 which promoted the core InferenceService API from v1alpha2 to v1beta1 stable and added ModelMesh component to the release. Additionally, LFAI Trusted AI Projects on AI Fairness, AI Explainability and Adversarial Robustness have been integrated with KServe, and we have made KServe available on OpenShift as well. To know more, please read the <a href="https://kserve.github.io/website/blog/articles/2021-10-11-KServe-0.7-release/">release blog</a> and follow the <a href="https://github.com/KServe/KServe/releases/tag/v0.7.0">release notes</a></p>
<h2 id="standalone-kserve">Standalone KServe</h2>
<h3 id="quickstart-installhttpskservegithubiowebsite07get_started"><a href="https://kserve.github.io/website/0.7/get_started/">Quickstart Install</a></h3>
<p>KServe Quickstart Environments are for experimentation use only. For production installation, see our <a href="https://kserve.github.io/website/0.7/admin/serverless/">Administrator&rsquo;s Guide</a></p>
<h2 id="learn-more">Learn more</h2>
<ul>
<li><a href="https://www.youtube.com/watch?v=lj_X2ND2BBI">Kubeflow 101: What is KFserving?</a></li>
<li><a href="https://drive.google.com/file/d/16oqz6dhY5BR0u74pi9mDThU97Np__AFb/view">KFServing 101 slides</a>.</li>
<li><a href="https://kccncna19.sched.com/event/UaZo/introducing-kfserving-serverless-model-serving-on-kubernetes-ellis-bigelow-google-dan-sun-bloomberg">Kubecon Introducing KFServing</a>.</li>
<li><a href="https://www.youtube.com/watch?v=sE_A54T2n6k">Serving Machine Learning Models at Scale Using KServe - Yuzhui Liu, Bloomberg</a></li>
<li><a href="https://www.youtube.com/watch?v=0YmM_h7PvpI">KServe (Kubeflow KFServing) Live Coding Session</a></li>
<li><a href="https://www.youtube.com/watch?v=0H-HvK8zIUI">TFiR: Let’s Talk About IBM’s ModelMesh, KServe And Other Open Source AI/ML Technologies</a> | Animesh Singh |</li>
<li><a href="https://www.youtube.com/watch?v=la3Y0lXuKRM">KubeCon 2021: Serving Machine Learning Models at Scale Using KServe</a> | Animesh Singh |</li>
</ul>
<h3 id="kserve-key-links"><strong>KServe Key Links</strong></h3>
<ul>
<li><a href="https://kserve.github.io/website/"><u>Website</u></a></li>
<li><a href="https://github.com/kserve/kserve/"><u>Github</u></a></li>
<li><a href="https://kubeflow.slack.com/join/shared_invite/zt-n73pfj05-l206djXlXk5qdQKs4o1Zkg#/"><u>Slack(#kubeflow-kfserving)</u></a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-acff66d23d7c7d3586b4d8ff94e133a5">2 - Migration</h1>
    <div class="lead">Migrating from KFServing to KServe</div>
	<p>The migration job will by default delete the leftover KFServing installation after migrating the InferenceServices from
<code>serving.kubeflow.org</code> to <code>serving.kserve.io</code>.</p>
<h3 id="migrating-from-kubeflow-based-kfserving">Migrating from Kubeflow-based KFServing</h3>
<ol>
<li>
<p>Install Kubeflow-based KServe 0.7 using the <a href="https://github.com/kserve/kserve/blob/master/install/v0.7.0/kserve_kubeflow.yaml">install YAML</a></p>
<ul>
<li>This will not affect existing services yet.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl apply -f https://raw.githubusercontent.com/kserve/kserve/master/install/v0.7.0/kserve_kubeflow.yaml
</span></span></code></pre></div></li>
<li>
<p>Run the <a href="https://github.com/kserve/kserve/blob/master/hack/kserve_migration/kserve_migration_job_kubeflow.yaml">KServe Migration YAML</a> for Kubeflow-based installations</p>
<ul>
<li>
<p>This will begin the migration. Any errors here may affect your existing services.</p>
</li>
<li>
<p>If you do not want to delete the KFServing resources after migrating, download and edit the env <code>REMOVE_KFSERVING</code>
in the YAML before applying it</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl apply -f https://raw.githubusercontent.com/kserve/kserve/master/hack/kserve_migration/kserve_migration_job_kubeflow.yaml
</span></span></code></pre></div></li>
<li>
<p>Clean up the migration resources</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl delete ClusterRoleBinding cluster-migration-rolebinding
</span></span><span class="line"><span class="cl">kubectl delete ClusterRole cluster-migration-role
</span></span><span class="line"><span class="cl">kubectl delete ServiceAccount cluster-migration-svcaccount -n kubeflow
</span></span></code></pre></div></li>
<li>
<p>Update the models web app to use the new InferenceService API group <code>serving.kserve.io</code></p>
<ul>
<li>Change the deployment image to <code>kserve/models-web-app:v0.7.0</code></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl edit deployment kfserving-models-web-app -n kubeflow
</span></span></code></pre></div></li>
<li>
<p>Update the cluster role to be able to access the new InferenceService API group <code>serving.kserve.io</code></p>
<ul>
<li>Edit the <code>apiGroups</code> from <code>serving.kubeflow.org</code> to <code>serving.kserve.io</code></li>
<li>This is a temporary fix until the next Kubeflow release includes these changes</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl edit clusterrole kfserving-models-web-app-cluster-role
</span></span></code></pre></div></li>
</ol>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-1d68cdc0f643957989aed2fc989e0ede">3 - Models UI</h1>
    <div class="lead">Web app for managing Model servers</div>
	<p>The Models web app is responsible for allowing the user to manipulate the Model Servers in their Kubeflow cluster. To achieve this it provides a user friendly way to handle the lifecycle of <code>InferenceService</code> CRs.</p>
<p>The web app currently works with <code>v1beta1</code> versions of <code>InferenceService</code> objects.</p>
<p>The web app is also exposing information from the underlying Knative resources,
like Conditions from the Knative Configurations, Route and Revisions as well as
live logs from the Model server pod.</p>
<h2 id="installation-and-access">Installation and Access</h2>
<p>Refer <a href="https://github.com/kserve/models-web-app/#development">https://github.com/kserve/models-web-app/#development</a> for installation</p>
<p>The web app includes the following resources:</p>
<ul>
<li>A <code>Deployment</code> for running the backend server, and serving the static frontend files</li>
<li>A <code>Service</code> for configuring the incluster network traffic</li>
<li>A <code>ServiceAccount</code> and <code>ClusterRole{Binding}</code> to give the necessary
permissions to the web app&rsquo;s Pod</li>
<li>A <code>VirtualService</code> for exposing the app via the cluster&rsquo;s Istio Ingress
Gateway</li>
</ul>
<h3 id="kubeflow">Kubeflow</h3>
<p>The web app is included as a part of the Kubeflow <a href="https://github.com/kubeflow/manifests/tree/v1.5-branch/contrib/kserve/models-web-app">1.5
release</a> manifests.
It is <a href="https://github.com/kubeflow/manifests/blob/v1.5-branch/apps/centraldashboard/upstream/base/configmap.yaml#L30">exposed</a> via the
Central Dashboard, out of the box.</p>
<h3 id="standalone">Standalone</h3>
<p>In this case all the resources of the web app will be installed in the
<code>kserve</code> namespace. Users can access the web app either via the
<code>knative-ingress-gateway.knative-serving</code> Istio Ingress Gateway or by
port-forwarding the backend.</p>
<h4 id="port-forwarding">Port forwarding</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># set the following ENV vars in the app&#39;s Deployment</span>
</span></span><span class="line"><span class="cl">kubectl edit -n kserve deployments.apps kserve-models-web-app
</span></span><span class="line"><span class="cl"><span class="c1"># APP_PREFIX: /</span>
</span></span><span class="line"><span class="cl"><span class="c1"># APP_DISABLE_AUTH: &#34;True&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># APP_SECURE_COOKIES: &#34;False&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># expose the app under localhost:5000</span>
</span></span><span class="line"><span class="cl">kubectl port-forward -n kserve svc/kserve-models-web-app 5000:80
</span></span></code></pre></div><h2 id="authorization">Authorization</h2>
<h3 id="subjectaccessreviews">SubjectAccessReviews</h3>
<p>The web app has a mechanism for performing authentication and authorization
checks, to ensure that user actions are compliant with the cluster&rsquo;s RBAC,
which is only enabled in the <em>kubeflow</em> manifests of the app. This mechanism
can be toggled by leveraging the <code>APP_DISABLE_AUTH: &quot;True&quot; | &quot;False&quot;</code> ENV Var.</p>
<p>This mechanism is only enabled in the <em>kubeflow</em> manifests since in a Kubeflow
installation all requests that end up in the web app&rsquo;s Pod will also contain a custom
header that denotes the user. In a Kubeflow installation there&rsquo;s an authentication
component in front of the cluster that ensures only logged in users can
access the cluster&rsquo;s services. In the standalone mode such a
component might not always be deployed.</p>
<p>The web app will be using the value from this custom header to extract the name
of the <a href="https://kubernetes.io/docs/reference/access-authn-authz/authentication/">K8s
user</a>
that made the request. Then it will create a
<a href="https://kubernetes.io/docs/reference/access-authn-authz/authorization/#determine-whether-a-request-is-allowed-or-denied">SubjectAccessReview</a>
to check if the user has permissions to perform the specific action, for
example deleting an InferenceService in a namespace.</p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Tip</h4>

    If you are port-forwarding the app via <strong>kubectl port-forward</strong> then you will
need to set <strong>APP_DISABLE_AUTH=&ldquo;True&rdquo;</strong> in the web app&rsquo;s Deployment. When
port-forwarding the authentication header will not be set, which will result in the
web app raising <strong>401</strong> errors.

</div>

<h3 id="namespace-selection">Namespace selection</h3>
<p>Both in <em>standalone</em> and in <em>kubeflow</em> setups the user needs to be able to
select a Namespace in order to interact with the InferenceServices in it.</p>
<p>In <em>standalone</em> mode the web app will show a dropdown that will show all the
namespaces to the user and allow them to select any of them. The backend will
make a LIST request to the API Server to get all the namespaces. In this case
the only authorization check that takes place is in the K8s API Server that
ensures the <a href="https://github.com/kserve/models-web-app/blob/release-0.7/config/base/rbac.yaml">web app Pod&rsquo;s
ServiceAccount</a>
has permissions to list namespaces.</p>
<p>In <em>kubeflow</em> mode the <a href="/docs/components/central-dash/overview/">Central
Dashboard</a> is responsible for the
Namespace selection. Once the user selects a namespace then the Dashboard will
inform the iframed Models web app about the newly selected namespace. The
Models web app itself won&rsquo;t expose a dropdown namespace selector in this mode.</p>
<h2 id="use-cases">Use Cases</h2>
<p>Currently users can do the following workflows via this web app:</p>
<ul>
<li>See a list of the existing InferenceService CRs in a Namespace</li>
<li>Create a new InferenceService by providing a YAML</li>
<li>Inspect an InferenceService
<ul>
<li>View the live status of the InferenceService</li>
<li>Inspect the K8s Conditions of the underlying Knative resources</li>
<li>View the logs of the created Model server Pod, for that InferenceService</li>
<li>Inspect the YAML contents as they are stored in the K8s API Server</li>
<li>View some basic metrics</li>
</ul>
</li>
</ul>
<h3 id="listing">Listing</h3>
<p>The main page of the app provides a list of all the InferenceServices that are
deployed in the selected Namespace. The frontend periodically polls the backend
for the latest state of InferenceServices.</p>
<img src="/docs/external-add-ons/kserve/pics/webapp-list.png" alt="Models web app main page">
<h3 id="creating">Creating</h3>
<p>The page for creating a new InferenceService. The user can paste the YAML
object of the InferenceService they wish to create.</p>
<p>Note that the backend will override the provided <code>.metadata.namespace</code> field of
the submitted object, to prevent users from trying to create InferenceServices
in other namespaces.</p>
<img src="/docs/external-add-ons/kserve/pics/webapp-new.png" alt="Models web app create page">
<h3 id="deleting">Deleting</h3>
<p>Users can delete an existing InferenceService by clicking on the
<i class="fas fa-trash"></i> icon next to an InferenceService, in the main page
that lists all the namespaced resources.</p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    The backend is using <a href="https://kubernetes.io/docs/concepts/workloads/controllers/garbage-collection/#foreground-cascading-deletion">foreground cascading
deletion</a>
when deleting an InferenceService. This means that the InferenceService CR will
be deleted from the K8s API Server only once the underlying resources have been
deleted.

</div>

<h3 id="inspecting">Inspecting</h3>
<p>Users can click on the name of an InferenceService, from the main page, and
view a more detailed summary of the CR&rsquo;s state. In this page users can inspect:</p>
<ol>
<li>The overview of the InferenceService&rsquo;s status (OVERVIEW)</li>
<li>A user friendly representation of the CR&rsquo;s spec (DETAILS)</li>
<li>Metrics from the underlying resources (METRICS)</li>
<li>Logs from the created Pods (LOGS)</li>
<li>The YAML file as is in the K8s API Server (YAML)</li>
</ol>
<img src="/docs/external-add-ons/kserve/pics/webapp-overview.png" alt="Models web app overview page">


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    <p>To gather the logs the backend will:</p>
<ol>
<li>Filter all the pods that have a <code>serving.knative.dev/revision</code> label</li>
<li>Get the logs from the <code>kserve-container</code></li>
</ol>


</div>

<h2 id="metrics">Metrics</h2>
<p>As mentioned in the above sections the web app allows users to inspect the
metrics from the InferenceService. This tab will <strong>not</strong> be enable by default.
In order to expose it the users will need to install Grafana and Prometheus.</p>
<p>Currently the frontend is expecting to find a Grafana exposed in the <code>/grafana</code>
prefix. This Grafana instance will need to have specific dashboards in order
for the app to embed them in iframes. We are working on making this more
generic to allow people to expose their own graphs.</p>
<p>You can install Grafana and Prometheus, for the web app to consume, by
installing</p>
<ol>
<li>the <code>monitoring-core.yaml</code> and
<code>monitoring-metrics-prometheus.yaml</code> files from the <a href="https://github.com/knative/serving/releases/tag/v0.18.0">Knative 0.18
release</a></li>
<li>the following yaml files for exposing Grafana outside the cluster, by
allowing <strong>anonymous access</strong></li>
</ol>
<ul class="nav nav-tabs" id="grafana-installation-yamls" role="tablist"><li class="nav-item"><a data-toggle="tab" class="nav-link active" href="#grafana-installation-yamls-0" role="tab" aria-controls="grafana-installation-yamls-0" aria-selected="true">ConfigMap</a></li>
	  
		<li class="nav-item"><a data-toggle="tab" class="nav-link" href="#grafana-installation-yamls-1" role="tab" aria-controls="grafana-installation-yamls-1">VirtualService</a></li>
		<li class="nav-item"><a data-toggle="tab" class="nav-link" href="#grafana-installation-yamls-2" role="tab" aria-controls="grafana-installation-yamls-2">AuthorizationPolicy</a></li></ul>
<div class="tab-content" id="grafana-installation-yamls"><div id="grafana-installation-yamls-0" class="tab-pane show active" role="tabpanel" aria-labelledby="grafana-installation-yamls-0">

<p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ConfigMap</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">grafana-custom-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">knative-monitoring</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">serving.knative.dev/release</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;v0.11.0&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">custom.ini</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">    # You can customize Grafana via changing the context of this field.
</span></span></span><span class="line"><span class="cl"><span class="sd">    [auth.anonymous]
</span></span></span><span class="line"><span class="cl"><span class="sd">    # enable anonymous access
</span></span></span><span class="line"><span class="cl"><span class="sd">    enabled = true
</span></span></span><span class="line"><span class="cl"><span class="sd">    [security]
</span></span></span><span class="line"><span class="cl"><span class="sd">    allow_embedding = true
</span></span></span><span class="line"><span class="cl"><span class="sd">    [server]
</span></span></span><span class="line"><span class="cl"><span class="sd">    root_url = &#34;/grafana&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">    serve_from_sub_path = true</span><span class="w">    
</span></span></span></code></pre></div></div>
  <div id="grafana-installation-yamls-1" class="tab-pane" role="tabpanel" aria-labelledby="grafana-installation-yamls-1">

<p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">networking.istio.io/v1alpha3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">VirtualService</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">grafana</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">knative-monitoring</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">gateways</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">kubeflow/kubeflow-gateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="s1">&#39;*&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">http</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">match</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">uri</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l">/grafana/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">route</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">destination</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">grafana.knative-monitoring.svc.cluster.local</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="m">30802</span><span class="w">
</span></span></span></code></pre></div></div>
  <div id="grafana-installation-yamls-2" class="tab-pane" role="tabpanel" aria-labelledby="grafana-installation-yamls-2">

<p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">security.istio.io/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">AuthorizationPolicy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">models-web-app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">kubeflow</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l">ALLOW</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">from</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">source</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">principals</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">cluster.local/ns/istio-system/sa/istio-ingressgateway-service-account</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">kustomize.component</span><span class="p">:</span><span class="w"> </span><span class="l">kserve-models-web-app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app.kubernetes.io/component</span><span class="p">:</span><span class="w"> </span><span class="l">kserve-models-web-app</span><span class="w">
</span></span></span></code></pre></div></div></div>



<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    If you installed the app in the <em>standalone</em> mode then you will need to instead
use the <strong>knative-serving/knative-ingress-gateway</strong> Ingress Gateway and deploy
the AuthorizationPolicy in the <strong>kserve</strong> namespace instead.

</div>

<p>After applying these YAMLs, based on your installation mode, and ensuring the
Grafana instance is exposed under <code>/grafana</code> the web app will show the
<code>METRICS</code> tab.</p>
<img src="/docs/external-add-ons/kserve/pics/webapp-metrics.png" alt="Models web app metrics page">
<h2 id="configurations">Configurations</h2>
<p>The following is a list of ENV var that can configure different aspects of the
application.</p>
<table>
<thead>
<tr>
<th>ENV Var</th>
<th>Default value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>APP_PREFIX</td>
<td>&ldquo;/models&rdquo;</td>
<td>Controls the app&rsquo;s prefix, by setting the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base">base-url</a> element</td>
</tr>
<tr>
<td>APP_DISABLE_AUTH</td>
<td>&ldquo;False&rdquo;</td>
<td>Controls whether the app should use SubjectAccessReviews to ensure the user is authorized to perform an action</td>
</tr>
<tr>
<td>APP_SECURE_COOKIES</td>
<td>&ldquo;True&rdquo;</td>
<td>Controls whether the app should use <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie#Secure">Secure</a> CSRF cookies. By default the app expects to be exposed with https</td>
</tr>
<tr>
<td>CSRF_SAMESITE</td>
<td>&ldquo;Strict&rdquo;</td>
<td>Controls the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie#SameSite">SameSite value</a> of the CSRF cookie</td>
</tr>
<tr>
<td>USERID_HEADER</td>
<td>&ldquo;kubeflow-userid&rdquo;</td>
<td>Header in each request that will contain the username of the logged in user</td>
</tr>
<tr>
<td>USERID_PREFIX</td>
<td>&quot;&quot;</td>
<td>Prefix to remove from the <code>USERID_HEADER</code> value to extract the logged in user name</td>
</tr>
</tbody>
</table>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ec2ce5b333fb900fdc270d79e3d82c1b">4 - Run your first InferenceService</h1>
    <div class="lead">A tutorial on building and deploying a model using the KServe Python SDK</div>
	<!--
AUTOGENERATED FROM content/en/docs/external-add-ons/kserve/first_isvc_kserve.ipynb
PLEASE UPDATE THE JUPYTER NOTEBOOK AND REGENERATE THIS FILE USING scripts/nb_to_md.py.-->
<style>
.notebook-links {display: flex; margin: 1em 0;}
.notebook-links a {padding: .75em; margin-right: .75em; font-weight: bold;}
a.colab-link {
padding-left: 3.25em;
background-image: url(/docs/images/logos/colab.ico);
background-repeat: no-repeat;
background-size: contain;
}
a.github-link {
padding-left: 2.75em;
background-image: url(/docs/images/logos/github.png);
background-repeat: no-repeat;
background-size: auto 75%;
background-position: left center;
}
</style>
<div class="notebook-links">
<a class="colab-link" href="https://colab.research.google.com/github/kubeflow/website/blob/master/content/en/docs/external-add-ons/kserve/first_isvc_kserve.ipynb">Run in Google Colab</a>
<a class="github-link" href="https://github.com/kubeflow/website/blob/master/content/en/docs/external-add-ons/kserve/first_isvc_kserve.ipynb">View source on GitHub</a>
</div>
<p>The InferenceService custom resource is the primary interface that is used for deploying models on KServe. Inside an InferenceService, users can specify multiple
components that are used for handling inference requests. These components are the predictor, transformer, and explainer. Learn more <a href="https://kserve.github.io/website/0.7/modelserving/data_plane/">here</a>.</p>
<p>In this tutorial, you will deploy an InferenceService with a predictor that will load a scikit-learn model trained with the <a href="https://archive.ics.uci.edu/ml/datasets/iris">iris</a> dataset.
This dataset has three output class: Iris Setosa, Iris Versicolour, and Iris Virginica.</p>
<p>You will then send an inference request to your deployed model in order to get a prediction for the class of iris plant your request corresponds to.</p>
<h2 id="before-you-begin">Before you begin</h2>
<p>First, install the KServe SDK using the following command. If you run this command in a Jupyter notebook, restart the kernel after installing the SDK.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">kserve</span><span class="o">==</span><span class="mf">0.7.0</span>
</span></span></code></pre></div><h2 id="import-kubernetesclient-and-kserve-packages">Import <code>kubernetes.client</code> and <code>kserve</code> packages</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">kubernetes</span> <span class="kn">import</span> <span class="n">client</span> 
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">kserve</span> <span class="kn">import</span> <span class="n">KServeClient</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">kserve</span> <span class="kn">import</span> <span class="n">constants</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">kserve</span> <span class="kn">import</span> <span class="n">utils</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">kserve</span> <span class="kn">import</span> <span class="n">V1beta1InferenceService</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">kserve</span> <span class="kn">import</span> <span class="n">V1beta1InferenceServiceSpec</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">kserve</span> <span class="kn">import</span> <span class="n">V1beta1PredictorSpec</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">kserve</span> <span class="kn">import</span> <span class="n">V1beta1SKLearnSpec</span>
</span></span></code></pre></div><h2 id="declare-namespace">Declare Namespace</h2>
<p>This will retrieve the current namespace of your Kubernetes context. The InferenceService will be deployed in this namespace.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">namespace</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_default_target_namespace</span><span class="p">()</span>
</span></span></code></pre></div><h2 id="define-inferenceservice">Define InferenceService</h2>
<p>Next, define the InferenceService based on several key parameters. In the <code>predictor</code> parameter, a <code>V1beta1PredictorSpec</code> object with an embedded <code>V1beta1SKLearnSpec</code> object is created.
Inside the <code>V1beta1SKLearnSpec</code> object, a storage URI is provided, pointing to the location of the trained iris model in cloud storage.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">name</span><span class="o">=</span><span class="s1">&#39;sklearn-iris&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">kserve_version</span><span class="o">=</span><span class="s1">&#39;v1beta1&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">api_version</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">KSERVE_GROUP</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">kserve_version</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">isvc</span> <span class="o">=</span> <span class="n">V1beta1InferenceService</span><span class="p">(</span><span class="n">api_version</span><span class="o">=</span><span class="n">api_version</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                               <span class="n">kind</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">KSERVE_KIND</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                               <span class="n">metadata</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">V1ObjectMeta</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                                   <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">,</span> <span class="n">annotations</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sidecar.istio.io/inject&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">}),</span>
</span></span><span class="line"><span class="cl">                               <span class="n">spec</span><span class="o">=</span><span class="n">V1beta1InferenceServiceSpec</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                               <span class="n">predictor</span><span class="o">=</span><span class="n">V1beta1PredictorSpec</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                               <span class="n">sklearn</span><span class="o">=</span><span class="p">(</span><span class="n">V1beta1SKLearnSpec</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                                   <span class="n">storage_uri</span><span class="o">=</span><span class="s2">&#34;gs://kfserving-samples/models/sklearn/iris&#34;</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></div><h2 id="create-inferenceservice">Create InferenceService</h2>
<p>Now, with the InferenceService defined, you can now create it by calling the <code>create</code> method of the <code>KServeClient</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">KServe</span> <span class="o">=</span> <span class="n">KServeClient</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">KServe</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">isvc</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="check-the-inferenceservice">Check the InferenceService</h2>
<p>Run the following command to watch the InferenceService until it is ready (or times out).</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">KServe</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">,</span> <span class="n">watch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timeout_seconds</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="perform-inference">Perform Inference</h2>
<p>Next, you can try sending an inference request to the deployed model in order to get predictions. This notebook assumes that you running
it in your Kubeflow cluster and will use the internal URL of the InferenceService.</p>
<p>The Python <code>requests</code> library will be used to send a POST request containing your payload.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">isvc_resp</span> <span class="o">=</span> <span class="n">KServe</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">isvc_url</span> <span class="o">=</span> <span class="n">isvc_resp</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">][</span><span class="s1">&#39;address&#39;</span><span class="p">][</span><span class="s1">&#39;url&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">isvc_url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">inference_input</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;instances&#39;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">[</span><span class="mf">6.8</span><span class="p">,</span>  <span class="mf">2.8</span><span class="p">,</span>  <span class="mf">4.8</span><span class="p">,</span>  <span class="mf">1.4</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="p">[</span><span class="mf">6.0</span><span class="p">,</span>  <span class="mf">3.4</span><span class="p">,</span>  <span class="mf">4.5</span><span class="p">,</span>  <span class="mf">1.6</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">isvc_url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">inference_input</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span></code></pre></div><p>You should see two predictions returned (i.e. <code>{&quot;predictions&quot;: [1, 1]}</code>). Both sets of data points sent for inference correspond to the flower with index <code>1</code>.
In this case, the model predicts that both flowers are &ldquo;Iris Versicolour&rdquo;.</p>
<p>To learn more about sending inference requests, please check out the <a href="https://kserve.github.io/website/0.7/get_started/first_isvc/#3-determine-the-ingress-ip-and-ports">KServe guide</a>.</p>
<h2 id="run-performance-test-optional">Run Performance Test (Optional)</h2>
<p>If you want to load test the deployed model, try deploying the Kubernetes Job to drive load to the InferenceService.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">kubectl</span> <span class="n">create</span> <span class="o">-</span><span class="n">f</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">raw</span><span class="o">.</span><span class="n">githubusercontent</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">kserve</span><span class="o">/</span><span class="n">kserve</span><span class="o">/</span><span class="n">release</span><span class="o">-</span><span class="mf">0.7</span><span class="o">/</span><span class="n">docs</span><span class="o">/</span><span class="n">samples</span><span class="o">/</span><span class="n">v1beta1</span><span class="o">/</span><span class="n">sklearn</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">perf</span><span class="o">.</span><span class="n">yaml</span> <span class="o">-</span><span class="n">n</span> <span class="n">kubeflow</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">example</span><span class="o">-</span><span class="n">com</span>
</span></span></code></pre></div><h3 id="get-job-name">Get Job Name</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">kubectl</span> <span class="n">get</span> <span class="n">pods</span> <span class="o">--</span><span class="n">namespace</span><span class="o">=</span><span class="n">kubeflow</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">example</span><span class="o">-</span><span class="n">com</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">load</span>
</span></span></code></pre></div><h3 id="check-the-job-logs">Check the Job Logs</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">kubectl</span> <span class="n">logs</span> <span class="o">&lt;</span><span class="n">job</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">n</span> <span class="n">kubeflow</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">example</span><span class="o">-</span><span class="n">com</span>
</span></span></code></pre></div><p>The output should look like similar to the following:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Requests      [total, rate, throughput]         30000, 500.02, 499.99
</span></span><span class="line"><span class="cl">Duration      [total, attack, wait]             1m0s, 59.998s, 3.336ms
</span></span><span class="line"><span class="cl">Latencies     [min, mean, 50, 90, 95, 99, max]  1.743ms, 2.748ms, 2.494ms, 3.363ms, 4.091ms, 7.749ms, 46.354ms
</span></span><span class="line"><span class="cl">Bytes In      [total, mean]                     690000, 23.00
</span></span><span class="line"><span class="cl">Bytes Out     [total, mean]                     2460000, 82.00
</span></span><span class="line"><span class="cl">Success       [ratio]                           100.00%
</span></span><span class="line"><span class="cl">Status Codes  [code:count]                      200:30000
</span></span><span class="line"><span class="cl">Error Set:
</span></span></code></pre></div><h2 id="delete-inferenceservice">Delete InferenceService</h2>
<p>When you are done with your InferenceService, you can delete it by running the following.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">KServe</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="next-steps">Next Steps</h2>
<p><a href="https://github.com/kubeflow/pipelines/blob/sdk/release-1.8/samples/contrib/kubeflow-e2e-mnist/kubeflow-e2e-mnist.ipynb"><strong>Kubeflow Pipelines E2E MNIST Tutorial</strong></a> - provides an end-to-end test sequence (i.e. start a notebook, run a pipeline, execute training, hyperparameter tuning, and model serving with KServe).</p>
<div class="notebook-links">
<a class="colab-link" href="https://colab.research.google.com/github/kubeflow/website/blob/master/content/en/docs/external-add-ons/kserve/first_isvc_kserve.ipynb">Run in Google Colab</a>
<a class="github-link" href="https://github.com/kubeflow/website/blob/master/content/en/docs/external-add-ons/kserve/first_isvc_kserve.ipynb">View source on GitHub</a>
</div>
</div>



    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark pt-3 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Kubeflow mailing list" aria-label="Kubeflow mailing list">
    <a class="text-white" target="_blank" rel="noopener" href="https://www.kubeflow.org/docs/about/community/#kubeflow-mailing-list" aria-label="Kubeflow mailing list">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-white" target="_blank" rel="noopener" href="https://twitter.com/kubeflow" aria-label="Twitter">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Stack Overflow" aria-label="Stack Overflow">
    <a class="text-white" target="_blank" rel="noopener" href="https://stackoverflow.com/questions/tagged/kubeflow" aria-label="Stack Overflow">
      <i class="fab fa-stack-overflow"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/GoogleCloudPlatform/kubeflow-distribution" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-white" target="_blank" rel="noopener" href="https://www.kubeflow.org/docs/about/community/#kubeflow-slack" aria-label="Slack">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Kubeflow community calendar" aria-label="Kubeflow community calendar">
    <a class="text-white" target="_blank" rel="noopener" href="https://www.kubeflow.org/docs/about/community/#kubeflow-community-calendars" aria-label="Kubeflow community calendar">
      <i class="fa fa-calendar"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-5 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2022 Google | Documentation Distributed under CC BY 4.0</small>
        <p><small class="ml-1"><a href="https://policies.google.com/privacy" target="_blank" rel="noopener">Privacy Policy</a></small></p>
	
		<p class="mt-2"><a href="/kubeflow-docs/docs/about/">About</a></p>
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="/kubeflow-docs/js/main.min.301c0110334bec1b4445867d27dc7dd69b2df859154ccf252005508bc860cc5a.js" integrity="sha256-MBwBEDNL7BtERYZ9J9x91pst&#43;FkVTM8lIAVQi8hgzFo=" crossorigin="anonymous"></script>
<script src='/kubeflow-docs/js/tabpane-persist.js'></script>

  </body>
</html>

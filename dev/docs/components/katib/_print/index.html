<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.105.0">
<link rel="canonical" type="text/html" href="https://gkcalat.github.io/kubeflow-docs/docs/components/katib/">
<link rel="alternate" type="application/rss&#43;xml" href="https://gkcalat.github.io/kubeflow-docs/docs/components/katib/index.xml">
<meta name="robots" content="noindex, nofollow">

<script type="application/ld+json">
  {
      "@context" : "http://schema.org",
      "@type" : "WebSite",
      "mainEntityOfPage": {
           "@type": "WebPage",
           "@id": "https:\/\/gkcalat.github.io\/kubeflow-docs"
      },
      "articleSection" : "docs",
      "name" : "Katib",
      "headline" : "Katib",
      "description" : "Documentation for Kubeflow Katib",
      "inLanguage" : "en-US",
      "author" : "",
      "creator" : "",
      "publisher": "",
      "accountablePerson" : "",
      "copyrightHolder" : "",
      "copyrightYear" : "0001",
      "datePublished": "0001-01-01 00:00:00 \u002b0000 UTC",
      "dateModified" : "0001-01-01 00:00:00 \u002b0000 UTC",
      "url" : "https:\/\/gkcalat.github.io\/kubeflow-docs\/docs\/components\/katib\/",
      "wordCount" : "0",
      "keywords" : [ "Kubeflow" ]
  }
  </script>

<link rel="shortcut icon" href="/kubeflow-docs/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/kubeflow-docs/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/kubeflow-docs/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/kubeflow-docs/favicons/favicon-32x32.png" sizes="32x32">
<link rel="manifest" href="/kubeflow-docs/favicons/manifest.json">
<meta name="msapplication-config" content="/kubeflow-docs/favicons/browserconfig.xml" />
<meta name="msapplication-TileColor" content="#4279f4">
<meta name="theme-color" content="#4279f4">

<title>Katib | Kubeflow on Google Cloud Platform</title>
<meta name="description" content="Documentation for Kubeflow Katib">
<meta property="og:title" content="Katib" />
<meta property="og:description" content="Documentation for Kubeflow Katib" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://gkcalat.github.io/kubeflow-docs/docs/components/katib/" /><meta property="og:site_name" content="Kubeflow on Google Cloud Platform" />

<meta itemprop="name" content="Katib">
<meta itemprop="description" content="Documentation for Kubeflow Katib"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Katib"/>
<meta name="twitter:description" content="Documentation for Kubeflow Katib"/>




<link rel="preload" href="/kubeflow-docs/scss/main.min.5006b434b14f73c3d5537a7ba4c8ecef723ddc93f3a3c8530e19d24f75486ea9.css" as="style">
<link href="/kubeflow-docs/scss/main.min.5006b434b14f73c3d5537a7ba4c8ecef723ddc93f3a3c8530e19d24f75486ea9.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-GK9XL47N6S"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-GK9XL47N6S', { 'anonymize_ip': false });
}
</script>

  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand-md navbar-dark  td-navbar">
        <a class="navbar-brand" href="/kubeflow-docs/">
		<span class="navbar-logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 276.93 274.55"><g data-name="Layer 2"><g data-name="Layer 1"><path d="M95.9 62.15l4.1 102.1 73.75-94.12a6.79 6.79.0 019.6-1.11l46 36.92-15-65.61z" fill="#4279f4"/><path fill="#0028aa" d="M102.55 182.98h65.42l-40.17-32.23-25.25 32.23z"/><path fill="#014bd1" d="M180.18 83.92l-44 56.14 46.88 37.61 44.47-55.76-47.35-37.99z"/><path fill="#bedcff" d="M83.56 52.3l.01-.01 38.69-48.52-62.39 30.05-15.41 67.51 39.1-49.03z"/><path fill="#6ca1ff" d="M45.32 122.05l41.44 51.96-3.95-98.98-37.49 47.02z"/><path fill="#a1c3ff" d="M202.31 28.73 142.65.0l-37.13 46.56 96.79-17.83z"/><path d="M1.6 272v-44.78h5.74v23.41l20.48-23.41h6.4l-17.39 19.7 19 25.07H29.1l-15.92-20.8-5.84 6.65V272zm40.02-9.79V240h5.43v22.39a4.67 4.67.0 002.35 4.19 11 11 0 0011 0 4.69 4.69.0 002.33-4.19V240h5.43v22.19a9.08 9.08.0 01-4.1 7.87 16.2 16.2.0 01-18.37.0 9.07 9.07.0 01-4.07-7.85zM77.46 272v-48h5.43v16.81a29.29 29.29.0 019.32-1.73 13.1 13.1.0 016.2 1.41 10.71 10.71.0 014.18 3.74 18.07 18.07.0 012.23 5.06 21.26 21.26.0 01.73 5.58q0 8.43-4.38 12.79T87.35 272zm5.43-4.87h4.55q6.77.0 9.72-2.95t3-9.51a14.21 14.21.0 00-2-7.52 6.55 6.55.0 00-6-3.22 24.73 24.73.0 00-9.25 1.54zm29.47-11.19q0-7.71 4.09-12.3a13.75 13.75.0 0110.8-4.59q13.35.0 13.36 18.86h-22.82a12.3 12.3.0 002.9 7.07q2.59 3.11 7.9 3.1a24.92 24.92.0 0010.55-2v5a27.74 27.74.0 01-9.86 1.87 19.83 19.83.0 01-7.7-1.37 13.31 13.31.0 01-5.28-3.76 16.21 16.21.0 01-3-5.38 20.84 20.84.0 01-.94-6.5zm5.62-2.12h17.26a14.91 14.91.0 00-2.37-7.12 6.44 6.44.0 00-5.62-2.78 8.2 8.2.0 00-6.21 2.72 12.07 12.07.0 00-3.04 7.18z" fill="#4279f4" stroke="#4279f4" stroke-miterlimit="10" stroke-width="3.2"/><path d="M147.32 244.89V240h5v-7.59a8.14 8.14.0 012.31-6.05 7.79 7.79.0 015.69-2.28h7.86V229h-5c-2.21.0-3.67.45-4.37 1.34s-1.06 2.55-1.06 5V240h8.46v4.87h-8.46V272h-5.44v-27.1zM175.26 272v-48h5.43v48zm19.15-3.95a17.86 17.86.0 1112.33 4.9 16.57 16.57.0 01-12.33-4.9zm3.84-20.65a13.16 13.16.0 000 17.2 12.07 12.07.0 0017 0 13.09 13.09.0 000-17.2 12.07 12.07.0 00-17 0zm30.2-7.4h5.75l7.3 25.32 7.43-25.32h5.36l7.34 25.34L269 240h5.74l-10.04 32h-6.12l-6.83-24.58L245 272h-6.47z" fill="#0028aa" stroke="#0028aa" stroke-miterlimit="10" stroke-width="3.2"/></g></g></svg></span><span class="text-uppercase font-weight-bold">Kubeflow on Google Cloud Platform</span>
	</a>
	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main_navbar" aria-controls="main_navbar" aria-expanded="false" aria-label="Toggle navigation">
		<span class="navbar-toggler-icon"></span>
	</button>
	<div class="collapse navbar-collapse ml-md-auto" id="main_navbar">
		<ul class="navbar-nav ml-auto pt-4 pt-md-0 my-2 my-md-1">
			
			
			<li class="nav-item mr-2 mr-lg-4 mt-1 mt-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/kubeflow-docs/docs/" ><span>Docs</span></a>
			</li>
			
			<li class="nav-item mr-2 mr-lg-4 mt-1 mt-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/kubeflow-docs/news/" ><span>News</span></a>
			</li>
			
			<li class="nav-item mr-2 mr-lg-4 mt-1 mt-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="https://github.com/GoogleCloudPlatform/kubeflow-distribution" target="_blank" ><i class='fa-brands fa-github pr-2'></i><span>Source</span></a>
			</li>
			
			
			<li class="nav-item dropdown mt-1 mt-lg-0 mr-2">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	Releases
</a>
<div class="dropdown-menu dropdown-menu-md-right dropdown-menu-lg-left" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/v1.6-release/docs">latest</a>
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/v1.6-release/docs">v1.6</a>
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/v1.5-release/docs">v1.5</a>
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/v1.4-release/docs">v1.4</a>
	
	<a class="dropdown-item" href="https://gkcalat.github.io/kubeflow-docs/main/docs">dev</a>
	
</div>

			</li>
			
			
		</ul>
	</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/kubeflow-docs/docs/components/katib/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Katib</h1>
<div class="lead">Documentation for Kubeflow Katib</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-00f61fe76ea63c90c498a3519d9a26a7">Introduction to Katib</a></li>


    
  
    
    
	
<li>2: <a href="#pg-0884c858a705c182d2436896e0bef13e">Getting Started with Katib</a></li>


    
  
    
    
	
<li>3: <a href="#pg-7f397238fac71de59685256a78cd9f76">Running an Experiment</a></li>


    
  
    
    
	
<li>4: <a href="#pg-bfd3194b361e71038ee054637a0a8043">Resuming an Experiment</a></li>


    
  
    
    
	
<li>5: <a href="#pg-ae840460e289e0593ca27a1274d3e948">Overview of Trial Templates</a></li>


    
  
    
    
	
<li>6: <a href="#pg-b80a2e37cea35fb836557e60f56f4ce2">Using Early Stopping</a></li>


    
  
    
    
	
<li>7: <a href="#pg-51e1645fcfdf30aa149835216f6f8cd0">Katib Configuration Overview</a></li>


    
  
    
    
	
<li>8: <a href="#pg-cffe32d69412f2ff2bd13ff9e8bcea7f">Environment Variables for Katib Components</a></li>


    
  

    </ul>


<div class="content">
      
</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-00f61fe76ea63c90c498a3519d9a26a7">1 - Introduction to Katib</h1>
    <div class="lead">Overview of Katib for hyperparameter tuning and neural architecture search</div>
	<div class="alert alert-warning" role="alert">
  <h4 class="alert-heading">Beta</h4>
  This Kubeflow component has <b>beta</b> status. See the
  <a href="/docs/started/support/#application-status">Kubeflow versioning policies</a>.
  The Kubeflow team is interested in your   
  <a href="https://github.com/kubeflow/katib/issues">feedback</a></h4> 
  about the usability of the feature.
</div>
<p>This guide introduces the concepts of hyperparameter tuning, neural
architecture search, and the Katib system as a component of Kubeflow.</p>
<p>Katib is a Kubernetes-native project for automated machine learning (AutoML).
Katib supports hyperparameter tuning, early stopping and
neural architecture search (NAS).
Learn more about AutoML at <a href="https://www.fast.ai/2018/07/16/auto-ml2/">fast.ai</a>,
<a href="https://cloud.google.com/automl">Google Cloud</a>,
<a href="https://docs.microsoft.com/en-us/azure/machine-learning/concept-automated-ml#automl-in-azure-machine-learning">Microsoft Azure</a> or
<a href="https://aws.amazon.com/blogs/aws/amazon-sagemaker-autopilot-fully-managed-automatic-machine-learning/">Amazon SageMaker</a>.</p>
<p>Katib is the project which is agnostic to machine learning (ML) frameworks.
It can tune hyperparameters of applications written in any language
of the users&rsquo; choice and natively supports many ML frameworks,
such as TensorFlow, MXNet, PyTorch, XGBoost, and others.</p>
<p>Katib supports a lot of various AutoML algorithms, such as
<a href="https://arxiv.org/pdf/1012.2599.pdf">Bayesian optimization</a>,
<a href="https://papers.nips.cc/paper/2011/file/86e8f7ab32cfd12577bc2619bc635690-Paper.pdf">Tree of Parzen Estimators</a>,
<a href="https://en.wikipedia.org/wiki/Hyperparameter_optimization#Random_search">Random Search</a>,
<a href="https://en.wikipedia.org/wiki/CMA-ES">Covariance Matrix Adaptation Evolution Strategy</a>,
<a href="https://arxiv.org/pdf/1603.06560.pdf">Hyperband</a>,
<a href="https://arxiv.org/abs/1802.03268">Efficient Neural Architecture Search</a>,
<a href="https://arxiv.org/abs/1806.09055">Differentiable Architecture Search</a>
and many more. Additional algorithm support is coming soon.</p>
<p>The <a href="https://github.com/kubeflow/katib">Katib project</a> is open source.
The <a href="https://github.com/kubeflow/katib/blob/master/docs/developer-guide.md">developer guide</a>
is a good starting point for developers who want to contribute to the project.</p>
<h2 id="hyperparameters-and-hyperparameter-tuning">Hyperparameters and hyperparameter tuning</h2>
<p><em>Hyperparameters</em> are the variables that control the model training process.
They include:</p>
<ul>
<li>The learning rate.</li>
<li>The number of layers in a neural network.</li>
<li>The number of nodes in each layer.</li>
</ul>
<p>Hyperparameter values are not <em>learned</em>. In other words, in contrast to the
node weights and other training <em>parameters</em>, the model training process does
not adjust the hyperparameter values.</p>
<p><em>Hyperparameter tuning</em> is the process of optimizing the hyperparameter values
to maximize the predictive accuracy of the model. If you don&rsquo;t use Katib or a
similar system for hyperparameter tuning, you need to run many training jobs
yourself, manually adjusting the hyperparameters to find the optimal values.</p>
<p>Automated hyperparameter tuning works by optimizing a target variable,
also called the <em>objective metric</em>, that you specify in the configuration for
the hyperparameter tuning job. A common metric is the model&rsquo;s accuracy
in the validation pass of the training job (<em>validation-accuracy</em>). You also
specify whether you want the hyperparameter tuning job to <em>maximize</em> or
<em>minimize</em> the metric.</p>
<p>For example, the following graph from Katib shows the level of validation accuracy
for various combinations of hyperparameter values (the learning rate, the number of
layers, and the optimizer):</p>
<p><img src="/docs/components/katib/images/random-example-graph.png"
alt="Graph produced by the random example"
class="mt-3 mb-3 border border-info rounded"></p>
<p><em>(To run the example that produced this graph, follow the <a href="/docs/components/katib/hyperparameter/">getting-started
guide</a>.)</em></p>
<p>Katib runs several training jobs (known as <em>trials</em>) within each
hyperparameter tuning job (<em>experiment</em>). Each trial tests a different set of
hyperparameter configurations. At the end of the experiment, Katib outputs
the optimized values for the hyperparameters.</p>
<p>You can improve your hyperparameter tunning experiments by using
<a href="https://en.wikipedia.org/wiki/Early_stopping">early stopping</a> techniques.
Follow the <a href="/docs/components/katib/early-stopping/">early stopping guide</a>
for the details.</p>
<h2 id="neural-architecture-search">Neural architecture search</h2>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Alpha version</h4>

    NAS is currently in <b>alpha</b> with limited support. The Kubeflow team is
interested in any feedback you may have, in particular with regards to usability
of the feature. You can log issues and comments in
the <a href="https://github.com/kubeflow/katib/issues">Katib issue tracker</a>.

</div>

<p>In addition to hyperparameter tuning, Katib offers a <em>neural architecture
search</em> feature. You can use the NAS to design
your artificial neural network, with a goal of maximizing the predictive
accuracy and performance of your model.</p>
<p>NAS is closely related to hyperparameter tuning. Both are subsets of AutoML.
While hyperparameter tuning optimizes the model&rsquo;s hyperparameters, a NAS system
optimizes the model&rsquo;s structure, node weights and hyperparameters.</p>
<p>NAS technology in general uses various techniques to find the optimal neural
network design.</p>
<p>You can submit Katib jobs from the command line or from the UI. (Learn more
about the Katib interfaces later on this page.) The following screenshot shows
part of the form for submitting a NAS job from the Katib UI:</p>
<p><img src="/docs/components/katib/images/nas-parameters.png"
alt="Submitting a neural architecture search from the Katib UI"
class="mt-3 mb-3 border border-info rounded"></p>
<h2 id="katib-interfaces">Katib interfaces</h2>
<p>You can use the following interfaces to interact with Katib:</p>
<ul>
<li>
<p>A web UI that you can use to submit experiments and to monitor your results.
Check the <a href="/docs/components/katib/hyperparameter/#katib-ui">getting-started
guide</a>
for information on how to access the UI.
The Katib home page within Kubeflow looks like this:</p>
<p><img src="/docs/components/katib/images/home-page.png"
alt="The Katib home page within the Kubeflow UI"
class="mt-3 mb-3 border border-info rounded"></p>
</li>
<li>
<p>A gRPC API. Check the <a href="https://github.com/kubeflow/katib/blob/master/pkg/apis/manager/v1beta1/gen-doc/api.md">API reference on GitHub</a>.</p>
</li>
<li>
<p>Command-line interfaces (CLIs):</p>
<ul>
<li>The Kubernetes CLI, <strong>kubectl</strong>, is useful for running commands against your
Kubeflow cluster. Learn about kubectl in the <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">Kubernetes
documentation</a>.</li>
</ul>
</li>
<li>
<p>Katib Python SDK. Check the <a href="https://github.com/kubeflow/katib/tree/master/sdk/python/v1beta1">Katib Python SDK documentation on GitHub</a>.</p>
</li>
</ul>
<h2 id="katib-concepts">Katib concepts</h2>
<p>This section describes the terms used in Katib.</p>
<h3 id="experiment">Experiment</h3>
<p>An <em>experiment</em> is a single tuning run, also called an optimization run.</p>
<p>You specify configuration settings to define the experiment. The following are
the main configurations:</p>
<ul>
<li>
<p><strong>Objective</strong>: What you want to optimize. This is the objective metric, also
called the target variable. A common metric is the model&rsquo;s accuracy
in the validation pass of the training job (<em>validation-accuracy</em>). You also
specify whether you want the hyperparameter tuning job to <em>maximize</em> or
<em>minimize</em> the metric.</p>
</li>
<li>
<p><strong>Search space</strong>: The set of all possible hyperparameter values that the
hyperparameter tuning job should consider for optimization, and the
constraints for each hyperparameter. Other names for search space include
<em>feasible set</em> and <em>solution space</em>. For example, you may provide the
names of the hyperparameters that you want to optimize. For each
hyperparameter, you may provide a <em>minimum</em> and <em>maximum</em> value or a <em>list</em>
of allowable values.</p>
</li>
<li>
<p><strong>Search algorithm</strong>: The algorithm to use when searching for the optimal
hyperparameter values.</p>
</li>
</ul>
<p>Katib experiment is defined as a
<a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/">Kubernetes CRD</a> .</p>
<p>For details of how to define your experiment, follow the guide to <a href="/docs/components/katib/experiment/">running an
experiment</a>.</p>
<h3 id="suggestion">Suggestion</h3>
<p>A <em>suggestion</em> is a set of hyperparameter values that the hyperparameter
tuning process has proposed. Katib creates a trial to evaluate the suggested
set of values.</p>
<p>Katib suggestion is defined as a
<a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/">Kubernetes CRD</a> .</p>
<h3 id="trial">Trial</h3>
<p>A <em>trial</em> is one iteration of the hyperparameter tuning process. A trial
corresponds to one worker job instance with a list of parameter assignments.
The list of parameter assignments corresponds to a suggestion.</p>
<p>Each experiment runs several trials. The experiment runs the trials until it
reaches either the objective or the configured maximum number of trials.</p>
<p>Katib trial is defined as a
<a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/">Kubernetes CRD</a> .</p>
<h3 id="worker-job">Worker job</h3>
<p>The <em>worker job</em> is the process that runs to evaluate a trial and calculate
its objective value.</p>
<p>The worker job can be any type of Kubernetes resource or
<a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/">Kubernetes CRD</a>.
Follow the
<a href="/docs/components/katib/trial-template/#custom-resource">trial template guide</a>
to check how to support your own Kubernetes resource in Katib.</p>
<p>Katib has these CRD examples in upstream:</p>
<ul>
<li>
<p><a href="https://kubernetes.io/docs/concepts/workloads/controllers/job/">Kubernetes <code>Job</code></a></p>
</li>
<li>
<p><a href="/docs/components/training/tftraining/">Kubeflow <code>TFJob</code></a></p>
</li>
<li>
<p><a href="/docs/components/training/pytorch/">Kubeflow <code>PyTorchJob</code></a></p>
</li>
<li>
<p><a href="/docs/components/training/mxnet">Kubeflow <code>MXJob</code></a></p>
</li>
<li>
<p><a href="/docs/components/training/xgboost">Kubeflow <code>XGBoostJob</code></a></p>
</li>
<li>
<p><a href="/docs/components/training/mpi">Kubeflow <code>MPIJob</code></a></p>
</li>
<li>
<p><a href="https://github.com/kubeflow/katib/tree/master/examples/v1beta1/tekton">Tekton <code>Pipelines</code></a></p>
</li>
<li>
<p><a href="https://github.com/kubeflow/katib/tree/master/examples/v1beta1/argo">Argo <code>Workflows</code></a></p>
</li>
</ul>
<p>By offering the above worker job types, Katib supports multiple ML frameworks.</p>
<h2 id="next-steps">Next steps</h2>
<p>Follow the <a href="/docs/components/katib/hyperparameter/">getting-started guide</a>
to set up Katib and run some hyperparameter tuning examples.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-0884c858a705c182d2436896e0bef13e">2 - Getting Started with Katib</h1>
    <div class="lead">How to set up Katib and perform hyperparameter tuning</div>
	<p>This guide shows how to get started with Katib and run a few examples using the
command line and the Katib user interface (UI) to perform hyperparameter tuning.</p>
<p>For an overview of the concepts around Katib and hyperparameter tuning, check the
<a href="/docs/components/katib/overview/">introduction to Katib</a>.</p>
<h2 id="katib-setup">Katib setup</h2>
<p>Let&rsquo;s set up and configure Katib on your Kubernetes cluster with Kubeflow.</p>
<h3 id="prerequisites">Prerequisites</h3>
<p>This is the minimal requirements to install Katib:</p>
<ul>
<li>Kubernetes &gt;= 1.17</li>
<li><code>kubectl</code> &gt;= 1.21</li>
</ul>
<p><a id="katib-install"></a></p>
<h3 id="installing-katib">Installing Katib</h3>
<p>You can skip this step if you have already installed Kubeflow. Your Kubeflow
deployment includes Katib.</p>
<p>To install Katib as part of Kubeflow, follow the
<a href="/docs/started/getting-started/">Kubeflow installation guide</a>.</p>
<p>If you want to install Katib separately from Kubeflow, or to get a later version
of Katib, you can use one of the following Katib installs. To install the specific
Katib release (e.g. <code>v0.11.1</code>), modify <code>ref=master</code> to <code>ref=v0.11.1</code>.</p>
<ol>
<li>
<p><strong>Katib Standalone Installation</strong></p>
<p>There are two ways to install Katib by standalone,
both of which do not require any additional setup on your Kubernetes cluster.</p>
<ol>
<li>
<p><strong>Basic Installation</strong></p>
<p>Run the following command to deploy Katib with the main components
(<code>katib-controller</code>, <code>katib-ui</code>, <code>katib-mysql</code>, <code>katib-db-manager</code>, and <code>katib-cert-generator</code>):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl apply -k <span class="s2">&#34;github.com/kubeflow/katib.git/manifests/v1beta1/installs/katib-standalone?ref=master&#34;</span>
</span></span></code></pre></div></li>
<li>
<p><strong>Controller Leader Election Support</strong></p>
<p>Run the following command to deploy Katib with Controller
<a href="https://kubernetes.io/blog/2016/01/simple-leader-election-with-kubernetes/">Leader Election</a>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl apply -k <span class="s2">&#34;github.com/kubeflow/katib.git/manifests/v1beta1/installs/katib-leader-election?ref=master&#34;</span>
</span></span></code></pre></div><p>This installation is almost the same as <code>Basic Installation</code>,
although you can make <code>katib-controller</code> Highly Available (HA) using leader election.
If you plan to use Katib in an environment where high Service Level Agreements (SLAs) and Service Level Objectives (SLOs) are required,
such as a production environment, consider choosing this installation.</p>
</li>
</ol>
</li>
<li>
<p><strong>Katib Cert Manager Installation</strong></p>
<p>Run the following command to deploy Katib with
<a href="https://cert-manager.io/docs/installation/kubernetes/">Cert Manager</a> requirement:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl apply -k <span class="s2">&#34;github.com/kubeflow/katib.git/manifests/v1beta1/installs/katib-cert-manager?ref=master&#34;</span>
</span></span></code></pre></div><p>This installation uses Cert Manager instead of <code>katib-cert-generator</code>
to provision Katib webhooks certificates. You have to deploy Cert Manager on
your Kubernetes cluster before deploying Katib using this installation.</p>
</li>
<li>
<p><strong>Katib External DB Installation</strong></p>
<p>Run the following command to deploy Katib with custom Database (DB) backend:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl apply -k <span class="s2">&#34;github.com/kubeflow/katib.git/manifests/v1beta1/installs/katib-external-db?ref=master&#34;</span>
</span></span></code></pre></div><p>This installation allows to use custom MySQL DB instead of <code>katib-mysql</code>.
You have to modify appropriate environment variables for <code>katib-db-manager</code> in the
<a href="https://github.com/kubeflow/katib/blob/master/manifests/v1beta1/installs/katib-external-db/secrets.env"><code>secrets.env</code></a>
to point at your custom MySQL DB. Learn more about <code>katib-db-manager</code>
environment variables in <a href="https://www.kubeflow.org/docs/components/katib/env-variables/#katib-db-manager">this guide</a>.</p>
</li>
<li>
<p><strong>Katib on OpenShift</strong></p>
<p>Run the following command to deploy Katib on <a href="https://docs.openshift.com/">OpenShift</a> v4.4+:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl apply -k <span class="s2">&#34;github.com/kubeflow/katib.git/manifests/v1beta1/installs/katib-openshift?ref=master&#34;</span>
</span></span></code></pre></div><p>This installation uses OpenShift service controller instead of <code>katib-cert-generator</code>
to provision Katib webhooks certificates.</p>
</li>
</ol>
<p>Above installations deploy
<a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#persistentvolumeclaims">PersistentVolumeClaim (PVC)</a>
for the Katib DB component.</p>
<p>Your Kubernetes cluster must have <code>StorageClass</code> for dynamic volume provisioning.
For more information, check the Kubernetes documentation on
<a href="https://kubernetes.io/docs/concepts/storage/dynamic-provisioning/">dynamic provisioning</a>.</p>
<p>If your cluster doesn&rsquo;t have dynamic volume provisioning, you must manually
deploy <a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#persistent-volumes">PersistentVolume (PV)</a>
to bind <a href="https://github.com/kubeflow/katib/blob/master/manifests/v1beta1/components/mysql/pvc.yaml">PVC</a>
for the Katib DB component.</p>
<h3 id="katib-components">Katib components</h3>
<p>Run the following command to verify that Katib components are running:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ kubectl get pods -n kubeflow
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">NAME                                READY   STATUS      RESTARTS   AGE
</span></span><span class="line"><span class="cl">katib-cert-generator-79g7d          0/1     Completed   <span class="m">0</span>          79s
</span></span><span class="line"><span class="cl">katib-controller-566595bdd8-8w7sx   1/1     Running     <span class="m">0</span>          82s
</span></span><span class="line"><span class="cl">katib-db-manager-57cd769cdb-vt7zs   1/1     Running     <span class="m">0</span>          82s
</span></span><span class="line"><span class="cl">katib-mysql-7894994f88-djp7m        1/1     Running     <span class="m">0</span>          81s
</span></span><span class="line"><span class="cl">katib-ui-5767cfccdc-v9fcs           1/1     Running     <span class="m">0</span>          80s
</span></span></code></pre></div><ul>
<li>
<p><code>katib-controller</code> - the controller to manage Katib Kubernetes CRDs
(<a href="/docs/components/katib/overview/#experiment"><code>Experiment</code></a>,
<a href="/docs/components/katib/overview/#suggestion"><code>Suggestion</code></a>,
<a href="/docs/components/katib/overview/#trial"><code>Trial</code></a>)</p>
</li>
<li>
<p><code>katib-ui</code> - the Katib user interface.</p>
</li>
<li>
<p><code>katib-db-manager</code> - the GRPC API server to control Katib DB interface.</p>
</li>
<li>
<p><code>katib-mysql</code> - the <code>mysql</code> DB backend to store Katib experiments metrics.</p>
</li>
<li>
<p>(Optional) <code>katib-cert-generator</code> - the certificate generator for Katib
standalone installation. Learn more about the cert generator in the
<a href="https://github.com/kubeflow/katib/blob/master/docs/developer-guide.md#katib-cert-generator">developer guide</a></p>
</li>
</ul>
<h2 id="accessing-the-katib-ui">Accessing the Katib UI</h2>
<p>You can use the Katib user interface (UI) to submit experiments and to monitor
your results. The Katib home page within Kubeflow looks like this:</p>
<p><img src="/docs/components/katib/images/home-page.png"
alt="The Katib home page within the Kubeflow UI"
class="mt-3 mb-3 border border-info rounded"></p>
<p>If you installed Katib as part of Kubeflow, you can access the
Katib UI from the Kubeflow UI:</p>
<ol>
<li>Open the Kubeflow UI. Check the guide to
<a href="/docs/components/central-dash/overview/">accessing the central dashboard</a>.</li>
<li>Click <strong>Katib</strong> in the left-hand menu.</li>
</ol>
<p>Alternatively, you can set port-forwarding for the Katib UI service:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl port-forward svc/katib-ui -n kubeflow 8080:80
</span></span></code></pre></div><p>Then you can access the Katib UI at this URL:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">http://localhost:8080/katib/
</span></span></code></pre></div><p>Check <a href="https://github.com/kubeflow/katib/tree/master/pkg/ui/v1beta1">this guide</a>
if you want to contribute to Katib UI.</p>
<h2 id="examples">Examples</h2>
<p>This section introduces some examples that you can run to try Katib.</p>
<p><a id="random-search"></a></p>
<h3 id="example-using-random-search-algorithm">Example using random search algorithm</h3>
<p>You can create an experiment for Katib by defining the experiment in a YAML
configuration file. The YAML file defines the configurations for the experiment,
including the hyperparameter feasible space, optimization parameter,
optimization goal, suggestion algorithm, and so on.</p>
<p>This example uses the <a href="https://github.com/kubeflow/katib/blob/master/examples/v1beta1/hp-tuning/random.yaml">YAML file for the
random search example</a>.</p>
<p>The random search algorithm example uses an MXNet neural network to train an image
classification model using the MNIST dataset. You can check training container source code
<a href="https://github.com/kubeflow/katib/tree/master/examples/v1beta1/trial-images/mxnet-mnist">here</a>.
The experiment runs twelve training jobs with various hyperparameters and saves the results.</p>
<p>If you installed Katib as part of Kubeflow, you can&rsquo;t run experiments in the
Kubeflow namespace. Run the following commands to change namespace and launch
an experiment using the random search example:</p>
<ol>
<li>
<p>Download the example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">curl https://raw.githubusercontent.com/kubeflow/katib/master/examples/v1beta1/hp-tuning/random.yaml --output random.yaml
</span></span></code></pre></div></li>
<li>
<p>Edit <code>random.yaml</code> and change the following line to use your Kubeflow
user profile namespace (e.g. <code>kubeflow-user-example-com</code>):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">namespace: kubeflow
</span></span></code></pre></div></li>
<li>
<p>(Optional) <strong>Note:</strong> Katib&rsquo;s experiments don&rsquo;t work with
<a href="https://istio.io/latest/docs/setup/additional-setup/sidecar-injection/#automatic-sidecar-injection">Istio sidecar injection</a>.
If you are using Kubeflow with
Istio, you have to disable sidecar injection. To do that, specify this annotation:
<code>sidecar.istio.io/inject: &quot;false&quot;</code> in your experiment&rsquo;s trial template.</p>
<p>For the provided random search example with Kubernetes
<a href="https://kubernetes.io/docs/concepts/workloads/controllers/job/"><code>Job</code></a>
trial template, annotation should be under
<a href="https://github.com/kubeflow/katib/blob/master/examples/v1beta1/hp-tuning/random.yaml#L52"><code>.trialSpec.spec.template.metadata.annotations</code></a>.
For the Kubeflow <code>TFJob</code> or other training operators check
<a href="/docs/components/training/tftraining/#what-is-tfjob">here</a>
how to set the annotation.</p>
</li>
<li>
<p>Deploy the example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl apply -f random.yaml
</span></span></code></pre></div></li>
</ol>
<p>This example embeds the hyperparameters as arguments. You can embed
hyperparameters in another way (for example, using environment variables)
by using the template defined in the <code>trialTemplate.trialSpec</code> section of
the YAML file. The template uses the
<a href="https://godoc.org/k8s.io/apimachinery/pkg/apis/meta/v1/unstructured">unstructured</a>
format and substitutes parameters from the <code>trialTemplate.trialParameters</code>.
Follow the <a href="/docs/components/katib/trial-template/">trial template guide</a>
to know more about it.</p>
<p>This example randomly generates the following hyperparameters:</p>
<ul>
<li><code>--lr</code>: Learning rate. Type: double.</li>
<li><code>--num-layers</code>: Number of layers in the neural network. Type: integer.</li>
<li><code>--optimizer</code>: Optimization method to change the neural network attributes.
Type: categorical.</li>
</ul>
<p>Check the experiment status:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl -n kubeflow-user-example-com get experiment random -o yaml
</span></span></code></pre></div><p>The output of the above command should look similar to this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">kubeflow.org/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Experiment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="l">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">random</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">kubeflow-user-example-com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="l">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">algorithm</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">algorithmName</span><span class="p">:</span><span class="w"> </span><span class="l">random</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">maxFailedTrialCount</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">maxTrialCount</span><span class="p">:</span><span class="w"> </span><span class="m">12</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">metricsCollectorSpec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">collector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">StdOut</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">objective</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">additionalMetricNames</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">Train-accuracy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">goal</span><span class="p">:</span><span class="w"> </span><span class="m">0.99</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metricStrategies</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Validation-accuracy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">max</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Train-accuracy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">max</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">objectiveMetricName</span><span class="p">:</span><span class="w"> </span><span class="l">Validation-accuracy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">maximize</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">parallelTrialCount</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">parameters</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">feasibleSpace</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">max</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;0.03&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">min</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;0.01&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">lr</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">parameterType</span><span class="p">:</span><span class="w"> </span><span class="l">double</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">feasibleSpace</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">max</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;5&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">min</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">num-layers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">parameterType</span><span class="p">:</span><span class="w"> </span><span class="l">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">feasibleSpace</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">list</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="l">sgd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="l">adam</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="l">ftrl</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">optimizer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">parameterType</span><span class="p">:</span><span class="w"> </span><span class="l">categorical</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">resumePolicy</span><span class="p">:</span><span class="w"> </span><span class="l">LongRunning</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">trialTemplate</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">failureCondition</span><span class="p">:</span><span class="w"> </span><span class="l">status.conditions.#(type==&#34;Failed&#34;)#|#(status==&#34;True&#34;)#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">primaryContainerName</span><span class="p">:</span><span class="w"> </span><span class="l">training-container</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">successCondition</span><span class="p">:</span><span class="w"> </span><span class="l">status.conditions.#(type==&#34;Complete&#34;)#|#(status==&#34;True&#34;)#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">trialParameters</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l">Learning rate for the training model</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">learningRate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">reference</span><span class="p">:</span><span class="w"> </span><span class="l">lr</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l">Number of training model layers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">numberLayers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">reference</span><span class="p">:</span><span class="w"> </span><span class="l">num-layers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l">Training model optimizer (sdg, adam or ftrl)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">optimizer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">reference</span><span class="p">:</span><span class="w"> </span><span class="l">optimizer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">trialSpec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">batch/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Job</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">sidecar.istio.io/inject</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;false&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span>- <span class="nt">command</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span>- <span class="l">python3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span>- <span class="l">/opt/mxnet-mnist/mnist.py</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span>- --<span class="l">batch-size=64</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span>- --<span class="l">lr=${trialParameters.learningRate}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span>- --<span class="l">num-layers=${trialParameters.numberLayers}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span>- --<span class="l">optimizer=${trialParameters.optimizer}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">docker.io/kubeflowkatib/mxnet-mnist:v1beta1-45c5727</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">training-container</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">Never</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">status</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">conditions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">lastTransitionTime</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2021-10-07T21:12:06Z&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">lastUpdateTime</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2021-10-07T21:12:06Z&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="l">Experiment is created</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">reason</span><span class="p">:</span><span class="w"> </span><span class="l">ExperimentCreated</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;True&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Created</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">lastTransitionTime</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2021-10-07T21:12:28Z&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">lastUpdateTime</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2021-10-07T21:12:28Z&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="l">Experiment is running</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">reason</span><span class="p">:</span><span class="w"> </span><span class="l">ExperimentRunning</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;True&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Running</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">currentOptimalTrial</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">bestTrialName</span><span class="p">:</span><span class="w"> </span><span class="l">random-hpsrsdqp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">observation</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">metrics</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">latest</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;0.993054&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">max</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;0.993054&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">min</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;0.917694&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Train-accuracy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">latest</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;0.979598&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">max</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;0.979598&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">min</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;0.957106&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Validation-accuracy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">parameterAssignments</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">lr</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;0.024736875661534784&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">num-layers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;4&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">optimizer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">sgd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">runningTrialList</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">random-2dwxbwcg</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">random-6jd8hmnd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">random-7gks8bmf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">startTime</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2021-10-07T21:12:06Z&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">succeededTrialList</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">random-xhpcrt2p</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">random-hpsrsdqp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">random-kddxqqg9</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">random-4lkr5cjp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">trials</span><span class="p">:</span><span class="w"> </span><span class="m">7</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">trialsRunning</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">trialsSucceeded</span><span class="p">:</span><span class="w"> </span><span class="m">4</span><span class="w">
</span></span></span></code></pre></div><p>When the last value in <code>status.conditions.type</code> is <code>Succeeded</code>, the experiment
is complete. You can check information about the best trial in <code>status.currentOptimalTrial</code>.</p>
<ul>
<li>
<p><code>.currentOptimalTrial.bestTrialName</code> is the trial name.</p>
</li>
<li>
<p><code>.currentOptimalTrial.observation.metrics</code> is the <code>max</code>, <code>min</code> and <code>latest</code> recorded values for objective
and additional metrics.</p>
</li>
<li>
<p><code>.currentOptimalTrial.parameterAssignments</code> is the corresponding hyperparameter set.</p>
</li>
</ul>
<p>In addition, <code>status</code> shows the experiment&rsquo;s trials with their current status.</p>
<p><a id="view-ui"></a></p>
<p>View the results of the experiment in the Katib UI:</p>
<ol>
<li>
<p>Open the Katib UI as described <a href="#katib-ui">above</a>.</p>
</li>
<li>
<p>You should be able to view the list of experiments:</p>
<p><img src="/docs/components/katib/images/experiment-list.png"
alt="The random example in the list of Katib experiments"
class="mt-3 mb-3 border border-info rounded"></p>
</li>
<li>
<p>Click the name of the experiment, <strong>random-example</strong>.</p>
</li>
<li>
<p>There should be a graph showing the level of validation and train accuracy
for various combinations of the hyperparameter values
(learning rate, number of layers, and optimizer):</p>
<p><img src="/docs/components/katib/images/random-example-graph.png"
alt="Graph produced by the random example"
class="mt-3 mb-3 border border-info rounded"></p>
</li>
<li>
<p>Below the graph is a list of trials that ran within the experiment:</p>
<p><img src="/docs/components/katib/images/random-example-trials.png"
alt="Trials that ran during the experiment"
class="mt-3 mb-3 border border-info rounded"></p>
</li>
<li>
<p>You can click on trial name to get metrics for the particular trial:</p>
<p><img src="/docs/components/katib/images/random-example-trial-info.png"
alt="Trials that ran during the experiment"
class="mt-3 mb-3 border border-info rounded"></p>
</li>
</ol>
<h3 id="tensorflow-example">TensorFlow example</h3>
<p>If you installed Katib as part of Kubeflow, you cant run experiments in the
Kubeflow namespace. Run the following commands to launch an experiment using
the Kubeflow&rsquo;s <a href="/docs/components/training/tftraining">TensorFlow training job operator</a>, <code>TFJob</code>:</p>
<ol>
<li>
<p>Download <code>tfjob-mnist-with-summaries.yaml</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">curl https://raw.githubusercontent.com/kubeflow/katib/master/examples/v1beta1/kubeflow-training-operator/tfjob-mnist-with-summaries.yaml --output tfjob-mnist-with-summaries.yaml
</span></span></code></pre></div></li>
<li>
<p>Edit <code>tfjob-mnist-with-summaries.yaml</code> and change the following line to use your Kubeflow
user profile namespace (e.g. <code>kubeflow-user-example-com</code>):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">namespace: kubeflow
</span></span></code></pre></div></li>
<li>
<p>(Optional) <strong>Note:</strong> Katib&rsquo;s experiments don&rsquo;t work with
<a href="https://istio.io/latest/docs/setup/additional-setup/sidecar-injection/#automatic-sidecar-injection">Istio sidecar injection</a>.
If you are using Kubeflow with
Istio, you have to disable sidecar injection. To do that, specify this annotation:
<code>sidecar.istio.io/inject: &quot;false&quot;</code> in your experiment&rsquo;s trial template.
For the provided <code>TFJob</code> example check
<a href="/docs/components/training/tftraining/#what-is-tfjob">here</a>
how to set the annotation.</p>
</li>
<li>
<p>Deploy the example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl apply -f tfjob-mnist-with-summaries.yaml
</span></span></code></pre></div></li>
<li>
<p>You can check the status of the experiment:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl -n kubeflow-user-example-com get experiment tfjob-mnist-with-summaries -o yaml
</span></span></code></pre></div></li>
</ol>
<p>Follow the steps as described for the <em>random search algorithm example</em>
<a href="#view-ui">above</a> to obtain the results of the experiment in the Katib UI.</p>
<h3 id="pytorch-example">PyTorch example</h3>
<p>If you installed Katib as part of Kubeflow, you cant run experiments in the
Kubeflow namespace. Run the following commands to launch an experiment
using Kubeflow&rsquo;s <a href="/docs/components/training/pytorch">PyTorch training job operator</a>, <code>PyTorchJob</code>:</p>
<ol>
<li>
<p>Download <code>pytorchjob-mnist.yaml</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">curl https://raw.githubusercontent.com/kubeflow/katib/master/examples/v1beta1/kubeflow-training-operator/pytorchjob-mnist.yaml --output pytorchjob-mnist.yaml
</span></span></code></pre></div></li>
<li>
<p>Edit <code>pytorchjob-mnist.yaml</code> and change the following line to use your
Kubeflow user profile namespace (e.g. <code>kubeflow-user-example-com</code>):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">namespace: kubeflow
</span></span></code></pre></div></li>
<li>
<p>(Optional) <strong>Note:</strong> Katib&rsquo;s experiments don&rsquo;t work with
<a href="https://istio.io/latest/docs/setup/additional-setup/sidecar-injection/#automatic-sidecar-injection">Istio sidecar injection</a>.
If you are using Kubeflow with
Istio, you have to disable sidecar injection. To do that, specify this annotation:
<code>sidecar.istio.io/inject: &quot;false&quot;</code> in your experiment&rsquo;s trial template.
For the provided <code>PyTorchJob</code> example setting the annotation should be similar to
<a href="/docs/components/training/tftraining/#what-is-tfjob"><code>TFJob</code></a></p>
</li>
<li>
<p>Deploy the example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl apply -f pytorchjob-mnist.yaml
</span></span></code></pre></div></li>
<li>
<p>You can check the status of the experiment:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl -n kubeflow-user-example-com describe experiment pytorchjob-mnist
</span></span></code></pre></div></li>
</ol>
<p>Follow the steps as described for the <em>random search algorithm example</em>
<a href="#view-ui">above</a> to get the results of the experiment in the Katib UI.</p>
<h2 id="cleaning-up">Cleaning up</h2>
<p>To remove Katib from your Kubernetes cluster run:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl delete -k <span class="s2">&#34;github.com/kubeflow/katib.git/manifests/v1beta1/installs/katib-standalone?ref=master&#34;</span>
</span></span></code></pre></div><h2 id="next-steps">Next steps</h2>
<ul>
<li>
<p>Learn how to
<a href="/docs/components/katib/experiment/">configure and run your Katib experiments</a>.</p>
</li>
<li>
<p>Learn to configure your
<a href="/docs/components/katib/trial-template/">trial templates</a>.</p>
</li>
<li>
<p>Check the
<a href="/docs/components/katib/katib-config/">Katib Configuration (Katib config)</a>.</p>
</li>
<li>
<p>How to <a href="/docs/components/katib/env-variables/">set up environment variables</a>
for each Katib component.</p>
</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-7f397238fac71de59685256a78cd9f76">3 - Running an Experiment</h1>
    <div class="lead">How to configure and run a hyperparameter tuning or neural architecture search experiment in Katib</div>
	<p>This guide describes how to configure and run a Katib experiment.
The experiment can perform hyperparameter tuning or a neural architecture search
(NAS) (<strong>alpha</strong>), depending on the configuration settings.</p>
<p>For an overview of the concepts involved, check the
<a href="/docs/components/katib/overview/">introduction to Katib</a>.</p>
<p><a id="docker-image"></a></p>
<h2 id="packaging-your-training-code-in-a-container-image">Packaging your training code in a container image</h2>
<p>Katib and Kubeflow are Kubernetes-based systems. To use Katib, you must package
your training code in a Docker container image and make the image available
in a registry. Check the
<a href="https://docs.docker.com/develop/develop-images/baseimages/">Docker documentation</a>
and the
<a href="https://kubernetes.io/docs/concepts/containers/images/">Kubernetes documentation</a>.</p>
<h2 id="configuring-the-experiment">Configuring the experiment</h2>
<p>To create a hyperparameter tuning or NAS experiment in Katib, you define the
experiment in a YAML configuration file. The YAML file defines the range of
potential values (the search space) for the parameters that you want to
optimize, the objective metric to use when determining optimal values, the
search algorithm to use during optimization, and other configurations.</p>
<p>As a reference, you can use the YAML file of the
<a href="https://github.com/kubeflow/katib/blob/master/examples/v1beta1/hp-tuning/random.yaml">random search algorithm example</a>.</p>
<p>The list below describes the fields in the YAML file for an experiment. The
Katib UI offers the corresponding fields. You can choose to configure and run
the experiment from the UI or from the command line.</p>
<h3 id="configuration-spec">Configuration spec</h3>
<p>These are the fields in the experiment configuration spec:</p>
<ul>
<li>
<p><strong>parameters</strong>: The range of the hyperparameters or other parameters that you
want to tune for your machine learning (ML) model. The parameters define the <em>search space</em>,
also known as the <em>feasible set</em> or the <em>solution space</em>.
In this section of the spec, you define the name and the distribution
(discrete or continuous) of every hyperparameter that you need to search.
For example, you may provide a minimum and maximum value or a list
of allowed values for each hyperparameter.
Katib generates hyperparameter combinations in the range based on the
hyperparameter tuning algorithm that you specify.
Refer to the
<a href="https://github.com/kubeflow/katib/blob/master/pkg/apis/controller/experiments/v1beta1/experiment_types.go#L185-L206"><code>ParameterSpec</code> type</a>.</p>
</li>
<li>
<p><strong>objective</strong>: The metric that you want to optimize.
The objective metric is also called the <em>target variable</em>.
A common metric is the model&rsquo;s accuracy in the validation pass of the training
job (<em>validation-accuracy</em>). You also specify whether you want Katib to
maximize or minimize the metric.</p>
<p>Katib uses the <code>objectiveMetricName</code> and <code>additionalMetricNames</code> to monitor
how the hyperparameters work with the model.
Katib records the value of the best <code>objectiveMetricName</code> metric (maximized
or minimized based on <code>type</code>) and the corresponding hyperparameter set
in the experiment&rsquo;s <code>.status.currentOptimalTrial.parameterAssignments</code>.
If the <code>objectiveMetricName</code> metric for a set of hyperparameters reaches the
<code>goal</code>, Katib stops trying more hyperparameter combinations.</p>
<p>You can run the experiment without specifying the <code>goal</code>. In that case, Katib
runs the experiment until the corresponding successful trials reach <code>maxTrialCount</code>.
<code>maxTrialCount</code> parameter is described below.</p>
<p>The default way to calculate the experiment&rsquo;s objective is:</p>
<ul>
<li>
<p>When the objective <code>type</code> is <code>maximize</code>, Katib compares all maximum
metric values.</p>
</li>
<li>
<p>When the objective <code>type</code> is <code>minimize</code>, Katib compares all minimum
metric values.</p>
</li>
</ul>
<p>To change the default settings, define <code>metricStrategies</code> with various rules
(<code>min</code>, <code>max</code> or <code>latest</code>) to extract values for each metric from the
experiment&rsquo;s <code>objectiveMetricName</code> and <code>additionalMetricNames</code>.
The experiment&rsquo;s objective value is calculated in
accordance with the selected strategy.</p>
<p>For example, you can set the parameters in your experiment as follows:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="l">. . .</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">objectiveMetricName</span><span class="p">:</span><span class="w"> </span><span class="l">accuracy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">maximize</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metricStrategies</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">accuracy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">. . .</span><span class="w">
</span></span></span></code></pre></div><p>where the Katib controller is searching for the best maximum from the all
latest reported <code>accuracy</code> metrics for each trial. Check the
<a href="https://github.com/kubeflow/katib/blob/master/examples/v1beta1/metrics-collector/metrics-collection-strategy.yaml">metrics strategies example</a>.
The default strategy type for each metric is equal to the objective <code>type</code>.</p>
<p>Refer to the
<a href="https://github.com/kubeflow/katib/blob/master/pkg/apis/controller/common/v1beta1/common_types.go#L93"><code>ObjectiveSpec</code> type</a>.</p>
</li>
<li>
<p><strong>parallelTrialCount</strong>: The maximum number of hyperparameter sets that Katib
should train in parallel. The default value is 3.</p>
</li>
<li>
<p><strong>maxTrialCount</strong>: The maximum number of trials to run.
This is equivalent to the number of hyperparameter sets that Katib should
generate to test the model. If the <code>maxTrialCount</code> value is <strong>omitted</strong>, your
experiment will be running until the objective goal is reached or the experiment
reaches a maximum number of failed trials.</p>
</li>
<li>
<p><strong>maxFailedTrialCount</strong>: The maximum number of trials allowed to fail.
This is equivalent to the number of failed hyperparameter sets that Katib should test.
Katib recognizes trials with a status of <code>Failed</code> or <code>MetricsUnavailable</code> as <code>Failed</code> trials,
and if the number of failed trials reaches <code>maxFailedTrialCount</code>, Katib stops the
experiment with a status of <code>Failed</code>.</p>
</li>
<li>
<p><strong>algorithm</strong>: The search algorithm that you want Katib to use to find the
best hyperparameters or neural architecture configuration. Examples include
random search, grid search, Bayesian optimization, and more.
Check the <a href="#search-algorithms">search algorithm details</a> below.</p>
</li>
<li>
<p><strong>trialTemplate</strong>: The template that defines the trial.
You have to package your ML training code into a Docker image, as described
<a href="#docker-image">above</a>. <code>trialTemplate.trialSpec</code> is your
<a href="https://godoc.org/k8s.io/apimachinery/pkg/apis/meta/v1/unstructured">unstructured</a>
template with model parameters, which are substituted from <code>trialTemplate.trialParameters</code>.
For example, your training container can receive hyperparameters as command-line
arguments or as environment variables. You have to set the name of your training
container in <code>trialTemplate.primaryContainerName</code>.</p>
<p>Katib dynamically supports any kind of
<a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/">Kubernetes CRD</a>.
In Katib <a href="https://github.com/kubeflow/katib/tree/master/examples/v1beta1">examples</a>,
you can find the following job types to train your model:</p>
<ul>
<li>
<p><a href="https://kubernetes.io/docs/concepts/workloads/controllers/job/">Kubernetes <code>Job</code></a></p>
</li>
<li>
<p><a href="/docs/components/training/tftraining/">Kubeflow <code>TFJob</code></a></p>
</li>
<li>
<p><a href="/docs/components/training/pytorch/">Kubeflow <code>PyTorchJob</code></a></p>
</li>
<li>
<p><a href="/docs/components/training/mxnet">Kubeflow <code>MXJob</code></a></p>
</li>
<li>
<p><a href="/docs/components/training/xgboost">Kubeflow <code>XGBoostJob</code></a></p>
</li>
<li>
<p><a href="/docs/components/training/mpi">Kubeflow <code>MPIJob</code></a></p>
</li>
<li>
<p><a href="https://github.com/kubeflow/katib/tree/master/examples/v1beta1/tekton">Tekton <code>Pipelines</code></a></p>
</li>
<li>
<p><a href="https://github.com/kubeflow/katib/tree/master/examples/v1beta1/argo">Argo <code>Workflows</code></a></p>
</li>
</ul>
<p>Refer to the
<a href="https://github.com/kubeflow/katib/blob/master/pkg/apis/controller/experiments/v1beta1/experiment_types.go#L208-L270"><code>TrialTemplate</code> type</a>.
Follow the <a href="/docs/components/katib/trial-template/">trial template guide</a>
to understand how to specify <code>trialTemplate</code> parameters, save templates in
<code>ConfigMaps</code> and support custom Kubernetes resources in Katib.</p>
</li>
<li>
<p><strong>metricsCollectorSpec</strong>: A specification of how to collect the metrics from
each trial, such as the accuracy and loss metrics.
Learn the <a href="#metrics-collector">details of the metrics collector</a> below.
The default metrics collector is <code>StdOut</code>.</p>
</li>
<li>
<p><strong>nasConfig</strong>: The configuration for a neural architecture search (NAS).
<strong>Note</strong>: NAS is currently in <strong>alpha</strong> with limited support.
You can specify the configurations of the neural network design that you want
to optimize, including the number of layers in the network, the types of
operations, and more.
Refer to the
<a href="https://github.com/kubeflow/katib/blob/master/pkg/apis/controller/experiments/v1beta1/experiment_types.go#L296"><code>NasConfig</code> type</a>.</p>
<ul>
<li>
<p><strong>graphConfig</strong>: The graph config that defines structure for a
directed acyclic graph of the neural network. You can specify the number of layers,
<code>input_sizes</code> for the input layer and <code>output_sizes</code> for the output layer.
Refer to the
<a href="https://github.com/kubeflow/katib/blob/master/pkg/apis/controller/experiments/v1beta1/experiment_types.go#L301-L306"><code>GraphConfig</code> type</a>.</p>
</li>
<li>
<p><strong>operations</strong>: The range of operations that you want to tune for your ML model.
For each neural network layer the NAS algorithm selects one of the operations
to build a neural network. Each operation contains sets of <strong>parameters</strong> which
are described above.
Refer to the
<a href="https://github.com/kubeflow/katib/blob/master/pkg/apis/controller/experiments/v1beta1/experiment_types.go#L308-L312"><code>Operation</code> type</a>.</p>
<p>You can find all NAS examples <a href="https://github.com/kubeflow/katib/tree/master/examples/v1beta1/nas">here</a>.</p>
</li>
</ul>
</li>
<li>
<p><strong>resumePolicy</strong>: The experiment resume policy. Can be one of
<code>LongRunning</code>, <code>Never</code> or <code>FromVolume</code>. The default value is <code>LongRunning</code>.
Refer to the
<a href="https://github.com/kubeflow/katib/blob/master/pkg/apis/controller/experiments/v1beta1/experiment_types.go#L58"><code>ResumePolicy</code> type</a>.
To find out how to modify a running experiment and use various
restart policies follow the
<a href="/docs/components/katib/resume-experiment/">resume an experiment guide</a>.</p>
</li>
</ul>
<p><em>Background information about Katib&rsquo;s <code>Experiment</code>, <code>Suggestion</code> and <code>Trial</code>
type:</em> In Kubernetes terminology, Katib&rsquo;s
<a href="https://github.com/kubeflow/katib/blob/master/pkg/apis/controller/experiments/v1beta1/experiment_types.go#L278"><code>Experiment</code> type</a>,
<a href="https://github.com/kubeflow/katib/blob/master/pkg/apis/controller/suggestions/v1beta1/suggestion_types.go#L128"><code>Suggestion</code> type</a> and
<a href="https://github.com/kubeflow/katib/blob/master/pkg/apis/controller/trials/v1beta1/trial_types.go#L129"><code>Trial</code> type</a>
is a <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/">custom resource (CR)</a>.
The YAML file that you create for your experiment is the CR specification.</p>
<p><a id="search-algorithms"></a></p>
<h3 id="search-algorithms-in-detail">Search algorithms in detail</h3>
<p>Katib currently supports several search algorithms.
Refer to the
<a href="https://github.com/kubeflow/katib/blob/master/pkg/apis/controller/common/v1beta1/common_types.go#L22-L39"><code>AlgorithmSpec</code> type</a>.</p>
<p>Here&rsquo;s a list of the search algorithms available in Katib:</p>
<ul>
<li><a href="#grid-search">Grid search</a></li>
<li><a href="#random-search">Random search</a></li>
<li><a href="#bayesian">Bayesian optimization</a></li>
<li><a href="#hyperband">Hyperband</a></li>
<li><a href="#tpe-search">Tree of Parzen Estimators (TPE)</a></li>
<li><a href="#multivariate-tpe-search">Multivariate TPE</a></li>
<li><a href="#cmaes">Covariance Matrix Adaptation Evolution Strategy (CMA-ES)</a></li>
<li><a href="#sobol">Sobol&rsquo;s Quasirandom Sequence</a></li>
<li><a href="#enas">Neural Architecture Search based on ENAS</a></li>
<li><a href="#darts">Differentiable Architecture Search (DARTS)</a></li>
<li><a href="#pbt">Population Based Training (PBT)</a></li>
</ul>
<p>More algorithms are under development.</p>
<p>You can add an algorithm to Katib yourself. Check the guide to
<a href="https://github.com/kubeflow/katib/blob/master/docs/new-algorithm-service.md">adding a new algorithm</a>
and the
<a href="https://github.com/kubeflow/katib/blob/master/docs/developer-guide.md">developer guide</a>.</p>
<p><a id="grid-search"></a></p>
<h4 id="grid-search">Grid search</h4>
<p>The algorithm name in Katib is <code>grid</code>.</p>
<p>Grid sampling is useful when all variables are discrete (as opposed to
continuous) and the number of possibilities is low. A grid search
performs an exhaustive combinatorial search over all possibilities,
making the search process extremely long even for medium sized problems.</p>
<p>Katib uses the <a href="https://chocolate.readthedocs.io">Chocolate</a> optimization
framework for its grid search.</p>
<p><a id="random-search"></a></p>
<h4 id="random-search">Random search</h4>
<p>The algorithm name in Katib is <code>random</code>.</p>
<p>Random sampling is an alternative to grid search and is used when the number of
discrete variables to optimize is large and the time required for each
evaluation is long. When all parameters are discrete, random search performs
sampling without replacement. Random search is therefore the best algorithm to
use when combinatorial exploration is not possible. If the number of continuous
variables is high, you should use quasi random sampling instead.</p>
<p>Katib uses the <a href="http://hyperopt.github.io/hyperopt/">Hyperopt</a>,
<a href="https://github.com/c-bata/goptuna">Goptuna</a>,
<a href="https://chocolate.readthedocs.io">Chocolate</a> or
<a href="https://github.com/optuna/optuna">Optuna</a> optimization
framework for its random search.</p>
<p>Katib supports the following algorithm settings:</p>
<div class="table-responsive">
  <table class="table table-bordered">
    <thead class="thead-light">
      <tr>
        <th>Setting name</th>
        <th>Description</th>
        <th>Example</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>random_state</td>
        <td>[int]: Set <code>random_state</code> to something other than None
          for reproducible results.</td>
        <td>10</td>
      </tr>
    </tbody>
  </table>
</div>
<p><a id="bayesian"></a></p>
<h4 id="bayesian-optimization">Bayesian optimization</h4>
<p>The algorithm name in Katib is <code>bayesianoptimization</code>.</p>
<p>The <a href="https://arxiv.org/pdf/1012.2599.pdf">Bayesian optimization</a> method uses
Gaussian process regression to model the search space. This technique calculates
an estimate of the loss function and the uncertainty of that estimate at every
point in the search space. The method is suitable when the number of
dimensions in the search space is low. Since the method models both
the expected loss and the uncertainty, the search algorithm converges in a few
steps, making it a good choice when the time to
complete the evaluation of a parameter configuration is long.</p>
<p>Katib uses the
<a href="https://github.com/scikit-optimize/scikit-optimize">Scikit-Optimize</a> or
<a href="https://chocolate.readthedocs.io">Chocolate</a> optimization framework
for its Bayesian search. Scikit-Optimize is also known as <code>skopt</code>.</p>
<p>Katib supports the following algorithm settings:</p>
<div class="table-responsive">
  <table class="table table-bordered">
    <thead class="thead-light">
      <tr>
        <th>Setting Name</th>
        <th>Description</th>
        <th>Example</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>base_estimator</td>
        <td>[GP, RF, ET, GBRT or sklearn regressor, default=GP]:
          Should inherit from <code>sklearn.base.RegressorMixin</code>.
          The <code>predict</code> method should have an optional
          <code>return_std</code> argument, which returns
          <code>std(Y | x)</code> along with <code>E[Y | x]</code>. If
          <code>base_estimator</code> is one of
          [GP, RF, ET, GBRT], the system uses a default surrogate model
          of the corresponding type. Learn more information in the
          <a href="https://scikit-optimize.github.io/stable/modules/generated/skopt.Optimizer.html#skopt.Optimizer">skopt
          documentation</a>.</td>
        <td>GP</td>
      </tr>
      <tr>
        <td>n_initial_points</td>
        <td>[int, default=10]: Number of evaluations of <code>func</code> with
          initialization points before approximating it with
          <code>base_estimator</code>. Points provided as <code>x0</code> count
          as initialization points.
          If <code>len(x0) &lt; n_initial_points</code>, the
          system samples additional points at random. Learn more information in the
          <a href="https://scikit-optimize.github.io/stable/modules/generated/skopt.Optimizer.html#skopt.Optimizer">skopt
          documentation</a>.</td>
        <td>10</td>
      </tr>
      <tr>
        <td>acq_func</td>
        <td>[string, default=<code>&quot;gp_hedge&quot;</code>]: The function to
          minimize over the posterior distribution. Learn more information in the
          <a href="https://scikit-optimize.github.io/stable/modules/generated/skopt.Optimizer.html#skopt.Optimizer">skopt
          documentation</a>.</td>
        <td>gp_hedge</td>
      </tr>
      <tr>
        <td>acq_optimizer</td>
        <td>[string, sampling or lbfgs, default=auto]: The method to
          minimize the acquisition function. The system updates the fit model
          with the optimal value obtained by optimizing <code>acq_func</code>
          with <code>acq_optimizer</code>. Learn more information in the
          <a href="https://scikit-optimize.github.io/stable/modules/generated/skopt.Optimizer.html#skopt.Optimizer">skopt
          documentation</a>.</td>
        <td>auto</td>
      </tr>
      <tr>
        <td>random_state</td>
        <td>[int]: Set <code>random_state</code> to something other than None
          for reproducible results.</td>
        <td>10</td>
      </tr>
    </tbody>
  </table>
</div>
<p><a id="hyperband"></a></p>
<h4 id="hyperband">Hyperband</h4>
<p>The algorithm name in Katib is <code>hyperband</code>.</p>
<p>Katib supports the <a href="https://arxiv.org/pdf/1603.06560.pdf">Hyperband</a>
optimization framework.
Instead of using Bayesian optimization to select configurations, Hyperband
focuses on early stopping as a strategy for optimizing resource allocation and
thus for maximizing the number of configurations that it can evaluate.
Hyperband also focuses on the speed of the search.</p>
<p><a id="tpe-search"></a></p>
<h4 id="tree-of-parzen-estimators-tpe">Tree of Parzen Estimators (TPE)</h4>
<p>The algorithm name in Katib is <code>tpe</code>.</p>
<p>Katib uses the <a href="http://hyperopt.github.io/hyperopt/">Hyperopt</a>,
<a href="https://github.com/c-bata/goptuna">Goptuna</a> or
<a href="https://github.com/optuna/optuna">Optuna</a> optimization
framework for its TPE search.</p>
<p>This method provides a <a href="https://arxiv.org/pdf/1703.01785.pdf">forward and reverse gradient-based</a>
search.</p>
<p>Katib supports the following algorithm settings:</p>
<div class="table-responsive">
  <table class="table table-bordered">
    <thead class="thead-light">
      <tr>
        <th>Setting name</th>
        <th>Description</th>
        <th>Example</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>n_EI_candidates</td>
        <td>[int]: Number of candidate samples used to calculate the expected improvement.</td>
        <td>25</td>
      </tr>
      <tr>
        <td>random_state</td>
        <td>[int]: Set <code>random_state</code> to something other than None
          for reproducible results.</td>
        <td>10</td>
      </tr>
      <tr>
        <td>gamma</td>
        <td>[float]: The threshold to split between l(x) and g(x), check equation 2 in
        <a href="https://papers.nips.cc/paper/2011/file/86e8f7ab32cfd12577bc2619bc635690-Paper.pdf">
        this Paper</a>. Value must be in (0, 1) range.</td>
        <td>0.25</td>
      </tr>
      <tr>
        <td>prior_weight</td>
        <td>[float]: Smoothing factor for counts, to avoid having 0 probability.
        Value must be > 0.</td>
        <td>1.1</td>
      </tr>
    </tbody>
  </table>
</div>
<p><a id="multivariate-tpe-search"></a></p>
<h4 id="multivariate-tpe">Multivariate TPE</h4>
<p>The algorithm name in Katib is <code>multivariate-tpe</code>.</p>
<p>Katib uses the <a href="http://hyperopt.github.io/hyperopt/">Optuna</a> optimization
framework for its Multivariate TPE search.</p>
<p><a href="https://tech.preferred.jp/en/blog/multivariate-tpe-makes-optuna-even-more-powerful/">Multivariate TPE</a>
is improved version of independent (default) TPE. This method finds
dependencies among hyperparameters in search space.</p>
<p>Katib supports the following algorithm settings:</p>
<div class="table-responsive">
  <table class="table table-bordered">
    <thead class="thead-light">
      <tr>
        <th>Setting name</th>
        <th>Description</th>
        <th>Example</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>n_ei_candidates</td>
        <td>[int]: Number of Trials used to calculate the expected improvement.</td>
        <td>25</td>
      </tr>
      <tr>
        <td>random_state</td>
        <td>[int]: Set <code>random_state</code> to something other than None
          for reproducible results.</td>
        <td>10</td>
      </tr>
      <tr>
        <td>n_startup_trials</td>
        <td>[int]: Number of initial Trials for which the random search algorithm generates
        hyperparameters.</td>
        <td>5</td>
      </tr>
    </tbody>
  </table>
</div>
<p><a id="cmaes"></a></p>
<h4 id="covariance-matrix-adaptation-evolution-strategy-cma-es">Covariance Matrix Adaptation Evolution Strategy (CMA-ES)</h4>
<p>The algorithm name in Katib is <code>cmaes</code>.</p>
<p>Katib uses the <a href="https://github.com/c-bata/goptuna">Goptuna</a> or
<a href="https://github.com/optuna/optuna">Optuna</a> optimization
framework for its CMA-ES search.</p>
<p>The <a href="https://en.wikipedia.org/wiki/CMA-ES">Covariance Matrix Adaptation Evolution Strategy</a>
is a stochastic derivative-free numerical optimization algorithm for optimization
problems in continuous search spaces.
You can also use <a href="https://sci2s.ugr.es/sites/default/files/files/TematicWebSites/EAMHCO/contributionsCEC05/auger05ARCMA.pdf">IPOP-CMA-ES</a> and <a href="https://hal.inria.fr/inria-00382093/document">BIPOP-CMA-ES</a>, variant algorithms for restarting optimization when converges to local minimum.</p>
<p>Katib supports the following algorithm settings:</p>
<div class="table-responsive">
  <table class="table table-bordered">
    <thead class="thead-light">
      <tr>
        <th>Setting name</th>
        <th>Description</th>
        <th>Example</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>random_state</td>
        <td>[int]: Set <code>random_state</code> to something other than None
          for reproducible results.</td>
        <td>10</td>
      </tr>
      <tr>
        <td>sigma</td>
        <td>[float]: Initial standard deviation of CMA-ES.</td>
        <td>0.001</td>
      </tr>
      <tr>
        <td>restart_strategy</td>
        <td>[string, "none", "ipop", or "bipop", default="none"]: Strategy for restarting CMA-ES optimization when converges to a local minimum.</td>
        <td>"ipop"</td>
      </tr>
    </tbody>
  </table>
</div>
<p><a id="sobol"></a></p>
<h4 id="sobols-quasirandom-sequence">Sobol&rsquo;s Quasirandom Sequence</h4>
<p>The algorithm name in Katib is <code>sobol</code>.</p>
<p>Katib uses the <a href="https://github.com/c-bata/goptuna">Goptuna</a> optimization
framework for its Sobol&rsquo;s quasirandom search.</p>
<p>The <a href="https://dl.acm.org/doi/10.1145/641876.641879">Sobol&rsquo;s quasirandom sequence</a>
is a low-discrepancy sequence. And it is known that Sobol&rsquo;s quasirandom sequence can
provide better uniformity properties.</p>
<p><a id="enas"></a></p>
<h4 id="neural-architecture-search-based-on-enas">Neural Architecture Search based on ENAS</h4>
<p>The algorithm name in Katib is <code>enas</code>.</p>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Alpha version</h4>

    Neural architecture search is currently in <b>alpha</b> with limited support.
The Kubeflow team is interested in any feedback you may have, in particular with
regards to usability of the feature. You can log issues and comments in
the <a href="https://github.com/kubeflow/katib/issues">Katib issue tracker</a>.

</div>

<p>This NAS algorithm is ENAS-based. Currently, it doesn&rsquo;t support parameter sharing.</p>
<p>Katib supports the following algorithm settings:</p>
<div class="table-responsive">
  <table class="table table-bordered">
    <thead class="thead-light">
      <tr>
        <th>Setting Name</th>
        <th>Type</th>
        <th>Default value</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>controller_hidden_size</td>
        <td>int</td>
        <td>64</td>
        <td>RL controller lstm hidden size. Value must be >= 1.</td>
      </tr>
      <tr>
        <td>controller_temperature</td>
        <td>float</td>
        <td>5.0</td>
        <td>RL controller temperature for the sampling logits. Value must be > 0.
          Set value to "None" to disable it in the controller.</td>
      </tr>
      <tr>
        <td>controller_tanh_const</td>
        <td>float</td>
        <td>2.25</td>
        <td>RL controller tanh constant to prevent premature convergence.
          Value must be > 0. Set value to "None" to disable it in the controller.</td>
      </tr>
      <tr>
        <td>controller_entropy_weight</td>
        <td>float</td>
        <td>1e-5</td>
        <td>RL controller weight for entropy applying to reward. Value must be > 0.
          Set value to "None" to disable it in the controller.</td>
      </tr>
      <tr>
        <td>controller_baseline_decay</td>
        <td>float</td>
        <td>0.999</td>
        <td>RL controller baseline factor. Value must be > 0 and <= 1.</td>
      </tr>
      <tr>
        <td>controller_learning_rate</td>
        <td>float</td>
        <td>5e-5</td>
        <td>RL controller learning rate for Adam optimizer. Value must be > 0 and <= 1.</td>
      </tr>
      <tr>
        <td>controller_skip_target</td>
        <td>float</td>
        <td>0.4</td>
        <td>RL controller probability, which represents the prior belief of a
          skip connection being formed. Value must be > 0 and <= 1.</td>
      </tr>
      <tr>
        <td>controller_skip_weight</td>
        <td>float</td>
        <td>0.8</td>
        <td>RL controller weight of skip penalty loss. Value must be > 0.
          Set value to "None" to disable it in the controller.</td>
      </tr>
      <tr>
        <td>controller_train_steps</td>
        <td>int</td>
        <td>50</td>
        <td>Number of RL controller training steps after each candidate runs.
          Value must be >= 1.</td>
      </tr>
      <tr>
        <td>controller_log_every_steps</td>
        <td>int</td>
        <td>10</td>
        <td>Number of RL controller training steps before logging it. Value must be >= 1.</td>
      </tr>
    </tbody>
  </table>
</div>
<p>For more information, check:</p>
<ul>
<li>
<p>Documentation in the Katib repository on the
<a href="https://github.com/kubeflow/katib/tree/master/pkg/suggestion/v1beta1/nas/enas">Efficient Neural Architecture Search (ENAS)</a>.</p>
</li>
<li>
<p>The ENAS example 
<a href="https://github.com/kubeflow/katib/blob/master/examples/v1beta1/nas/enas-gpu.yaml"><code>enas-gpu.yaml</code></a> 
which attempts to show all possible operations. Due to the large search
space, the example is not likely to generate a good result.</p>
</li>
</ul>
<p><a id="darts"></a></p>
<h4 id="differentiable-architecture-search-darts">Differentiable Architecture Search (DARTS)</h4>
<p>The algorithm name in Katib is <code>darts</code>.</p>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Alpha version</h4>

    Neural architecture search is currently in <b>alpha</b> with limited support.
The Kubeflow team is interested in any feedback you may have, in particular with
regards to usability of the feature. You can log issues and comments in
the <a href="https://github.com/kubeflow/katib/issues">Katib issue tracker</a>.

</div>

<p>Currently, you can&rsquo;t view results of this algorithm in the Katib UI and
you can run experiments only on a single GPU.</p>
<p>Katib supports the following algorithm settings:</p>
<div class="table-responsive">
  <table class="table table-bordered">
    <thead class="thead-light">
      <tr>
        <th>Setting Name</th>
        <th>Type</th>
        <th>Default value</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>num_epochs</td>
        <td>int</td>
        <td>50</td>
        <td>Number of epochs to train model</td>
      </tr>
      <tr>
        <td>w_lr</td>
        <td>float</td>
        <td>0.025</td>
        <td>Initial learning rate for training model weights.
          This learning rate annealed down to <code>w_lr_min</code>
          following a cosine schedule without restart.</td>
      </tr>
      <tr>
        <td>w_lr_min</td>
        <td>float</td>
        <td>0.001</td>
        <td>Minimum learning rate for training model weights.</td>
      </tr>
      <tr>
        <td>w_momentum</td>
        <td>float</td>
        <td>0.9</td>
        <td>Momentum for training training model weights.</td>
      </tr>
      <tr>
        <td>w_weight_decay</td>
        <td>float</td>
        <td>3e-4</td>
        <td>Training model weight decay.</td>
      </tr>
      <tr>
        <td>w_grad_clip</td>
        <td>float</td>
        <td>5.0</td>
        <td>Max norm value for clipping gradient norm of training model weights.</td>
      </tr>
      <tr>
        <td>alpha_lr</td>
        <td>float</td>
        <td>3e-4</td>
        <td>Initial learning rate for alphas weights.</td>
      </tr>
      <tr>
        <td>alpha_weight_decay</td>
        <td>float</td>
        <td>1e-3</td>
        <td>Alphas weight decay.</td>
      </tr>
      <tr>
        <td>batch_size</td>
        <td>int</td>
        <td>128</td>
        <td>Batch size for dataset.</td>
      </tr>
      <tr>
        <td>num_workers</td>
        <td>int</td>
        <td>4</td>
        <td>Number of subprocesses to download the dataset.</td>
      </tr>
      <tr>
        <td>init_channels</td>
        <td>int</td>
        <td>16</td>
        <td>Initial number of channels.</td>
      </tr>
      <tr>
        <td>print_step</td>
        <td>int</td>
        <td>50</td>
        <td>Number of training or validation steps before logging it.</td>
      </tr>
      <tr>
        <td>num_nodes</td>
        <td>int</td>
        <td>4</td>
        <td>Number of DARTS nodes.</td>
      </tr>
      <tr>
        <td>stem_multiplier</td>
        <td>int</td>
        <td>3</td>
        <td>Multiplier for initial channels. It is used in the first stem cell.</td>
      </tr>
    </tbody>
  </table>
</div>
<p>For more information, check:</p>
<ul>
<li>
<p>Documentation in the Katib repository on the
<a href="https://github.com/kubeflow/katib/tree/master/pkg/suggestion/v1beta1/nas/darts">Differentiable Architecture Search</a>.</p>
</li>
<li>
<p>The DARTS example 
<a href="https://github.com/kubeflow/katib/blob/master/examples/v1beta1/nas/darts-gpu.yaml"><code>darts-gpu.yaml</code></a>.</p>
</li>
</ul>
<p><a id="pbt"></a></p>
<h4 id="population-based-training-pbt">Population Based Training (PBT)</h4>
<p>The algorithm name in Katib is <code>pbt</code>.</p>
<p>Review the population based training <a href="https://arxiv.org/abs/1711.09846">paper</a> for more details about the algorithm.</p>
<p>The PBT service requires a Persistent Volume Claim with <a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#access-modes">RWX access mode</a> to share resources between Suggestion and Trials. Currently, Katib Experiments should have <code>resumePolicy: FromVolume</code> to run the PBT algorithm. Learn more about resume policies in <a href="/docs/components/katib/resume-experiment/">this guide</a>.</p>
<p>Katib supports the following algorithm settings:</p>
<div class="table-responsive">
  <table class="table table-bordered">
    <thead class="thead-light">
      <tr>
        <th>Setting name</th>
        <th>Description</th>
        <th>Example</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>suggestion_trial_dir</td>
        <td>The location within the trial container where checkpoints are saved</td>
        <td><code>/var/log/katib/checkpoints/</code></td>
      </tr>
      <tr>
        <td>n_population</td>
        <td>Number of trial seeds per generation</td>
        <td>40</td>
      </tr>
      <tr>
        <td>resample_probability</td>
        <td>null (default): perturbs the hyperparameter by 0.8 or 1.2. 0-1: resamples the original distribution by the specified probability</td>
        <td>0.3</td>
      </tr>
      <tr>
        <td>truncation_threshold</td>
        <td>Exploit threshold for pruning low performing seeds</td>
        <td>0.4</td>
      </tr>
    </tbody>
  </table>
</div>
<p><a id="metrics-collector"></a></p>
<h3 id="metrics-collector">Metrics collector</h3>
<p>In the <code>metricsCollectorSpec</code> section of the YAML configuration file, you can
define how Katib should collect the metrics from each trial, such as the
accuracy and loss metrics.
Refer to the
<a href="https://github.com/kubeflow/katib/blob/master/pkg/apis/controller/common/v1beta1/common_types.go#L155-L225"><code>MetricsCollectorSpec</code> type</a></p>
<p>Your training code can record the metrics into <code>stdout</code> or into arbitrary output
files. Katib collects the metrics using a <em>sidecar</em> container. A sidecar is
a utility container that supports the main container in the Kubernetes Pod.</p>
<p>To define the metrics collector for your experiment:</p>
<ol>
<li>
<p>Specify the collector type in the <code>.collector.kind</code> field.
Katib&rsquo;s metrics collector supports the following collector types:</p>
<ul>
<li>
<p><code>StdOut</code>: Katib collects the metrics from the operating system&rsquo;s default
output location (<em>standard output</em>). This is the default metrics collector.</p>
</li>
<li>
<p><code>File</code>: Katib collects the metrics from an arbitrary file, which
you specify in the <code>.source.fileSystemPath.path</code> field. Training container
should log metrics to this file in <code>TEXT</code> or <code>JSON</code> format. If you select <code>JSON</code> format, metrics must be line-separated by <code>epoch</code> or <code>step</code> as follows, and the key for timestamp must be <code>timestamp</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;epoch&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nt">&#34;foo&#34;</span><span class="p">:</span> <span class="err">bar</span><span class="s2">&#34;, fizz&#34;</span><span class="p">:</span> <span class="err">buzz</span><span class="s2">&#34;, &#34;</span><span class="err">timestamp</span><span class="s2">&#34;: 1638422847.28721}
</span></span></span><span class="line"><span class="cl"><span class="s2">{&#34;</span><span class="err">epoch</span><span class="s2">&#34;: 1, &#34;</span><span class="err">foo</span><span class="s2">&#34;: bar&#34;</span><span class="p">,</span> <span class="err">fizz</span><span class="nt">&#34;: buzz&#34;</span><span class="p">,</span> <span class="nt">&#34;timestamp&#34;</span><span class="p">:</span> <span class="mf">1638422847.287801</span><span class="err"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;epoch&#34;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nt">&#34;foo&#34;</span><span class="p">:</span> <span class="err">bar</span><span class="s2">&#34;, fizz&#34;</span><span class="p">:</span> <span class="err">buzz</span><span class="s2">&#34;, &#34;</span><span class="err">timestamp</span><span class="s2">&#34;: &#34;</span><span class="mi">2021-12-02</span><span class="err">T</span><span class="mi">14</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mf">50.000035161</span><span class="err">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="s2">&#34;}
</span></span></span><span class="line"><span class="cl"><span class="s2">{&#34;</span><span class="err">epoch</span><span class="s2">&#34;: 3, &#34;</span><span class="err">foo</span><span class="s2">&#34;: bar&#34;</span><span class="p">,</span> <span class="err">fizz</span><span class="nt">&#34;: buzz&#34;</span><span class="p">,</span> <span class="nt">&#34;timestamp&#34;</span><span class="p">:</span> <span class="s2">&#34;2021-12-02T14:27:50.000037459+09:00&#34;</span><span class="err"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="err"></span>
</span></span></code></pre></div><p>Check the file metrics collector example for <a href="https://github.com/kubeflow/katib/blob/master/examples/v1beta1/metrics-collector/file-metrics-collector.yaml#L13-L22"><code>TEXT</code></a> and <a href="https://github.com/kubeflow/katib/blob/master/examples/v1beta1/metrics-collector/file-metrics-collector-with-json-format.yaml#L13-L20"><code>JSON</code></a> format.
Also, the default file path is <code>/var/log/katib/metrics.log</code>, and the default file format is <code>TEXT</code>.</p>
</li>
<li>
<p><code>TensorFlowEvent</code>: Katib collects the metrics from a directory path
containing a <a href="https://www.tensorflow.org/api_docs/python/tf/compat/v1/Event">tf.Event</a>.
You should specify the path in the <code>.source.fileSystemPath.path</code> field.
Check the
<a href="https://github.com/kubeflow/katib/blob/master/examples/v1beta1/kubeflow-training-operator/tfjob-mnist-with-summaries.yaml#L16-L22">TFJob example</a>.
The default directory path is <code>/var/log/katib/tfevent/</code>.</p>
</li>
<li>
<p><code>Custom</code>: Specify this value if you need to use a custom way to collect
metrics. You must define your custom metrics collector container
in the <code>.collector.customCollector</code> field.
Check the
<a href="https://github.com/kubeflow/katib/blob/master/examples/v1beta1/metrics-collector/custom-metrics-collector.yaml#L13-L35">custom metrics collector example</a>.</p>
</li>
<li>
<p><code>None</code>: Specify this value if you don&rsquo;t need to use Katib&rsquo;s metrics
collector. For example, your training code may handle the persistent
storage of its own metrics.</p>
</li>
</ul>
</li>
<li>
<p>Write code in your training container to print or save to the file metrics in the format
specified in the <code>.source.filter.metricsFormat</code>
field. The default format is <code>([\w|-]+)\s*=\s*([+-]?\d*(\.\d+)?([Ee][+-]?\d+)?)</code>.
Each element is a regular expression with two subexpressions. The first
matched expression is taken as the metric name. The second matched
expression is taken as the metric value.</p>
<p>For example, using the default metrics format and <code>StdOut</code> metrics collector,
if the name of your objective metric is <code>loss</code> and the additional metrics are
<code>recall</code> and <code>precision</code>, your training code should print the following output:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">epoch 1:
</span></span><span class="line"><span class="cl"><span class="nv">loss</span><span class="o">=</span>3.0e-02
</span></span><span class="line"><span class="cl"><span class="nv">recall</span><span class="o">=</span>0.5
</span></span><span class="line"><span class="cl"><span class="nv">precision</span><span class="o">=</span>.4
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">epoch 2:
</span></span><span class="line"><span class="cl"><span class="nv">loss</span><span class="o">=</span>1.3e-02
</span></span><span class="line"><span class="cl"><span class="nv">recall</span><span class="o">=</span>0.55
</span></span><span class="line"><span class="cl"><span class="nv">precision</span><span class="o">=</span>.5
</span></span></code></pre></div></li>
</ol>
<h2 id="running-the-experiment">Running the experiment</h2>
<p>You can run a Katib experiment from the command line or from the Katib UI.</p>
<h3 id="running-the-experiment-from-the-command-line">Running the experiment from the command line</h3>
<p>You can use <a href="https://kubernetes.io/docs/reference/kubectl/overview/">kubectl</a>
to launch an experiment from the command line:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl apply -f &lt;your-path/your-experiment-config.yaml&gt;
</span></span></code></pre></div><p><strong>Note:</strong></p>
<ul>
<li>
<p>If you deployed Katib as part of Kubeflow (your Kubeflow deployment
should include Katib), you need to change Kubeflow namespace to your
profile namespace.</p>
</li>
<li>
<p>(Optional) Katib&rsquo;s experiments don&rsquo;t work with
<a href="https://istio.io/latest/docs/setup/additional-setup/sidecar-injection/#automatic-sidecar-injection">Istio sidecar injection</a>.
If you are running Kubeflow using Istio, you have to disable sidecar injection. To do that, specify this annotation:
<code>sidecar.istio.io/inject: &quot;false&quot;</code> in your experiment&rsquo;s trial template. For
examples on how to do it for <code>Job</code>, <code>TFJob</code> (TensorFlow) or
<code>PyTorchJob</code> (PyTorch), refer to the
<a href="/docs/components/katib/hyperparameter/#examples">getting-started guide</a>.</p>
</li>
</ul>
<p>Run the following command to launch an experiment
using the random search algorithm example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl apply -f https://raw.githubusercontent.com/kubeflow/katib/master/examples/v1beta1/hp-tuning/random.yaml
</span></span></code></pre></div><p>Check the experiment status:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl -n kubeflow describe experiment &lt;your-experiment-name&gt;
</span></span></code></pre></div><p>For example, to check the status of the random search algorithm experiment run:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl -n kubeflow describe experiment random
</span></span></code></pre></div><h3 id="running-the-experiment-from-the-katib-ui">Running the experiment from the Katib UI</h3>
<p>Instead of using the command line, you can submit an experiment from the Katib
UI. The following steps assume you want to run a hyperparameter tuning
experiment. If you want to run a neural architecture search, access the <strong>NAS</strong>
section of the UI (instead of the <strong>HP</strong> section) and then follow a similar
sequence of steps.</p>
<p>To run a hyperparameter tuning experiment from the Katib UI:</p>
<ol>
<li>
<p>Follow the getting-started guide to
<a href="/docs/components/katib/hyperparameter/#katib-ui">access the Katib UI</a>.</p>
</li>
<li>
<p>Click <strong>NEW EXPERIMENT</strong> on the Katib home page.</p>
</li>
<li>
<p>You should be able to view tabs offering you the following options:</p>
<ul>
<li>
<p><strong>YAML file:</strong> Choose this option to supply an entire YAML file containing
the configuration for the experiment.</p>
<p><img src="/docs/components/katib/images/deploy-yaml.png"
alt="UI tab to paste a YAML configuration file"
class="mt-3 mb-3 border border-info rounded"></p>
</li>
<li>
<p><strong>Parameters:</strong> Choose this option to enter the configuration values
into a form.</p>
<p><img src="/docs/components/katib/images/deploy-parameters.png"
alt="UI form to deploy a Katib experiment"
class="mt-3 mb-3 border border-info rounded"></p>
</li>
</ul>
</li>
</ol>
<p>View the results of the experiment in the Katib UI:</p>
<ol>
<li>
<p>You should be able to view the list of experiments:</p>
<p><img src="/docs/components/katib/images/experiment-list.png"
alt="The random example in the list of Katib experiments"
class="mt-3 mb-3 border border-info rounded"></p>
</li>
<li>
<p>Click the name of your experiment. For example, click <strong>random-example</strong>.</p>
</li>
<li>
<p>There should be a graph showing the level of validation and train accuracy
for various combinations of the hyperparameter values (learning rate, number
of layers, and optimizer):</p>
<p><img src="/docs/components/katib/images/random-example-graph.png"
alt="Graph produced by the random example"
class="mt-3 mb-3 border border-info rounded"></p>
</li>
<li>
<p>Below the graph is a list of trials that ran within the experiment:</p>
<p><img src="/docs/components/katib/images/random-example-trials.png"
alt="Trials that ran during the experiment"
class="mt-3 mb-3 border border-info rounded"></p>
</li>
<li>
<p>You can click on trial name to get metrics for the particular trial:</p>
<p><img src="/docs/components/katib/images/random-example-trial-info.png"
alt="Trials that ran during the experiment"
class="mt-3 mb-3 border border-info rounded"></p>
</li>
</ol>
<h2 id="next-steps">Next steps</h2>
<ul>
<li>
<p>Learn how to run the
<a href="/docs/components/katib/hyperparameter/#random-search">random search algorithm and other Katib examples</a>.</p>
</li>
<li>
<p>How to
<a href="/docs/components/katib/resume-experiment/">restart your experiment and use the resume policies</a>.</p>
</li>
<li>
<p>Learn to configure your
<a href="/docs/components/katib/trial-template/">trial templates</a>.</p>
</li>
<li>
<p>For an overview of the concepts involved in hyperparameter tuning and
neural architecture search, check the
<a href="/docs/components/katib/overview/">introduction to Katib</a>.</p>
</li>
<li>
<p>Boost your hyperparameter tuning experiment with
the <a href="/docs/components/katib/early-stopping/">early stopping guide</a></p>
</li>
<li>
<p>Check the
<a href="/docs/components/katib/katib-config/">Katib Configuration (Katib config)</a>.</p>
</li>
<li>
<p>How to <a href="/docs/components/katib/env-variables/">set up environment variables</a>
for each Katib component.</p>
</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-bfd3194b361e71038ee054637a0a8043">4 - Resuming an Experiment</h1>
    <div class="lead">How to restart and modify running experiments</div>
	<p>This guide describes how to modify running experiments
and restart completed experiments. You will learn
about changing the experiment execution process and use various
resume policies for the Katib experiment.</p>
<p>For the details on how to configure and run your experiment, follow the
<a href="/docs/components/katib/experiment/">running an experiment guide</a>.</p>
<a id="modify-experiment">
<h2 id="modify-running-experiment">Modify running experiment</h2>
<p>While the experiment is running you are able to change trial count parameters.
For example, you can decrease the maximum number of
hyperparameter sets that are trained in parallel.</p>
<p>You can change only <strong><code>parallelTrialCount</code></strong>, <strong><code>maxTrialCount</code></strong> and <strong><code>maxFailedTrialCount</code></strong>
experiment parameters.</p>
<p>Use Kubernetes API or <code>kubectl</code>
<a href="https://kubernetes.io/docs/concepts/cluster-administration/manage-deployment/#in-place-updates-of-resources">in-place update of resources</a>
to make experiment changes. For example, run:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl edit experiment &lt;experiment-name&gt; -n &lt;experiment-namespace&gt;
</span></span></code></pre></div><p>Make appropriate changes and save it. Controller automatically processes
the new parameters and makes necessary changes.</p>
<ul>
<li>
<p>If you want to increase or decrease parallel trial execution,
modify <code>parallelTrialCount</code>. Controller accordingly creates or
deletes trials in line with the <code>parallelTrialCount</code> value.</p>
</li>
<li>
<p>If you want to increase or decrease maximum trial count,
modify <code>maxTrialCount</code>. <code>maxTrialCount</code> should be greater than current
count of <code>Succeeded</code> trials. You can remove the <code>maxTrialCount</code> parameter,
if your experiment should run endless with <code>parallelTrialCount</code> of parallel
trials until the experiment reaches <code>Goal</code> or <code>maxFailedTrialCount</code></p>
</li>
<li>
<p>If you want to increase or decrease maximum failed trial count,
modify <code>maxFailedTrialCount</code>. You can remove the <code>maxFailedTrialCount</code>
parameter, if the experiment should not reach <code>Failed</code> status.</p>
</li>
</ul>
<h2 id="resume-succeeded-experiment">Resume succeeded experiment</h2>
<p>Katib experiment is restartable only if it is in <strong><code>Succeeded</code></strong> status because
<code>maxTrialCount</code> has been reached. To check current experiment status run:
<code>kubectl get experiment &lt;experiment-name&gt; -n &lt;experiment-namespace&gt;</code>.</p>
<p>To restart an experiment, you are able to change only <strong><code>parallelTrialCount</code></strong>,
<strong><code>maxTrialCount</code></strong> and <strong><code>maxFailedTrialCount</code></strong>
as described <a href="#modify-experiment">above</a></p>
<p>To control various resume policies, you can specify <code>.spec.resumePolicy</code>
for the experiment.
Refer to the
<a href="https://github.com/kubeflow/katib/blob/master/pkg/apis/controller/experiments/v1beta1/experiment_types.go#L58"><code>ResumePolicy</code> type</a>.</p>
<h3 id="resume-policy-never">Resume policy: Never</h3>
<p>Use this policy if your experiment should not be resumed at any time.
After the experiment has finished,
the suggestion&rsquo;s <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Deployment</a>
and <a href="https://kubernetes.io/docs/concepts/services-networking/service/">Service</a>
are deleted and you can&rsquo;t restart the experiment.
Learn more about Katib concepts
in the <a href="/docs/components/katib/overview/#katib-concepts">overview guide</a>.</p>
<p>Check the
<a href="https://github.com/kubeflow/katib/blob/master/examples/v1beta1/resume-experiment/never-resume.yaml#L18"><code>never-resume.yaml</code></a>
example for more details.</p>
<h3 id="resume-policy-longrunning">Resume policy: LongRunning</h3>
<p>Use this policy if you intend to restart the experiment.
After the experiment has finished, the suggestion&rsquo;s Deployment and Service stay
running. Modify experiment&rsquo;s trial count parameters to restart the experiment.</p>
<p>When you delete the experiment, the suggestion&rsquo;s Deployment and
Service are deleted.</p>
<p>This is the default policy for all Katib experiments.
You can omit <code>.spec.resumePolicy</code> parameter for that functionality.</p>
<h3 id="resume-policy-fromvolume">Resume policy: FromVolume</h3>
<p>Use this policy if you intend to restart the experiment.
In that case, <a href="https://kubernetes.io/docs/concepts/storage/volumes/">volume</a>
is attached to the suggestion&rsquo;s Deployment.</p>
<p>Katib controller creates
<a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#persistentvolumeclaims">PersistentVolumeClaim (PVC)</a>
in addition to the suggestion&rsquo;s Deployment and Service.</p>
<p><strong>Note:</strong> Your Kubernetes cluster must have <code>StorageClass</code> for
<a href="https://kubernetes.io/docs/concepts/storage/dynamic-provisioning/">dynamic volume provisioning</a>
to automatically provision storage for the created PVC. Otherwise, you have to define
suggestion&rsquo;s <a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#persistent-volumes">PersistentVolume (PV)</a>
specification in the Katib configuration settings and Katib controller will create PVC and PV.
Follow the <a href="/docs/components/katib/katib-config/#suggestion-volume-settings">Katib configuration guide</a>
to set up the suggestion&rsquo;s volume settings.</p>
<ul>
<li>
<p>PVC is deployed with the name: <code>&lt;suggestion-name&gt;-&lt;suggestion-algorithm&gt;</code>
in the suggestion namespace.</p>
</li>
<li>
<p>PV is deployed with the name:
<code>&lt;suggestion-name&gt;-&lt;suggestion-algorithm&gt;-&lt;suggestion-namespace&gt;</code></p>
</li>
</ul>
<p>After the experiment has finished, the suggestion&rsquo;s Deployment and
Service are deleted. Suggestion data can be retained in the volume.
When you restart the experiment, the suggestion&rsquo;s Deployment and Service
are created and suggestion statistics can be recovered from the volume.</p>
<p>When you delete the experiment, the suggestion&rsquo;s Deployment, Service,
PVC and PV are deleted automatically.</p>
<p>Check the
<a href="https://github.com/kubeflow/katib/blob/master/examples/v1beta1/resume-experiment/from-volume-resume.yaml#L18"><code>from-volume-resume.yaml</code></a>
example for more details.</p>
<h2 id="next-steps">Next steps</h2>
<ul>
<li>
<p>Learn how to
<a href="/docs/components/katib/experiment/">configure and run your Katib experiments</a>.</p>
</li>
<li>
<p>Check the
<a href="/docs/components/katib/katib-config/">Katib Configuration (Katib config)</a>.</p>
</li>
<li>
<p>How to <a href="/docs/components/katib/env-variables/">set up environment variables</a>
for each Katib component.</p>
</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ae840460e289e0593ca27a1274d3e948">5 - Overview of Trial Templates</h1>
    <div class="lead">How to specify trial template parameters and support a custom resource (CRD) in Katib</div>
	<p>This guide describes how to configure trial template parameters and use custom
<a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/">Kubernetes CRD</a>
in Katib. You will learn about changing trial template specification, how to use
<a href="https://kubernetes.io/docs/concepts/configuration/configmap/">Kubernetes ConfigMaps</a>
to store templates and how to modify Katib controller to support your
Kubernetes CRD in Katib experiments.</p>
<p>Katib has these CRD examples in upstream:</p>
<ul>
<li>
<p><a href="https://kubernetes.io/docs/concepts/workloads/controllers/job/">Kubernetes <code>Job</code></a></p>
</li>
<li>
<p><a href="/docs/components/training/tftraining/">Kubeflow <code>TFJob</code></a></p>
</li>
<li>
<p><a href="/docs/components/training/pytorch/">Kubeflow <code>PyTorchJob</code></a></p>
</li>
<li>
<p><a href="/docs/components/training/mxnet">Kubeflow <code>MXJob</code></a></p>
</li>
<li>
<p><a href="/docs/components/training/xgboost">Kubeflow <code>XGBoostJob</code></a></p>
</li>
<li>
<p><a href="/docs/components/training/mpi">Kubeflow <code>MPIJob</code></a></p>
</li>
<li>
<p><a href="https://github.com/kubeflow/katib/tree/master/examples/v1beta1/tekton">Tekton <code>Pipelines</code></a></p>
</li>
<li>
<p><a href="https://github.com/kubeflow/katib/tree/master/examples/v1beta1/argo">Argo <code>Workflows</code></a></p>
</li>
</ul>
<p>To use your own Kubernetes resource follow the steps <a href="#custom-resource">below</a>.</p>
<p>For the details on how to configure and run your experiment, follow the
<a href="/docs/components/katib/experiment/">running an experiment guide</a>.</p>
<h2 id="use-trial-template-to-submit-experiment">Use trial template to submit experiment</h2>
<p>To run the Katib experiment you have to specify a trial template for your
worker job where actual training is running. Learn more about Katib concepts
in the <a href="/docs/components/katib/overview/#trial">overview guide</a>.</p>
<h3 id="configure-trial-template-specification">Configure trial template specification</h3>
<p>Trial template specification is located under <code>.spec.trialTemplate</code> of your experiment.
For the API overview refer to the
<a href="https://github.com/kubeflow/katib/blob/master/pkg/apis/controller/experiments/v1beta1/experiment_types.go#L208-L270"><code>TrialTemplate</code> type</a>.</p>
<p>To define experiment&rsquo;s trial, you should specify these parameters in <code>.spec.trialTemplate</code>:</p>
<ul>
<li>
<p><code>trialParameters</code> - list of the parameters which are used in the trial template
during experiment execution.</p>
<p><strong>Note:</strong> Your trial template must contain each parameter from the
<code>trialParameters</code>. You can set these parameters in any field of your template,
except <code>.metadata.name</code> and <code>.metadata.namespace</code>.
Check <a href="#template-metadata">below</a> how you can use trial <code>metadata</code> parameters
in your template. For example, your training container can receive
hyperparameters as command-line or arguments or as environment variables.</p>
<p>Your experiment&rsquo;s suggestion produces <code>trialParameters</code> before running the trial.
Each <code>trialParameter</code> has these structure:</p>
<ul>
<li>
<p><code>name</code> - the parameter name that is replaced in your template.</p>
</li>
<li>
<p><code>description</code> (optional) - the description of the parameter.</p>
</li>
<li>
<p><code>reference</code> - the parameter name that experiment&rsquo;s suggestion returns.
Usually, for the hyperparameter tuning parameter references are equal to the
experiment search space. For example, in grid example search space has
<a href="https://github.com/kubeflow/katib/blob/master/examples/v1beta1/hp-tuning/grid.yaml#L18-L36">three parameters</a>
(<code>lr</code>, <code>num-layers</code> and <code>optimizer</code>) and <code>trialParameters</code> contains each of
these parameters in
<a href="https://github.com/kubeflow/katib/blob/master/examples/v1beta1/hp-tuning/grid.yaml#L39-L48"><code>reference</code></a>.</p>
</li>
</ul>
</li>
<li>
<p>You have to define your experiment&rsquo;s trial template in <strong>one</strong> of the <code>trialSpec</code>
or <code>configMap</code> sources.</p>
<p><strong>Note:</strong> Your template must omit <code>.metadata.name</code> and <code>.metadata.namespace</code>.</p>
<p>To set the parameters from the <code>trialParameters</code>, you need to use this
expression: <code>${trialParameters.&lt;parameter-name&gt;}</code> in your template.
Katib automatically replaces it with the appropriate values from the
experiment&rsquo;s suggestion.</p>
<p>For example,
<a href="https://github.com/kubeflow/katib/blob/master/examples/v1beta1/hp-tuning/grid.yaml#L62"><code>--lr=${trialParameters.learningRate}</code></a>
is the <a href="https://github.com/kubeflow/katib/blob/master/examples/v1beta1/hp-tuning/grid.yaml#L40"><code>learningRate</code></a>
parameter.</p>
<ul>
<li>
<p><code>trialSpec</code> - the experiment&rsquo;s trial template in
<a href="https://godoc.org/k8s.io/apimachinery/pkg/apis/meta/v1/unstructured">unstructured</a>
format. The template should be a valid YAML. Check the
<a href="https://github.com/kubeflow/katib/blob/master/examples/v1beta1/hp-tuning/grid.yaml#L49-L65">grid example</a>.</p>
</li>
<li>
<p><code>configMap</code> - Kubernetes ConfigMap specification where the experiment&rsquo;s
trial template is located. This ConfigMap must have the label
<code>katib.kubeflow.org/component: trial-templates</code> and contains key-value pairs, where
<code>key: &lt;template-name&gt;, value: &lt;template-yaml&gt;</code>. Check the example of the
<a href="https://github.com/kubeflow/katib/blob/master/manifests/v1beta1/components/controller/trial-templates.yaml">ConfigMap with trial templates</a>.</p>
<p>The <code>configMap</code> specification should have:</p>
<ol>
<li>
<p><code>configMapName</code> - the ConfigMap name with the trial templates.</p>
</li>
<li>
<p><code>configMapNamespace</code> - the ConfigMap namespace with the trial templates.</p>
</li>
<li>
<p><code>templatePath</code> - the ConfigMap&rsquo;s data path to the template.</p>
</li>
</ol>
<p>Check the example with
<a href="https://github.com/kubeflow/katib/blob/master/examples/v1beta1/trial-template/trial-configmap-source.yaml#L50-L53">ConfigMap source</a>
for the trial template.</p>
</li>
</ul>
</li>
</ul>
<p><code>.spec.trialTemplate</code> parameters below are used to control trial behavior.
If parameter has the default value, it can be <strong>omitted</strong> in the experiment YAML.</p>
<ul>
<li>
<p><code>retain</code> - indicates that trial&rsquo;s resources are not clean-up after the trial
is complete. Check the example with
<a href="https://github.com/kubeflow/katib/blob/master/examples/v1beta1/tekton/pipeline-run.yaml#L32"><code>retain: true</code></a>
parameter.</p>
<p>The default value is <code>false</code></p>
</li>
<li>
<p><code>primaryPodLabels</code> - the
<a href="/docs/components/katib/overview/#worker-job">trial worker&rsquo;s</a> Pod or Pods
labels. These Pods are injected by Katib metrics collector.</p>
<p><strong>Note:</strong> If <code>primaryPodLabels</code> is <strong>omitted</strong>, the metrics collector wraps
all worker&rsquo;s Pods. Learn more about Katib metrics collector in
<a href="/docs/components/katib/experiment/#metrics-collector">running an experiment guide</a>.
Check the example with
<a href="https://github.com/kubeflow/katib/blob/master/examples/v1beta1/kubeflow-training-operator/mpijob-horovod.yaml#L29-L30"><code>primaryPodLabels</code></a>.</p>
<p>The default value for Kubeflow <code>TFJob</code>, <code>PyTorchJob</code>, <code>MXJob</code>, and <code>XGBoostJob</code> is <code>job-role: master</code></p>
<p>The <code>primaryPodLabels</code> default value works only if you specify your template
in <code>.spec.trialTemplate.trialSpec</code>. For the <code>configMap</code> template source you
have to manually set <code>primaryPodLabels</code>.</p>
</li>
<li>
<p><code>primaryContainerName</code> - the training container name where actual
model training is running. Katib metrics collector wraps this container
to collect required metrics for the single experiment optimization step.</p>
</li>
<li>
<p><code>successCondition</code> - The trial worker&rsquo;s object
<a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/kubernetes-objects/#object-spec-and-status">status</a>
in which trial&rsquo;s job has succeeded. This condition must be in
<a href="https://github.com/tidwall/gjson">GJSON format</a>. Check the example with
<a href="https://github.com/kubeflow/katib/blob/master/examples/v1beta1/tekton/pipeline-run.yaml#L36"><code>successCondition</code></a>.</p>
<p>The default value for Kubernetes <code>Job</code> is
<code>status.conditions.#(type==&quot;Complete&quot;)#|#(status==&quot;True&quot;)#</code></p>
<p>The default value for Kubeflow <code>TFJob</code>, <code>PyTorchJob</code>, <code>MXJob</code>, and <code>XGBoostJob</code> is
<code>status.conditions.#(type==&quot;Succeeded&quot;)#|#(status==&quot;True&quot;)#</code></p>
<p>The <code>successCondition</code> default value works only if you specify your template
in <code>.spec.trialTemplate.trialSpec</code>. For the <code>configMap</code> template source
you have to manually set <code>successCondition</code>.</p>
</li>
<li>
<p><code>failureCondition</code> - The trial worker&rsquo;s object
<a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/kubernetes-objects/#object-spec-and-status">status</a>
in which trial&rsquo;s job has failed. This condition must be in
<a href="https://github.com/tidwall/gjson">GJSON format</a>. Check the example with
<a href="https://github.com/kubeflow/katib/blob/master/examples/v1beta1/tekton/pipeline-run.yaml#L37"><code>failureCondition</code></a>.</p>
<p>The default value for Kubernetes <code>Job</code> is
<code>status.conditions.#(type==&quot;Failed&quot;)#|#(status==&quot;True&quot;)#</code></p>
<p>The default value for Kubeflow <code>TFJob</code>, <code>PyTorchJob</code>, <code>MXJob</code>, and <code>XGBoostJob</code> is
<code>status.conditions.#(type==&quot;Failed&quot;)#|#(status==&quot;True&quot;)#</code></p>
<p>The <code>failureCondition</code> default value works only if you specify your template
in <code>.spec.trialTemplate.trialSpec</code>. For the <code>configMap</code> template source you
have to manually set <code>failureCondition</code>.</p>
</li>
</ul>
<p><a id="template-metadata"></a></p>
<h3 id="use-trial-metadata-in-template">Use trial metadata in template</h3>
<p>You can&rsquo;t specify <code>.metadata.name</code> and <code>.metadata.namespace</code> in your
trial template, but you can get this data during the experiment run.
For example, if you want to append the trial&rsquo;s name to your model storage.</p>
<p>To do this, point <code>.trialParameters[x].reference</code> to the
appropriate metadata parameter and use <code>.trialParameters[x].name</code>
in your trial template.</p>
<p>The table below shows the connection between
<code>.trialParameters[x].reference</code> value and trial metadata.</p>
<div class="table-responsive">
  <table class="table table-bordered">
    <thead class="thead-light">
      <tr>
        <th>Reference</th>
        <th>Trial metadata</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>${trialSpec.Name}</code></td>
        <td>Trial name</td>
      </tr>
      <tr>
        <td><code>${trialSpec.Namespace}</code></td>
        <td>Trial namespace</td>
      </tr>
      <tr>
        <td><code>${trialSpec.Kind}</code></td>
        <td>Kubernetes resource kind for the trial's worker</td>
      </tr>
      <tr>
        <td><code>${trialSpec.APIVersion}</code></td>
        <td>Kubernetes resource APIVersion for the trial's worker</td>
      </tr>
      <tr>
        <td><code>${trialSpec.Labels[custom-key]}</code></td>
        <td>Trial's worker label with <code>custom-key</code> key </td>
      </tr>
      <tr>
        <td><code>${trialSpec.Annotations[custom-key]}</code></td>
        <td>Trial's worker annotation with <code>custom-key</code> key </td>
      </tr>
    </tbody>
  </table>
</div>
<p>Check the example of
<a href="https://github.com/kubeflow/katib/blob/master/examples/v1beta1/trial-template/trial-metadata-substitution.yaml">using trial metadata</a>.</p>
<p><a id="custom-resource"></a></p>
<h2 id="use-custom-kubernetes-resource-as-a-trial-template">Use custom Kubernetes resource as a trial template</h2>
<p>In Katib examples you can find the following trial worker types:
<a href="https://github.com/kubeflow/katib/blob/master/examples/v1beta1/hp-tuning/random.yaml">Kubernetes <code>Job</code></a>,
<a href="https://github.com/kubeflow/katib/blob/master/examples/v1beta1/kubeflow-training-operator/tfjob-mnist-with-summaries.yaml">Kubeflow <code>TFJob</code></a>,
<a href="https://github.com/kubeflow/katib/blob/master/examples/v1beta1/kubeflow-training-operator/pytorchjob-mnist.yaml">Kubeflow <code>PyTorchJob</code></a>,
<a href="https://github.com/kubeflow/katib/blob/master/examples/v1beta1/kubeflow-training-operator/mxjob-byteps.yaml">Kubeflow <code>MXJob</code></a>,
<a href="https://github.com/kubeflow/katib/blob/master/examples/v1beta1/kubeflow-training-operator/xgboostjob-lightgbm.yaml">Kubeflow <code>XGBoostJob</code></a>,
<a href="https://github.com/kubeflow/katib/blob/master/examples/v1beta1/kubeflow-training-operator/mpijob-horovod.yaml">Kubeflow <code>MPIJob</code></a>,
<a href="https://github.com/kubeflow/katib/tree/master/examples/v1beta1/tekton">Tekton <code>Pipelines</code></a>,
and <a href="https://github.com/kubeflow/katib/tree/master/examples/v1beta1/argo">Argo <code>Workflows</code></a>.</p>
<p>It is possible to use your own Kubernetes CRD or other Kubernetes resource
(e.g. <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Kubernetes <code>Deployment</code></a>)
as a trial worker without modifying Katib controller source code and building
the new image. As long as your CRD creates Kubernetes Pods, allows to inject
the <a href="https://kubernetes.io/docs/concepts/workloads/pods/">sidecar container</a> on
these Pods and has succeeded and failed status, you can use it in Katib.</p>
<p>To do that, you need to modify Katib components before installing it on your
Kubernetes cluster. Accordingly, you have to know your CRD API group and version,
the CRD object&rsquo;s kind. Also, you need to know which resources your custom object
is created. Check the
<a href="https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definitions/">Kubernetes guide</a>
to know more about CRDs.</p>
<p>Follow these two simple steps to integrate your custom CRD in Katib:</p>
<ol>
<li>
<p>Modify Katib controller
<a href="https://github.com/kubeflow/katib/blob/master/manifests/v1beta1/components/controller/rbac.yaml#L5">ClusterRole&rsquo;s rules</a>
with the new rule to give Katib access to all resources that are created
by the trial. To know more about ClusterRole, check
<a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/#role-and-clusterrole">Kubernetes guide</a>.</p>
<p>In case of Tekton <code>Pipelines</code>, trial creates Tekton <code>PipelineRun</code>, then
Tekton <code>PipelineRun</code> creates Tekton <code>TaskRun</code>. Therefore, Katib controller
ClusterRole should have access to the <code>pipelineruns</code> and <code>taskruns</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl">- <span class="nt">apiGroups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">tekton.dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">pipelineruns</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">taskruns</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">verbs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="s2">&#34;*&#34;</span><span class="w">
</span></span></span></code></pre></div></li>
<li>
<p>Modify Katib controller
<a href="https://github.com/kubeflow/katib/blob/master/manifests/v1beta1/components/controller/controller.yaml#L27">Deployment&rsquo;s <code>args</code></a>
with the new flag:
<code>--trial-resources=&lt;object-kind&gt;.&lt;object-API-version&gt;.&lt;object-API-group&gt;</code>.</p>
<p>For example, to support Tekton <code>Pipelines</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl">- <span class="s2">&#34;--trial-resources=PipelineRun.v1beta1.tekton.dev&#34;</span><span class="w">
</span></span></span></code></pre></div></li>
</ol>
<p>After these changes, deploy Katib as described in the
<a href="/docs/components/katib/hyperparameter/#installing-katib">getting started guide</a>
and wait until the <code>katib-controller</code> Pod is created.
You can check logs from the Katib controller to verify your resource integration:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ kubectl logs <span class="k">$(</span>kubectl get pods -n kubeflow -o name <span class="p">|</span> grep katib-controller<span class="k">)</span> -n kubeflow <span class="p">|</span> grep <span class="s1">&#39;&#34;CRD Kind&#34;:&#34;PipelineRun&#34;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1628032648.6285546,<span class="s2">&#34;logger&#34;</span>:<span class="s2">&#34;trial-controller&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Job watch added successfully&#34;</span>,<span class="s2">&#34;CRD Group&#34;</span>:<span class="s2">&#34;tekton.dev&#34;</span>,<span class="s2">&#34;CRD Version&#34;</span>:<span class="s2">&#34;v1beta1&#34;</span>,<span class="s2">&#34;CRD Kind&#34;</span>:<span class="s2">&#34;PipelineRun&#34;</span><span class="o">}</span>
</span></span></code></pre></div><p>If you ran the above steps successfully, you should be able to use your custom
object YAML in the experiment&rsquo;s trial template source spec.</p>
<p>We appreciate your feedback on using various CRDs in Katib.
It would be great, if you let us know about your experiments.
The <a href="https://github.com/kubeflow/katib/blob/master/docs/developer-guide.md">developer guide</a>
is a good starting point to know how to contribute to the project.</p>
<h2 id="next-steps">Next steps</h2>
<ul>
<li>
<p>Learn how to
<a href="/docs/components/katib/experiment/">configure and run your Katib experiments</a>.</p>
</li>
<li>
<p>Check the
<a href="/docs/components/katib/katib-config/">Katib Configuration (Katib config)</a>.</p>
</li>
<li>
<p>How to <a href="/docs/components/katib/env-variables/">set up environment variables</a>
for each Katib component.</p>
</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-b80a2e37cea35fb836557e60f56f4ce2">6 - Using Early Stopping</h1>
    <div class="lead">How to use early stopping in Katib experiments</div>
	<p>This guide shows how you can use
<a href="https://en.wikipedia.org/wiki/Early_stopping">early stopping</a> to improve your
Katib experiments. Early stopping allows you to avoid overfitting when you
train your model during Katib experiments. It also helps by saving computing
resources and reducing experiment execution time by stopping the experiment&rsquo;s
trials when the target metric(s) no longer improves before the training process
is complete.</p>
<p>The major advantage of using early stopping in Katib is that you don&rsquo;t
need to modify your
<a href="/docs/components/katib/experiment/#packaging-your-training-code-in-a-container-image">training container package</a>.
All you have to do is make necessary changes in your experiment&rsquo;s YAML file.</p>
<p>Early stopping works in the same way as Katib&rsquo;s
<a href="/docs/components/katib/experiment/#metrics-collector">metrics collector</a>.
It analyses required metrics from the <code>stdout</code> or from the arbitrary output file
and an early stopping algorithm makes the decision if the trial needs to be
stopped. Currently, early stopping works only with
<code>StdOut</code> or <code>File</code> metrics collectors.</p>
<p><strong>Note</strong>: Your training container must print training logs with the timestamp,
because early stopping algorithms need to know the sequence of reported metrics.
Check the
<a href="https://github.com/kubeflow/katib/blob/master/examples/v1beta1/trial-images/mxnet-mnist/mnist.py#L36"><code>MXNet</code> example</a>
to learn how to add a date format to your logs.</p>
<h2 id="configure-the-experiment-with-early-stopping">Configure the experiment with early stopping</h2>
<p>As a reference, you can use the YAML file of the
<a href="https://github.com/kubeflow/katib/blob/master/examples/v1beta1/early-stopping/median-stop.yaml">early stopping example</a>.</p>
<ol>
<li>
<p>Follow the
<a href="/docs/components/katib/experiment/#configuring-the-experiment">guide</a>
to configure your Katib experiment.</p>
</li>
<li>
<p>Next, to apply early stopping for your experiment, specify the <code>.spec.earlyStopping</code>
parameter, similar to the <code>.spec.algorithm</code>. Refer to the
<a href="https://github.com/kubeflow/katib/blob/master/pkg/apis/controller/common/v1beta1/common_types.go#L41-L58"><code>EarlyStoppingSpec</code> type</a>
for more information.</p>
<ul>
<li>
<p><code>.earlyStopping.algorithmName</code> - the name of the early stopping algorithm.</p>
</li>
<li>
<p><code>.earlyStopping.algorithmSettings</code>- the settings for the early stopping algorithm.</p>
</li>
</ul>
</li>
</ol>
<p>What happens is your experiment&rsquo;s suggestion produces new trials. After that,
the early stopping algorithm generates early stopping rules for the created
trials. Once the trial reaches all the rules, it is stopped and the trial status
is changed to the <code>EarlyStopped</code>. Then, Katib calls the suggestion again to
ask for the new trials.</p>
<p>Learn more about Katib concepts
in the <a href="/docs/components/katib/overview/#katib-concepts">overview guide</a>.</p>
<p>Follow the
<a href="/docs/components/katib/katib-config/#early-stopping-settings">Katib configuration guide</a>
to specify your own image for the early stopping algorithm.</p>
<h3 id="early-stopping-algorithms-in-detail">Early stopping algorithms in detail</h3>
<p>Heres a list of the early stopping algorithms available in Katib:</p>
<ul>
<li><a href="#median-stopping-rule">Median Stopping Rule</a></li>
</ul>
<p>More algorithms are under development.</p>
<p>You can add an early stopping algorithm to Katib yourself. Check the
<a href="https://github.com/kubeflow/katib/blob/master/docs/developer-guide.md">developer guide</a>
to contribute.</p>
<p><a id="median-stopping-rule"></a></p>
<h3 id="median-stopping-rule">Median Stopping Rule</h3>
<p>The early stopping algorithm name in Katib is <code>medianstop</code>.</p>
<p>The median stopping rule stops a pending trial <code>X</code> at step <code>S</code> if the trial&rsquo;s
best objective value by step <code>S</code> is worse than the median value of the running
averages of all completed trials&rsquo; objectives reported up to step <code>S</code>.</p>
<p>To learn more about it, check
<a href="https://static.googleusercontent.com/media/research.google.com/en//pubs/archive/46180.pdf">Google Vizier: A Service for Black-Box Optimization</a>.</p>
<p>Katib supports the following early stopping settings:</p>
<div class="table-responsive">
  <table class="table table-bordered">
    <thead class="thead-light">
      <tr>
        <th>Setting Name</th>
        <th>Description</th>
        <th>Default Value</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>min_trials_required</td>
        <td>Minimal number of successful trials to compute median value</td>
        <td>3</td>
      </tr>
      <tr>
        <td>start_step</td>
        <td>Number of reported intermediate results before stopping the trial</td>
        <td>4</td>
      </tr>
    </tbody>
  </table>
</div>
<h3 id="submit-an-early-stopping-experiment-from-the-ui">Submit an early stopping experiment from the UI</h3>
<p>You can use Katib UI to submit an early stopping experiment. Follow
<a href="/docs/components/katib/experiment/#running-the-experiment-from-the-katib-ui">these steps</a>
to create an experiment from the UI.</p>
<p>Once you reach the early stopping section, select the appropriate values:</p>
<p><img src="/docs/components/katib/images/early-stopping-parameter.png"
alt="UI form to deploy an early stopping Katib experiment"
class="mt-3 mb-3 border border-info rounded"></p>
<h2 id="view-the-early-stopping-experiment-results">View the early stopping experiment results</h2>
<p>First, make sure you have <a href="https://stedolan.github.io/jq/download/">jq</a>
installed.</p>
<p>Check the early stopped trials in your experiment:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl get experiment &lt;experiment-name&gt;  -n &lt;experiment-namespace&gt; -o json <span class="p">|</span> jq -r <span class="s2">&#34;.status&#34;</span>
</span></span></code></pre></div><p>The last part of the above command output looks similar to this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w">  </span><span class="l">. . .</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">&#34;earlyStoppedTrialList&#34;: </span><span class="p">[</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;median-stop-2ml8h96d&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;median-stop-cgjkq8zn&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;median-stop-pvn5p54p&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;median-stop-sjc9tcgc&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">],</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">&#34;startTime&#34;: </span><span class="s2">&#34;2020-11-05T03:03:43Z&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">&#34;succeededTrialList&#34;: </span><span class="p">[</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;median-stop-2kmh57qf&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;median-stop-7ccstz4z&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;median-stop-7sqt7556&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;median-stop-lgvhfch2&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;median-stop-mkfjtwbj&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;median-stop-nfmgqd7w&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;median-stop-nsbxw5m9&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;median-stop-nsmhg4p2&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;median-stop-rp88xflk&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;median-stop-xl7dlf5n&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;median-stop-ztc58kwq&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">],</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">&#34;trials&#34;: </span><span class="m">15</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">&#34;trialsEarlyStopped&#34;: </span><span class="m">4</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">&#34;trialsSucceeded&#34;: </span><span class="m">11</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>}<span class="w">
</span></span></span></code></pre></div><p>Check the status of the early stopped trial by running this command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl get trial median-stop-2ml8h96d -n &lt;experiment-namespace&gt;
</span></span></code></pre></div><p>and you should be able to view <code>EarlyStopped</code> status for the trial:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">NAME                   TYPE           STATUS   AGE
</span></span><span class="line"><span class="cl">median-stop-2ml8h96d   EarlyStopped   True     15m
</span></span></code></pre></div><p>In addition, you can check your results on the Katib UI.
The trial statuses on the experiment monitor page should look as follows:</p>
<p><img src="/docs/components/katib/images/early-stopping-trials.png"
alt="UI form to view trials"
class="mt-3 mb-3 border border-info rounded"></p>
<p>You can click on the early stopped trial name to get reported metrics before
this trial is early stopped:</p>
<p><img src="/docs/components/katib/images/early-stopping-trial-info.png"
alt="UI form to view trial info"
class="mt-3 mb-3 border border-info rounded"></p>
<h2 id="next-steps">Next steps</h2>
<ul>
<li>
<p>Learn how to
<a href="/docs/components/katib/experiment/">configure and run your Katib experiments</a>.</p>
</li>
<li>
<p>How to
<a href="/docs/components/katib/resume-experiment/">restart your experiment and use the resume policies</a>.</p>
</li>
<li>
<p>Check the
<a href="/docs/components/katib/katib-config/">Katib Configuration (Katib config)</a>.</p>
</li>
<li>
<p>How to <a href="/docs/components/katib/env-variables/">set up environment variables</a>
for each Katib component.</p>
</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-51e1645fcfdf30aa149835216f6f8cd0">7 - Katib Configuration Overview</h1>
    <div class="lead">How to make changes in Katib configuration</div>
	<p>This guide describes
<a href="https://github.com/kubeflow/katib/blob/master/manifests/v1beta1/components/controller/katib-config.yaml">Katib config</a> 
the Kubernetes
<a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/">Config Map</a> that contains information about:</p>
<ol>
<li>
<p>Current
<a href="/docs/components/katib/experiment/#metrics-collector">metrics collectors</a>
(<code>key = metrics-collector-sidecar</code>).</p>
</li>
<li>
<p>Current
<a href="/docs/components/katib/experiment/#search-algorithms-in-detail">algorithms</a>
(suggestions) (<code>key = suggestion</code>).</p>
</li>
<li>
<p>Current
<a href="/docs/components/katib/early-stopping/#early-stopping-algorithms-in-detail">early stopping algorithms</a>
(<code>key = early-stopping</code>).</p>
</li>
</ol>
<p>The Katib Config Map must be deployed in the
<a href="/docs/components/katib/env-variables/#katib-controller"><code>KATIB_CORE_NAMESPACE</code></a>
namespace with the <code>katib-config</code> name. The Katib controller parses the Katib config when
you submit your experiment.</p>
<p>You can edit this Config Map even after deploying Katib.</p>
<p>If you are deploying Katib in the Kubeflow namespace, run this command to edit your Katib config:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl edit configMap katib-config -n kubeflow
</span></span></code></pre></div><h2 id="metrics-collector-sidecar-settings">Metrics Collector Sidecar settings</h2>
<p>These settings are related to Katib metrics collectors, where:</p>
<ul>
<li>key: <code>metrics-collector-sidecar</code></li>
<li>value: corresponding JSON settings for each metrics collector kind</li>
</ul>
<p>Example for the <code>File</code> metrics collector with all settings:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="err">metrics-collector-sidecar:</span> <span class="err">|-</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;File&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;image&#34;</span><span class="p">:</span> <span class="s2">&#34;docker.io/kubeflowkatib/file-metrics-collector&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;imagePullPolicy&#34;</span><span class="p">:</span> <span class="s2">&#34;Always&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;resources&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;requests&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;memory&#34;</span><span class="p">:</span> <span class="s2">&#34;200Mi&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;cpu&#34;</span><span class="p">:</span> <span class="s2">&#34;250m&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;ephemeral-storage&#34;</span><span class="p">:</span> <span class="s2">&#34;200Mi&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;limits&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;memory&#34;</span><span class="p">:</span> <span class="s2">&#34;1Gi&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;cpu&#34;</span><span class="p">:</span> <span class="s2">&#34;500m&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;ephemeral-storage&#34;</span><span class="p">:</span> <span class="s2">&#34;2Gi&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;waitAllProcesses&#34;</span><span class="p">:</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="err">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>All of these settings except <strong><code>image</code></strong> can be omitted. If you don&rsquo;t specify any other settings,
a default value is set automatically.</p>
<ol>
<li>
<p><code>image</code> - a Docker image for the <code>File</code> metrics collector&rsquo;s container (<strong>must be specified</strong>).</p>
</li>
<li>
<p><code>imagePullPolicy</code> - an <a href="https://kubernetes.io/docs/concepts/configuration/overview/#container-images">image pull policy</a>
for the <code>File</code> metrics collector&rsquo;s container.</p>
<p>The default value is <code>IfNotPresent</code></p>
</li>
<li>
<p><code>resources</code> - <a href="https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#resource-requests-and-limits-of-pod-and-container">resources</a>
for the <code>File</code> metrics collector&rsquo;s container. In the above example you
can check how to specify <code>limits</code> and <code>requests</code>. Currently, you can specify
only <code>memory</code>, <code>cpu</code> and <code>ephemeral-storage</code> resources.</p>
<p>The default values for the <code>requests</code> are:</p>
<ul>
<li><code>memory = 10Mi</code></li>
<li><code>cpu = 50m</code></li>
<li><code>ephemeral-storage = 500Mi</code></li>
</ul>
<p>The default values for the <code>limits</code> are:</p>
<ul>
<li><code>memory = 100Mi</code></li>
<li><code>cpu = 500m</code></li>
<li><code>ephemeral-storage = 5Gi</code></li>
</ul>
<p>You can run your metrics collector&rsquo;s container without requesting
the <code>cpu</code>, <code>memory</code>, or <code>ephemeral-storage</code> resource from the Kubernetes cluster.
For instance, you have to remove <code>ephemeral-storage</code> from the container resources to use the
<a href="https://cloud.google.com/kubernetes-engine/docs/concepts/cluster-autoscaler#limitations">Google Kubernetes Engine cluster autoscaler</a>.</p>
<p>To remove specific resources from the metrics collector&rsquo;s container set the
negative values in requests and limits in your Katib config as follows:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="s2">&#34;requests&#34;</span><span class="err">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;cpu&#34;</span><span class="p">:</span> <span class="s2">&#34;-1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;memory&#34;</span><span class="p">:</span> <span class="s2">&#34;-1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;ephemeral-storage&#34;</span><span class="p">:</span> <span class="s2">&#34;-1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="err">,</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;limits&#34;</span><span class="err">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;cpu&#34;</span><span class="p">:</span> <span class="s2">&#34;-1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;memory&#34;</span><span class="p">:</span> <span class="s2">&#34;-1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;ephemeral-storage&#34;</span><span class="p">:</span> <span class="s2">&#34;-1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></li>
<li>
<p><code>waitAllProcesses</code> - a flag to define whether the metrics collector should
wait until all processes in the training container are finished before start
to collect metrics.</p>
<p>The default value is <code>true</code></p>
</li>
</ol>
<h2 id="suggestion-settings">Suggestion settings</h2>
<p>These settings are related to Katib suggestions, where:</p>
<ul>
<li>key: <code>suggestion</code></li>
<li>value: corresponding JSON settings for each algorithm name</li>
</ul>
<p>If you want to use a new algorithm, you need to update the Katib config. For example,
using a <code>random</code> algorithm with all settings looks as follows:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="err">suggestion:</span> <span class="err">|-</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;random&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;image&#34;</span><span class="p">:</span> <span class="s2">&#34;docker.io/kubeflowkatib/suggestion-hyperopt&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;imagePullPolicy&#34;</span><span class="p">:</span> <span class="s2">&#34;Always&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;resources&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;requests&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;memory&#34;</span><span class="p">:</span> <span class="s2">&#34;100Mi&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;cpu&#34;</span><span class="p">:</span> <span class="s2">&#34;100m&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;ephemeral-storage&#34;</span><span class="p">:</span> <span class="s2">&#34;100Mi&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;limits&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;memory&#34;</span><span class="p">:</span> <span class="s2">&#34;500Mi&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;cpu&#34;</span><span class="p">:</span> <span class="s2">&#34;500m&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;ephemeral-storage&#34;</span><span class="p">:</span> <span class="s2">&#34;3Gi&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;serviceAccountName&#34;</span><span class="p">:</span> <span class="s2">&#34;random-sa&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="err">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>All of these settings except <strong><code>image</code></strong> can be omitted. If you don&rsquo;t specify
any other settings, a default value is set automatically.</p>
<ol>
<li>
<p><code>image</code> - a Docker image for the suggestion&rsquo;s container with a <code>random</code>
algorithm (<strong>must be specified</strong>).</p>
<p>Image example: <code>docker.io/kubeflowkatib/&lt;suggestion-name&gt;</code></p>
<p>For each algorithm (suggestion) you can specify one of the following
suggestion names in the Docker image:</p>
<div class="table-responsive">
  <table class="table table-bordered">
    <thead class="thead-light">
      <tr>
        <th>Suggestion name</th>
        <th>List of supported algorithms</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>suggestion-hyperopt</code></td>
        <td><code>random</code>, <code>tpe</code></td>
        <td><a href="https://github.com/hyperopt/hyperopt">Hyperopt</a> optimization framework</td>
      </tr>
      <tr>
        <td><code>suggestion-chocolate</code></td>
        <td><code>grid</code>, <code>random</code>, <code>quasirandom</code>, <code>bayesianoptimization</code>, <code>mocmaes</code></td>
        <td><a href="https://github.com/AIworx-Labs/chocolate">Chocolate</a> optimization framework</td>
      </tr>
      <tr>
        <td><code>suggestion-skopt</code></td>
        <td><code>bayesianoptimization</code></td>
        <td><a href="https://github.com/scikit-optimize/scikit-optimize">Scikit-optimize</a> optimization framework</td>
      </tr>
      <tr>
        <td><code>suggestion-goptuna</code></td>
        <td><code>cmaes</code>, <code>random</code>, <code>tpe</code>, <code>sobol</code></td>
        <td><a href="https://github.com/c-bata/goptuna">Goptuna</a> optimization framework</td>
      </tr>
      <tr>
        <td><code>suggestion-optuna</code></td>
        <td><code>multivariate-tpe</code>, <code>tpe</code>, <code>cmaes</code>, <code>random</code></td>
        <td><a href="https://github.com/optuna/optuna">Optuna</a> optimization framework</td>
      </tr>
      <tr>
        <td><code>suggestion-hyperband</code></td>
        <td><code>hyperband</code></td>
        <td><a href="https://github.com/kubeflow/katib/tree/master/pkg/suggestion/v1beta1/hyperband">Katib
          Hyperband</a> implementation</td>
      </tr>
      <tr>
        <td><code>suggestion-pbt</code></td>
        <td><code>pbt</code></td>
        <td><a href="https://github.com/kubeflow/katib/tree/master/pkg/suggestion/v1beta1/pbt">Katib
          PBT</a> implementation</td>
      </tr>
      <tr>
        <td><code>suggestion-enas</code></td>
        <td><code>enas</code></td>
        <td><a href="https://github.com/kubeflow/katib/tree/master/pkg/suggestion/v1beta1/nas/enas">Katib
          ENAS</a> implementation</td>
      </tr>
      <tr>
        <td><code>suggestion-darts</code></td>
        <td><code>darts</code></td>
        <td><a href="https://github.com/kubeflow/katib/tree/master/pkg/suggestion/v1beta1/nas/darts">Katib
          DARTS</a> implementation</td>
      </tr>
    </tbody>
  </table>
</div>
</li>
<li>
<p><code>imagePullPolicy</code> - an <a href="https://kubernetes.io/docs/concepts/configuration/overview/#container-images">image pull policy</a>
for the suggestion&rsquo;s container with a <code>random</code> algorithm.</p>
<p>The default value is <code>IfNotPresent</code></p>
</li>
<li>
<p><code>resources</code> - <a href="https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#resource-requests-and-limits-of-pod-and-container">resources</a>
for the suggestion&rsquo;s container with a <code>random</code> algorithm.
In the above example you can check how to specify <code>limits</code> and <code>requests</code>.
Currently, you can specify only <code>memory</code>, <code>cpu</code> and
<code>ephemeral-storage</code> resources.</p>
<p>The default values for the <code>requests</code> are:</p>
<ul>
<li><code>memory = 10Mi</code></li>
<li><code>cpu = 50m</code></li>
<li><code>ephemeral-storage = 500Mi</code></li>
</ul>
<p>The default values for the <code>limits</code> are:</p>
<ul>
<li><code>memory = 100Mi</code></li>
<li><code>cpu = 500m</code></li>
<li><code>ephemeral-storage = 5Gi</code></li>
</ul>
<p>You can run your suggestion&rsquo;s container without requesting
the <code>cpu</code>, <code>memory</code>, or <code>ephemeral-storage</code> resource from the Kubernetes cluster.
For instance, you have to remove <code>ephemeral-storage</code> from the container resources to use the
<a href="https://cloud.google.com/kubernetes-engine/docs/concepts/cluster-autoscaler#limitations">Google Kubernetes Engine cluster autoscaler</a>.</p>
<p>To remove specific resources from the suggestion&rsquo;s container set the
negative values in requests and limits in your Katib config as follows:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="s2">&#34;requests&#34;</span><span class="err">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;cpu&#34;</span><span class="p">:</span> <span class="s2">&#34;-1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;memory&#34;</span><span class="p">:</span> <span class="s2">&#34;-1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;ephemeral-storage&#34;</span><span class="p">:</span> <span class="s2">&#34;-1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="err">,</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;limits&#34;</span><span class="err">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;cpu&#34;</span><span class="p">:</span> <span class="s2">&#34;-1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;memory&#34;</span><span class="p">:</span> <span class="s2">&#34;-1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;ephemeral-storage&#34;</span><span class="p">:</span> <span class="s2">&#34;-1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></li>
<li>
<p><code>serviceAccountName</code> - a <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/">service account</a>
for the suggestion&rsquo;s container with a <code>random</code> algorithm.</p>
<p>In the above example, the <code>random-sa</code> service account is attached for each
experiment&rsquo;s suggestion with a <code>random</code> algorithm until you change or delete
this service account from the Katib config.</p>
<p>By default, the suggestion pod doesn&rsquo;t have any specific service account,
in which case, the pod uses the
<a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/#use-the-default-service-account-to-access-the-api-server">default</a>
service account.</p>
<p><strong>Note:</strong> If you want to run your experiments with
<a href="/docs/components/katib/early-stopping/">early stopping</a>,
the suggestion&rsquo;s deployment must have permission to update the experiment&rsquo;s
trial status. If you don&rsquo;t specify a service account in the Katib config,
Katib controller creates required
<a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac">Kubernetes Role-based access control</a>
for the suggestion.</p>
<p>If you need your own service account for the experiment&rsquo;s
suggestion with early stopping, you have to follow the rules:</p>
<ul>
<li>
<p>The service account name can&rsquo;t be equal to
<code>&lt;experiment-name&gt;-&lt;experiment-algorithm&gt;</code></p>
</li>
<li>
<p>The service account must have sufficient permissions to update
the experiment&rsquo;s trial status.</p>
</li>
</ul>
</li>
</ol>
<h3 id="suggestion-volume-settings">Suggestion volume settings</h3>
<p>When you create an experiment with
<a href="/docs/components/katib/resume-experiment#resume-policy-fromvolume"><code>FromVolume</code> resume policy</a>,
you are able to specify
<a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#persistent-volumes">PersistentVolume (PV)</a>
and
<a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#persistentvolumeclaims">PersistentVolumeClaim (PVC)</a>
settings for the experiment&rsquo;s suggestion. Learn more about Katib concepts
in the <a href="/docs/components/katib/overview/#suggestion">overview guide</a>.</p>
<p>If PV settings are empty, Katib controller creates only PVC.
If you want to use the default volume specification, you can omit these settings.</p>
<p>Follow the example for the <code>random</code> algorithm:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="err">suggestion:</span> <span class="err">|-</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;random&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;image&#34;</span><span class="p">:</span> <span class="s2">&#34;docker.io/kubeflowkatib/suggestion-hyperopt&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;volumeMountPath&#34;</span><span class="p">:</span> <span class="s2">&#34;/opt/suggestion/data&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;persistentVolumeClaimSpec&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;accessModes&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ReadWriteMany&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;resources&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;requests&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;storage&#34;</span><span class="p">:</span> <span class="s2">&#34;3Gi&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;storageClassName&#34;</span><span class="p">:</span> <span class="s2">&#34;katib-suggestion&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;persistentVolumeSpec&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;accessModes&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ReadWriteMany&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;capacity&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;storage&#34;</span><span class="p">:</span> <span class="s2">&#34;3Gi&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;hostPath&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;path&#34;</span><span class="p">:</span> <span class="s2">&#34;/tmp/suggestion/unique/path&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;storageClassName&#34;</span><span class="p">:</span> <span class="s2">&#34;katib-suggestion&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;persistentVolumeLabels&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;local&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="err">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ol>
<li>
<p><code>volumeMountPath</code> - a <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-volume-storage/#configure-a-volume-for-a-pod">mount path</a>
for the suggestion&rsquo;s container with <code>random</code> algorithm.</p>
<p>The default value is <code>/opt/katib/data</code></p>
</li>
<li>
<p><code>persistentVolumeClaimSpec</code> - a <a href="https://v1-18.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#persistentvolumeclaimspec-v1-core">PVC specification</a>
for the suggestion&rsquo;s PVC.</p>
<p>The default value is set, if you don&rsquo;t specify any of these settings:</p>
<ul>
<li>
<p><code>persistentVolumeClaimSpec.accessModes[0]</code> - the default value is
<a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#access-modes"><code>ReadWriteOnce</code></a></p>
</li>
<li>
<p><code>persistentVolumeClaimSpec.resources.requests.storage</code> - the default value
is <code>1Gi</code></p>
</li>
</ul>
</li>
<li>
<p><code>persistentVolumeSpec</code> - a <a href="https://v1-18.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#persistentvolumespec-v1-core">PV specification</a>
for the suggestion&rsquo;s PV.</p>
<p>PV <code>persistentVolumeReclaimPolicy</code> is always equal to <strong><code>Delete</code></strong> to properly
remove all resources once Katib experiment is deleted. To know more about
PV reclaim policies check the
<a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#reclaiming">Kubernetes documentation</a>.</p>
</li>
<li>
<p><code>persistentVolumeLabels</code> - <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/">PV labels</a>
for the suggestion&rsquo;s PV.</p>
</li>
</ol>
<h2 id="early-stopping-settings">Early stopping settings</h2>
<p>These settings are related to Katib early stopping, where:</p>
<ul>
<li>key: <code>early-stopping</code></li>
<li>value: corresponding JSON settings for each early stopping algorithm name</li>
</ul>
<p>If you want to use a new early stopping algorithm, you need to update the
Katib config. For example, using a <code>medianstop</code> early stopping algorithm with
all settings looks as follows:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="err">early-stopping:</span> <span class="err">|-</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;medianstop&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;image&#34;</span><span class="p">:</span> <span class="s2">&#34;docker.io/kubeflowkatib/earlystopping-medianstop&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;imagePullPolicy&#34;</span><span class="p">:</span> <span class="s2">&#34;Always&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="err">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>All of these settings except <strong><code>image</code></strong> can be omitted. If you don&rsquo;t specify
any other settings, a default value is set automatically.</p>
<ol>
<li>
<p><code>image</code> - a Docker image for the early stopping&rsquo;s container with a
<code>medianstop</code> algorithm (<strong>must be specified</strong>).</p>
<p>Image example: <code>docker.io/kubeflowkatib/&lt;early-stopping-name&gt;</code></p>
<p>For each early stopping algorithm you can specify one of the following
early stopping names in the Docker image:</p>
<div class="table-responsive">
  <table class="table table-bordered">
    <thead class="thead-light">
      <tr>
        <th>Early stopping name</th>
        <th>Early stopping algorithm</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>earlystopping-medianstop</code></td>
        <td><code>medianstop</code></td>
        <td><a href="https://github.com/kubeflow/katib/tree/master/pkg/earlystopping/v1beta1/medianstop">Katib
          Median Stopping</a> implementation</td>
      </tr>
    </tbody>
  </table>
</div>
</li>
<li>
<p><code>imagePullPolicy</code> - an
<a href="https://kubernetes.io/docs/concepts/configuration/overview/#container-images">image pull policy</a>
for the early stopping&rsquo;s container with a <code>medianstop</code> algorithm.</p>
<p>The default value is <code>IfNotPresent</code></p>
</li>
</ol>
<h2 id="next-steps">Next steps</h2>
<ul>
<li>
<p>Learn how to
<a href="/docs/components/katib/experiment/">configure and run your Katib experiments</a>.</p>
</li>
<li>
<p>How to
<a href="/docs/components/katib/resume-experiment/">restart your experiment and use the resume policies</a>.</p>
</li>
<li>
<p>How to <a href="/docs/components/katib/env-variables/">set up environment variables</a>
for each Katib component.</p>
</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-cffe32d69412f2ff2bd13ff9e8bcea7f">8 - Environment Variables for Katib Components</h1>
    <div class="lead">How to set up environment variables for each Katib component</div>
	<p>This guide describes environment variables for each Katib component.
If you want to change your Katib installation,
you can modify some of these variables.</p>
<p>In the tables below you can find descriptions, default values and mandatory
properties for all environment variables in each Katib component.
If a variable has a mandatory property, you need to set the relevant
environment variable in an appropriate Katib component&rsquo;s manifest.</p>
<h2 id="katib-controller">Katib Controller</h2>
<p>Bellow are the environment variables for the
<a href="https://github.com/kubeflow/katib/blob/master/manifests/v1beta1/components/controller/controller.yaml">Katib Controller</a>
deployment:</p>
<div class="table-responsive">
  <table class="table table-bordered">
    <thead class="thead-light">
      <tr>
        <th>Variable</th>
        <th>Description</th>
        <th>Default Value</th>
        <th>Mandatory</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>KATIB_CORE_NAMESPACE</code></td>
        <td>Base Namespace for all Katib components and default Experiment</td>
        <td><code>metadata.namespace</code></td>
        <td>Yes</td>
      </tr>
      <tr>
        <td><code>KATIB_SUGGESTION_COMPOSER</code></td>
        <td> <a href="https://github.com/kubeflow/katib/blob/master/pkg/controller.v1beta1/suggestion/composer/composer.go">Composer</a>
          for the Katib Suggestions. You can use your own Composer</td>
        <td>general</td>
        <td>No</td>
      </tr>
      <tr>
        <td><code>KATIB_DB_MANAGER_SERVICE_NAMESPACE</code></td>
        <td>Katib DB Manager Namespace</td>
        <td><code>KATIB_CORE_NAMESPACE</code> env variable</td>
        <td>No</td>
      </tr>
      <tr>
        <td><code>KATIB_DB_MANAGER_SERVICE_IP</code></td>
        <td>Katib DB Manager IP</td>
        <td>katib-db-manager</td>
        <td>No</td>
      </tr>
       <tr>
        <td><code>KATIB_DB_MANAGER_SERVICE_PORT</code></td>
        <td>Katib DB Manager Port</td>
        <td>6789</td>
        <td>No</td>
      </tr>
    </tbody>
  </table>
</div>
<p>Katib Controller calls Katib DB Manager with this address expression:</p>
<p><strong><code>KATIB_DB_MANAGER_SERVICE_IP.KATIB_DB_MANAGER_SERVICE_NAMESPACE:KATIB_DB_MANAGER_SERVICE_PORT</code></strong></p>
<p>If you set <code>KATIB_DB_MANAGER_SERVICE_NAMESPACE=&quot;&quot;</code>, Katib Controller calls Katib DB Manager with this address:</p>
<p><strong><code>KATIB_DB_MANAGER_SERVICE_IP:KATIB_DB_MANAGER_SERVICE_PORT</code></strong></p>
<p>If you want to use your own DB Manager to report Katib metrics, you can change <code>KATIB_DB_MANAGER_SERVICE_NAMESPACE</code>, <code>KATIB_DB_MANAGER_SERVICE_IP</code> and <code>KATIB_DB_MANAGER_SERVICE_PORT</code> variables.</p>
<h2 id="katib-ui">Katib UI</h2>
<p>Below are the environment variables for the
<a href="https://github.com/kubeflow/katib/blob/master/manifests/v1beta1/components/ui/ui.yaml">Katib UI</a>
deployment:</p>
<div class="table-responsive">
  <table class="table table-bordered">
    <thead class="thead-light">
      <tr>
        <th>Variable</th>
        <th>Description</th>
        <th>Default Value</th>
        <th>Mandatory</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>KATIB_CORE_NAMESPACE</code></td>
        <td>Base Namespace for all Katib components and default Experiment</td>
        <td><code>metadata.namespace</code></td>
        <td>Yes</td>
      </tr>
      <tr>
        <td><code>KATIB_DB_MANAGER_SERVICE_NAMESPACE</code></td>
        <td>Katib DB Manager Namespace</td>
        <td><code>KATIB_CORE_NAMESPACE</code> env variable</td>
        <td>No</td>
      </tr>
      <tr>
        <td><code>KATIB_DB_MANAGER_SERVICE_IP</code></td>
        <td>Katib DB Manager IP</td>
        <td>katib-db-manager</td>
        <td>No</td>
      </tr>
       <tr>
        <td><code>KATIB_DB_MANAGER_SERVICE_PORT</code></td>
        <td>Katib DB Manager Port</td>
        <td>6789</td>
        <td>No</td>
      </tr>
    </tbody>
  </table>
</div>
<p>Katib UI calls Katib DB Manager with the same address expression as Katib Controller.</p>
<h2 id="katib-db-manager">Katib DB Manager</h2>
<p>Bellow are the environment variables for the
<a href="https://github.com/kubeflow/katib/blob/master/manifests/v1beta1/components/db-manager/db-manager.yaml">Katib DB Manager</a>
deployment:</p>
<div class="table-responsive">
  <table class="table table-bordered">
    <thead class="thead-light">
      <tr>
        <th>Variable</th>
        <th>Description</th>
        <th>Default Value</th>
        <th>Mandatory</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>DB_NAME</code></td>
        <td>Katib DB Name: 'mysql' or 'postgres'</td>
        <td>  </td> 
        <td>Yes</td>
      </tr>
      <tr>
        <td><code>DB_PASSWORD</code></td>
        <td>Katib DB Password</td>
        <td>test (MySQL)<br>katib (Postgres)</td>
        <td>Yes</td>
      </tr>
      <tr>
        <td><code>DB_USER</code></td>
        <td>Katib DB User</td>
        <td>root (MySQL)<br>katib (Postgres)</td>
        <td>No</td>
      </tr>
      <tr>
        <td><code>KATIB_MYSQL_DB_HOST</code></td>
        <td>Katib MySQL Host</td>
        <td>katib-mysql</td>
        <td>No</td>
      </tr>
      <tr>
        <td><code>KATIB_MYSQL_DB_PORT</code></td>
        <td>Katib MySQL Port</td>
        <td>3306</td>
        <td>No</td>
      </tr>
      <tr>
        <td><code>KATIB_MYSQL_DB_DATABASE</code></td>
        <td>Katib MySQL Database name</td>
        <td>katib</td>
        <td>No</td>
      </tr>
      <tr>
        <td><code>KATIB_POSTGRESQL_DB_HOST</code></td>
        <td>Katib Postgres Host</td>
        <td>katib-postgres</td>
        <td>No</td>
      </tr>
      <tr>
        <td><code>KATIB_POSTGRESQL_DB_PORT</code></td>
        <td>Katib Postgres Port</td>
        <td>5432</td>
        <td>No</td>
      </tr>
      <tr>
        <td><code>KATIB_POSTGRESQL_DATABASE</code></td>
        <td>Katib Postgres Database name</td>
        <td>katib</td>
        <td>No</td>
      </tr>
    </tbody>
  </table>
</div>
<p>Currently, Katib DB Manager supports only <strong>MySQL</strong> and <strong>Postgres</strong> database. (<code>DB_NAME</code> env variable must be filled with one of <code>mysql</code> or <code>postgres</code>)<br>
However, you can use your own DB Manager and Database to report metrics by implements the <a href="https://github.com/kubeflow/katib/blob/master/pkg/db/v1beta1/common/kdb.go">katib db interface</a>.</p>
<p>For the <a href="https://github.com/kubeflow/katib/blob/master/manifests/v1beta1/components/db-manager/db-manager.yaml#L25">Katib DB Manager</a>
you can change <code>DB_PASSWORD</code> to your own DB password.</p>
<p>Katib DB Manager creates DB connection to the DB by the type of DB.<br>
If <code>DB_NAME=mysql</code>, it uses <code>mysql</code> driver and this data source name:<br>
<strong><code>DB_USER:DB_PASSWORD@tcp(KATIB_MYSQL_DB_HOST:KATIB_MYSQL_DB_PORT)/KATIB_MYSQL_DB_DATABASE?timeout=5s</code></strong></p>
<p>If <code>DB_NAME=postgres</code>, it uses <code>pq</code> driver and this data source name:<br>
<strong><code>postgresql://[DB_USER[:DB_PASSWORD]@][KATIB_POSTGRESQL_DB_HOST][:KATIB_POSTGRESQL_DB_PORT][/KATIB_POSTGRESQL_DB_DATABASE]</code></strong></p>
<h2 id="katib-db">Katib DB</h2>
<p>Katib DB components supports MySQL and Postgres.</p>
<h3 id="katib-mysql">Katib MySQL</h3>
<p>For the <a href="https://github.com/kubeflow/katib/blob/master/manifests/v1beta1/components/mysql/mysql.yaml">Katib MySQL</a>
you need to set these environment variables:</p>
<ul>
<li><code>MYSQL_ROOT_PASSWORD</code> to a value from <a href="https://github.com/kubeflow/katib/blob/master/manifests/v1beta1/components/mysql/secret.yaml">katib-mysql-secrets</a>,
which is equal to &ldquo;test&rdquo;.</li>
<li><code>MYSQL_ALLOW_EMPTY_PASSWORD</code> as <code>true</code></li>
<li><code>MYSQL_DATABASE</code> as <code>katib</code>.</li>
</ul>
<p>You can refer to the list of
<a href="https://github.com/docker-library/docs/tree/master/mysql#environment-variables">all environment variables</a>
for the MySQL Docker image.</p>
<p>Katib MySQL environment variables must be matched with the Katib DB Manager environment variables, it means:</p>
<ol>
<li><code>MYSQL_ROOT_PASSWORD</code> = <code>DB_PASSWORD</code></li>
<li><code>MYSQL_DATABASE</code> = <code>KATIB_MYSQL_DB_DATABASE</code></li>
</ol>
<h3 id="katib-postgres">Katib Postgres</h3>
<p>For the <a href="https://github.com/kubeflow/katib/blob/master/manifests/v1beta1/components/postgres/postgres.yaml">Katib Postgres</a>
you need to set these environment variables:</p>
<ul>
<li><code>POSTGRES_USER</code>, <code>POSTGRES_PASSWORD</code> and <code>POSTGRES_DB</code> to a value from <a href="https://github.com/kubeflow/katib/blob/master/manifests/v1beta1/components/postgres/secret.yaml">katib-postgres-secrets</a>,
which are equal to &ldquo;katib&rdquo;.</li>
</ul>
<p>You can refer to the list of
<a href="https://github.com/docker-library/docs/blob/master/postgres/README.md#environment-variables">all environment variables</a>
for the Postgres Docker image.</p>
<p>Katib Postgres environment variables must be matched with the Katib DB Manager environment variables, it means:</p>
<ol>
<li><code>POSTGRES_USER</code> = <code>DB_USER</code></li>
<li><code>POSTGRES_PASSWORD</code> = <code>DB_PASSWORD</code></li>
<li><code>POSTGRES_DB</code> = <code>KATIB_POSTGRESQL_DB_DATABASE</code></li>
</ol>

</div>



    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark pt-3 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Kubeflow mailing list" aria-label="Kubeflow mailing list">
    <a class="text-white" target="_blank" rel="noopener" href="https://www.kubeflow.org/docs/about/community/#kubeflow-mailing-list" aria-label="Kubeflow mailing list">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-white" target="_blank" rel="noopener" href="https://twitter.com/kubeflow" aria-label="Twitter">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Stack Overflow" aria-label="Stack Overflow">
    <a class="text-white" target="_blank" rel="noopener" href="https://stackoverflow.com/questions/tagged/kubeflow" aria-label="Stack Overflow">
      <i class="fab fa-stack-overflow"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/GoogleCloudPlatform/kubeflow-distribution" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-white" target="_blank" rel="noopener" href="https://www.kubeflow.org/docs/about/community/#kubeflow-slack" aria-label="Slack">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Kubeflow community calendar" aria-label="Kubeflow community calendar">
    <a class="text-white" target="_blank" rel="noopener" href="https://www.kubeflow.org/docs/about/community/#kubeflow-community-calendars" aria-label="Kubeflow community calendar">
      <i class="fa fa-calendar"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-5 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2022 Google | Documentation Distributed under CC BY 4.0</small>
        <p><small class="ml-1"><a href="https://policies.google.com/privacy" target="_blank" rel="noopener">Privacy Policy</a></small></p>
	
		<p class="mt-2"><a href="/kubeflow-docs/docs/about/">About</a></p>
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="/kubeflow-docs/js/main.min.301c0110334bec1b4445867d27dc7dd69b2df859154ccf252005508bc860cc5a.js" integrity="sha256-MBwBEDNL7BtERYZ9J9x91pst&#43;FkVTM8lIAVQi8hgzFo=" crossorigin="anonymous"></script>
<script src='/kubeflow-docs/js/tabpane-persist.js'></script>

  </body>
</html>
